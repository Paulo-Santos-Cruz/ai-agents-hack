<!DOCTYPE html>
<html lang="en">
   <head>
      <meta charset="UTF-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <title>Application Technical Profile</title>
      <!-- Google Fonts: Roboto and Material Symbols -->
      <link rel="preconnect" href="https://fonts.googleapis.com">
      <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
      <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
      <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" rel="stylesheet" />
      <!-- Mermaid.js for diagram rendering -->
      <script src="https://cdn.jsdelivr.net/npm/mermaid@11.8.1/dist/mermaid.min.js"></script>
      <script>
         // Simple immediate check for Mermaid availability
         window.addEventListener('load', function() {
            if (typeof mermaid === 'undefined') {
               console.error('Mermaid library failed to load');
            } else {
               console.log('Mermaid library loaded successfully', mermaid.version || 'version unknown');
            }
         });
      </script>
      
      <!-- Critical stylesheet for Material Icons -->
      <style id="material-icons-critical">
         /* Ensure proper icon rendering and prevent emoji conversion */
         .material-symbols-outlined,
         .icon,
         [class*="icon"] {
            font-family: 'Material Symbols Outlined', sans-serif !important;
            font-weight: normal !important;
            font-style: normal !important;
            line-height: 1 !important;
            text-transform: none !important;
            letter-spacing: normal !important;
            word-wrap: normal !important;
            white-space: nowrap !important;
            direction: ltr !important;
            font-feature-settings: 'liga' !important;
            -webkit-font-feature-settings: 'liga' !important;
            -webkit-font-smoothing: antialiased !important;
            font-variant-emoji: text !important;
            text-rendering: optimizeLegibility !important;
            font-size: 20px !important;
            display: inline-flex !important;
            align-items: center !important;
            justify-content: center !important;
         }
         
         /* Specifically target table content icons that might get corrupted during pagination */
         tbody .material-symbols-outlined,
         tbody .icon,
         tbody td .material-symbols-outlined,
         tbody td .icon {
            font-family: 'Material Symbols Outlined', sans-serif !important;
            font-variant-emoji: text !important;
            text-rendering: optimizeLegibility !important;
         }
         
         /* Specifically target pagination icons */
         .pagination-button .material-symbols-outlined,
         .pagination-button .icon {
            font-family: 'Material Symbols Outlined', sans-serif !important;
            font-variant-emoji: text !important;
            font-size: 20px !important;
         }
      </style>
      
      <!-- Table styling and pagination styles -->
      <style>
         /* Common styles */
         * {
            box-sizing: border-box;
         }
         
         body {
            font-family: 'Roboto', sans-serif;
            line-height: 1.5;
            color: #333;
            margin: 0;
            padding: 0;
         }
         
         /* Table container */
         .table-container {
            width: 100%;
            overflow-x: auto;
            margin-bottom: 2rem;
         }
         
         /* Table pagination styles */
         .table-pagination {
            margin-top: 12px;
         }
         
         .pagination-top-controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
         }
         
         .page-size-selector {
            display: flex;
            align-items: center;
         }
         
         .page-size-label {
            margin-right: 8px;
            font-size: 14px;
            color: #555;
            padding-left: 4px;
         }
         
         .page-size-select {
            padding: 4px 8px;
            border-radius: 4px;
            border: 1px solid #ccc;
            min-width: 60px;
         }
         
         .pagination-info {
            font-size: 14px;
            color: #555;
            padding: 4px 0;
            padding-right: 4px;
            text-align: right;
         }
         
         .pagination-nav {
            display: flex;
            justify-content: center;
            align-items: center;
            margin-top: 8px;
         }
         
         .pagination-nav-buttons,
         .pagination-next-buttons {
            display: flex;
            align-items: center;
            justify-content: center;
         }
         
         .pagination-page-numbers {
            display: flex;
            align-items: center;
            margin: 0 10px;
         }
         
         /* Pagination buttons */
         .pagination-button {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            min-width: 36px;
            height: 36px;
            padding: 4px 8px;
            margin: 0 3px;
            border: none;
            border-radius: 50%;
            background: transparent;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.15s ease;
            box-shadow: none;
            color: #5f6368;
            user-select: none;
            outline: none;
         }
         
         .pagination-button:hover:not(:disabled) {
            background-color: rgba(0, 0, 0, 0.04);
         }
         
         .pagination-button:disabled {
            opacity: 0.5;
            cursor: default;
            color: #bdc1c6;
            background: transparent;
         }
         
         .pagination-button.active {
            background-color: #0071ce;
            color: white;
            font-weight: 500;
         }
         
         .pagination-button.ellipsis {
            color: #5f6368;
            pointer-events: none;
         }
         
         /* Table grouping styles */
         .table-group-controls {
            margin-bottom: 16px;
            display: flex;
            flex-wrap: wrap;
            align-items: center;
            padding: 8px 12px;
            background-color: #f8f9fa;
            border-radius: 4px;
            border: 1px solid #e0e0e0;
            transition: background-color 0.2s ease, border-color 0.2s ease;
         }
         
         .group-title {
            margin-right: 16px;
            font-weight: 500;
            display: flex;
            align-items: center;
            color: #333;
            transition: color 0.2s ease;
         }
         
         .group-options {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
         }
         
         .group-option {
            padding: 6px 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            background-color: #fff;
            color: #333;
            cursor: pointer;
            transition: all 0.2s ease;
         }
         
         .group-option:hover:not(.active) {
            background-color: #f0f0f0;
         }
         
         .group-option.active {
            background-color: #0071ce;
            color: #fff;
            border: 1px solid #0071ce;
            font-weight: 500;
         }
         
         .group-header {
            background-color: #f5f7f9;
            transition: background-color 0.2s ease;
         }
         
         .group-header td {
            padding: 0 !important;
         }
         
         .group-header-content {
            display: flex;
            align-items: center;
            padding: 10px;
            background-color: #f5f7f9;
            border-radius: 4px;
            transition: background-color 0.2s ease;
         }
         
         .group-toggle {
            margin-right: 8px;
            color: #0071ce;
            transition: color 0.2s ease;
         }
         
         .group-header-title {
            font-weight: 500;
            color: #333;
            transition: color 0.2s ease;
         }
         
         .group-count {
            margin-left: 12px;
            font-size: 0.85em;
            color: #666;
            background-color: rgba(0, 113, 206, 0.1);
            padding: 2px 8px;
            border-radius: 12px;
            transition: all 0.2s ease;
         }
         
         .collapsed-row {
            display: none !important;
         }
         
         tr.first-in-group td {
            border-top: 1px solid #e0e0e0;
            transition: border-color 0.2s ease;
         }
         
         .group-header:hover {
            background-color: #eef1f5;
         }
         
         .group-tooltip {
            font-size: 0.75em;
            color: #666;
            margin-left: 8px;
            padding: 2px 6px;
            background: rgba(0, 113, 206, 0.08);
            border-radius: 4px;
            transition: all 0.2s ease;
         }

         /* Dark mode styles for table grouping */
         @media (prefers-color-scheme: dark) {
            body {
               background-color: #1a202c !important;
               color: #e2e8f0 !important;
            }
            
            .table-group-controls {
               background-color: #2d3748 !important;
               border: 1px solid #4a5568 !important;
               box-shadow: none !important;
            }
            
            .group-title {
               color: #cbd5e0 !important;
            }
            
            .group-option {
               background-color: #4a5568 !important;
               border: 1px solid #718096 !important;
               color: #e2e8f0 !important;
               box-shadow: none !important;
            }
            
            .group-option:hover:not(.active) {
               background-color: #718096 !important;
               border-color: #a0aec0 !important;
            }
            
            .group-option.active {
               background-color: #3182ce !important;
               color: #ffffff !important;
               border: 1px solid #3182ce !important;
               box-shadow: none !important;
            }
            
            .group-header {
               background-color: #2d3748 !important;
            }
            
            .group-header-content {
               background-color: #2d3748 !important;
            }
            
            .group-toggle {
               color: #4299e1 !important;
            }
            
            .group-header-title {
               color: #e2e8f0 !important;
            }
            
            .group-count {
               color: #cbd5e0 !important;
               background-color: rgba(66, 153, 225, 0.2) !important;
               border: none !important;
            }
            
            tr.first-in-group td {
               border-top: 1px solid #4a5568 !important;
            }
            
            .group-header:hover {
               background-color: #4a5568 !important;
            }
            
            .group-header:hover .group-header-content {
               background-color: #4a5568 !important;
            }
            
            .group-tooltip {
               color: #cbd5e0 !important;
               background: rgba(66, 153, 225, 0.15) !important;
               border: none !important;
            }
         }

         /* Force dark mode styles - Alternative approach */
         .dark-mode body,
         [data-theme="dark"] body {
            background-color: var(--background-main) !important;
            color: var(--text-primary) !important;
         }

         .dark-mode .footer-wordmark{
            color: var(--text-primary) !important;
         }

         .dark-mode .tab-link
         {
            color: var(--text-primary) !important;
            text-decoration: none !important;
            font-weight: 500 !important;
            transition: color 0.2s ease;
         }
         
         .dark-mode .table-group-controls,
         [data-theme="dark"] .table-group-controls {
            background-color: var(--background-main) !important;
            border: 1px solid var(--border-color) !important;
            box-shadow: none !important;
         }
         
         .dark-mode .group-title,
         [data-theme="dark"] .group-title {
            color: var(--text-primary) !important;
         }
         
         .dark-mode .group-option,
         [data-theme="dark"] .group-option {
            background-color: var(--border-color) !important;
            border: none !important;
            color: var(--text-primary) !important;
            box-shadow: none !important;
         }
         
         .dark-mode .group-option:hover:not(.active),
         [data-theme="dark"] .group-option:hover:not(.active) {
            background-color: var(--background-button) !important;
            border-color: none !important;
         }
         
         .dark-mode .group-option.active,
         [data-theme="dark"] .group-option.active {
            background-color: var(--product-accent) !important;
            color: var(--text-primary) !important;
            border: none !important;
            box-shadow: none !important;
         }

         .dark-mode .group-header-content{
            background-color: var(--background-main) !important;
         }

         .dark-mode .group-header-title
         {
            color: var(--text-primary) !important;
         }

         .dark-mode .group-tooltip{
            color: var(--text-primary) !important;
            background-color: var(--border-color) !important;
            border: none !important;
         }

         .dark-mode .group-count{
            background-color: rgba(0, 113, 206, 0.1) !important;
            border: none !important;
            color: rgb(0, 113, 206) !important;
         }

         .dark-mode .floating-toc-link:hover{
            background-color: var(--product-accent) !important;
         }


         .dark-mode .pagination-nav{
            background-color: var(--background-main) !important;          
            border: 1px solid var(--border-color) !important;
            box-shadow: none !important;
         }

         .dark-mode .pagination-button.page-number {
            color: var(--text-primary) !important;
         }

         .dark-mode .pagination-button.page-number.active {
            background-color: var(--product-accent) !important;
            color: var(--text-primary) !important;
            border: none !important;
            box-shadow: none !important;
         }

         .dark-mode .pagination-button.page-number:hover:not(.active) {
            background-color: var(--product-accent) !important;
            border-color: none !important;
            color: var(--text-primary) !important;
         }

         .dark-mode .pagination-button.next, .dark-mode .pagination-button.prev, .dark-mode .pagination-button.first, .dark-mode .pagination-button.last {
            background-color: var(--background-main) !important;
            border-color: none !important;
            color: var(--text-primary) !important;
         }

         /* Enhanced light mode styles for better contrast */
         @media (prefers-color-scheme: light) {
            .table-group-controls {
               background-color: #ffffff;
               border: 1px solid #e2e8f0;
               box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            }
            
            .group-option {
               background-color: #f8f9fa;
               border: 1px solid #d1d5db;
               color: #374151;
               box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05);
            }
            
            .group-option:hover:not(.active) {
               background-color: #e5e7eb;
               border-color: #9ca3af;
            }
            
            .group-option.active {
               background-color: #0071ce;
               color: #ffffff;
               border: 1px solid #0071ce;
               box-shadow: 0 2px 4px rgba(0, 113, 206, 0.2);
            }
            
            .group-count {
               background-color: rgba(0, 113, 206, 0.1);
               border: 1px solid rgba(0, 113, 206, 0.2);
            }
            
            .group-tooltip {
               background: rgba(0, 113, 206, 0.08);
               border: 1px solid rgba(0, 113, 206, 0.15);
            }
         }

         /* MERMAID DIAGRAM THEMING */
         .mermaid-container {
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
            overflow-x: auto;
            text-align: center;
            transition: background-color 0.3s ease, border-color 0.3s ease;
            
            /* Use CSS variables for consistent theming */
            background-color: var(--background-main);
            border: 1px solid var(--border-color);
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
         }

         .mermaid-container svg {
            max-width: 100%;
            height: auto;
            background-color: transparent !important;
         }

         /* Global font styling for all Mermaid diagrams */
         .mermaid-container svg text,
         .mermaid-container svg tspan,
         .mermaid-container svg .nodeLabel,
         .mermaid-container svg .edgeLabel,
         .mermaid-container svg .label,
         .mermaid-container svg .titleText {
            font-family: 'Roboto', 'Segoe UI', Arial, sans-serif !important;
            font-size: 14px !important;
         }

         /* Ensure text visibility in dark mode Mermaid diagrams */
         .dark-mode .mermaid-container svg text,
         [data-theme="dark"] .mermaid-container svg text {
            fill: var(--text-primary) !important;
         }

         .dark-mode .mermaid-container svg .node rect,
         [data-theme="dark"] .mermaid-container svg .node rect {
            stroke: var(--border-color) !important;
         }

         .dark-mode .mermaid-container svg .edgePath path,
         [data-theme="dark"] .mermaid-container svg .edgePath path {
            stroke: var(--border-color) !important;
         }

         /* Light mode Mermaid container */
         @media (prefers-color-scheme: light) {
            .mermaid-container {
               box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            }
         }

         /* Dark mode Mermaid container */
         @media (prefers-color-scheme: dark) {
            .mermaid-container {
               box-shadow: 0 2px 8px rgba(0, 0, 0, 0.5);
            }
         }

         /* Force dark mode Mermaid styling */
         .dark-mode .mermaid-container,
         [data-theme="dark"] .mermaid-container {
            background-color: var(--background-main) !important;
            border: 1px solid var(--border-color) !important;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.5) !important;
         }

         /* Force light mode Mermaid styling */
         .light-mode .mermaid-container,
         [data-theme="light"] .mermaid-container {
            background-color: var(--background-main) !important;
            border: 1px solid var(--border-color) !important;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1) !important;
         }

         /* GOOGLE-LIKE LOADING INDICATOR */
         .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(2px);
            z-index: 9999;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease, visibility 0.3s ease;
         }

         .loading-overlay.show {
            opacity: 1;
            visibility: visible;
         }

         .loading-dots {
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 16px;
         }

         .loading-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background-color: var(--background-button);
            margin: 0 3px;
            animation: pulse 1.5s ease-in-out infinite;
         }

         .loading-dot:nth-child(1) { animation-delay: 0s; }
         .loading-dot:nth-child(2) { animation-delay: 0.2s; }
         .loading-dot:nth-child(3) { animation-delay: 0.4s; }
         .loading-dot:nth-child(4) { animation-delay: 0.6s; }

         .loading-text {
            font-family: 'Roboto', sans-serif;
            font-size: 14px;
            color: var(--text-primary);
            margin-bottom: 8px;
            text-align: center;
         }

         .loading-progress {
            width: 200px;
            height: 4px;
            background-color: #e8eaed;
            border-radius: 2px;
            overflow: hidden;
            position: relative;
         }

         .loading-progress-bar {
            height: 100%;
            background-color:var(--background-button);
            border-radius: 2px;
            position: absolute;
            left: -100%;
            animation: progress 2s ease-in-out infinite;
         }

         /* Dark mode loading overlay */
         .dark-mode .loading-overlay,
         [data-theme="dark"] .loading-overlay {
            background-color: var(--background-main);
         }

         .dark-mode .loading-dot,
         [data-theme="dark"] .loading-dot {
            background-color: var(--background-button);
         }

         .dark-mode .loading-text,
         [data-theme="dark"] .loading-text {
            color: var(--text-primary);
         }

         .dark-mode .loading-progress,
         [data-theme="dark"] .loading-progress {
            background-color: var(--background-main);
         }

         .dark-mode .loading-progress-bar,
         [data-theme="dark"] .loading-progress-bar {
            background-color: var(--background-button);
         }

         /* Animations */
         @keyframes pulse {
            0%, 20% { 
               transform: scale(1); 
               opacity: 1; 
            }
            50% { 
               transform: scale(1.3); 
               opacity: 0.7; 
            }
            80%, 100% { 
               transform: scale(1); 
               opacity: 1; 
            }
         }

         @keyframes progress {
            0% {
               left: -100%;
               width: 0%;
            }
            50% {
               left: 0%;
               width: 100%;
            }
            100% {
               left: 100%;
               width: 0%;
            }
         }

         /* Loading indicator for specific sections */
         .section-loading {
            position: relative;
         }

         .section-loading::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(1px);
            z-index: 100;
            display: flex;
            justify-content: center;
            align-items: center;
         }

         .dark-mode .section-loading::after,
         [data-theme="dark"] .section-loading::after {
            background-color: rgba(26, 32, 44, 0.8);
         }
      </style>
     
      <!-- Table sorting and grouping functionality -->
      <script>
         // --- MERMAID DIAGRAM RENDERING ---
         
         // Loading indicator management
         let loadingTasks = new Set();
         
         function showLoading(message = 'Loading...', taskId = 'default') {
             const overlay = document.getElementById('loadingOverlay');
             const loadingText = document.getElementById('loadingText');
             
             if (overlay && loadingText) {
                 loadingTasks.add(taskId);
                 loadingText.textContent = message;
                 overlay.classList.add('show');
                 console.log(`Loading started: ${message} (task: ${taskId})`);
             }
         }
         
         function hideLoading(taskId = 'default') {
             loadingTasks.delete(taskId);
             console.log(`Loading task completed: ${taskId}, ${loadingTasks.size} tasks remaining`);
             
             // Only hide if no other tasks are running
             if (loadingTasks.size === 0) {
                 const overlay = document.getElementById('loadingOverlay');
                 if (overlay) {
                     // Add a small delay to prevent flicker for quick operations
                     setTimeout(() => {
                         // Double-check that no new tasks were added during the delay
                         if (loadingTasks.size === 0) {
                             overlay.classList.remove('show');
                             console.log(`All loading tasks completed - hiding overlay`);
                         }
                     }, 100); // Reduced delay from 300ms to 100ms
                 }
             }
         }
         
         function updateLoadingMessage(message, taskId = 'default') {
             if (loadingTasks.has(taskId)) {
                 const loadingText = document.getElementById('loadingText');
                 if (loadingText) {
                     loadingText.textContent = message;
                 }
             }
         }

         function initializeMermaidRendering() {
             showLoading('Initializing diagram renderer...', 'mermaid-init');
             
             try {
                 // Detect current theme
                 const isDarkMode = document.documentElement.classList.contains('dark-mode') || 
                                   document.documentElement.getAttribute('data-theme') === 'dark' ||
                                   window.matchMedia('(prefers-color-scheme: dark)').matches;
                 
                 // Get theme-specific configuration
                 const themeConfig = getMermaidThemeConfig(isDarkMode);
                 
                 updateLoadingMessage('Configuring diagram themes...', 'mermaid-init');
                 
                 // Configure Mermaid with comprehensive theme settings
                 mermaid.initialize({
                     startOnLoad: false, // Important! We manually control the rendering
                     securityLevel: 'loose', // Allow all diagram features
                     htmlLabels: true, // Enable HTML labels for better text rendering
                     theme: themeConfig.theme,
                     themeVariables: themeConfig.themeVariables,
                     flowchart: {
                         useMaxWidth: true,
                         htmlLabels: true,
                         curve: 'basis'
                     },
                     sequence: {
                         useMaxWidth: true,
                         wrap: true
                     },
                     class: {
                         useMaxWidth: true
                     },
                     state: {
                         useMaxWidth: true
                     },
                     er: {
                         useMaxWidth: true
                     },
                     journey: {
                         useMaxWidth: true
                     },
                     gantt: {
                         useMaxWidth: true
                     },
                     pie: {
                         useMaxWidth: true
                     },
                     // Simplified configuration - remove complex settings that might cause issues
                     logLevel: 'error',
                     suppressErrorRendering: false
                 });
                 console.log(`Mermaid initialized successfully with ${isDarkMode ? 'dark' : 'light'} theme`);
                 hideLoading('mermaid-init');
             } catch (error) {
                 console.error('Error initializing Mermaid:', error);
                 hideLoading('mermaid-init');
             }
         }

         // Get comprehensive theme configuration for Mermaid
         function getMermaidThemeConfig(isDarkMode) {
             // Get CSS variables from the document
             const rootStyles = getComputedStyle(document.documentElement);
             const backgroundMain = rootStyles.getPropertyValue('--background-main').trim();
             const textPrimary = rootStyles.getPropertyValue('--text-primary').trim();
             const textSecondary = rootStyles.getPropertyValue('--text-secondary').trim();
             const borderColor = rootStyles.getPropertyValue('--border-color').trim();
             const backgroundCard = rootStyles.getPropertyValue('--background-card').trim();
             const backgroundHover = rootStyles.getPropertyValue('--background-hover').trim();
             const productAccent = rootStyles.getPropertyValue('--product-accent').trim();
             
             if (isDarkMode) {
                 return {
                     theme: 'dark',
                     themeVariables: {
                         // Core theme colors using CSS variables
                         darkMode: true,
                         background: backgroundMain,
                         primaryColor: productAccent, // Use the accent color for primary elements
                         primaryTextColor: textPrimary,
                         primaryBorderColor: borderColor,
                         lineColor: borderColor,
                         
                         // Font configuration
                         fontFamily: "'Roboto', 'Segoe UI', Arial, sans-serif",
                         fontSize: '14px',
                         
                         // Secondary colors
                         secondaryColor: backgroundCard,
                         tertiaryColor: backgroundHover,
                         
                         // Text colors - all using CSS variables
                         textColor: textPrimary,
                         darkTextColor: textPrimary,
                         mainBkg: backgroundCard,
                         secondBkg: backgroundHover,
                         tertiaryBkg: backgroundMain,
                         
                         // Node and connector styling
                         nodeBkg: backgroundCard,
                         nodeBorder: borderColor,
                         clusterBkg: backgroundMain,
                         clusterBorder: borderColor,
                         defaultLinkColor: productAccent,
                         titleColor: textPrimary,
                         edgeLabelBackground: backgroundMain,
                         
                         // Specific diagram type colors
                         actorBorder: borderColor,
                         actorBkg: backgroundCard,
                         actorTextColor: textPrimary,
                         actorLineColor: borderColor,
                         signalColor: textPrimary,
                         signalTextColor: textPrimary,
                         
                         // Flowchart colors - readable and distinguishable
                         fillType0: '#4285f4', // Blue - good contrast in dark mode
                         fillType1: '#81c995', // Light green
                         fillType2: '#fdd663', // Yellow
                         fillType3: '#f28b82', // Light red
                         fillType4: '#ce93d8', // Light purple
                         fillType5: '#ffab91', // Light orange
                         fillType6: '#80deea', // Light cyan
                         fillType7: '#a5d6a7', // Another green shade
                         
                         // Class diagram colors
                         classText: textPrimary,
                         
                         // State diagram colors
                         labelColor: textPrimary,
                         altBackground: backgroundCard,
                         
                         // ER diagram colors
                         entityBkg: backgroundCard,
                         entityTextColor: textPrimary,
                         relationLabelColor: textPrimary,
                         
                         // Journey diagram colors
                         taskBkgColor: backgroundCard,
                         taskTextColor: textPrimary,
                         activeTaskBkgColor: productAccent,
                         activeTaskBorderColor: borderColor,
                         gridColor: borderColor,
                         section0: '#4285f4',
                         section1: '#81c995',
                         section2: '#fdd663',
                         section3: '#f28b82'
                     }
                 };
             } else {
                 return {
                     theme: 'default',
                     themeVariables: {
                         // Core theme colors using CSS variables
                         background: backgroundMain,
                         primaryColor: productAccent,
                         primaryTextColor: textPrimary,
                         primaryBorderColor: borderColor,
                         lineColor: borderColor,
                         
                         // Font configuration
                         fontFamily: "'Roboto', 'Segoe UI', Arial, sans-serif",
                         fontSize: '14px',
                         
                         // Secondary colors
                         secondaryColor: backgroundCard,
                         tertiaryColor: backgroundHover,
                         
                         // Text colors - all using CSS variables
                         textColor: textPrimary,
                         darkTextColor: textPrimary,
                         mainBkg: backgroundCard,
                         secondBkg: backgroundHover,
                         tertiaryBkg: backgroundMain,
                         
                         // Node and connector styling
                         nodeBkg: backgroundCard,
                         nodeBorder: borderColor,
                         clusterBkg: backgroundMain,
                         clusterBorder: borderColor,
                         defaultLinkColor: productAccent,
                         titleColor: textPrimary,
                         edgeLabelBackground: backgroundMain,
                         
                         // Specific diagram type colors
                         actorBorder: borderColor,
                         actorBkg: backgroundCard,
                         actorTextColor: textPrimary,
                         actorLineColor: borderColor,
                         signalColor: textPrimary,
                         signalTextColor: textPrimary,
                         
                         // Flowchart colors - readable in light mode
                         fillType0: '#0071ce', // Primary blue
                         fillType1: '#1e8e3e', // Green
                         fillType2: '#f9ab00', // Amber/Yellow
                         fillType3: '#d93025', // Red
                         fillType4: '#9c27b0', // Purple
                         fillType5: '#ff5722', // Deep orange
                         fillType6: '#00acc1', // Cyan
                         fillType7: '#689f38', // Light green
                         
                         // Class diagram colors
                         classText: textPrimary,
                         
                         // State diagram colors
                         labelColor: textPrimary,
                         altBackground: backgroundCard,
                         
                         // ER diagram colors
                         entityBkg: backgroundCard,
                         entityTextColor: textPrimary,
                         relationLabelColor: textPrimary,
                         
                         // Journey diagram colors
                         taskBkgColor: backgroundCard,
                         taskTextColor: textPrimary,
                         activeTaskBkgColor: productAccent,
                         activeTaskBorderColor: borderColor,
                         gridColor: borderColor,
                         section0: '#0071ce',
                         section1: '#1e8e3e',
                         section2: '#f9ab00',
                         section3: '#d93025'
                     }
                 };
             }
         }

         function renderMermaidDiagrams() {
             // Find all mermaid code blocks - be more specific in the selector
             const mermaidBlocks = document.querySelectorAll('pre.mermaid');
             
             if (mermaidBlocks.length === 0) {
                 console.log('No Mermaid diagrams found to render');
                 return;
             }
             
             showLoading(`Preparing ${mermaidBlocks.length} diagram${mermaidBlocks.length > 1 ? 's' : ''}...`, 'mermaid-render');
             console.log(`Found ${mermaidBlocks.length} Mermaid diagrams to render`);
             
             let processedCount = 0;
             let successCount = 0;
             let errorCount = 0;
             
             const updateProgress = () => {
                 processedCount++;
                 updateLoadingMessage(
                     `Rendering diagrams... ${processedCount}/${mermaidBlocks.length} (${successCount} successful, ${errorCount} errors)`,
                     'mermaid-render'
                 );
                 
                 // Hide loading when all diagrams are processed
                 if (processedCount >= mermaidBlocks.length) {
                     clearTimeout(maxTimeout); // Clear the fallback timeout
                     setTimeout(() => {
                         hideLoading('mermaid-render');
                     }, 200); // Small delay to show completion message
                 }
             };
             
             // Set a maximum timeout to ensure loading doesn't hang indefinitely
             const maxTimeout = setTimeout(() => {
                 console.warn('Forcing loading to complete after maximum timeout');
                 hideLoading('mermaid-render');
             }, 30000); // 30 second maximum timeout
             
             mermaidBlocks.forEach((preBlock, index) => {
                 try {
                     // Skip if already processed
                     if (preBlock.classList.contains('mermaid-processed')) {
                         console.log(`Skipping diagram ${index + 1} - already processed`);
                         updateProgress(); // Still count this as processed
                         return;
                     }
                     
                     // Check if there's already a rendered container
                     const existingContainer = preBlock.nextElementSibling?.classList.contains('mermaid-container') ||
                                             preBlock.previousElementSibling?.classList.contains('mermaid-container');
                     if (existingContainer) {
                         console.log(`Skipping diagram ${index + 1} - container already exists`);
                         updateProgress(); // Still count this as processed
                         return;
                     }
                     
                     // Get the code element inside the pre block
                     const codeElement = preBlock.querySelector('code');
                     if (!codeElement) {
                         console.warn(`No code element found in mermaid block ${index + 1}`);
                         errorCount++;
                         updateProgress();
                         return;
                     }
                     
                     // Get the mermaid code content from the code element
                     let mermaidCode = codeElement.textContent || codeElement.innerText;
                     
                     // Skip if empty
                     if (!mermaidCode.trim()) {
                         console.warn(`Empty mermaid code in block ${index + 1}`);
                         errorCount++;
                         updateProgress();
                         return;
                     }
                     
                     // Clean up the code
                     mermaidCode = mermaidCode.trim();
                     
                     // Debug: Log the first few lines of the code to verify content
                     const firstLines = mermaidCode.split('\n').slice(0, 3).join('\n');
                     console.log(`Diagram ${index + 1} content preview:`, firstLines);
                     
                     // Validate this is actually Mermaid syntax, not CSS or other content
                     if (mermaidCode.includes('font-family:') || mermaidCode.includes('keyframes') || mermaidCode.includes('.mermaid-')) {
                         console.error(`Block ${index + 1} contains CSS instead of Mermaid syntax, skipping`);
                         errorCount++;
                         updateProgress();
                         return;
                     }
                     
                     // Validate and fix common syntax issues
                     mermaidCode = validateAndFixMermaidSyntax(mermaidCode);
                     
                     // Detect diagram type for specific handling
                     const diagramType = detectDiagramType(mermaidCode);
                     console.log(`Rendering ${diagramType} diagram ${index + 1}`);
                     
                     // Create a unique ID for this diagram
                     const diagramId = `mermaid-diagram-${index}-${Date.now()}`;
                     
                     // Create container for the rendered diagram with enhanced styling
                     const container = document.createElement('div');
                     container.id = diagramId;
                     container.className = 'mermaid-container';
                     
                     // Apply CSS variable-based styling that adapts to theme
                     const isDarkMode = document.documentElement.classList.contains('dark-mode') || 
                                       document.documentElement.getAttribute('data-theme') === 'dark' ||
                                       window.matchMedia('(prefers-color-scheme: dark)').matches;
                     
                     // Use CSS variables for consistent theming
                     container.style.cssText = `
                         text-align: center;
                         margin: 20px 0;
                         padding: 20px;
                         border: 1px solid var(--border-color);
                         border-radius: 8px;
                         background-color: var(--background-main);
                         box-shadow: ${isDarkMode ? '0 2px 8px rgba(0, 0, 0, 0.5)' : '0 2px 4px rgba(0, 0, 0, 0.1)'};
                         overflow-x: auto;
                         transition: background-color 0.3s ease, border-color 0.3s ease;
                     `;
                     
                     // Insert the container after the pre block
                     preBlock.parentNode.insertBefore(container, preBlock.nextSibling);
                     preBlock.style.display = 'none'; // Hide original but keep for reference
                     
                     // Add timeout to prevent hanging
                     const renderTimeout = setTimeout(() => {
                         console.error(`Rendering timeout for ${diagramType} diagram ${index + 1}`);
                         container.innerHTML = `
                             <div style="color: #ff6b35; padding: 20px; text-align: center;">
                                 <strong>Rendering timeout for ${diagramType} diagram</strong><br>
                                 <small>The diagram took too long to render</small>
                             </div>
                         `;
                         errorCount++;
                         updateProgress();
                     }, 10000); // 10 second timeout
                     
                     // Render the diagram
                     mermaid.render(diagramId + '-svg', mermaidCode)
                         .then(({ svg, bindFunctions }) => {
                             clearTimeout(renderTimeout);
                             container.innerHTML = svg;
                             
                             // Apply bind functions if they exist (for interactive elements)
                             if (bindFunctions) {
                                 try {
                                     bindFunctions(container);
                                 } catch (bindError) {
                                     console.warn('Error applying bind functions:', bindError);
                                 }
                             }
                             
                             // Mark as processed
                             preBlock.classList.add('mermaid-processed');
                             
                             // Add diagram type as data attribute
                             container.setAttribute('data-diagram-type', diagramType);
                             
                             console.log(`Successfully rendered ${diagramType} diagram ${index + 1}`);
                             successCount++;
                             updateProgress();
                         })
                         .catch(error => {
                             clearTimeout(renderTimeout);
                             console.error(`Error rendering ${diagramType} diagram ${index + 1}:`, error);
                             
                             // Show detailed error information
                             const errorDetails = error.message || 'Unknown error occurred';
                             const codePreview = mermaidCode.length > 200 ? 
                                 mermaidCode.substring(0, 200) + '...' : 
                                 mermaidCode;
                             
                             container.innerHTML = `
                                 <div style="color: #d32f2f; padding: 20px; text-align: center; border: 1px solid #d32f2f; border-radius: 4px; background-color: #ffebee;">
                                     <strong>Error rendering ${diagramType} diagram:</strong><br>
                                     <small>${errorDetails}</small><br>
                                     <details style="margin-top: 10px;">
                                         <summary>Show diagram code</summary>
                                         <pre style="text-align: left; background: #f5f5f5; padding: 10px; margin-top: 10px; border-radius: 4px; white-space: pre-wrap; word-wrap: break-word;">${codePreview}</pre>
                                     </details>
                                 </div>
                             `;
                             errorCount++;
                             updateProgress();
                         });
                         
                 } catch (error) {
                     console.error(`Error processing Mermaid block ${index + 1}:`, error);
                     errorCount++;
                     updateProgress();
                 }
             });
             
             // Fallback: if no diagrams were found or processed, hide loading immediately
             if (mermaidBlocks.length === 0) {
                 console.log('No Mermaid diagrams found');
                 clearTimeout(maxTimeout);
                 hideLoading('mermaid-render');
             }
         }

         function detectDiagramType(code) {
             const trimmedCode = code.trim().toLowerCase();
             
             if (trimmedCode.startsWith('graph') || trimmedCode.startsWith('flowchart')) return 'flowchart';
             if (trimmedCode.startsWith('sequencediagram')) return 'sequence';
             if (trimmedCode.startsWith('classdiagram')) return 'class';
             if (trimmedCode.startsWith('statediagram')) return 'state';
             if (trimmedCode.startsWith('erdiagram')) return 'er';
             if (trimmedCode.startsWith('journey')) return 'user-journey';
             if (trimmedCode.startsWith('gantt')) return 'gantt';
             if (trimmedCode.startsWith('pie')) return 'pie';
             if (trimmedCode.startsWith('gitgraph')) return 'gitgraph';
             if (trimmedCode.startsWith('mindmap')) return 'mindmap';
             if (trimmedCode.startsWith('timeline')) return 'timeline';
             if (trimmedCode.startsWith('quadrantchart')) return 'quadrant';
             if (trimmedCode.startsWith('xychart')) return 'xy';
             if (trimmedCode.startsWith('block')) return 'block';
             if (trimmedCode.startsWith('packet')) return 'packet';
             if (trimmedCode.startsWith('tree')) return 'tree';
             
             return 'unknown';
         }

         function validateAndFixMermaidSyntax(code) {
             let fixedCode = code.trim();
             
             // Remove any HTML entities that might cause issues
             fixedCode = fixedCode
                 .replace(/&amp;/g, '&')
                 .replace(/&lt;/g, '<')
                 .replace(/&gt;/g, '>')
                 .replace(/&#39;/g, "'")
                 .replace(/&quot;/g, '"');
             
             return fixedCode;
         }

         // Update Mermaid theme (used for theme switching)
         function updateMermaidTheme() {
             showLoading('Updating diagram themes...', 'theme-update');
             
             try {
                 // Re-initialize Mermaid with new theme
                 initializeMermaidRendering();
                 
                 // Re-render all diagrams
                 const processedDiagrams = document.querySelectorAll('.mermaid-processed');
                 if (processedDiagrams.length > 0) {
                     updateLoadingMessage('Re-rendering diagrams with new theme...', 'theme-update');
                     
                     // Reset processed state
                     processedDiagrams.forEach(diagram => {
                         diagram.classList.remove('mermaid-processed');
                     });
                     
                     // Remove existing rendered containers
                     const containers = document.querySelectorAll('.mermaid-container');
                     containers.forEach(container => container.remove());
                     
                     // Show original code blocks
                     const hiddenBlocks = document.querySelectorAll('pre.mermaid[style*="display: none"]');
                     hiddenBlocks.forEach(block => {
                         block.style.display = '';
                     });
                     
                     // Re-render
                     renderMermaidDiagrams();
                 }
                 
                 hideLoading('theme-update');
             } catch (error) {
                 console.error('Error updating Mermaid theme:', error);
                 hideLoading('theme-update');
             }
         }
      </script>
   </head>
   <body>
      <!-- Google-like Loading Overlay -->
      <div id="loadingOverlay" class="loading-overlay">
         <div class="loading-dots">
            <div class="loading-dot"></div>
            <div class="loading-dot"></div>
            <div class="loading-dot"></div>
            <div class="loading-dot"></div>
         </div>
         <div class="loading-text" id="loadingText">Loading...</div>
         <div class="loading-progress">
            <div class="loading-progress-bar"></div>
         </div>
      </div>

      <script>
         document.addEventListener('DOMContentLoaded', function() {
            showLoading('Initializing application...', 'app-init');
            
            // Apply dark mode detection and styling
            updateLoadingMessage('Applying theme settings...', 'app-init');
            applyThemeDetection();
            
            // Initialize Mermaid diagrams
            if (typeof mermaid !== 'undefined') {
               updateLoadingMessage('Setting up diagram renderer...', 'app-init');
               console.log('Initializing Mermaid diagrams...');
               initializeMermaidRendering();
               renderMermaidDiagrams();
            } else {
               console.warn('Mermaid library not loaded');
            }
            
            // Add sorting capability to all tables
            updateLoadingMessage('Preparing interactive tables...', 'app-init');
            makeTablesSortable();
            
            // Add grouping capability to tables with specific columns
            makeTablesGroupable();
            
            // Add pagination to all tables
            makeTablesPaginated();
            
            hideLoading('app-init');
         });
         
         function applyThemeDetection() {
            // Function to apply dark mode
            function applyDarkMode() {
               document.body.classList.add('dark-mode');
               document.documentElement.setAttribute('data-theme', 'dark');
               console.log('Dark mode applied');
               
               // Update Mermaid diagrams theme
               if (typeof updateMermaidTheme === 'function') {
                  setTimeout(updateMermaidTheme, 100);
               }
            }
            
            // Function to apply light mode
            function applyLightMode() {
               document.body.classList.remove('dark-mode');
               document.documentElement.setAttribute('data-theme', 'light');
               console.log('Light mode applied');
               
               // Update Mermaid diagrams theme
               if (typeof updateMermaidTheme === 'function') {
                  setTimeout(updateMermaidTheme, 100);
               }
            }
            
            // Check for dark mode preference
            if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
               applyDarkMode();
            } else {
               applyLightMode();
            }
            
            // Listen for changes in color scheme preference
            if (window.matchMedia) {
               const mediaQuery = window.matchMedia('(prefers-color-scheme: dark)');
               mediaQuery.addEventListener('change', function(e) {
                  showLoading('Switching theme...', 'theme-switch');
                  
                  if (e.matches) {
                     updateLoadingMessage('Applying dark theme...', 'theme-switch');
                     applyDarkMode();
                  } else {
                     updateLoadingMessage('Applying light theme...', 'theme-switch');
                     applyLightMode();
                  }
                  
                  // Update Mermaid diagrams with new theme
                  if (typeof updateMermaidTheme === 'function') {
                     updateMermaidTheme();
                  }
                  
                  hideLoading('theme-switch');
               });
            }
         }
         
         function makeTablesPaginated() {
            const tables = document.querySelectorAll('.table-container table');
            const defaultPageSize = 20;
            
            tables.forEach((table) => {
                // Skip tables that shouldn't be paginated
                if (table.classList.contains('no-pagination')) {
                    return;
                }
                
                // Mark table as paginated
                table.setAttribute('data-paginated', 'true');
                table.setAttribute('data-page-size', String(defaultPageSize));
                table.setAttribute('data-current-page', '1');
                
                // Ensure the table has necessary DOM structure
                let tbody = table.querySelector('tbody');
                if (!tbody) {
                    tbody = document.createElement('tbody');
                    
                    // Move all rows that aren't in thead to tbody
                    const rows = Array.from(table.querySelectorAll('tr'));
                    const theadRows = Array.from(table.querySelectorAll('thead tr'));
                    
                    rows.forEach(row => {
                        if (!theadRows.includes(row)) {
                            tbody.appendChild(row);
                        }
                    });
                    
                    table.appendChild(tbody);
                }
                
                // Store the original table data for pagination
                storeTableData(table);
                
                // Add pagination controls
                addPaginationControls(table);
                
                // Initial pagination
                paginateTable(table);
            });
         }
         
         function storeTableData(table) {
            // Store original rows for pagination
            const tbody = table.querySelector('tbody');
            if (!tbody) {
                return;
            }
            
            // Get all rows, including potential group headers
            const rows = Array.from(tbody.querySelectorAll('tr'));
            
            // Function to preserve icon data before storing
            const preserveIconData = (element) => {
                if (!element) return;
                
                const icons = element.querySelectorAll('.icon, .material-symbols-outlined, [class*="icon"]');
                icons.forEach((icon, index) => {
                    // Store the original icon text as a data attribute
                    const iconText = icon.textContent.trim();
                    if (iconText) {
                        icon.setAttribute('data-original-icon-text', iconText);
                        icon.setAttribute('data-icon-index', String(index));
                    }
                    
                    // Ensure proper classes and styling
                    if (!icon.classList.contains('material-symbols-outlined')) {
                        icon.classList.add('material-symbols-outlined');
                    }
                });
            };
            
            // Check if we're dealing with grouped data
            const hasGroups = rows.some(row => row.classList.contains('group-header'));
            
            // Clear previous pagination data to prevent stale data issues
            if (table._paginationGroupData) delete table._paginationGroupData;
            if (table._paginationData) delete table._paginationData;
            
            if (hasGroups) {
                // For grouped tables, we store the data differently
                const groupData = [];
                let currentGroup = null;
                let currentRows = [];
                
                rows.forEach(row => {
                    if (row.classList.contains('group-header')) {
                        // If we have a previous group, store it
                        if (currentGroup) {
                            groupData.push({
                                header: currentGroup,
                                rows: currentRows
                            });
                        }
                        // Start a new group
                        currentGroup = row;
                        currentRows = [];
                    } else {
                        // Add row to current group
                        currentRows.push(row);
                    }
                });
                
                // Don't forget to add the last group
                if (currentGroup) {
                    groupData.push({
                        header: currentGroup,
                        rows: currentRows
                    });
                }
                
                // Preserve icon data for all grouped elements
                groupData.forEach(group => {
                    preserveIconData(group.header);
                    group.rows.forEach(row => {
                        preserveIconData(row);
                    });
                });
                
                // Store the grouped data
                table._paginationGroupData = groupData;
            } else {
                // For regular tables, filter out any potential group headers just to be safe
                const dataRows = rows.filter(row => !row.classList.contains('group-header'));
                
                // Preserve icon data for all rows
                dataRows.forEach(row => {
                    preserveIconData(row);
                });
                
                table._paginationData = dataRows;
            }
         }
         
         function addPaginationControls(table) {
            const tableContainer = table.closest('.table-container');
            if (!tableContainer) return;
            
            // Create pagination container
            const paginationContainer = document.createElement('div');
            paginationContainer.className = 'table-pagination';
            
            // Top controls with page size selector
            const topControls = document.createElement('div');
            topControls.className = 'pagination-top-controls';
            
            const pageSizeSelector = document.createElement('div');
            pageSizeSelector.className = 'page-size-selector';
            
            // Get current page size from table attribute
            const currentPageSize = parseInt(table.getAttribute('data-page-size') || '20', 10);
            
            // Create the page size selector with the current value selected
            pageSizeSelector.innerHTML = `
                <span class="page-size-label">Items per page</span>
                <select class="page-size-select">
                    <option value="5" ${currentPageSize === 5 ? 'selected' : ''}>5</option>
                    <option value="10" ${currentPageSize === 10 ? 'selected' : ''}>10</option>
                    <option value="20" ${currentPageSize === 20 ? 'selected' : ''}>20</option>
                    <option value="50" ${currentPageSize === 50 ? 'selected' : ''}>50</option>
                    <option value="100" ${currentPageSize === 100 ? 'selected' : ''}>100</option>
                </select>
            `;
            
            // Add event listener for page size change
            const pageSizeSelect = pageSizeSelector.querySelector('.page-size-select');
            pageSizeSelect.addEventListener('change', function() {
                const newPageSize = parseInt(this.value);
                
                console.log(`Page size change requested: ${newPageSize} (from ${table.getAttribute('data-page-size')})`);
                
                // DEBUG: Let's see what's currently visible before making changes
                const currentlyVisibleRows = table.querySelectorAll('tbody tr');
                console.log(`Currently visible rows: ${currentlyVisibleRows.length}`);
                currentlyVisibleRows.forEach((row, index) => {
                    const firstCell = row.querySelector('td');
                    if (firstCell) {
                        console.log(`Row ${index + 1}: ${firstCell.textContent.trim()}`);
                    }
                });
                
                // Calculate pagination values  
                const oldPageSize = parseInt(table.getAttribute('data-page-size')) || 20;
                const oldCurrentPage = parseInt(table.getAttribute('data-current-page')) || 1;
                
                // Get total rows first
                let totalRows = 0;
                if (table._paginationGroupData) {
                    table._paginationGroupData.forEach(group => totalRows += group.rows.length);
                } else if (table._paginationData) {
                    totalRows = table._paginationData.length;
                }
                
                console.log(`Total rows in data: ${totalRows}`);
                
                // Calculate which item we're currently starting with
                const currentFirstItem = (oldCurrentPage - 1) * oldPageSize + 1;
                const currentLastItem = Math.min(currentFirstItem + oldPageSize - 1, totalRows);
                console.log(`Current view: items ${currentFirstItem} to ${currentLastItem}`);
                
                // For page size changes, we want to show the same starting item
                // but limit to the new page size
                let newCurrentPage = Math.ceil(currentFirstItem / newPageSize);
                const newTotalPages = Math.max(1, Math.ceil(totalRows / newPageSize));
                newCurrentPage = Math.max(1, Math.min(newCurrentPage, newTotalPages));
                
                // Calculate how many items we should actually show
                const newFirstItem = (newCurrentPage - 1) * newPageSize + 1;
                const newLastItem = Math.min(newFirstItem + newPageSize - 1, totalRows);
                
                console.log(`Page size change: totalRows=${totalRows}, oldPage=${oldCurrentPage}/${Math.ceil(totalRows / oldPageSize)}, newPage=${newCurrentPage}/${newTotalPages}`);
                console.log(`New view should show: items ${newFirstItem} to ${newLastItem} (max ${newPageSize} items)`);
                
                // IMPORTANT: If we're changing to a smaller page size, we might need to show fewer items
                // to maintain the same starting point
                const visibleItemsCount = currentLastItem - currentFirstItem + 1;
                const expectedNewItemsCount = Math.min(newPageSize, visibleItemsCount);
                console.log(`Currently showing ${visibleItemsCount} items, new page size allows ${newPageSize}, should show ${expectedNewItemsCount}`);
                
                // If the current view has fewer items than the new page size,
                // we might need to adjust to show the same number of items
                if (visibleItemsCount < newPageSize) {
                    console.log(`Adjusting to show same number of items (${visibleItemsCount}) instead of full page size (${newPageSize})`);
                }
                
                // Set new values
                table.setAttribute('data-page-size', newPageSize);
                table.setAttribute('data-current-page', newCurrentPage);
                
                // Execute pagination immediately to see the result
                setTimeout(() => {
                    console.log('Executing pagination with new settings');
                    
                    paginateTable(table);
                    
                    // NOTE: Removed emoji replacement - let's preserve original content exactly
                    const newVisibleRows = table.querySelectorAll('tbody tr');
                    console.log(`After pagination - visible rows: ${newVisibleRows.length}`);
                    newVisibleRows.forEach((row, index) => {
                        const firstCell = row.querySelector('td');
                        if (firstCell) {
                            console.log(`New Row ${index + 1}: ${firstCell.textContent.trim()}`);
                        }
                    });
                }, 0);
            });
            
            // Pagination info (showing X-Y of Z)
            const paginationInfo = document.createElement('div');
            paginationInfo.className = 'pagination-info';
            
            topControls.appendChild(pageSizeSelector);
            topControls.appendChild(paginationInfo);
            
            // Pagination navigation
            const paginationNav = document.createElement('div');
            paginationNav.className = 'pagination-nav';
            
            // We'll populate the navigation in the updatePaginationControls function
            
            // Add all elements to the container
            paginationContainer.appendChild(topControls);
            paginationContainer.appendChild(paginationNav);
            
            // Add to the DOM after the table
            tableContainer.appendChild(paginationContainer);
            
            // Initial update of pagination controls
            updatePaginationControls(table);
         }
         
         function paginateTable(table) {
            // Make sure we have valid numeric values for page size and current page
            const pageSize = Math.max(1, parseInt(table.getAttribute('data-page-size') || '20', 10));
            let currentPage = Math.max(1, parseInt(table.getAttribute('data-current-page') || '1', 10));
            const tbody = table.querySelector('tbody');
            
            if (!tbody) {
                return;
            }
            
            // Calculate total rows and total pages to make sure current page is valid
            let totalRows = 0;
            
            // Check if we have pagination data at all
            if (!table._paginationGroupData && !table._paginationData) {
                try {
                    storeTableData(table);
                } catch (error) {
                    console.error('Error storing table data:', error);
                    return;
                }
            }
            
            // Ensure we're not dealing with stale grouped data when we should be in ungrouped mode
            // Check if the table has actual group headers in the DOM
            const hasRealGroupHeaders = tbody.querySelector('.group-header') !== null;
            
            // If we have grouped data in memory but no actual group headers in the DOM, 
            // we need to rebuild the pagination data for the ungrouped state
            if (table._paginationGroupData && !hasRealGroupHeaders) {
                delete table._paginationGroupData;
                storeTableData(table);
            }
            
            // Calculate total rows from whichever data structure we have
            if (table._paginationGroupData) {
                table._paginationGroupData.forEach(group => totalRows += group.rows.length);
            } else if (table._paginationData) {
                totalRows = table._paginationData.length;
            } else {
                // Emergency fallback - get what's in the DOM right now
                const visibleRows = tbody.querySelectorAll('tr:not(.group-header)').length;
                totalRows = visibleRows;
                if (totalRows === 0) return; // Nothing to do if no rows
            }
            
            // Ensure we have at least one page
            const totalPages = Math.max(1, Math.ceil(totalRows / pageSize));
            
            // Ensure current page is valid (between 1 and totalPages)
            currentPage = Math.max(1, Math.min(currentPage, totalPages));
            
            // Update the current page attribute if it was adjusted
            if (currentPage !== parseInt(table.getAttribute('data-current-page') || '1', 10)) {
                table.setAttribute('data-current-page', String(currentPage));
            }
            
            // Clear the table body first
            tbody.innerHTML = '';
            
            // SIMPLIFIED APPROACH: Use direct cloning and restore proper Material Icons
            const simpleCloneRow = (originalRow) => {
                if (!originalRow) return null;
                
                // Clone the row
                const cloned = originalRow.cloneNode(true);
                
                // Convert any emojis back to proper Material Icons
                const emojiToIconMap = {
                    '🔴': { iconName: 'cancel', classes: 'icon icon-high', title: 'High/Critical' },
                    '🟠': { iconName: 'warning', classes: 'icon icon-medium', title: 'Medium/Warning' },
                    '🟢': { iconName: 'recommend', classes: 'icon icon-low', title: 'Low/Info' },
                    '✅': { iconName: 'check_circle', classes: 'icon icon-check', title: 'Yes/Used/Supported' },
                    '❌': { iconName: 'cancel', classes: 'icon icon-cross', title: 'No/Not Used/Unsupported' },
                    '❔': { iconName: 'help', classes: 'icon icon-question', title: 'Uncertain/Likely' },
                    '🟡': { iconName: 'warning', classes: 'icon icon-medium', title: 'Medium/Warning' },
                    '⚠️': { iconName: 'warning', classes: 'icon icon-medium', title: 'Medium/Warning' },
                    '⚠': { iconName: 'warning', classes: 'icon icon-medium', title: 'Medium/Warning' },
                    '✓': { iconName: 'check_circle', classes: 'icon icon-check', title: 'Yes/Used/Supported' },
                    '✗': { iconName: 'cancel', classes: 'icon icon-cross', title: 'No/Not Used/Unsupported' },
                    '❓': { iconName: 'help', classes: 'icon icon-question', title: 'Uncertain/Likely' },
                    '🔥': { iconName: 'cancel', classes: 'icon icon-high', title: 'High/Critical' },
                    '⭕': { iconName: 'cancel', classes: 'icon icon-cross', title: 'No/Not Used/Unsupported' },
                    '🛑': { iconName: 'cancel', classes: 'icon icon-high', title: 'High/Critical' }
                };
                
                // Find all text nodes and spans that might contain emojis
                const walker = document.createTreeWalker(
                    cloned,
                    NodeFilter.SHOW_TEXT | NodeFilter.SHOW_ELEMENT,
                    null,
                    false
                );
                
                const nodesToReplace = [];
                let node;
                
                while (node = walker.nextNode()) {
                    if (node.nodeType === Node.TEXT_NODE) {
                        const text = node.textContent;
                        for (const emoji in emojiToIconMap) {
                            if (text.includes(emoji)) {
                                nodesToReplace.push({
                                    node: node,
                                    emoji: emoji,
                                    iconData: emojiToIconMap[emoji],
                                    text: text
                                });
                                break;
                            }
                        }
                    } else if (node.nodeType === Node.ELEMENT_NODE && node.tagName === 'SPAN') {
                        const text = node.textContent.trim();
                        if (emojiToIconMap[text]) {
                            nodesToReplace.push({
                                node: node,
                                emoji: text,
                                iconData: emojiToIconMap[text],
                                isSpan: true
                            });
                        }
                    }
                }
                
                // Replace emojis with proper Material Icons
                nodesToReplace.forEach(replacement => {
                    if (replacement.isSpan) {
                        // Update span content to proper Material Icon name, use correct semantic classes
                        replacement.node.textContent = replacement.iconData.iconName;
                        replacement.node.className = replacement.iconData.classes + ' material-symbols-outlined';
                        replacement.node.title = replacement.iconData.title;
                        
                        // Apply proper Material Icons styling
                        replacement.node.style.fontFamily = "'Material Symbols Outlined', sans-serif";
                        replacement.node.style.fontVariantEmoji = "text";
                    } else {
                        // For text nodes, create new icon span with correct semantic classes
                        const iconSpan = document.createElement('span');
                        iconSpan.className = replacement.iconData.classes + ' material-symbols-outlined';
                        iconSpan.textContent = replacement.iconData.iconName;
                        iconSpan.title = replacement.iconData.title;
                        iconSpan.style.fontFamily = "'Material Symbols Outlined', sans-serif";
                        iconSpan.style.fontVariantEmoji = "text";
                        
                        // Replace the emoji in the text
                        const newText = replacement.text.replace(replacement.emoji, '');
                        if (newText.trim()) {
                            const textNode = document.createTextNode(newText);
                            replacement.node.parentNode.insertBefore(iconSpan, replacement.node);
                            replacement.node.parentNode.insertBefore(textNode, replacement.node);
                        } else {
                            replacement.node.parentNode.insertBefore(iconSpan, replacement.node);
                        }
                        replacement.node.parentNode.removeChild(replacement.node);
                    }
                });
                
                return cloned;
            };
            
            // Check if we're dealing with grouped data
            if (table._paginationGroupData) {
                // For grouped tables, pagination works differently
                const groupData = table._paginationGroupData;
                let totalRows = 0;
                groupData.forEach(group => totalRows += group.rows.length);
                
                // Calculate pagination
                const totalPages = Math.ceil(totalRows / pageSize);
                const startIdx = (currentPage - 1) * pageSize;
                const endIdx = Math.min(startIdx + pageSize, totalRows);
                
                let rowCount = 0;
                let addedRows = 0;
                
                // Add groups and their visible rows
                groupData.forEach(group => {
                    // Check if any rows from this group should be visible
                    const groupStartRow = rowCount;
                    const groupEndRow = rowCount + group.rows.length;
                    
                    // If any rows in this group are visible in the current page
                    if (groupEndRow > startIdx && groupStartRow < endIdx) {
                        // Add the group header
                        const clonedHeader = simpleCloneRow(group.header);
                        tbody.appendChild(clonedHeader);
                        
                        // Add visible rows from this group
                        for (let i = 0; i < group.rows.length; i++) {
                            if (rowCount >= startIdx && rowCount < endIdx) {
                                const clonedRow = simpleCloneRow(group.rows[i]);
                                tbody.appendChild(clonedRow);
                                addedRows++;
                            }
                            rowCount++;
                        }
                    } else {
                        rowCount += group.rows.length;
                    }
                });
                
                // Restore event listeners for group headers
                const groupHeaders = tbody.querySelectorAll('.group-header');
                groupHeaders.forEach(header => {
                    header.addEventListener('click', function() {
                        this.classList.toggle('collapsed');
                        const isCollapsed = this.classList.contains('collapsed');
                        const groupValue = this.getAttribute('data-group');
                        const groupRows = tbody.querySelectorAll(`tr[data-group="${groupValue}"]:not(.group-header)`);
                        
                        groupRows.forEach(row => {
                            if (isCollapsed) {
                                row.classList.add('collapsed-row');
                            } else {
                                row.classList.remove('collapsed-row');
                            }
                        });
                        
                        const icon = this.querySelector('.group-toggle');
                        if (icon) {
                            icon.textContent = isCollapsed ? 'chevron_right' : 'expand_more';
                            icon.className = 'material-symbols-outlined icon group-toggle';
                        }
                    });
                });
            } else {
                // Regular table pagination
                const rows = table._paginationData;
                if (!rows) return;
                
                // Calculate pagination
                const totalPages = Math.ceil(rows.length / pageSize);
                const startIdx = (currentPage - 1) * pageSize;
                const endIdx = Math.min(startIdx + pageSize, rows.length);
                
                // Add visible rows
                for (let i = startIdx; i < endIdx; i++) {
                    const clonedRow = simpleCloneRow(rows[i]);
                    tbody.appendChild(clonedRow);
                }
            }
            
            // Always update pagination controls at the end
            console.log('Calling updatePaginationControls...');
            // Force this to run after the current execution context
            // This ensures the table is fully updated before pagination controls are created
            setTimeout(() => {
                updatePaginationControls(table);
                
                // NOTE: Removed emoji replacement to preserve original content structure
            }, 0);
            console.log('=== Finished paginateTable ===');
         }
         
         function updatePaginationControls(table) {
            console.log('=== Starting updatePaginationControls ===');
            
            const pageSize = parseInt(table.getAttribute('data-page-size')) || 20;
            const currentPage = parseInt(table.getAttribute('data-current-page')) || 1;
            const tableContainer = table.closest('.table-container');
            const paginationContainer = tableContainer.querySelector('.table-pagination');
            
            console.log(`updatePaginationControls: pageSize=${pageSize}, currentPage=${currentPage}`);
            
            if (!paginationContainer) {
                console.error('No pagination container found');
                return;
            }
            
            // Find pagination elements
            const paginationInfo = paginationContainer.querySelector('.pagination-info');
            const paginationNav = paginationContainer.querySelector('.pagination-nav');
            
            // Calculate total rows
            let totalRows = 0;
            if (table._paginationGroupData) {
                table._paginationGroupData.forEach(group => totalRows += group.rows.length);
            } else if (table._paginationData) {
                totalRows = table._paginationData.length;
            }
            
            // Calculate pagination values
            const totalPages = Math.max(1, Math.ceil(totalRows / pageSize));
            const startItem = totalRows === 0 ? 0 : (currentPage - 1) * pageSize + 1;
            const endItem = Math.min(startItem + pageSize - 1, totalRows);
            
            // Update info text
            if (paginationInfo) {
                paginationInfo.textContent = `Showing ${startItem}-${endItem} of ${totalRows}`;
            }
            
            // Clear existing navigation
            if (paginationNav) {
                paginationNav.innerHTML = '';
            }
            
            console.log(`Final pagination state: totalRows=${totalRows}, pageSize=${pageSize}, totalPages=${totalPages}, currentPage=${currentPage}`);
            
            // Always show pagination nav div, but only add buttons if multiple pages
            if (paginationNav) {                
                console.log(`Pagination nav found, totalPages=${totalPages}`);
                
                // Create page buttons regardless of total pages
                // This ensures pagination controls are always visible after page size change
                console.log('Creating page buttons...');
                createPageButtons(paginationNav, currentPage, totalPages, table);
                
                // Make sure the page size selector shows the correct value
                const pageSizeSelect = paginationContainer.querySelector('.page-size-select');
                if (pageSizeSelect && pageSizeSelect.value != pageSize) {
                    console.log(`Updating page size selector from ${pageSizeSelect.value} to ${pageSize}`);
                    pageSizeSelect.value = pageSize;
                } else {
                    console.log(`Page size selector already shows correct value: ${pageSize}`);
                }
            } else {
                console.error('Pagination nav not found!');
            }
            
            console.log('=== Finished updatePaginationControls ===');
         }
         
         function createPageButtons(container, currentPage, totalPages, table) {
            // Validate inputs
            currentPage = Math.max(1, currentPage);
            totalPages = Math.max(1, totalPages);
            
            // Define button styles
            const buttonStyles = `
                border: none;
                background: transparent;
                color: #5f6368;
                padding: 8px 12px;
                margin: 0 2px;
                border-radius: 4px;
                cursor: pointer;
                font-size: 14px;
                font-weight: 500;
                transition: all 0.2s ease;
                display: inline-flex;
                align-items: center;
                justify-content: center;
                min-width: 32px;
                min-height: 32px;
            `;
            
            const disabledButtonStyles = `
                opacity: 0.38;
                cursor: not-allowed;
                pointer-events: none;
            `;
            
            // Ensure we have at least one page
            totalPages = Math.max(1, totalPages);
            
            // Create a div to hold the navigation buttons
            const navButtonsContainer = document.createElement('div');
            navButtonsContainer.className = 'pagination-nav-buttons';
            
            // First page button
            const firstBtn = document.createElement('button');
            firstBtn.className = 'pagination-button first';
            firstBtn.innerHTML = '<span class="material-symbols-outlined icon">first_page</span>';
            firstBtn.title = 'First Page';
            firstBtn.disabled = currentPage === 1;
            firstBtn.style.cssText = buttonStyles + (currentPage === 1 ? disabledButtonStyles : '');
            
            // Immediately fix the icon in this button
            const firstIcon = firstBtn.querySelector('span');
            if (firstIcon) {
                firstIcon.setAttribute('data-original-icon-text', 'first_page');
                firstIcon.style.fontFamily = "'Material Symbols Outlined', sans-serif";
                firstIcon.style.fontVariantEmoji = "text";
            }
            
            // Add hover effect - Updated Google style
            firstBtn.addEventListener('mouseover', function() {
                if (currentPage !== 1) {
                    this.style.backgroundColor = 'rgba(60, 64, 67, 0.08)';
                    this.style.color = '#202124';
                }
            });
            
            firstBtn.addEventListener('mouseout', function() {
                if (currentPage !== 1) {
                    this.style.backgroundColor = 'transparent';
                    this.style.color = '#5f6368';
                }
            });
            firstBtn.addEventListener('click', () => {
                table.setAttribute('data-current-page', '1');
                paginateTable(table);
            });
            navButtonsContainer.appendChild(firstBtn);
            
            // Previous button
            const prevBtn = document.createElement('button');
            prevBtn.className = 'pagination-button prev';
            prevBtn.innerHTML = '<span class="material-symbols-outlined icon">chevron_left</span>';
            prevBtn.title = 'Previous Page';
            prevBtn.disabled = currentPage === 1;
            prevBtn.style.cssText = buttonStyles + (currentPage === 1 ? disabledButtonStyles : '');
            
            // Immediately fix the icon in this button
            const prevIcon = prevBtn.querySelector('span');
            if (prevIcon) {
                prevIcon.setAttribute('data-original-icon-text', 'chevron_left');
                prevIcon.style.fontFamily = "'Material Symbols Outlined', sans-serif";
                prevIcon.style.fontVariantEmoji = "text";
            }
            
            // Add hover effect - Updated Google style
            prevBtn.addEventListener('mouseover', function() {
                if (currentPage !== 1) {
                    this.style.backgroundColor = 'rgba(60, 64, 67, 0.08)';
                    this.style.color = '#202124';
                }
            });
            
            prevBtn.addEventListener('mouseout', function() {
                if (currentPage !== 1) {
                    this.style.backgroundColor = 'transparent';
                    this.style.color = '#5f6368';
                }
            });
            prevBtn.addEventListener('click', () => {
                const newPage = Math.max(1, currentPage - 1);
                table.setAttribute('data-current-page', newPage);
                paginateTable(table);
            });
            navButtonsContainer.appendChild(prevBtn);
            
            // Add the nav buttons container to the main container
            container.appendChild(navButtonsContainer);
            
            // Create a div to hold the page number buttons
            const pageNumbersContainer = document.createElement('div');
            pageNumbersContainer.className = 'pagination-page-numbers';
            pageNumbersContainer.style.display = 'flex';
            pageNumbersContainer.style.alignItems = 'center';
            pageNumbersContainer.style.margin = '0 10px';
            
            // Google-style page numbers (always show current page and some context)
            let startPage = Math.max(1, currentPage - 2);
            let endPage = Math.min(totalPages, startPage + 4);
            
            // Adjust if we're near the end
            if (endPage === totalPages) {
                startPage = Math.max(1, endPage - 4);
            }
            
            // For single page, ensure we show at least that one page
            if (totalPages === 1) {
                startPage = 1;
                endPage = 1;
            }
            
            // Add ellipsis at start if needed
            if (startPage > 1) {
                const ellipsisStart = document.createElement('span');
                ellipsisStart.className = 'pagination-button ellipsis';
                ellipsisStart.style.cssText = `
                    display: inline-flex;
                    align-items: center;
                    justify-content: center;
                    min-width: 36px;
                    height: 36px;
                    margin: 0 4px;
                    font-size: 14px;
                    color: #5f6368;
                `;
                ellipsisStart.textContent = '...';
                pageNumbersContainer.appendChild(ellipsisStart);
            }
            
            // Add page buttons
            for (let i = startPage; i <= endPage; i++) {
                const pageBtn = document.createElement('button');
                pageBtn.className = 'pagination-button page-number';
                pageBtn.style.cssText = buttonStyles;
                
                // Add hover effect - Updated Google style
                pageBtn.addEventListener('mouseover', function() {
                    if (i !== currentPage) {
                        this.style.backgroundColor = 'rgba(60, 64, 67, 0.08)'; // Transparent gray hover effect
                        this.style.color = '#202124';
                    }
                });
                
                pageBtn.addEventListener('mouseout', function() {
                    if (i !== currentPage) {
                        this.style.backgroundColor = 'transparent';
                        this.style.color = '#5f6368';
                    }
                });
                
                if (i === currentPage) {
                    pageBtn.classList.add('active');
                    pageBtn.style.backgroundColor = 'var(--product-accent)'; // Google Blue
                    pageBtn.style.color = 'white';
                    pageBtn.style.fontWeight = '500';
                    pageBtn.style.border = 'none';
                }
                
                pageBtn.textContent = i;
                pageBtn.addEventListener('click', () => {
                    table.setAttribute('data-current-page', i);
                    paginateTable(table);
                });
                pageNumbersContainer.appendChild(pageBtn);
            }
            
            // Add ellipsis at end if needed
            if (endPage < totalPages) {
                const ellipsisEnd = document.createElement('span');
                ellipsisEnd.className = 'pagination-button ellipsis';
                ellipsisEnd.style.cssText = `
                    display: inline-flex;
                    align-items: center;
                    justify-content: center;
                    min-width: 36px;
                    height: 36px;
                    margin: 0 4px;
                    font-size: 14px;
                    color: #5f6368;
                `;
                ellipsisEnd.textContent = '...';
                pageNumbersContainer.appendChild(ellipsisEnd);
            }
            
            // Add the page numbers container to the main container
            container.appendChild(pageNumbersContainer);
            
            // Create a div for the next/last buttons
            const nextButtonsContainer = document.createElement('div');
            nextButtonsContainer.className = 'pagination-next-buttons';
            nextButtonsContainer.style.display = 'flex';
            nextButtonsContainer.style.alignItems = 'center';
            
            // Next button
            const nextBtn = document.createElement('button');
            nextBtn.className = 'pagination-button next';
            nextBtn.innerHTML = '<span class="material-symbols-outlined icon">chevron_right</span>';
            nextBtn.title = 'Next Page';
            nextBtn.disabled = currentPage === totalPages;
            nextBtn.style.cssText = buttonStyles + (currentPage === totalPages ? disabledButtonStyles : '');
            
            // Immediately fix the icon in this button
            const nextIcon = nextBtn.querySelector('span');
            if (nextIcon) {
                nextIcon.setAttribute('data-original-icon-text', 'chevron_right');
                nextIcon.style.fontFamily = "'Material Symbols Outlined', sans-serif";
                nextIcon.style.fontVariantEmoji = "text";
            }
            
            // Add hover effect - Updated Google style
            nextBtn.addEventListener('mouseover', function() {
                if (currentPage !== totalPages) {
                    this.style.backgroundColor = 'rgba(60, 64, 67, 0.08)';
                    this.style.color = '#202124';
                }
            });
            
            nextBtn.addEventListener('mouseout', function() {
                if (currentPage !== totalPages) {
                    this.style.backgroundColor = 'transparent';
                    this.style.color = '#5f6368';
                }
            });
            nextBtn.addEventListener('click', () => {
                const newPage = Math.min(totalPages, currentPage + 1);
                table.setAttribute('data-current-page', newPage);
                paginateTable(table);
            });
            nextButtonsContainer.appendChild(nextBtn);
            
            // Last page button
            const lastBtn = document.createElement('button');
            lastBtn.className = 'pagination-button last';
            lastBtn.innerHTML = '<span class="material-symbols-outlined icon">last_page</span>';
            lastBtn.title = 'Last Page';
            lastBtn.disabled = currentPage === totalPages;
            lastBtn.style.cssText = buttonStyles + (currentPage === totalPages ? disabledButtonStyles : '');
            
            // Immediately fix the icon in this button
            const lastIcon = lastBtn.querySelector('span');
            if (lastIcon) {
                lastIcon.setAttribute('data-original-icon-text', 'last_page');
                lastIcon.style.fontFamily = "'Material Symbols Outlined', sans-serif";
                lastIcon.style.fontVariantEmoji = "text";
            }
            
            // Add hover effect - Updated Google style
            lastBtn.addEventListener('mouseover', function() {
                if (currentPage !== totalPages) {
                    this.style.backgroundColor = 'rgba(60, 64, 67, 0.08)';
                    this.style.color = '#202124';
                }
            });
            
            lastBtn.addEventListener('mouseout', function() {
                if (currentPage !== totalPages) {
                    this.style.backgroundColor = 'transparent';
                    this.style.color = '#5f6368';
                }
            });
            lastBtn.addEventListener('click', () => {
                table.setAttribute('data-current-page', totalPages);
                paginateTable(table);
            });
            nextButtonsContainer.appendChild(lastBtn);
            
            // Add the next buttons container to the main container
            container.appendChild(nextButtonsContainer);
            
            // Fix all icons in the pagination controls
            setTimeout(() => {
                const paginationIcons = container.querySelectorAll('.icon, .material-symbols-outlined');
                paginationIcons.forEach(icon => {
                    if (!icon.classList.contains('material-symbols-outlined')) {
                        icon.classList.add('material-symbols-outlined');
                    }
                    
                    icon.style.fontFamily = "'Material Symbols Outlined', sans-serif";
                    icon.style.fontWeight = "normal";
                    icon.style.fontStyle = "normal";
                    icon.style.fontVariantEmoji = "text"; // Prevent emoji rendering
                    
                    const iconText = icon.textContent.trim();
                    if (iconText) {
                        icon.innerHTML = '';
                        icon.textContent = iconText;
                    }
                });
            }, 0);
         }
         
         function makeTablesSortable() {
            const tables = document.querySelectorAll('.table-container table');
            
            tables.forEach(table => {
               const headers = table.querySelectorAll('th');
               
               headers.forEach((header, index) => {
                  // Skip columns that shouldn't be sortable (you can add a 'no-sort' class to specific headers)
                  if (header.classList.contains('no-sort')) return;
                  
                  // Add sorting indicators and cursor pointer
                  header.style.cursor = 'pointer';
                  header.style.position = 'relative';
                  header.setAttribute('data-sort-direction', '');
                  
                  // Create sort indicator element
                  const sortIndicator = document.createElement('span');
                  sortIndicator.className = 'sort-indicator';
                  sortIndicator.innerHTML = '&nbsp;⇕';
                  sortIndicator.style.fontSize = '0.8em';
                  sortIndicator.style.opacity = '0.6';
                  sortIndicator.style.marginLeft = '5px';
                  sortIndicator.style.display = 'inline-block';
                  header.appendChild(sortIndicator);
                  
                  // Add click event
                  header.addEventListener('click', function() {
                     sortTable(table, index, header);
                  });
               });
            });
         }
         
         function makeTablesGroupable() {
            const tables = document.querySelectorAll('.table-container table');
            
            // For debugging - add a small indicator to help identify if function is running
            console.log('Looking for groupable tables...', tables.length);
            
            tables.forEach((table, tableIndex) => {
               // Make sure the table has a thead
               const thead = table.querySelector('thead');
               if (!thead) return;
               
               const headers = Array.from(thead.querySelectorAll('th'));
               let groupableColumnIndices = [];
               
               // Make all columns groupable
               headers.forEach((header, index) => {
                  // Skip columns that shouldn't be groupable (you can add a 'no-group' class to specific headers)
                  if (header.classList.contains('no-group')) return;
                  
                  const headerText = header.textContent.trim();
                  
                  // Skip empty headers
                  if (headerText !== '') {
                     groupableColumnIndices.push({index: index, name: headerText});
                  }
               });
               
               // If there are any columns to group by, add group controls
               if (groupableColumnIndices.length > 0) {
                  addGroupingControlsToTable(table, groupableColumnIndices);
                  console.log(`Added grouping controls to table ${tableIndex+1} with ${groupableColumnIndices.length} columns`);
               }
            });
         }
         
         function addGroupingControlsToTable(table, groupableColumns) {
            const tableContainer = table.closest('.table-container');
            
            // Remove any existing grouping controls to prevent duplicates
            const existingControls = tableContainer.querySelector('.table-group-controls');
            if (existingControls) {
               existingControls.remove();
            }
            
            // Create grouping control panel with improved styling
            const groupingControls = document.createElement('div');
            groupingControls.className = 'table-group-controls';
            groupingControls.style.display = 'flex';
            groupingControls.style.flexWrap = 'wrap';
            groupingControls.style.alignItems = 'center';
            groupingControls.style.padding = '10px 12px';
            groupingControls.style.backgroundColor = '#f8f9fa';
            groupingControls.style.borderRadius = '4px';
            groupingControls.style.border = '1px solid #e0e0e0';
            
            // Add title with icon
            const groupTitle = document.createElement('div');
            groupTitle.className = 'group-title';
            groupTitle.style.marginRight = '16px';
            groupTitle.style.fontWeight = '500';
            groupTitle.style.display = 'flex';
            groupTitle.style.alignItems = 'center';
            
            const icon = document.createElement('span');
            icon.className = 'material-symbols-outlined';
            icon.textContent = 'filter_list';
            icon.style.marginRight = '6px';
            icon.style.fontSize = '20px';
            icon.style.color = '#0071ce';
            
            const titleText = document.createElement('span');
            titleText.textContent = 'Group by:';
            
            groupTitle.appendChild(icon);
            groupTitle.appendChild(titleText);
            groupingControls.appendChild(groupTitle);
            
            // Add controls for each groupable column
            const groupOptions = document.createElement('div');
            groupOptions.className = 'group-options';
            groupOptions.style.display = 'flex';
            groupOptions.style.flexWrap = 'wrap';
            groupOptions.style.gap = '8px';
            
            // Add "None" option with improved styling
            const noneOption = document.createElement('button');
            noneOption.className = 'group-option active';
            noneOption.textContent = 'None';
            noneOption.style.padding = '6px 12px';
            noneOption.style.border = '1px solid #ddd';
            noneOption.style.borderRadius = '4px';
            noneOption.style.backgroundColor = '#fff';
            noneOption.style.cursor = 'pointer';
            noneOption.style.transition = 'all 0.2s ease';
            
            // Active style
            if (noneOption.classList.contains('active')) {
               noneOption.style.backgroundColor = '#0071ce';
               noneOption.style.color = '#fff';
               noneOption.style.border = '1px solid #0071ce';
            }
            
            noneOption.onclick = function(event) {
               // Prevent event propagation
               event.stopPropagation();
               event.preventDefault();
               
               console.log('None option clicked - Starting grouping reset');
               
               try {
                  // Set this option as active first to provide visual feedback
                  setActiveGroupOption(groupOptions, this);
                  
                  // Add a small delay to ensure UI feedback happens before potentially intensive operation
                  setTimeout(() => {
                     // Ensure we clean up all grouping
                     resetGrouping(table);
                     console.log('None option: grouping reset complete');
                  }, 10);
               } catch (error) {
                  console.error('Error handling None option click:', error);
               }
            };
            
            // Add hover effect
            noneOption.onmouseover = function() {
               if (!this.classList.contains('active')) {
                  this.style.backgroundColor = '#f0f0f0';
               }
            };
            noneOption.onmouseout = function() {
               if (!this.classList.contains('active')) {
                  this.style.backgroundColor = '#fff';
               }
            };
            
            groupOptions.appendChild(noneOption);
            
            // Add column options with the same styling
            groupableColumns.forEach(column => {
               const option = document.createElement('button');
               option.className = 'group-option';
               option.textContent = column.name;
               option.style.padding = '6px 12px';
               option.style.border = '1px solid #ddd';
               option.style.borderRadius = '4px';
               option.style.backgroundColor = '#fff';
               option.style.cursor = 'pointer';
               option.style.transition = 'all 0.2s ease';
               
               // Add hover effect
               option.onmouseover = function() {
                  if (!this.classList.contains('active')) {
                     this.style.backgroundColor = '#f0f0f0';
                  }
               };
               option.onmouseout = function() {
                  if (!this.classList.contains('active')) {
                     this.style.backgroundColor = '#fff';
                  }
               };
               
               option.onclick = (event) => {
                  // Prevent event propagation
                  event.stopPropagation();
                  event.preventDefault();
                  
                  console.log(`Group option clicked: ${column.name}`);
                  groupTableByColumn(table, column.index, column.name);
                  setActiveGroupOption(groupOptions, option);
               };
               groupOptions.appendChild(option);
            });
            
            groupingControls.appendChild(groupOptions);
            
            // Insert controls before the table
            tableContainer.insertBefore(groupingControls, table);
         }
         
         function setActiveGroupOption(container, activeButton) {
            console.log('Setting active group option:', activeButton.textContent);
            
            // Remove active class and reset styles from all buttons
            const buttons = container.querySelectorAll('.group-option');
            buttons.forEach(button => {
               button.classList.remove('active');
               button.style.backgroundColor = '#fff';
               button.style.color = '#333';
               button.style.border = '1px solid #ddd';
            });
            
            // Add active class to the selected button
            activeButton.classList.add('active');
            
            // Apply active styles
            activeButton.style.backgroundColor = '#0071ce';
            activeButton.style.color = '#fff';
            activeButton.style.border = '1px solid #0071ce';
            activeButton.style.fontWeight = '500';
         }
         
         function groupTableByColumn(table, columnIndex, columnName) {
            // Implementation for grouping table by column
            
            // Get all rows except header
            const tbody = table.querySelector('tbody');
            if (!tbody) {
               console.error('No tbody found in table during grouping');
               return;
            }
            
            // First, ensure all existing group headers are removed
            const allRows = Array.from(tbody.querySelectorAll('tr'));
            const dataRows = allRows.filter(row => !row.classList.contains('group-header'));
            const existingGroups = tbody.querySelectorAll('.group-header');
            
            console.log(`Found ${allRows.length} total rows, ${dataRows.length} data rows, ${existingGroups.length} existing group headers`);
            
            // Make sure to remove existing group headers properly
            existingGroups.forEach(group => {
               if (group.parentNode) {
                  group.parentNode.removeChild(group);
               }
            });
            
            // Reset all rows to their default state
            dataRows.forEach(row => {
               row.style.display = '';
               row.removeAttribute('data-group');
               row.classList.remove('first-in-group', 'collapsed-row');
            });
            
            // Group the data - use a new empty object for clean grouping
            const groupedData = {};
            
            dataRows.forEach(row => {
               // Ensure we have the right index
               if (columnIndex >= row.cells.length) {
                  console.warn(`Column index ${columnIndex} out of bounds for row`, row);
                  return;
               }
               
               // Extract only the text content and ignore icons
               const cell = row.cells[columnIndex];
               if (!cell) {
                  console.warn(`No cell found at index ${columnIndex} for row`, row);
                  return;
               }
               
               let cellValue = '';
               
               // Function to extract text nodes only (no icon text)
               function extractTextOnly(element) {
                  // Special case for cells with icons + text pattern like "dangerous High"
                  // Try to find any direct text node that is not within an icon element
                  let directTextContent = '';
                  let hasFoundDirectText = false;
                  
                  // First, check if this is a cell with the specific structure we're targeting
                  // This usually means it has both an icon with text and visible text afterward
                  const iconElements = element.querySelectorAll('.icon, .icon-high, .icon-medium, .icon-low');
                  if (iconElements.length > 0) {
                     // Try to find text nodes that are direct children but not part of icons
                     for (let childNode of element.childNodes) {
                        // Text node that's a direct child
                        if (childNode.nodeType === 3 && childNode.textContent.trim()) {
                           directTextContent += childNode.textContent.trim() + ' ';
                           hasFoundDirectText = true;
                        }
                        // If it's a span that doesn't have icon classes, it might contain our text
                        else if (childNode.nodeType === 1 && 
                                !childNode.classList?.contains('icon') && 
                                !childNode.classList?.contains('icon-high') && 
                                !childNode.classList?.contains('icon-medium') && 
                                !childNode.classList?.contains('icon-low')) {
                           // Only extract text if it doesn't contain icon children
                           if (!childNode.querySelector('.icon')) {
                              directTextContent += childNode.textContent.trim() + ' ';
                              hasFoundDirectText = true;
                           }
                        }
                     }
                  }
                  
                  // If we found direct text, use that (this helps with the specific case of "dangerous High")
                  if (hasFoundDirectText) {
                     return directTextContent.trim();
                  }
                  
                  // Otherwise, use the more generic approach
                  let text = '';
                  for (let node of element.childNodes) {
                     if (node.nodeType === 3) { // Text node
                        text += node.textContent.trim() + ' ';
                     } else if (node.nodeType === 1) { // Element node
                        // Skip icon elements, elements with icon class
                        const classList = node.classList ? Array.from(node.classList) : [];
                        const hasIconClass = classList.some(cls => cls === 'icon' || cls.startsWith('icon-'));
                        const isIcon = hasIconClass || 
                                      node.tagName.toLowerCase() === 'i';
                                    
                        if (!isIcon) {
                           text += extractTextOnly(node);
                        }
                     }
                  }
                  return text;
               }
               
               cellValue = extractTextOnly(cell).trim();
               
               // If we couldn't extract text properly, fallback to full text
               if (!cellValue) {
                  cellValue = cell.textContent.trim();
               }
               
               // Handle empty values specially
               const normalizedValue = cellValue || '(Empty)';
               
               // Create the group if it doesn't exist yet
               if (!groupedData[normalizedValue]) {
                  groupedData[normalizedValue] = [];
               }
               
               // Add the row to the group
               groupedData[normalizedValue].push(row);
            });
            
            // Clear the tbody completely to start fresh
            while (tbody.firstChild) {
               tbody.removeChild(tbody.firstChild);
            }
            
            // Create a sorted array of group values
            const groupValues = Object.keys(groupedData).sort();
            console.log(`Created ${groupValues.length} groups`);
            
            // Add rows back with group headers
            groupValues.forEach(groupValue => {
               const rowsInThisGroup = groupedData[groupValue];
               console.log(`Adding group: "${groupValue}" with ${rowsInThisGroup.length} rows`);
               
               // Create group header
               const groupHeader = document.createElement('tr');
               groupHeader.className = 'group-header';
               groupHeader.setAttribute('data-group', groupValue);
               
               const groupCell = document.createElement('td');
               // Get the correct column count from thead
               const headerRow = table.querySelector('thead tr');
               const colCount = headerRow ? headerRow.cells.length : 
                               (rowsInThisGroup.length > 0 ? rowsInThisGroup[0].cells.length : 1);
               groupCell.colSpan = colCount;
               
               const groupContent = document.createElement('div');
               groupContent.className = 'group-header-content';
               groupContent.style.display = 'flex';
               groupContent.style.alignItems = 'center';
               groupContent.style.padding = '8px';
               groupContent.style.backgroundColor = '#f5f7f9';
               groupContent.style.borderRadius = '4px';
               
               const groupIcon = document.createElement('span');
               groupIcon.className = 'material-symbols-outlined icon group-toggle';
               groupIcon.textContent = 'expand_more';
               groupIcon.style.marginRight = '8px';
               groupIcon.style.color = '#0071ce';
               groupIcon.style.fontFamily = "'Material Symbols Outlined', sans-serif";
               groupIcon.style.fontWeight = 'normal';
               groupIcon.style.fontSize = '20px';
               groupIcon.style.lineHeight = '1';
               groupIcon.style.display = 'flex';
               groupIcon.style.alignItems = 'center';
               groupIcon.style.justifyContent = 'center';
               
               const groupTitle = document.createElement('span');
               groupTitle.className = 'group-header-title';
               groupTitle.textContent = `${columnName}: ${groupValue}`;
               groupTitle.style.fontWeight = '500';
               groupTitle.style.color = '#333';
               
               const groupCount = document.createElement('span');
               groupCount.className = 'group-count';
               groupCount.textContent = `${rowsInThisGroup.length} items`;
               groupCount.style.marginLeft = '12px';
               groupCount.style.fontSize = '0.85em';
               groupCount.style.color = '#666';
               groupCount.style.backgroundColor = 'rgba(0, 113, 206, 0.1)';
               groupCount.style.padding = '2px 8px';
               groupCount.style.borderRadius = '12px';
               
               groupContent.appendChild(groupIcon);
               groupContent.appendChild(groupTitle);
               groupContent.appendChild(groupCount);
               groupCell.appendChild(groupContent);
               groupHeader.appendChild(groupCell);
               
               // Add toggle functionality and make it more obvious
               groupHeader.title = 'Click to expand/collapse group';
               groupHeader.style.cursor = 'pointer';
               
               /* Add tooltip text to make it clear this is collapsible
               const tooltipSpan = document.createElement('span');
               tooltipSpan.className = 'group-tooltip';
               tooltipSpan.textContent = 'Click to expand/collapse';
               tooltipSpan.style.fontSize = '0.75em';
               tooltipSpan.style.color = '#666';
               tooltipSpan.style.marginLeft = '8px';
               tooltipSpan.style.padding = '2px 6px';
               tooltipSpan.style.background = 'rgba(0, 113, 206, 0.08)';
               tooltipSpan.style.borderRadius = '4px';
               groupContent.appendChild(tooltipSpan);*/
               
               groupHeader.addEventListener('click', function(event) {
                  // Prevent event propagation
                  event.stopPropagation();
                  
                  this.classList.toggle('collapsed');
                  const isCollapsed = this.classList.contains('collapsed');
                  const groupValue = this.getAttribute('data-group');
                  
                  // Ensure we're getting the right rows by being more specific with our selector
                  // We need to escape special characters in the group value for the selector
                  const escapedGroupValue = groupValue.replace(/"/g, '\\"');
                  const groupRows = tbody.querySelectorAll(`tr[data-group="${escapedGroupValue}"]:not(.group-header)`);
                  
                  console.log(`Toggle group: "${groupValue}", Collapsed: ${isCollapsed}, Found rows: ${groupRows.length}`);
                  
                  // Toggle row visibility with CSS classes for better performance
                  groupRows.forEach(row => {
                     if (isCollapsed) {
                        row.classList.add('collapsed-row');
                        row.style.display = 'none';
                     } else {
                        row.classList.remove('collapsed-row');
                        row.style.display = '';
                     }
                  });
                  
                  // Update the icon with proper styling
                  const icon = this.querySelector('.group-toggle');
                  if (icon) {
                     icon.textContent = isCollapsed ? 'chevron_right' : 'expand_more';
                     
                     // Ensure consistent icon styling after text change
                     icon.style.fontFamily = "'Material Symbols Outlined', sans-serif";
                     icon.style.fontWeight = 'normal';
                     icon.style.fontSize = '20px';
                     icon.style.lineHeight = '1';
                     icon.style.display = 'flex';
                     icon.style.alignItems = 'center';
                     icon.style.justifyContent = 'center';
                  }
                  
                  /* Update tooltip text based on collapsed state
                  const tooltipElement = this.querySelector('.group-tooltip');
                  if (tooltipElement) {
                     tooltipElement.textContent = isCollapsed ? 'Click to expand' : 'Click to collapse';
                  }*/
                  
                  // Show a count of collapsed items when collapsed
                  const existingBadge = this.querySelector('.collapsed-count');
                  if (existingBadge) {
                     existingBadge.remove();
                  }
                  
                  if (isCollapsed) {
                     const count = groupRows.length;
                     const countBadge = document.createElement('span');
                     countBadge.className = 'collapsed-count';
                     countBadge.textContent = `(${count} items hidden)`;
                     countBadge.style.fontSize = '0.7em';
                     countBadge.style.padding = '2px 8px';
                     countBadge.style.backgroundColor = 'rgba(0, 113, 206, 0.15)';
                     countBadge.style.color = 'rgba(0, 113, 206, 0.9)';
                     countBadge.style.borderRadius = '10px';
                     countBadge.style.marginLeft = '10px';
                     countBadge.style.fontWeight = '500';
                     countBadge.style.border = '1px solid rgba(0, 113, 206, 0.3)';
                     
                     const headerContent = this.querySelector('.group-header-content');
                     if (headerContent) {
                        headerContent.appendChild(countBadge);
                     }
                  }
               });
               
               // Add the group header to the tbody
               tbody.appendChild(groupHeader);
               
               // Add the rows for this group with data-group attribute
               groupedData[groupValue].forEach((row, i) => {
                  // Set data-group attribute for proper identification
                  row.setAttribute('data-group', groupValue);
                  
                  // Style the first row in each group differently if needed
                  if (i === 0) {
                     row.classList.add('first-in-group');
                  }
                  
                  // Add the row to the tbody
                  tbody.appendChild(row);
               });
            });
            
            // Make sure we have consistent styles for grouped table
            const style = document.createElement('style');
            style.textContent = `
               .group-header { background-color: #f5f7f9; }
               .group-header td { padding: 0 !important; }
               .group-header-content { padding: 10px; }
               .collapsed-row { display: none; }
               tr.first-in-group td { border-top: 1px solid #e0e0e0; }
               .group-header:hover { background-color: #eef1f5; }
               
               /* Material Icons proper styling */
               .material-symbols-outlined.icon {
                  font-family: 'Material Symbols Outlined', sans-serif !important;
                  font-weight: normal !important;
                  font-style: normal !important;
                  font-size: 20px !important;
                  line-height: 1 !important;
                  display: inline-flex !important;
                  align-items: center !important;
                  justify-content: center !important;
                  text-transform: none !important;
                  letter-spacing: normal !important;
                  overflow-wrap: normal !important;
                  white-space: nowrap !important;
                  direction: ltr !important;
                  -webkit-font-smoothing: antialiased !important;
               }
            `;
            
            // Only add the style if it doesn't exist yet
            if (!document.querySelector('style[data-group-styles="true"]')) {
                style.setAttribute('data-group-styles', 'true');
                document.head.appendChild(style);
            }
            
            console.log('Group headers and rows added to table');
            
            // Re-apply pagination if it's enabled
            if (table.hasAttribute('data-paginated')) {
               console.log('Table is paginated, re-applying pagination after grouping');
               // Re-store table data since grouping has changed the structure
               storeTableData(table);
               // Reset to first page and update
               table.setAttribute('data-current-page', '1');
               paginateTable(table);
            }
         }
         
         function resetGrouping(table) {
            console.log('Resetting table grouping - START');
            const tbody = table.querySelector('tbody');
            if (!tbody) {
               console.error('No tbody found in table during resetGrouping');
               return;
            }
            
            try {
               // Backup of all non-header rows (important data rows)
               const allRows = Array.from(tbody.querySelectorAll('tr'));
               const dataRows = allRows.filter(row => !row.classList.contains('group-header'));
               
               console.log(`Found ${allRows.length} total rows, ${dataRows.length} data rows to restore`);
               
               // Make a clean copy of each data row to avoid any reference issues
               const cleanDataRows = dataRows.map(row => {
                  const clonedRow = row.cloneNode(true);
                  
                  // Reset any grouping-related attributes and styling
                  clonedRow.removeAttribute('data-group');
                  clonedRow.classList.remove('first-in-group', 'collapsed-row');
                  clonedRow.style.display = '';
                  
                  // Ensure any row that was hidden is now visible
                  if (row.style.display === 'none') {
                     clonedRow.style.display = '';
                  }
                  
                  return clonedRow;
               });
               
               console.log(`Created ${cleanDataRows.length} clean rows for regrouping`);
               
               // Clear the tbody completely to start fresh
               console.log('Clearing tbody to start fresh');
               while (tbody.firstChild) {
                  tbody.removeChild(tbody.firstChild);
               }
               
               // Re-add all data rows in their original order with clean state
               console.log('Re-adding clean data rows to table');
               cleanDataRows.forEach(row => tbody.appendChild(row));
               
               // Re-apply pagination if it's enabled
               if (table.hasAttribute('data-paginated')) {
                  console.log('Table is paginated, restoring pagination after group reset');
                  // Re-store table data since we've reset the grouping
                  storeTableData(table);
                  // Reset to first page and update
                  table.setAttribute('data-current-page', '1');
                  paginateTable(table);
               }
               
               console.log('Resetting table grouping - COMPLETE');
            } catch (error) {
               console.error('Error in resetGrouping:', error);
            }
         }
         
         function sortTable(table, columnIndex, header) {
            const sortDirection = header.getAttribute('data-sort-direction');
            const newDirection = sortDirection === 'asc' ? 'desc' : 'asc';
            
            // Reset all headers
            const headers = table.querySelectorAll('th');
            headers.forEach(h => {
               h.setAttribute('data-sort-direction', '');
               const indicator = h.querySelector('.sort-indicator');
               if (indicator) indicator.innerHTML = '&nbsp;⇕';
               indicator.style.opacity = '0.6';
            });
            
            // Set current header
            header.setAttribute('data-sort-direction', newDirection);
            const sortIndicator = header.querySelector('.sort-indicator');
            sortIndicator.innerHTML = newDirection === 'asc' ? '&nbsp;↑' : '&nbsp;↓';
            sortIndicator.style.opacity = '1';
            
            // Check if table is grouped
            const tbody = table.querySelector('tbody');
            const groupHeaders = tbody.querySelectorAll('.group-header');
            
            if (groupHeaders.length > 0) {
               // Table is grouped, sort within each group
               const groups = {};
               
               // Collect all groups
               groupHeaders.forEach(header => {
                  const groupValue = header.getAttribute('data-group');
                  groups[groupValue] = [];
                  
                  // Find all rows in this group
                  const groupRows = tbody.querySelectorAll(`tr[data-group="${groupValue}"]:not(.group-header)`);
                  groupRows.forEach(row => groups[groupValue].push(row));
                  
                  // Sort rows in this group
                  groups[groupValue].sort((rowA, rowB) => {
                     const cellA = rowA.cells[columnIndex].textContent.trim();
                     const cellB = rowB.cells[columnIndex].textContent.trim();
                     
                     // Check if values are numbers
                     const numA = parseFloat(cellA);
                     const numB = parseFloat(cellB);
                     
                     if (!isNaN(numA) && !isNaN(numB)) {
                        return newDirection === 'asc' ? numA - numB : numB - numA;
                     } else {
                        // String comparison
                        return newDirection === 'asc' 
                           ? cellA.localeCompare(cellB) 
                           : cellB.localeCompare(cellA);
                     }
                  });
                  
                  // Remove existing rows
                  groupRows.forEach(row => {
                     tbody.removeChild(row);
                  });
                  
                  // Insert sorted rows after their group header
                  let insertAfter = header;
                  const isGroupCollapsed = header.classList.contains('collapsed');
                  
                  groups[groupValue].forEach((row, idx) => {
                     // Preserve the collapsed state from the group header
                     if (isGroupCollapsed) {
                        row.classList.add('collapsed-row');
                     } else {
                        row.classList.remove('collapsed-row');
                     }
                     
                     // Add first-in-group class to the first row
                     if (idx === 0) {
                        row.classList.add('first-in-group');
                     } else {
                        row.classList.remove('first-in-group');
                     }
                     
                     if (insertAfter.nextSibling) {
                        tbody.insertBefore(row, insertAfter.nextSibling);
                     } else {
                        tbody.appendChild(row);
                     }
                     insertAfter = row;
                  });
               });
               
            } else {
               // Normal sorting (no groups)
               const rows = Array.from(tbody.querySelectorAll('tr'));
               
               // Sort rows
               rows.sort((rowA, rowB) => {
                  const cellA = rowA.cells[columnIndex].textContent.trim();
                  const cellB = rowB.cells[columnIndex].textContent.trim();
                  
                  // Check if values are numbers
                  const numA = parseFloat(cellA);
                  const numB = parseFloat(cellB);
                  
                  if (!isNaN(numA) && !isNaN(numB)) {
                     return newDirection === 'asc' ? numA - numB : numB - numA;
                  } else {
                     // String comparison
                     return newDirection === 'asc' 
                        ? cellA.localeCompare(cellB) 
                        : cellB.localeCompare(cellA);
                  }
               });
               
               // Remove existing rows
               rows.forEach(row => tbody.removeChild(row));
               
               // Add sorted rows
               rows.forEach(row => tbody.appendChild(row));
            }
            
            // Re-apply pagination if it's enabled
            if (table.hasAttribute('data-paginated')) {
               // Re-store table data since sorting has changed the structure
               storeTableData(table);
               paginateTable(table);
            }
            
            // Add a highlight effect on sorting
            tbody.style.transition = 'background-color 0.3s ease';
            tbody.style.backgroundColor = 'rgba(0, 113, 206, 0.05)';
            setTimeout(() => {
               tbody.style.backgroundColor = '';
            }, 500);
         }
      </script>

      <style>
         :root {
         /* Light Theme */
         --cgd-blue: #0071CE;
         --product-accent: #0071CE;
         --product-accent-hover: #00559A;
         --text-primary: #202124;
         --text-secondary: #5f6368;
         --border-color: #dadce0;
         --background-main: #f8f9fa;
         --background-card: #ffffff;
         --background-hover: #f1f3f4;
         --background-button: #0071CE;
         --background-button-text: #ffffff;
         /* Icon Colors */
         --color-red: #d93025;
         --color-amber: #f9ab00;
         --color-green: #1e8e3e;
         }
        html.dark-mode {
         /* Dark Theme - Improved for better visibility and contrast */
         --product-accent: #4285f4;
         --product-accent-hover: #5294ff;
         --text-primary: #ffffff;
         --text-secondary: #ffffff;
         --border-color: #5f6368;
         --background-main: #1a1a1a;
         --background-card: #2d2d2d;
         --background-hover: #404040;
         --background-button: #4285f4;
         --background-button-text: #ffffff;
         /* Improved Icon Colors for dark mode */
         --color-red: #f28b82;
         --color-amber: #fdd663;
         --color-green: #81c995;
         }
         html {
         color: var(--text-primary);
         background-color: var(--background-main);
         box-sizing: border-box;
         scroll-behavior: smooth;
         }
         *, *::before, *::after { box-sizing: inherit; }
         body {
         margin: 0; padding: 0; width: 100%;
         font-family: 'Roboto', 'Segoe UI', Arial, sans-serif;
         font-size: 14px; line-height: 1.6;
         text-rendering: optimizeLegibility;
         overflow-x: hidden;
         text-align: left;
         color: var(--text-primary);
         background-color: var(--background-main);
         transition: background-color 0.3s ease, color 0.3s ease;
         }
         /* --- HEADER --- */
         /* --- READING PROGRESS INDICATOR --- */
         .reading-progress {
         position: fixed;
         top: 0;
         left: 0;
         width: 100%;
         height: 3px;
         background-color: rgba(0, 113, 206, 0.1);
         z-index: 103;
         opacity: 0;
         transition: opacity 0.3s ease;
         }
         .reading-progress.show {
         opacity: 1;
         }
         .reading-progress-fill {
         height: 100%;
         background: linear-gradient(90deg, var(--product-accent) 0%, #00559A 100%);
         width: 0%;
         transition: width 0.1s ease-out;
         border-radius: 0 2px 2px 0;
         box-shadow: 0 0 10px rgba(0, 113, 206, 0.3);
         }
         .reading-progress-text {
         position: fixed;
         top: 8px;
         right: 20px;
         background-color: var(--background-card);
         color: var(--text-secondary);
         font-size: 0.75rem;
         font-weight: 500;
         padding: 0.25rem 0.5rem;
         border-radius: 12px;
         border: 1px solid var(--border-color);
         z-index: 104;
         opacity: 0;
         visibility: hidden;
         transition: all 0.3s ease;
         backdrop-filter: blur(8px);
         }
         .reading-progress-text.show {
         opacity: 1;
         visibility: visible;
         }
         .header {
         background-color: var(--background-card);
         box-shadow: 0 1px 2px rgba(0,0,0,0.1);
         position: sticky;
         top: 0;
         z-index: 102;
         width: 100%;
         border-bottom: 1px solid var(--border-color);
         transition: background-color 0.3s ease, border-color 0.3s ease;
         }
         .header-container {
         display: flex;
         align-items: center;
         justify-content: space-between;
         padding: 0.5rem 1.5rem; /* Reduced padding */
         max-width: 100%;
         margin: 0 auto;
         }
         .header-brand { display: flex; align-items: center; }
         .header-logo { height: 38px; margin-right: 1rem; }
         .header-title { font-size: 18px; font-weight: 600; color: var(--cgd-blue); padding: 0; }
         .header-controls { display: flex; align-items: center; gap: 0.5rem; }
         .support-button {
         background-color: var(--background-button);
         color: var(--background-button-text);
         border: 1px solid transparent;
         border-radius: 4px;
         padding: 8px 16px;
         font-size: 14px;
         font-weight: 500;
         text-decoration: none;
         cursor: pointer;
         transition: background-color 0.2s ease, box-shadow 0.2s ease;
         margin-left: 1rem;
         }
         .support-button:hover {
         background-color: var(--product-accent-hover);
         box-shadow: 0 1px 3px rgba(0,0,0,0.1);
         }
         .icon-button {
         background: none; border: none; cursor: pointer;
         padding: 8px; border-radius: 50%;
         display: inline-flex; align-items: center; justify-content: center;
         color: var(--text-secondary);
         transition: background-color 0.2s ease, color 0.2s ease;
         }
         .icon-button:hover { background-color: var(--background-hover); color: var(--text-primary); }
         .icon-button .icon { margin: 0; vertical-align: -6px; }
         /* --- MAIN CONTENT & TYPOGRAPHY --- */
         .content { max-width: 100%; padding: 0 1.5rem; margin: 0 auto; }
         .product-header {
         background-color: var(--background-card);
         padding: 2rem 1.5rem;
         margin-bottom: 0;
         border-bottom: 1px solid var(--border-color);
         transition: background-color 0.3s ease, border-color 0.3s ease;
         }
         .document-meta {
         display: flex;
         align-items: center;
         gap: 1rem;
         margin-top: 0.5rem;
         color: var(--text-secondary);
         font-size: 0.875rem;
         }
         .read-time { display: flex; align-items: center; gap: 0.25rem; }
         .read-time .icon { font-size: 18px; vertical-align: -4px; }
         h1, h2, h3, h4 { color: var(--text-primary); text-align: left; font-weight: 600; margin-bottom: 1rem; }
         h1 { margin-top: 0; font-size: 2.25rem; padding-bottom: 0.5rem; }
         h2 { font-size: 1.75rem; padding-bottom: 0.75rem; border-bottom: 1px solid var(--border-color); transition: border-color 0.3s ease; }
         h3 { font-size: 1.4rem; }
         h4 { font-size: 1.2rem; }
         p { margin: 1rem 0; color: var(--text-secondary); }
         /* --- ICON STYLES --- */
         .icon { font-family: 'Material Symbols Outlined', sans-serif; font-weight: normal; font-style: normal; font-size: 20px; line-height: 1; letter-spacing: normal; text-transform: none; display: inline-block; white-space: nowrap; word-wrap: normal; direction: ltr; -webkit-font-smoothing: antialiased; vertical-align: -5px; margin-right: 0.07em; }
         .icon-high { color: var(--color-red); }
         .icon-medium { color: var(--color-amber); }
         .icon-low { color: var(--color-green); }
         .icon-check { color: var(--color-green); }
         .icon-cross { color: var(--color-red); }
         .icon-question { color: var(--text-secondary); }
         /* --- BREADCRUMB NAVIGATION --- */
         .breadcrumb-container {
         background-color: var(--background-main);
         border-top: 1px solid var(--border-color);
         padding: 0.5rem 1.5rem;
         transition: all 0.3s ease;
         }
         .breadcrumb {
         display: flex;
         align-items: center;
         flex-wrap: wrap;
         gap: 0.5rem;
         font-size: 0.8rem;
         color: var(--text-secondary);
         max-width: 1200px;
         margin: 0 auto;
         }
         .breadcrumb-item {
         display: flex;
         align-items: center;
         gap: 0.25rem;
         }
         .breadcrumb-link {
         color: var(--text-secondary);
         text-decoration: none;
         padding: 0.25rem 0.5rem;
         border-radius: 4px;
         transition: all 0.2s ease;
         cursor: pointer;
         }
         .breadcrumb-link:hover {
         color: var(--product-accent);
         background-color: var(--background-hover);
         }
         .breadcrumb-link.active {
         color: var(--product-accent);
         font-weight: 500;
         background-color: rgba(0, 113, 206, 0.1);
         }
         .breadcrumb-separator {
         color: var(--border-color);
         font-size: 0.75rem;
         margin: 0 0.25rem;
         }
         .breadcrumb-home {
         display: flex;
         align-items: center;
         gap: 0.25rem;
         color: var(--text-secondary);
         text-decoration: none;
         padding: 0.25rem 0.5rem;
         border-radius: 4px;
         transition: all 0.2s ease;
         }
         .breadcrumb-home:hover {
         color: var(--product-accent);
         background-color: var(--background-hover);
         }
         .breadcrumb-home .icon {
         font-size: 16px;
         }
         .breadcrumb-section-info {
         margin-left: auto;
         display: flex;
         align-items: center;
         gap: 1rem;
         font-size: 0.8rem;
         color: var(--text-secondary);
         }
         .breadcrumb-progress {
         display: flex;
         align-items: center;
         gap: 0.25rem;
         }
         .breadcrumb-progress-bar {
         width: 60px;
         height: 4px;
         background-color: var(--border-color);
         border-radius: 2px;
         overflow: hidden;
         }
         .breadcrumb-progress-fill {
         height: 100%;
         background-color: var(--product-accent);
         width: 0%;
         transition: width 0.3s ease;
         }
         /* Mobile adjustments for breadcrumb */
         @media (max-width: 768px) {
         .breadcrumb-container {
         padding: 0.4rem 1rem;
         }
         .breadcrumb {
         font-size: 0.75rem;
         }
         .breadcrumb-section-info {
         display: none;
         }
         .breadcrumb-link {
         padding: 0.2rem 0.4rem;
         }
         }
         @media (max-width: 480px) {
         .breadcrumb-container {
         padding: 0.3rem 1rem;
         }
         .breadcrumb {
         font-size: 0.7rem;
         gap: 0.25rem;
         }
         .breadcrumb-link {
         padding: 0.15rem 0.3rem;
         max-width: 100px;
         overflow: hidden;
         text-overflow: ellipsis;
         white-space: nowrap;
         }
         }
         /* --- TAB STYLES --- */
         .tab-navigation-container {
         position: sticky; top: 62px; /* After header (which now includes breadcrumb) */
         background-color: var(--background-card);
         z-index: 101;
         border-bottom: 1px solid var(--border-color);
         width: 100vw; margin-left: calc(-50vw + 50%);
         transition: background-color 0.3s ease, border-color 0.3s ease;
         }
         .tab-nav-scroller { overflow-x: auto; scrollbar-width: thin; scrollbar-color: var(--border-color) transparent; padding: 0 1.5rem; }
         .tab-navigation { display: flex; flex-wrap: nowrap; white-space: nowrap; margin: 0; padding: 0; list-style: none; }
         .tab-link { padding: 0.75rem 0; margin: 0 1.25rem; cursor: pointer; background: none; border: none; border-bottom: 3px solid transparent; color: var(--text-secondary); font-size: 0.9rem; font-weight: 500; transition: color 0.2s ease, border-color 0.2s ease; margin-bottom: -1px; text-align: center; }
         
         
         .tab-link:hover { color: var(--product-accent); }
         .tab-link.active { color: var(--product-accent); border-bottom-color: var(--product-accent); }
         .tab-link:first-child { margin-left: 0; } .tab-link:last-child { margin-right: 0; }
         .tab-content { padding-top: 2rem; }
         .tab-pane { display: none; animation: fadeIn 0.5s ease; }
         .tab-pane.active { display: block; }
         .tab-link span {font-weight: 550; }
         @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
         .product-section { margin-bottom: 3rem; background: var(--background-card); border-radius: 8px; border: 1px solid var(--border-color); padding: 0 2rem; transition: background-color 0.3s ease, border-color 0.3s ease; }
         /* --- TABLES --- */
         .table-container { width: 100%; overflow-x: auto; margin: 1.5rem 0; border: 1px solid var(--border-color); border-radius: 8px; transition: border-color 0.3s ease; }
         table { width: 100%; border-collapse: collapse; min-width: 650px; }
         th, td { padding: 12px 16px; text-align: left; vertical-align: middle; font-size: 0.875rem; border-bottom: 1px solid var(--border-color); transition: border-color 0.3s ease;}
         th { background-color: var(--background-main); color: var(--text-primary); font-weight: 500; position: sticky; top: 0; z-index: 10; transition: background-color 0.3s ease, color 0.3s ease; }
         tr:last-child td { border-bottom: none; }
         tr:hover { background-color: var(--background-hover); }
         td strong { color: var(--text-primary); font-weight: 500; }
         td .icon { margin-left: -4px; }

         /* Sortable table styles */
         th[data-sort-direction="asc"],
         th[data-sort-direction="desc"] {
            background-color: rgba(0, 113, 206, 0.1);
         }
         th .sort-indicator {
            transition: transform 0.2s ease, opacity 0.2s ease;
         }
         th:hover .sort-indicator {
            opacity: 1 !important;
         }
         th:hover {
            background-color: rgba(0, 113, 206, 0.05);
         }
         tbody tr.sort-highlight {
            animation: highlightRow 1s ease;
         }
         @keyframes highlightRow {
            0% { background-color: rgba(0, 113, 206, 0.1); }
            100% { background-color: transparent; }
         }
         
         /* Table grouping styles */
         .table-group-controls {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 0px;
            padding: 8px 12px;
            background-color: var(--background-main);
            border-radius: 6px;
            border: 1px solid var(--border-color);
            transition: border-color 0.3s ease, background-color 0.3s ease;
         }
         
         .group-title {
            display: flex;
            align-items: center;
            gap: 6px;
            font-weight: 500;
            color: var(--text-primary);
            font-size: 0.9rem;
         }
         
         .group-options {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
         }
         
         .group-option {
            padding: 4px 10px;
            border-radius: 4px;
            border: 1px solid var(--border-color);
            background-color: var(--background-card);
            color: var(--text-secondary);
            cursor: pointer;
            font-size: 0.8rem;
            transition: all 0.2s ease;
         }
         
         .group-option:hover {
            background-color: var(--background-hover);
            color: var(--text-primary);
         }
         
         .group-option.active {
            background-color: var(--product-accent);
            color: white;
            border-color: var(--product-accent);
            font-weight: 500;
         }
         
         tr.group-header {
            background-color: rgba(0, 113, 206, 0.08);
            cursor: pointer;
            user-select: none;
            transition: all 0.2s ease;
            border-radius: 4px;
            border-left: 3px solid rgba(0, 113, 206, 0.6);
         }
         
         tr.group-header:hover {
            background-color: rgba(0, 113, 206, 0.15);
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
         }
         
         tr.group-header.collapsed {
            background-color: rgba(0, 113, 206, 0.12);
            border-left-color: rgba(0, 113, 206, 0.6);
            margin-bottom: 0;
            border-bottom: 2px solid rgba(0, 113, 206, 0.4);
            position: relative; /* For the ::after pseudo-element */
         }
         
         tr.group-header.collapsed:hover {
            background-color: rgba(0, 113, 206, 0.18);
         }
         
         /* Add visual indicator of collapsed rows below */
         tr.group-header.collapsed::after {
            content: "";
            height: 3px;
            background: linear-gradient(to right, rgba(0, 113, 206, 0.4), rgba(0, 113, 206, 0.1), transparent);
            display: block;
            position: relative;
            margin-top: 2px;
         }
         
         /* Add a more prominent indicator for collapsed content */
         tr.group-header.collapsed td:first-child {
            position: relative;
         }
         
         tr.group-header.collapsed td:first-child::before {
            content: "▾"; /* Down-pointing triangle */
            position: absolute;
            right: 10px;
            color: rgba(0, 113, 206, 0.6);
            font-size: 12px;
         }
         
         .group-header-content {
            display: flex;
            align-items: center;
            padding: 4px 0;
            flex-wrap: wrap;
         }
         
         .group-header-title {
            font-weight: 500;
            color: var(--text-primary);
            margin-right: 8px;
         }
         
         .group-count {
            font-size: 0.75rem;
            color: var(--text-secondary);
            background-color: var(--background-card);
            padding: 2px 8px;
            border-radius: 12px;
            border: 1px solid var(--border-color);
         }
         
         .group-toggle {
            margin-right: 10px;
            transition: all 0.3s ease;
            color: rgba(0, 113, 206, 0.8);
            font-weight: bold;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            background-color: rgba(0, 113, 206, 0.1);
            width: 26px;
            height: 26px;
            border-radius: 50%;
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
            font-size: 18px;
         }
         
         tr.group-header:hover .group-toggle {
            background-color: rgba(0, 113, 206, 0.2);
            transform: scale(1.1);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.15);
         }
         
         tr.group-header.collapsed .group-toggle {
            transform: rotate(-90deg);
            color: rgba(0, 113, 206, 0.6);
            background-color: rgba(0, 113, 206, 0.05);
         }
         
         /* Simplify the animation */
         tr.group-header.collapsed:hover .group-toggle {
            background-color: rgba(0, 113, 206, 0.15);
            transform: rotate(-90deg) scale(1.05);
         }
         
         /* Styles for grouped rows */
         tr[data-group] {
            transition: all 0.3s ease;
         }
         
         /* Collapsed rows - completely hidden */
         tbody tr.collapsed-row {
            display: none !important;
         }
         
         tr.first-in-group {
            border-top: 1px solid rgba(0, 113, 206, 0.1);
         }
         
         @media (max-width: 768px) {
            .table-group-controls {
               flex-direction: column;
               align-items: flex-start;
               gap: 8px;
            }
            
            .group-options {
               width: 100%;
            }
         }
         
         /* Table Pagination Styles */
         .table-pagination {
            margin-top: 1rem;
            border-top: 1px solid var(--border-color);
            padding-top: 0.75rem;
         }
         
         .pagination-top-controls {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 0.75rem;
            padding-left:12px;
            padding-right: 12px;
         }
         
         .page-size-selector {
            display: flex;
            align-items: center;
            gap: 0.5rem;
         }
         
         .page-size-label {
            font-size: 0.875rem;
            color: var(--text-secondary);
         }
         
         .page-size-select {
            padding: 0.25rem 0.5rem;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            background-color: var(--background-card);
            color: var(--text-primary);
            font-size: 0.875rem;
            cursor: pointer;
         }
         
         .page-size-select:focus {
            outline: none;
            border-color: var(--product-accent);
            box-shadow: 0 0 0 2px rgba(0, 113, 206, 0.1);
         }
         
         .pagination-info {
            font-size: 0.875rem;
            color: var(--text-secondary);
         }
         
         .pagination-nav {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.25rem;
            padding: 8px 0;
            background-color: #f8f9fa;
            border-radius: 8px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.05);
         }
         
         .pagination-button {
            min-width: 36px;
            height: 36px;
            padding: 0;
            border: none;
            border-radius: 4px;
            background-color: transparent;
            color: var(--product-accent);
            font-size: 0.875rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
            margin: 0 2px;
         }
         
         .pagination-button:hover:not(:disabled) {
            background-color: rgba(0, 113, 206, 0.08);
            color: var(--product-accent);
         }
         
         .pagination-button {
            background-color: var(--product-accent);
            color: white;
            font-weight: 500;
         }
         
         /* Navigation buttons styling */
         .pagination-button.prev,
         .pagination-button.next,
         .pagination-button.first,
         .pagination-button.last {
            background-color: transparent;
            border-radius: 50%;
         }
         
         /* Number buttons styling */
         .pagination-button.page-number {
            font-family: 'Roboto', Arial, sans-serif;
            font-weight: 500;
         }
         
         .pagination-button.ellipsis {
            cursor: default;
            min-width: 24px;
         }
         
         .pagination-button.ellipsis:hover {
            background-color: transparent;
         }
         
         .pagination-button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            color: var(--text-secondary);
         }
         
         .pagination-button.prev,
         .pagination-button.next,
         .pagination-button.first,
         .pagination-button.last {
            background-color: transparent;
            border: none;
         }
         
         .pagination-button.prev:hover:not(:disabled),
         .pagination-button.next:hover:not(:disabled),
         .pagination-button.first:hover:not(:disabled),
         .pagination-button.last:hover:not(:disabled) {
            background-color: rgba(0, 113, 206, 0.08);
            border: none;
         }
         
         .pagination-button .icon {
            font-size: 20px;
            margin: 0;
            font-family: 'Material Symbols Outlined', sans-serif !important;
            vertical-align: middle;
            font-style: normal;
         }
         
         .icon {
            font-family: 'Material Symbols Outlined', sans-serif !important;
            font-weight: normal;
            font-style: normal;
            line-height: 1;
            text-transform: none;
            letter-spacing: normal;
            word-wrap: normal;
            white-space: nowrap;
            direction: ltr;
            display: inline-block;
            text-rendering: auto;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
         }
         
         /* Ensure Material Symbols are properly applied */
         span.material-symbols-outlined,
         .material-symbols-outlined {
            font-family: 'Material Symbols Outlined', sans-serif !important;
            font-weight: normal;
            font-style: normal;
            font-size: 20px;
            line-height: 1;
            letter-spacing: normal;
            text-transform: none;
            display: inline-block;
            white-space: nowrap;
            word-wrap: normal;
            direction: ltr;
            font-feature-settings: 'liga';
            -webkit-font-feature-settings: 'liga';
            -webkit-font-smoothing: antialiased;
         }
         
         .pagination-button.ellipsis {
            cursor: default;
            color: var(--text-secondary);
         }
         
         .pagination-button.ellipsis:hover {
            background-color: transparent;
         }
         
         /* Mobile adjustments for pagination */
         @media (max-width: 768px) {
            .pagination-top-controls {
               flex-direction: column;
               align-items: flex-start;
               gap: 0.5rem;
            }
            
            .pagination-info {
               margin-top: 0.25rem;
            }
            
            .pagination-button {
               min-width: 32px;
               height: 32px;
            }
         }
         
         @media (max-width: 480px) {
            .pagination-button:not(.prev):not(.next):not(.active):not(.first):not(.last) {
               display: none;
            }
            
            .pagination-button.ellipsis:first-of-type,
            .pagination-button.ellipsis:last-of-type {
               display: flex;
            }
            
            .pagination-nav {
               width: 100%;
               justify-content: space-between;
            }
         }
         /* --- FLOATING TABLE OF CONTENTS --- */
         .floating-toc {
         position: fixed;
         top: 50%;
         right: 20px;
         transform: translateY(-50%);
         background-color: var(--background-card);
         border: 1px solid var(--border-color);
         border-radius: 12px;
         padding: 1rem;
         max-width: 280px;
         min-width: 240px;
         max-height: 70vh;
         overflow-y: auto;
         z-index: 1001;
         box-shadow: 0 8px 32px rgba(0,0,0,0.12);
         opacity: 0;
         visibility: hidden;
         transition: opacity 0.3s ease, visibility 0.3s ease, transform 0.3s ease;
         backdrop-filter: blur(8px);
         }
         .floating-toc.show {
         opacity: 1;
         visibility: visible;
         }
         .floating-toc-header {
         display: flex;
         align-items: center;
         justify-content: space-between;
         margin-bottom: 1rem;
         padding-bottom: 0.5rem;
         border-bottom: 1px solid var(--border-color);
         }
         .floating-toc-title {
         font-size: 0.875rem;
         font-weight: 600;
         color: var(--text-primary);
         display: flex;
         align-items: center;
         gap: 0.5rem;
         }
         .floating-toc-close {
         background: none;
         border: none;
         cursor: pointer;
         padding: 4px;
         border-radius: 4px;
         color: var(--text-secondary);
         transition: background-color 0.2s ease, color 0.2s ease;
         }
         .floating-toc-close:hover {
         background-color: var(--background-hover);
         color: var(--text-primary);
         }
         .floating-toc-list {
         list-style: none;
         padding: 0;
         margin: 0;
         }
         .floating-toc-item {
         margin-bottom: 0.5rem;
         }
         .floating-toc-link {
         display: block;
         padding: 0.5rem 0.75rem;
         text-decoration: none;
         color: var(--text-secondary);
         font-size: 0.8rem;
         line-height: 1.4;
         border-radius: 6px;
         transition: all 0.2s ease;
         cursor: pointer;
         position: relative;
         border-left: 3px solid transparent;
         }
         .floating-toc-link:hover {
         background-color: var(--background-hover);
         color: var(--text-primary);
         }
         .floating-toc-link.active {
         background-color: rgba(0, 113, 206, 0.1);
         color: var(--product-accent);
         border-left-color: var(--product-accent);
         font-weight: 500;
         }
         .floating-toc-progress {
         position: absolute;
         right: 0.5rem;
         top: 50%;
         transform: translateY(-50%);
         width: 20px;
         height: 20px;
         border-radius: 50%;
         background-color: var(--border-color);
         border: 2px solid var(--background-card);
         transition: all 0.2s ease;
         }
         .floating-toc-link.active .floating-toc-progress {
         background-color: var(--product-accent);
         }
         .floating-toc-progress-fill {
         position: absolute;
         top: 2px;
         left: 2px;
         right: 2px;
         bottom: 2px;
         border-radius: 50%;
         background-color: var(--product-accent);
         transform: scale(0);
         transition: transform 0.2s ease;
         }
         .floating-toc-link.reading .floating-toc-progress-fill {
         transform: scale(1);
         }
         .floating-toc-toggle {
         position: fixed;
         top: 50%;
         right: 20px;
         transform: translateY(-50%);
         background-color: var(--product-accent);
         color: var(--background-button-text);
         border: none;
         border-radius: 50%;
         width: 48px;
         height: 48px;
         display: flex;
         align-items: center;
         justify-content: center;
         cursor: pointer;
         z-index: 1002;
         box-shadow: 0 4px 16px rgba(0,0,0,0.15);
         opacity: 0;
         visibility: hidden;
         transition: all 0.3s ease;
         }
         .floating-toc-toggle.show {
         opacity: 1;
         visibility: visible;
         }
         .floating-toc-toggle:hover {
         background-color: var(--product-accent-hover);
         transform: translateY(-50%) scale(1.05);
         }
         /* --- FULL-SCREEN READING MODE --- */
         .fullscreen-reading-mode {
         position: fixed;
         top: 0;
         left: 0;
         right: 0;
         bottom: 0;
         background-color: var(--background-main);
         z-index: 2000;
         overflow-y: auto;
         padding: 2rem;
         opacity: 0;
         visibility: hidden;
         transition: opacity 0.3s ease, visibility 0.3s ease;
         }
         .fullscreen-reading-mode.active {
         opacity: 1;
         visibility: visible;
         }
         .fullscreen-reading-content {
         max-width: 800px;
         margin: 0 auto;
         line-height: 1.8;
         font-size: 1.1rem;
         color: var(--text-primary);
         }
         .fullscreen-reading-content h2 {
         font-size: 2rem;
         margin-bottom: 1.5rem;
         color: var(--text-primary);
         border-bottom: 2px solid var(--product-accent);
         padding-bottom: 0.5rem;
         }
         .fullscreen-reading-content h3 {
         font-size: 1.5rem;
         margin-top: 2rem;
         margin-bottom: 1rem;
         color: var(--text-primary);
         }
         .fullscreen-reading-content h4 {
         font-size: 1.25rem;
         margin-top: 1.5rem;
         margin-bottom: 0.75rem;
         color: var(--text-primary);
         }
         .fullscreen-reading-content p {
         margin-bottom: 1.5rem;
         text-align: justify;
         color: var(--text-secondary);
         }
         .fullscreen-reading-content table {
         margin: 2rem 0;
         font-size: 0.95rem;
         }
         .fullscreen-reading-controls {
         position: fixed;
         top: 20px;
         right: 20px;
         display: flex;
         gap: 0.5rem;
         z-index: 2001;
         }
         .fullscreen-reading-control {
         background-color: var(--background-card);
         border: 1px solid var(--border-color);
         border-radius: 8px;
         padding: 0.5rem;
         cursor: pointer;
         color: var(--text-secondary);
         transition: all 0.2s ease;
         backdrop-filter: blur(8px);
         }
         .fullscreen-reading-control:hover {
         background-color: var(--background-hover);
         color: var(--text-primary);
         }
         .fullscreen-reading-exit {
         background-color: var(--product-accent);
         color: var(--background-button-text);
         }
         .fullscreen-reading-exit:hover {
         background-color: var(--product-accent-hover);
         }
         .fullscreen-reading-progress {
         position: fixed;
         bottom: 20px;
         left: 50%;
         transform: translateX(-50%);
         background-color: var(--background-card);
         border: 1px solid var(--border-color);
         border-radius: 20px;
         padding: 0.5rem 1rem;
         font-size: 0.875rem;
         color: var(--text-secondary);
         backdrop-filter: blur(8px);
         z-index: 2001;
         }
         .fullscreen-font-controls {
         position: fixed;
         top: 20px;
         left: 20px;
         display: flex;
         gap: 0.5rem;
         z-index: 2001;
         }
         .fullscreen-font-control {
         background-color: var(--background-card);
         border: 1px solid var(--border-color);
         border-radius: 8px;
         padding: 0.5rem;
         cursor: pointer;
         color: var(--text-secondary);
         transition: all 0.2s ease;
         backdrop-filter: blur(8px);
         min-width: 40px;
         text-align: center;
         }
         .fullscreen-font-control:hover {
         background-color: var(--background-hover);
         color: var(--text-primary);
         }
         /* Hide UI elements when in fullscreen reading mode */
         body.fullscreen-reading .header,
         body.fullscreen-reading .product-header,
         body.fullscreen-reading .tab-navigation-container,
         body.fullscreen-reading .footer,
         body.fullscreen-reading .floating-toc,
         body.fullscreen-reading .floating-toc-toggle,
         body.fullscreen-reading #back-to-top,
         body.fullscreen-reading .reading-progress,
         body.fullscreen-reading .reading-progress-text {
         display: none !important;
         }
         /* Mobile adjustments for fullscreen reading */
         @media (max-width: 768px) {
         .fullscreen-reading-mode {
         padding: 1rem;
         }
         .fullscreen-reading-content {
         font-size: 1rem;
         line-height: 1.7;
         }
         .fullscreen-reading-controls {
         top: 10px;
         right: 10px;
         }
         .fullscreen-font-controls {
         top: 10px;
         left: 10px;
         }
         .fullscreen-reading-progress {
         bottom: 10px;
         padding: 0.4rem 0.8rem;
         font-size: 0.8rem;
         }
         }
         /* Hide TOC on smaller screens */
         @media (max-width: 1024px) {
         .floating-toc,
         .floating-toc-toggle {
         display: none !important;
         }
         }
         
         /* Mobile adjustments for reading progress */
         @media (max-width: 768px) {
         .reading-progress-text {
         right: 10px;
         top: 6px;
         font-size: 0.7rem;
         padding: 0.2rem 0.4rem;
         }
         }
         
         @media (max-width: 480px) {
         .reading-progress-text {
         right: 5px;
         top: 4px;
         font-size: 0.65rem;
         padding: 0.15rem 0.3rem;
         max-width: 120px;
         text-overflow: ellipsis;
         overflow: hidden;
         white-space: nowrap;
         }
         }
         /* --- MISC & FOOTER --- */
         .ai-disclaimer { text-align: center; font-style: italic; color: var(--text-secondary); font-size: 0.875rem; margin: -1rem auto -2rem; padding: 0 1rem; line-height: 1.5; }
         #back-to-top {
         position: fixed; bottom: 20px; left: 20px;
         background-color: var(--product-accent); color: var(--background-button-text);
         border: none; border-radius: 50%;
         width: 50px; height: 50px;
         display: none; align-items: center; justify-content: center;
         cursor: pointer; z-index: 1000;
         box-shadow: 0 4px 8px rgba(0,0,0,0.2);
         opacity: 0;
         transition: opacity 0.3s ease, transform 0.3s ease, background-color 0.3s ease;
         }
         #back-to-top.show { opacity: 1; display: flex; }
         #back-to-top:hover { background-color: var(--product-accent-hover); transform: translateY(-2px); }
         .footer { background-color: var(--background-card); color: var(--text-secondary); padding: 2rem 1.5rem; margin-top: 4rem; text-align: center; border-top: 1px solid var(--border-color); transition: background-color 0.3s ease, border-color 0.3s ease;}
         .footer-container { max-width: 1440px; margin: 0 auto; display: flex; flex-direction: column; align-items: center; gap: 1.5rem; }
         .footer-brand { display: flex; align-items: center; gap: 1rem; }
         .footer-logo { height: 32px; }
         .footer-wordmark { font-size: 1rem; font-weight: 500; color: var(--cgd-blue); }
         .footer-copyright { font-size: 0.8rem; }
         .footer-socials { display: flex; gap: 1rem; }
         .footer-socials a { color: var(--text-secondary); text-decoration: none; display: inline-block; transition: color 0.2s ease, transform 0.2s ease; }
         .footer-socials a:hover { color: var(--product-accent); transform: scale(1.1); }
         .footer-socials svg { width: 24px; height: 24px; fill: currentColor; }
         @media (max-width: 768px) {
         .content, .product-header { padding-left: 1rem; padding-right: 1rem; }
         .footer-container { flex-direction: column; text-align: center; gap: 1.5rem; }
         }
         @media print {
         /* Print styles remain largely the same */
         .header, .footer, .tab-navigation-container, .ai-disclaimer, #back-to-top, .header-controls { display: none !important; }
         }
      </style>
   </head>
   <body>
      <!-- Reading Progress Indicator -->
      <div id="reading-progress" class="reading-progress">
         <div id="reading-progress-fill" class="reading-progress-fill"></div>
      </div>
      <div id="reading-progress-text" class="reading-progress-text">
         0% read
      </div>
      
      <header class="header">
         <div class="header-container">
            <div class="header-brand">
               <img src="https://www.cgd.pt/PublishingImages/WSImages/Novo-CGD/logo-ap_Blue.png" alt="CGD Logo" class="header-logo">
            </div>
            <div class="header-controls">
               <div id="tts-controls" style="display: none;">
                  <button id="tts-play-pause-btn" class="icon-button" title="Listen to this section">
                  <span class="icon">play_arrow</span>
                  </button>
                  <button id="tts-stop-btn" class="icon-button" title="Stop listening">
                  <span class="icon">stop</span>
                  </button>
               </div>
               <button id="fullscreen-reading-btn" class="icon-button" title="Enter fullscreen reading mode">
               <span class="icon">fullscreen</span>
               </button>
               <button id="dark-mode-toggle" class="icon-button" title="Toggle dark/light mode">
               <span class="icon">light_mode</span>
               </button>
               <a href="mailto:david.alexandre.rosa@cgd.pt?subject=Support Request for Application Technical Profile&cc=dsi-arquitetura_empresarial@cgd.pt" target="_blank" class="support-button">Ask for Support</a>
            </div>
         </div>
         
         <!-- Breadcrumb Navigation integrated in header -->
         <div id="breadcrumb-container" class="breadcrumb-container">
            <nav class="breadcrumb" aria-label="Breadcrumb navigation">
               <a href="#" id="breadcrumb-home" class="breadcrumb-home" title="Go to overview">
                  <span class="icon">home</span>
                  <span>Overview</span>
               </a>
               <span class="breadcrumb-separator">›</span>
               <div id="breadcrumb-current" class="breadcrumb-item">
                  <span class="breadcrumb-link active">Current Section</span>
               </div>
               <div class="breadcrumb-section-info">
                  <div class="breadcrumb-progress">
                     <span class="icon">trending_up</span>
                     <div class="breadcrumb-progress-bar">
                        <div id="breadcrumb-progress-fill" class="breadcrumb-progress-fill"></div>
                     </div>
                     <span id="breadcrumb-progress-text">0%</span>
                  </div>
                  <div id="breadcrumb-section-count">
                     Section 1 of 13
                  </div>
               </div>
            </nav>
         </div>
      </header>
      
      <div class="product-header">
         <h1 id="application-technical-profile">Application Technical Profile</h1>
         <p style="font-size: 16px">A structured and in-depth technical overview of the application, capturing key architectural elements, technology stack, system components, and more. This profile serves as a foundational reference for modernization, migration, and governance initiatives.</p>
         <div class="document-meta">
            <div class="read-time" id="total-read-time">
               <span class="icon">schedule</span>
               <span>Calculating...</span>
            </div>
         </div>
      </div>
      <div id="tab-container-placeholder"></div>
      
      <main class="content" id="main-content-area">
<div class="product-section">
<h2 id="1-application-overview">1. Application overview</h2>
This section provides a high-level summary of the application, including its purpose, scope, and key technical characteristics.
<div class="table-container">
<table>
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr>
<th style="text-align: left;">Field</th>
<th style="text-align: left;">Value</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>Acronym</strong></td>
<td style="text-align: left;">SDCIM</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Application name</strong></td>
<td style="text-align: left;">Serviço de Depósito e Captura de Imagens (Image Capture and Deposit Service)</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Primary business purpose</strong></td>
<td style="text-align: left;">A back-office system for processing bank remittances, including handling of tranches, documents, and alerts, with a Windows Forms front-end for monitoring and management.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Business domain</strong></td>
<td style="text-align: left;">Banking, Financial Services, Remittance Processing</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Solution files</strong></td>
<td style="text-align: left;">- <strong>Total</strong>: 2<br>- <code>CIControloComSetup.sln</code><br>- <code>CIControloSemSetup.sln</code></td>
</tr>
<tr>
<td style="text-align: left;"><strong>Project files</strong></td>
<td style="text-align: left;">- <strong>Total</strong>: 17<br>- <strong>CIControloComSetup.sln</strong>: <code>CIControlo.csproj</code>, <code>QueryForm.csproj</code>, <code>CIConfigGlobalParameters.csproj</code>, <code>CIConfiguration.csproj</code>, <code>CIActividades.csproj</code>, <code>CIReports.csproj</code>, <code>Alerta.csproj</code>, <code>CIServRemessas.csproj</code>, <code>CIServTester.csproj</code>, <code>CIServAlertas.csproj</code>, <code>CIServico.csproj</code>, <code>CIFicheirosControlo.csproj</code>, <code>CIFicheiro.csproj</code>, <code>MDIsControlo.csproj</code>, <code>MDIWebTransmCI.vbproj</code><br>- <strong>CIControloSemSetup.sln</strong>: Includes all projects from the other solution plus <code>CITestes.csproj</code> and <code>CIDepositoErro.csproj</code>.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Files</strong></td>
<td style="text-align: left;">- <strong>Total</strong>: 79<br>- C# source code files (.cs): 55<br>- Visual Basic source code files (.vb): 4<br>- C# project files (.csproj): 17<br>- Visual Basic project files (.vbproj): 1<br>- Solution files (.sln): 2<br>- Application configuration files (.config): 6<br>- Resource files (.resx): 10<br>- Other (Batch, Settings, etc.): 13</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Main programming language(s)</strong></td>
<td style="text-align: left;">C#, VB.NET</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Target .NET Framework(s)</strong></td>
<td style="text-align: left;">- .NET Framework 4.0<br>- .NET Framework 3.5</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Application type</strong></td>
<td style="text-align: left;">Composite Application (Windows Service, Windows Forms UI, Class Libraries)</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Output type</strong></td>
<td style="text-align: left;">- .dll (Dynamic Link Library)<br>- .exe (Executable)</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Deployment model</strong></td>
<td style="text-align: left;">On-premises</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Deployment target platform</strong></td>
<td style="text-align: left;">AnyCPU</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Complexity</strong></td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High - The application consists of 17 projects, multiple technologies (WinForms, Windows Service, Web Service client), and complex business logic for processing financial remittances and alerts.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Last updated (Source code)</strong></td>
<td style="text-align: left;">2008-01-01</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Last updated (Documentation)</strong></td>
<td style="text-align: left;">2025-08-06</td>
</tr>
</tbody>
</table>
</div>
<h3 id="11-main-components-and-features">1.1. Main components and features</h3>
This section breaks down the application into its main logical components, describing their purpose and key features.
<div class="table-container">
<table>
<colgroup>
<col style="width: 16%" />
<col style="width: 16%" />
<col style="width: 16%" />
<col style="width: 16%" />
<col style="width: 16%" />
<col style="width: 16%" />
</colgroup>
<thead>
<tr>
<th style="text-align: left;">Component</th>
<th style="text-align: left;">Description</th>
<th style="text-align: left;">Key features</th>
<th style="text-align: left;">Dependencies</th>
<th style="text-align: left;">Related projects</th>
<th style="text-align: left;">Technologies</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>Remittance Processing Service</strong></td>
<td style="text-align: left;">Core background service responsible for processing remittances (<code>Remessas</code>) in tranches.</td>
<td style="text-align: left;">- Fetches remittances pending processing.<br>- Processes document tranches.<br>- Updates status in the database.</td>
<td style="text-align: left;"><code>CIConfigGlobalParameters</code>, <code>CIServRemessas</code></td>
<td style="text-align: left;"><code>CIServico.csproj</code>, <code>CIServRemessas.csproj</code></td>
<td style="text-align: left;">.NET Framework, Windows Services</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Alerting System</strong></td>
<td style="text-align: left;">Manages system and business alerts based on predefined situations.</td>
<td style="text-align: left;">- Triggers alerts for specific situations.<br>- Executes actions like sending emails (WebDAV/EWS), logging to DB, or writing to files.<br>- Parameterized actions.</td>
<td style="text-align: left;"><code>CIConfigGlobalParameters</code></td>
<td style="text-align: left;"><code>Alerta.csproj</code>, <code>CIServAlertas.csproj</code></td>
<td style="text-align: left;">.NET Framework, <code>System.Data.SqlClient</code></td>
</tr>
<tr>
<td style="text-align: left;"><strong>Activity Monitoring UI</strong></td>
<td style="text-align: left;">A Windows Forms application for monitoring and managing system activities, remittances, and estornos (reversals).</td>
<td style="text-align: left;">- View summaries and details of remittances and reversals.<br>- Filter by date, branch, and type.<br>- Manually trigger state changes.<br>- View document images.</td>
<td style="text-align: left;"><code>CIConfigGlobalParameters</code>, <code>NBIISNET.dll</code></td>
<td style="text-align: left;"><code>CIActividades.csproj</code></td>
<td style="text-align: left;">Windows Forms, .NET Framework 4.0</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Configuration & User Management</strong></td>
<td style="text-align: left;">Provides shared configuration parameters and manages user access.</td>
<td style="text-align: left;">- Centralized database connection strings.<br>- Application settings (timers, paths).<br>- User and group management with privilege levels.</td>
<td style="text-align: left;"><code>GenericNet.dll</code></td>
<td style="text-align: left;"><code>CIConfigGlobalParameters.csproj</code>, <code>CIConfiguration.csproj</code></td>
<td style="text-align: left;">.NET Framework</td>
</tr>
<tr>
<td style="text-align: left;"><strong>File Processing & Control</strong></td>
<td style="text-align: left;">Handles the import and processing of external files like ACOM and ENVM.</td>
<td style="text-align: left;">- File watching/polling.<br>- Parsing fixed-format files.<br>- Storing file data into the database.</td>
<td style="text-align: left;"><code>CIConfigGlobalParameters</code></td>
<td style="text-align: left;"><code>CIFicheiro.csproj</code>, <code>CIFicheirosControlo.csproj</code></td>
<td style="text-align: left;">.NET Framework</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Testing Framework</strong></td>
<td style="text-align: left;">A dedicated project for unit and integration tests of the services.</td>
<td style="text-align: left;">- Tests remittance processing logic.<br>- Validates service components.</td>
<td style="text-align: left;"><code>CIServico</code>, <code>CIServRemessas</code>, <code>Microsoft.VisualStudio.TestTools.UnitTesting</code></td>
<td style="text-align: left;"><code>CITestes.csproj</code></td>
<td style="text-align: left;">MSTest</td>
</tr>
</tbody>
</table>
</div>
<pre class="mermaid"><code>flowchart TD
    subgraph "User Interface"
        UI_Actividades["CIActividades (WinForms)"]
    end

    subgraph "Core Services"
        Servico["CIServico (Windows Service)"]
        ServRemessas["CIServRemessas (Processing Logic)"]
        ServAlertas["CIServAlertas (Alerting Logic)"]
    end
    
    subgraph "Business Logic & Data"
        Alerta["Alerta (Entities & Logic)"]
        Config["CIConfiguration (System Config)"]
        Ficheiro["CIFicheiro (File Handling)"]
    end

    subgraph "Shared Components"
        GlobalParams["CIConfigGlobalParameters (Shared Config)"]
        GenericNet["GenericNet.dll (External)"]
        NBIISNET["NBIISNET.dll (External)"]
    end

    subgraph "Data Storage"
        DB[("Database")]
    end

    UI_Actividades -->|"Manages/Monitors"| Servico
    Servico -->|"Executes"| ServRemessas
    Servico -->|"Executes"| ServAlertas
    Servico -->|"Uses"| Ficheiro
    
    ServRemessas -->|"Uses"| GlobalParams
    ServAlertas -->|"Uses"| Alerta
    Alerta -->|"Uses"| GlobalParams
    
    ServRemessas -->|"Reads/Writes"| DB
    Alerta -->|"Reads/Writes"| DB
    Config -->|"Reads/Writes"| DB
    
    UI_Actividades -->|"Uses"| GlobalParams
    GlobalParams --> DB

    style UI_Actividades fill:#cde4ff,stroke:#36c
    style Servico fill:#d5e8d4,stroke:#82b366
    style ServRemessas fill:#d5e8d4,stroke:#82b366
    style ServAlertas fill:#d5e8d4,stroke:#82b366
    style Alerta fill:#ffe6cc,stroke:#d79b00
    style Config fill:#ffe6cc,stroke:#d79b00
    style Ficheiro fill:#ffe6cc,stroke:#d79b00
    style GlobalParams fill:#f8cecc,stroke:#b85450
    style GenericNet fill:#f8cecc,stroke:#b85450
    style NBIISNET fill:#f8cecc,stroke:#b85450
    style DB fill:#dae8fc,stroke:#6c8ebf
</code></pre>
<center>Figure 1 - High-level diagram of the main application components and their interactions.</center>
<h3 id="12-solutions">1.2. Solutions</h3>
This section details the Visual Studio solutions found in the source code.
<div class="table-container">
<table>
<colgroup>
<col style="width: 33%" />
<col style="width: 33%" />
<col style="width: 33%" />
</colgroup>
<thead>
<tr>
<th style="text-align: left;">Solution</th>
<th style="text-align: left;">Projects</th>
<th style="text-align: left;">Visual Studio Version</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>CIControloComSetup.sln</strong></td>
<td style="text-align: left;">- <code>CIControlo.csproj</code><br>- <code>QueryForm.csproj</code><br>- <code>CIConfigGlobalParameters.csproj</code><br>- <code>CIConfiguration.csproj</code><br>- <code>CIActividades.csproj</code><br>- <code>CIReports.csproj</code><br>- <code>Alerta.csproj</code><br>- <code>CIServRemessas.csproj</code><br>- <code>CIServTester.csproj</code><br>- <code>CIServAlertas.csproj</code><br>- <code>CIServico.csproj</code><br>- <code>CIFicheirosControlo.csproj</code><br>- <code>CIFicheiro.csproj</code><br>- <code>MDIsControlo.csproj</code><br>- <code>MDIWebTransmCI.vbproj</code></td>
<td style="text-align: left;">2010</td>
</tr>
<tr>
<td style="text-align: left;"><strong>CIControloSemSetup.sln</strong></td>
<td style="text-align: left;">- <code>CIControlo.csproj</code><br>- <code>QueryForm.csproj</code><br>- <code>CIConfigGlobalParameters.csproj</code><br>- <code>CIConfiguration.csproj</code><br>- <code>CIActividades.csproj</code><br>- <code>CIReports.csproj</code><br>- <code>Alerta.csproj</code><br>- <code>CIServRemessas.csproj</code><br>- <code>CIServTester.csproj</code><br>- <code>CIServAlertas.csproj</code><br>- <code>CIServico.csproj</code><br>- <code>CIFicheirosControlo.csproj</code><br>- <code>CIFicheiro.csproj</code><br>- <code>MDIsControlo.csproj</code><br>- <code>MDIWebTransmCI.vbproj</code><br>- <code>CITestes.csproj</code><br>- <code>CIDepositoErro.csproj</code></td>
<td style="text-align: left;">2010</td>
</tr>
</tbody>
</table>
</div>
<pre class="mermaid"><code>mindmap
  root((SDCIM Application))
    CIControloComSetup.sln
      CIControlo.csproj
      QueryForm.csproj
      CIConfigGlobalParameters.csproj
      CIConfiguration.csproj
      CIActividades.csproj
      CIReports.csproj
      Alerta.csproj
      CIServRemessas.csproj
      CIServTester.csproj
      CIServAlertas.csproj
      CIServico.csproj
      CIFicheirosControlo.csproj
      CIFicheiro.csproj
      MDIsControlo.csproj
      MDIWebTransmCI.vbproj
    CIControloSemSetup.sln
      CIControlo.csproj
      QueryForm.csproj
      CIConfigGlobalParameters.csproj
      CIConfiguration.csproj
      CIActividades.csproj
      CIReports.csproj
      Alerta.csproj
      CIServRemessas.csproj
      CIServTester.csproj
      CIServAlertas.csproj
      CIServico.csproj
      CIFicheirosControlo.csproj
      CIFicheiro.csproj
      MDIsControlo.csproj
      MDIWebTransmCI.vbproj
      CITestes.csproj
      CIDepositoErro.csproj
</code></pre>
<center>Figure 2 - Mind map illustrating the two solutions and their constituent projects.</center>
<h3 id="13-projects">1.3. Projects</h3>
This section provides a detailed breakdown of each project within the solutions.
<div class="table-container">
<table>
<colgroup>
<col style="width: 7%" />
<col style="width: 7%" />
<col style="width: 7%" />
<col style="width: 7%" />
<col style="width: 7%" />
<col style="width: 7%" />
<col style="width: 7%" />
<col style="width: 7%" />
<col style="width: 7%" />
<col style="width: 7%" />
<col style="width: 7%" />
<col style="width: 7%" />
<col style="width: 7%" />
</colgroup>
<thead>
<tr>
<th style="text-align: left;">Solution</th>
<th style="text-align: left;">Project</th>
<th style="text-align: left;">Main objectives</th>
<th style="text-align: left;">Type</th>
<th style="text-align: left;">Output type</th>
<th style="text-align: left;">Version</th>
<th style="text-align: left;">Runtime</th>
<th style="text-align: left;">Framework</th>
<th style="text-align: left;">Architecture</th>
<th style="text-align: left;">Compilation mode</th>
<th style="text-align: left;">Principal classes</th>
<th style="text-align: left;">Internal dependencies</th>
<th style="text-align: left;">External dependencies</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;">Both</td>
<td style="text-align: left;"><strong>CIControlo.csproj</strong></td>
<td style="text-align: left;">Main executable for the Windows Forms application, likely the MDI host.</td>
<td style="text-align: left;">Windows Application</td>
<td style="text-align: left;">Executable</td>
<td style="text-align: left;">1.0.0.0</td>
<td style="text-align: left;">v4.0.30319</td>
<td style="text-align: left;">.NET Framework 4.0</td>
<td style="text-align: left;">AnyCPU</td>
<td style="text-align: left;">Debug/Release</td>
<td style="text-align: left;"><code>CIMainForm</code>, <code>Program</code></td>
<td style="text-align: left;"><code>CIActividades</code>, <code>CIConfiguration</code>, <code>CIConfigGlobalParameters</code>, <code>CIFicheiro</code>, <code>CIFicheirosControlo</code>, <code>CIReports</code>, <code>CIServTester</code>, <code>MDIsControlo</code>, <code>QueryForm</code></td>
<td style="text-align: left;"><code>GenericLogNET</code>, <code>GenericNet</code>, <code>NBIISNET</code></td>
</tr>
<tr>
<td style="text-align: left;">Both</td>
<td style="text-align: left;"><strong>CIActividades.csproj</strong></td>
<td style="text-align: left;">Provides the UI for monitoring activities, remittances, and reversals.</td>
<td style="text-align: left;">Class Library</td>
<td style="text-align: left;">Library</td>
<td style="text-align: left;">1.0.0.0</td>
<td style="text-align: left;">v4.0.30319</td>
<td style="text-align: left;">.NET Framework 4.0</td>
<td style="text-align: left;">AnyCPU</td>
<td style="text-align: left;">Debug/Release</td>
<td style="text-align: left;"><code>ActividadeBalcaoForm</code>, <code>ActividadesForm</code>, <code>PesquisasForm</code></td>
<td style="text-align: left;"><code>Alerta</code>, <code>CIConfigGlobalParameters</code></td>
<td style="text-align: left;"><code>CrystalDecisions</code>, <code>GenericLogNET</code>, <code>GenericNet</code>, <code>NBIISNET</code></td>
</tr>
<tr>
<td style="text-align: left;">Both</td>
<td style="text-align: left;"><strong>Alerta.csproj</strong></td>
<td style="text-align: left;">Defines data entities and logic for system alerts.</td>
<td style="text-align: left;">Class Library</td>
<td style="text-align: left;">Library</td>
<td style="text-align: left;">1.0.0.0</td>
<td style="text-align: left;">v4.0.30319</td>
<td style="text-align: left;">.NET Framework 4.0</td>
<td style="text-align: left;">AnyCPU</td>
<td style="text-align: left;">Debug/Release</td>
<td style="text-align: left;"><code>Accao</code>, <code>AlertaSituacaoAccao</code></td>
<td style="text-align: left;"><code>CIConfigGlobalParameters</code></td>
<td style="text-align: left;"><code>GenericNet</code>, <code>System.Data</code></td>
</tr>
<tr>
<td style="text-align: left;">Both</td>
<td style="text-align: left;"><strong>CIServico.csproj</strong></td>
<td style="text-align: left;">The Windows Service project that hosts background processing tasks.</td>
<td style="text-align: left;">Windows Application</td>
<td style="text-align: left;">Executable</td>
<td style="text-align: left;">1.0.0.0</td>
<td style="text-align: left;">v4.0.30319</td>
<td style="text-align: left;">.NET Framework 4.0</td>
<td style="text-align: left;">AnyCPU</td>
<td style="text-align: left;">Debug/Release</td>
<td style="text-align: left;"><code>CIServico</code>, <code>CIServicoThread</code></td>
<td style="text-align: left;"><code>Alerta</code>, <code>CIConfigGlobalParameters</code>, <code>CIFicheiro</code>, <code>CIServAlertas</code>, <code>CIServRemessas</code></td>
<td style="text-align: left;"><code>GenericLogNET</code>, <code>GenericNet</code>, <code>NBIISNET</code></td>
</tr>
<tr>
<td style="text-align: left;">Both</td>
<td style="text-align: left;"><strong>CIServRemessas.csproj</strong></td>
<td style="text-align: left;">Contains the core business logic for processing remittances.</td>
<td style="text-align: left;">Class Library</td>
<td style="text-align: left;">Library</td>
<td style="text-align: left;">1.0.0.0</td>
<td style="text-align: left;">v4.0.30319</td>
<td style="text-align: left;">.NET Framework 4.0</td>
<td style="text-align: left;">AnyCPU</td>
<td style="text-align: left;">Debug/Release</td>
<td style="text-align: left;"><code>ServRemessa</code></td>
<td style="text-align: left;"><code>Alerta</code>, <code>CIActividades</code>, <code>CIConfigGlobalParameters</code></td>
<td style="text-align: left;"><code>GenericLogNET</code>, <code>GenericNet</code>, <code>NBIISNET</code></td>
</tr>
<tr>
<td style="text-align: left;">Both</td>
<td style="text-align: left;"><strong>MDIWebTransmCI.vbproj</strong></td>
<td style="text-align: left;">A VB.NET project for web service communication, likely for transmitting MDI documents.</td>
<td style="text-align: left;">Class Library</td>
<td style="text-align: left;">Library</td>
<td style="text-align: left;">1.0.0.0</td>
<td style="text-align: left;">v4.0.30319</td>
<td style="text-align: left;">.NET Framework 4.0</td>
<td style="text-align: left;">AnyCPU</td>
<td style="text-align: left;">Debug/Release</td>
<td style="text-align: left;"><code>TInsertDoc</code></td>
<td style="text-align: left;"><code>CIConfigGlobalParameters</code></td>
<td style="text-align: left;"><code>CCAGeneric</code>, <code>CCAWebTransmCI</code></td>
</tr>
<tr>
<td style="text-align: left;">Both</td>
<td style="text-align: left;"><strong>CIConfigGlobalParameters.csproj</strong></td>
<td style="text-align: left;">A shared library for global configuration parameters and interfaces.</td>
<td style="text-align: left;">Class Library</td>
<td style="text-align: left;">Library</td>
<td style="text-align: left;">1.0.0.0</td>
<td style="text-align: left;">v4.0.30319</td>
<td style="text-align: left;">.NET Framework 4.0</td>
<td style="text-align: left;">AnyCPU</td>
<td style="text-align: left;">Debug/Release</td>
<td style="text-align: left;"><code>CIGlobalParameters</code>, <code>User</code></td>
<td style="text-align: left;"><code>System.Windows.Forms</code></td>
<td style="text-align: left;"><code>GenericLogNET</code>, <code>GenericNet</code>, <code>NBIISNET</code></td>
</tr>
<tr>
<td style="text-align: left;">Both</td>
<td style="text-align: left;"><strong>CIConfiguration.csproj</strong></td>
<td style="text-align: left;">Manages application configuration, including users and branches (<code>Balcao</code>).</td>
<td style="text-align: left;">Class Library</td>
<td style="text-align: left;">Library</td>
<td style="text-align: left;">1.0.0.0</td>
<td style="text-align: left;">v4.0.30319</td>
<td style="text-align: left;">.NET Framework 4.0</td>
<td style="text-align: left;">AnyCPU</td>
<td style="text-align: left;">Debug/Release</td>
<td style="text-align: left;"><code>Config</code>, <code>Balcao</code>, <code>Maquina</code></td>
<td style="text-align: left;"><code>Alerta</code>, <code>CIConfigGlobalParameters</code></td>
<td style="text-align: left;"><code>GenericLogNET</code>, <code>GenericNet</code>, <code>NBIISNET</code></td>
</tr>
<tr>
<td style="text-align: left;">Both</td>
<td style="text-align: left;"><strong>CIFicheiro.csproj</strong></td>
<td style="text-align: left;">Logic for handling file-based operations (ACOM, ENVM).</td>
<td style="text-align: left;">Class Library</td>
<td style="text-align: left;">Library</td>
<td style="text-align: left;">1.0.0.0</td>
<td style="text-align: left;">v4.0.30319</td>
<td style="text-align: left;">.NET Framework 4.0</td>
<td style="text-align: left;">AnyCPU</td>
<td style="text-align: left;">Debug/Release</td>
<td style="text-align: left;"><code>FicheiroAcom</code>, <code>FicheiroEnvm</code></td>
<td style="text-align: left;"><code>CIConfigGlobalParameters</code></td>
<td style="text-align: left;"><code>GenericLogNET</code>, <code>GenericNet</code>, <code>NBIISNET</code></td>
</tr>
<tr>
<td style="text-align: left;">Both</td>
<td style="text-align: left;"><strong>CIFicheirosControlo.csproj</strong></td>
<td style="text-align: left;">UI components for managing and monitoring file imports.</td>
<td style="text-align: left;">Class Library</td>
<td style="text-align: left;">Library</td>
<td style="text-align: left;">1.0.0.0</td>
<td style="text-align: left;">v4.0.30319</td>
<td style="text-align: left;">.NET Framework 4.0</td>
<td style="text-align: left;">AnyCPU</td>
<td style="text-align: left;">Debug/Release</td>
<td style="text-align: left;"><code>FicheiroFormCentralENVM</code>, <code>FicheiroFormCentralACOM</code></td>
<td style="text-align: left;"><code>CIConfigGlobalParameters</code>, <code>CIFicheiro</code></td>
<td style="text-align: left;"><code>GenericLogNET</code>, <code>GenericNet</code>, <code>NBIISNET</code></td>
</tr>
<tr>
<td style="text-align: left;">Both</td>
<td style="text-align: left;"><strong>CIReports.csproj</strong></td>
<td style="text-align: left;">Handles the generation of Crystal Reports for the application.</td>
<td style="text-align: left;">Class Library</td>
<td style="text-align: left;">Library</td>
<td style="text-align: left;">1.0.0.0</td>
<td style="text-align: left;">v4.0.30319</td>
<td style="text-align: left;">.NET Framework 4.0</td>
<td style="text-align: left;">AnyCPU</td>
<td style="text-align: left;">Debug/Release</td>
<td style="text-align: left;"><code>ListagemRemessas</code>, <code>AcomResumo</code></td>
<td style="text-align: left;"><code>CIConfigGlobalParameters</code></td>
<td style="text-align: left;"><code>CrystalDecisions.*</code>, <code>GenericReportNet</code></td>
</tr>
<tr>
<td style="text-align: left;">Both</td>
<td style="text-align: left;"><strong>CIServAlertas.csproj</strong></td>
<td style="text-align: left;">Service logic for processing alerts, including sending emails and writing to logs.</td>
<td style="text-align: left;">Class Library</td>
<td style="text-align: left;">Library</td>
<td style="text-align: left;">1.0.0.0</td>
<td style="text-align: left;">v4.0.30319</td>
<td style="text-align: left;">.NET Framework 4.0</td>
<td style="text-align: left;">AnyCPU</td>
<td style="text-align: left;">Debug/Release</td>
<td style="text-align: left;"><code>ServAlerta</code>, <code>ServAlertasSendWebmail</code></td>
<td style="text-align: left;"><code>Alerta</code>, <code>CIConfigGlobalParameters</code></td>
<td style="text-align: left;"><code>CGDSendWebmail</code>, <code>GenericLogNET</code></td>
</tr>
<tr>
<td style="text-align: left;">Both</td>
<td style="text-align: left;"><strong>CIServTester.csproj</strong></td>
<td style="text-align: left;">A library for testing the core services.</td>
<td style="text-align: left;">Class Library</td>
<td style="text-align: left;">Library</td>
<td style="text-align: left;">1.0.0.0</td>
<td style="text-align: left;">v4.0.30319</td>
<td style="text-align: left;">.NET Framework 4.0</td>
<td style="text-align: left;">AnyCPU</td>
<td style="text-align: left;">Debug/Release</td>
<td style="text-align: left;"><code>ProcessarRemessas</code>, <code>ProcessarAlertas</code></td>
<td style="text-align: left;"><code>Alerta</code>, <code>CIConfigGlobalParameters</code>, <code>CIServAlertas</code>, <code>CIServRemessas</code></td>
<td style="text-align: left;"><code>GenericLogNET</code>, <code>GenericNet</code></td>
</tr>
<tr>
<td style="text-align: left;">Both</td>
<td style="text-align: left;"><strong>MDIsControlo.csproj</strong></td>
<td style="text-align: left;">UI and logic for controlling Multi-Function Devices (MDIs).</td>
<td style="text-align: left;">Class Library</td>
<td style="text-align: left;">Library</td>
<td style="text-align: left;">1.0.0.0</td>
<td style="text-align: left;">v4.0.30319</td>
<td style="text-align: left;">.NET Framework 4.0</td>
<td style="text-align: left;">AnyCPU</td>
<td style="text-align: left;">Debug/Release</td>
<td style="text-align: left;"><code>MDIsControloForm</code>, <code>Documento<em>02</em>MDI</code></td>
<td style="text-align: left;"><code>CIConfigGlobalParameters</code>, <code>MDIWebTransmCI</code></td>
<td style="text-align: left;"><code>CCAGeneric</code>, <code>GenericNet</code></td>
</tr>
<tr>
<td style="text-align: left;">Both</td>
<td style="text-align: left;"><strong>QueryForm.csproj</strong></td>
<td style="text-align: left;">A utility form for running SQL queries against the database.</td>
<td style="text-align: left;">Class Library</td>
<td style="text-align: left;">Library</td>
<td style="text-align: left;">1.0.0.0</td>
<td style="text-align: left;">v4.0.30319</td>
<td style="text-align: left;">.NET Framework 4.0</td>
<td style="text-align: left;">AnyCPU</td>
<td style="text-align: left;">Debug/Release</td>
<td style="text-align: left;"><code>QueryForm</code></td>
<td style="text-align: left;"><code>CIConfigGlobalParameters</code></td>
<td style="text-align: left;"><code>GenericLogNET</code>, <code>GenericNet</code></td>
</tr>
<tr>
<td style="text-align: left;">SemSetup</td>
<td style="text-align: left;"><strong>CITestes.csproj</strong></td>
<td style="text-align: left;">A unit test project.</td>
<td style="text-align: left;">Class Library</td>
<td style="text-align: left;">Library</td>
<td style="text-align: left;">1.0.0.0</td>
<td style="text-align: left;">v4.0.30319</td>
<td style="text-align: left;">.NET Framework 4.0</td>
<td style="text-align: left;">AnyCPU</td>
<td style="text-align: left;">Debug/Release</td>
<td style="text-align: left;"><code>CIServRemessaTestes</code></td>
<td style="text-align: left;"><code>CIControlo</code>, <code>CIServico</code>, <code>CIServRemessas</code>, <code>CIServTester</code></td>
<td style="text-align: left;"><code>Microsoft.VisualStudio.QualityTools.UnitTestFramework</code></td>
</tr>
<tr>
<td style="text-align: left;">SemSetup</td>
<td style="text-align: left;"><strong>CIDepositoErro.csproj</strong></td>
<td style="text-align: left;">Project to handle deposit errors (details inferred).</td>
<td style="text-align: left;">Class Library</td>
<td style="text-align: left;">Library</td>
<td style="text-align: left;">1.0.0.0</td>
<td style="text-align: left;">v4.0.30319</td>
<td style="text-align: left;">.NET Framework 4.0</td>
<td style="text-align: left;">AnyCPU</td>
<td style="text-align: left;">Debug/Release</td>
<td style="text-align: left;">(Inferred) <code>DepositoErroForm</code></td>
<td style="text-align: left;"><code>CIConfigGlobalParameters</code></td>
<td style="text-align: left;"><code>GenericNet</code></td>
</tr>
</tbody>
</table>
</div>
<pre class="mermaid"><code>flowchart TD
    subgraph "Main Application"
        CIControlo["CIControlo.csproj (WinExe)"]
    end

    subgraph "UI & Activities"
        CIActividades["CIActividades.csproj"]
        CIFicheirosControlo["CIFicheirosControlo.csproj"]
        MDIsControlo["MDIsControlo.csproj"]
        QueryForm["QueryForm.csproj"]
    end

    subgraph "Core Services & Logic"
        CIServico["CIServico.csproj (WinExe)"]
        CIServRemessas["CIServRemessas.csproj"]
        CIServAlertas["CIServAlertas.csproj"]
        Alerta["Alerta.csproj"]
        CIFicheiro["CIFicheiro.csproj"]
    end

    subgraph "Configuration & Shared"
        CIConfiguration["CIConfiguration.csproj"]
        CIConfigGlobalParameters["CIConfigGlobalParameters.csproj"]
    end
    
    subgraph "Testing"
        CITestes["CITestes.csproj"]
        CIServTester["CIServTester.csproj"]
    end

    subgraph "External/Legacy"
        MDIWebTransmCI["MDIWebTransmCI.vbproj"]
        CIReports["CIReports.csproj"]
        CIDepositoErro["CIDepositoErro.csproj"]
    end

    CIControlo --> CIActividades
    CIControlo --> CIFicheirosControlo
    CIControlo --> MDIsControlo
    CIControlo --> QueryForm
    CIControlo --> CIReports
    
    CIActividades --> CIConfiguration
    CIActividades --> Alerta
    MDIsControlo --> MDIWebTransmCI

    CIServico --> CIServRemessas
    CIServico --> CIServAlertas
    CIServico --> CIFicheiro
    
    CITestes --> CIServTester
    CITestes --> CIServRemessas
    CIServTester --> CIServRemessas
    CIServTester --> CIServAlertas

    CIActividades --> CIConfigGlobalParameters
    CIServico --> CIConfigGlobalParameters
    CIConfiguration --> CIConfigGlobalParameters
</code></pre>
<center>Figure 3 - Project dependency graph showing the relationships between the various projects.</center>
</div>
<div class="product-section">
<h2 id="2-functional-overview">2. Functional overview</h2>
This section provides a high-level functional decomposition of the application, identifying the major, distinct functional blocks or modules as inferred from the code's high-level structure (e.g., top-level namespaces, solution folders, primary class groups). This overview serves as a map to the application's core responsibilities.
<h3 id="21-executive-summary">2.1. Executive summary</h3>
This section provides a high-level summary of the application's primary purpose and its core function from a business or operational perspective.
<div class="table-container">
<table>
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr>
<th style="text-align: left;">Field</th>
<th style="text-align: left;">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>Application's Primary Purpose</strong></td>
<td style="text-align: left;">The application, "Serviço de Depósito e Captura de Imagens" (SDCIM), is a comprehensive back-office system designed to automate the processing of bank remittances from various sources, including bank branches (<code>Balcão</code>) and potentially other channels.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Core Function</strong></td>
<td style="text-align: left;">Its core function is to manage the lifecycle of a <code>Remessa</code> (remittance), which involves receiving data, processing it in <code>Tranches</code>, handling individual <code>Documentos</code> (likely cheques), managing their state, and generating alerts for operational monitoring. The system includes a Windows Forms UI (<code>CIControlo</code>) for manual monitoring, intervention, and configuration, and a Windows Service (<code>CIServico</code>) for automated background processing.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Key Inferred Processes</strong></td>
<td style="text-align: left;">- <strong>Remittance Processing</strong>: Automated workflow to process incoming remittances, validate data, and update statuses.<br>- <strong>Alert Management</strong>: A rule-based system to trigger notifications (Email, DB logs) for specific system events or errors.<br>- <strong>Manual Operations & Monitoring</strong>: A user-facing desktop application allowing operators to view activities, manage entities, and resolve issues.<br>- <strong>Configuration</strong>: Management of system parameters, user roles, and branch (<code>Balcao</code>) configurations.</td>
</tr>
</tbody>
</table>
</div>
<h3 id="22-functional-decomposition">2.2. Functional decomposition</h3>
This section provides a detailed breakdown of the application's functional areas or modules, inferred from the code structure. Each module is described in terms of its primary responsibilities and how it contributes to the overall functionality of the application.
<div class="table-container">
<table>
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr>
<th style="text-align: left;">Functional Area / Module</th>
<th style="text-align: left;">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>User Interaction & Presentation</strong></td>
<td style="text-align: left;">Manages the graphical user interface for operators. This includes forms for monitoring activities, managing configurations, viewing reports, and manually intervening in processes. It is the primary interface between users and the system's core logic. Inferred from <code>CIActividades</code>, <code>CIConfiguration</code>, <code>CIFicheirosControlo</code>, and <code>MDIsControlo</code> projects.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Core Process Execution Engine</strong></td>
<td style="text-align: left;">The heart of the application, running as a background Windows Service. It orchestrates the automated processing of remittances, alerts, and file imports. It operates based on timers and database queues. Inferred from the <code>CIServico</code> and <code>CIServTester</code> projects.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Remittance & Document Logic</strong></td>
<td style="text-align: left;">Contains the specific business rules for handling remittances. This includes logic for breaking remittances into tranches, processing individual documents, validating data, and managing state transitions. Inferred from the <code>CIServRemessas</code> project and classes like <code>DetalheRemessa</code>.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Alerting & Notification</strong></td>
<td style="text-align: left;">A dedicated subsystem for generating and dispatching alerts. It defines different alert types (e.g., email, log) and the conditions under which they are triggered. Inferred from the <code>Alerta</code> and <code>CIServAlertas</code> projects.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Data Persistence & Management</strong></td>
<td style="text-align: left;">Handles all interactions with the underlying SQL Server database. This includes direct SQL queries for fetching data, updating records, and executing stored procedures. It provides a data access layer for other modules. Inferred from the use of <code>System.Data.SqlClient</code> and direct SQL in various classes.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Configuration Management</strong></td>
<td style="text-align: left;">Manages global and user-specific application settings, including database connections, user profiles, and operational parameters. Inferred from the <code>CIConfigGlobalParameters</code> and <code>CIConfiguration</code> projects.</td>
</tr>
</tbody>
</table>
</div>
<pre class="mermaid"><code>flowchart TD
    subgraph "User-Facing Layer"
        A["User Interaction & Presentation (WinForms)"]
    end

    subgraph "Application Core"
        B["Core Process Execution Engine (Windows Service)"]
    end
    
    subgraph "Business Logic Layer"
        C["Remittance & Document Logic"]
        D["Alerting & Notification"]
        E["Configuration Management"]
    end

    subgraph "Data Layer"
        F["Data Persistence & Management (ADO.NET)"]
        G[("SQL Server Database")]
    end

    A -->|"Initiates/Monitors"| B
    A -->|"Configures"| E
    
    B -->|"Executes"| C
    B -->|"Triggers"| D
    
    C -->|"Uses"| F
    D -->|"Uses"| F
    E -->|"Uses"| F

    F -->|"Accesses"| G
</code></pre>
<center>Figure 4 - Functional decomposition of the application, showing the layered architecture.</center>
<h3 id="23-user-roles-and-permissions">2.3. User roles and permissions</h3>
This section identifies all distinct types of users that interact with the application, inferred from authentication and authorization logic.
<div class="table-container">
<table>
<colgroup>
<col style="width: 16%" />
<col style="width: 16%" />
<col style="width: 16%" />
<col style="width: 16%" />
<col style="width: 16%" />
<col style="width: 16%" />
</colgroup>
<thead>
<tr>
<th style="text-align: left;">Role</th>
<th style="text-align: left;">Description</th>
<th style="text-align: left;">Permissions</th>
<th style="text-align: left;">Key Actions</th>
<th style="text-align: left;">Key Data Entities</th>
<th style="text-align: left;">Assumptions</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>Administrator / Privileged User</strong></td>
<td style="text-align: left;">A user with elevated privileges, likely responsible for system configuration and manual intervention in failed processes.</td>
<td style="text-align: left;">- Full access to all UI features.<br>- Ability to change the state of remittances and tranches.<br>- Can trigger manual re-processing of failed items.</td>
<td style="text-align: left;"><code>MudarEstado</code>, <code>Reenviar remessas em erro</code>, <code>ConfirmaPrivilegios</code></td>
<td style="text-align: left;"><code>Remessa</code>, <code>Tranche</code>, <code>User</code>, <code>Balcao</code>, <code>Maquina</code></td>
<td style="text-align: left;">Inferred from the <code>ConfirmaPrivilegios()</code> method in <code>ActividadeBalcaoForm.cs</code> which checks <code>m<em>oParameters.UserLogged.m</em>iUserGroup <= 1</code>.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Standard Operator</strong></td>
<td style="text-align: left;">A standard user responsible for monitoring the system's activities and viewing data.</td>
<td style="text-align: left;">- Read-only access to most data.<br>- Cannot change the state of entities or perform administrative actions.</td>
<td style="text-align: left;"><code>ViewRemittances</code>, <code>ViewDocuments</code>, <code>ViewAlerts</code></td>
<td style="text-align: left;"><code>Remessa</code>, <code>Tranche</code>, <code>Documento</code>, <code>Alerta</code></td>
<td style="text-align: left;">Inferred as any user with <code>m_iUserGroup > 1</code>. Assumed to have view-only rights on operational data.</td>
</tr>
</tbody>
</table>
</div>
<pre class="mermaid"><code>classDiagram
    class User {
        +m_sUserName: string
        +m_iUserGroup: int
    }
    
    class Administrator {
        <<Role>>
        +m_iUserGroup: 1
    }

    class StandardOperator {
        <<Role>>
        +m_iUserGroup: >1
    }

    class Remessa {
        +remId: int
        +estadoId: int
        +ChangeEstado()
    }
    
    class Tranche {
        +transId: int
        +estadoId: int
        +ChangeEstado()
    }
    
    class SystemConfiguration {
        +ParameterName: string
        +ParameterValue: string
    }

    User <|-- Administrator
    User <|-- StandardOperator
    
    Administrator --|> Remessa : "Manages"
    Administrator --|> Tranche : "Manages"
    Administrator --|> SystemConfiguration : "Configures"

    StandardOperator ..> Remessa : "Views"
    StandardOperator ..> Tranche : "Views"
</code></pre>
<center>Figure 5 - Class diagram illustrating the relationship between user roles and key entities.</center>
<h3 id="24-core-business-capabilities">2.4. Core business capabilities</h3>
This section lists the main, high-level capabilities of the application, representing its major functional domains.
<div class="table-container">
<table>
<colgroup>
<col style="width: 20%" />
<col style="width: 20%" />
<col style="width: 20%" />
<col style="width: 20%" />
<col style="width: 20%" />
</colgroup>
<thead>
<tr>
<th style="text-align: left;">Capability</th>
<th style="text-align: left;">Description</th>
<th style="text-align: left;">Key Features</th>
<th style="text-align: left;">Key Data Entities</th>
<th style="text-align: left;">Assumptions</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>Remittance Lifecycle Management</strong></td>
<td style="text-align: left;">The complete set of functions for processing bank remittances from ingestion to final state.</td>
<td style="text-align: left;">- Remittance creation and opening.<br>- Processing of tranches and documents.<br>- State transitions (e.g., Pending, Processing, Complete, Error).<br>- Reversal (<code>Estorno</code>) processing.</td>
<td style="text-align: left;"><code>Remessa</code>, <code>Tranche</code>, <code>Documento</code></td>
<td style="text-align: left;">Assumes that any module with "Remessa" or "Tranche" in its name is part of this capability. Inferred from <code>CIServRemessas</code> and <code>ActividadeBalcaoForm</code>.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>System Monitoring & Control</strong></td>
<td style="text-align: left;">Provides operators with the tools to view, monitor, and manually control the application's automated processes.</td>
<td style="text-align: left;">- Real-time activity dashboard.<br>- Detailed views for remittances, tranches, and documents.<br>- Manual state change functionality for privileged users.<br>- Image viewing for documents.</td>
<td style="text-align: left;"><code>Remessa</code>, <code>Tranche</code>, <code>Documento</code>, <code>Alerta</code></td>
<td style="text-align: left;">Inferred from the extensive UI components in the <code>CIActividades</code> project, such as <code>ActividadeBalcaoForm</code> and its various <code>ListView</code> controls.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Alerting and Notifications</strong></td>
<td style="text-align: left;">A proactive system for notifying operators or systems about important events, errors, or predefined conditions.</td>
<td style="text-align: left;">- Triggering alerts based on situations.<br>- Sending notifications via Email (WebDAV, EWS).<br>- Logging alerts to the database or files.<br>- Writing to the Windows Event Viewer.</td>
<td style="text-align: left;"><code>Alerta</code>, <code>Accao</code>, <code>SituacaoAccao</code></td>
<td style="text-align: left;">Inferred from the <code>Alerta</code> and <code>CIServAlertas</code> projects and the <code>enuTipoAccao</code> enum which lists notification channels.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>System Configuration</strong></td>
<td style="text-align: left;">Allows administrators to configure operational parameters, users, and system integrations.</td>
<td style="text-align: left;">- User and group management.<br>- <code>Balcao</code> (Branch) and <code>Maquina</code> (Machine) configuration.<br>- Setting processing parameters (e.g., timers, batch sizes).</td>
<td style="text-align: left;"><code>User</code>, <code>Balcao</code>, <code>Maquina</code>, <code>CIGlobalParameters</code></td>
<td style="text-align: left;">Inferred from the <code>CIConfiguration</code> project and the various forms for managing system entities.</td>
</tr>
</tbody>
</table>
</div>
<h3 id="25-detailed-feature-breakdown">2.5. Detailed feature breakdown</h3>
This section provides a granular breakdown of individual features within each Core Business Capability.
<div class="table-container">
<table>
<colgroup>
<col style="width: 25%" />
<col style="width: 25%" />
<col style="width: 25%" />
<col style="width: 25%" />
</colgroup>
<thead>
<tr>
<th style="text-align: left;">Feature</th>
<th style="text-align: left;">User Story / Description</th>
<th style="text-align: left;">Key Data Entities</th>
<th style="text-align: left;">Assumptions</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>Process a Bank Remittance</strong></td>
<td style="text-align: left;">As a System, I can fetch a pending remittance from the database, process its associated tranches and documents, and update its status to 'Processed' or 'Error'.</td>
<td style="text-align: left;"><code>Remessa</code>, <code>Tranche</code>, <code>Documento</code></td>
<td style="text-align: left;">Inferred from the <code>ProcessarTrancheBalcao</code> and <code>ServRemessa</code> classes, which contain methods like <code>RemessaBalcaoParaProcessar</code> and <code>TratarTranchesBalcao</code>.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Monitor Branch Activities</strong></td>
<td style="text-align: left;">As an Operator, I can view a dashboard summarizing all remittance and reversal activities, filtered by date, branch, and status, so that I can monitor the system's health.</td>
<td style="text-align: left;"><code>Remessa</code>, <code>Documento</code></td>
<td style="text-align: left;">Inferred from the UI layout in <code>ActividadeBalcaoForm.Designer.cs</code>, which includes date pickers, text boxes for filtering, and multiple <code>ListView</code> controls for displaying summaries.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Manually Change Remittance State</strong></td>
<td style="text-align: left;">As an Administrator, I can select a specific remittance or tranche and manually change its processing state to resolve an error or force reprocessing.</td>
<td style="text-align: left;"><code>Remessa</code>, <code>Tranche</code></td>
<td style="text-align: left;">Inferred from the <code>MudarEstadoForm</code> and the context menu items like <code>toolStripMenuRemessaMudarEstado_Click</code> in <code>ActividadeBalcaoForm.cs</code>.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Send Alert Email</strong></td>
<td style="text-align: left;">As the System, when a critical situation occurs (e.g., processing error), I can send an email notification to a predefined recipient list so that operators are alerted immediately.</td>
<td style="text-align: left;"><code>Alerta</code>, <code>Accao</code>, <code>SituacaoAccao</code></td>
<td style="text-align: left;">Inferred from <code>ServAlerta.cs</code> and the <code>Accao.enuTipoAccao.MAILEWS</code> enum value, which triggers the <code>ProcessaAlertaSituacaoAccaoMail</code> method.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>View Document Image</strong></td>
<td style="text-align: left;">As an Operator, I can double-click a document in the activity monitor to view its scanned image, so that I can visually verify its details.</td>
<td style="text-align: left;"><code>Documento</code>, <code>Imagem</code></td>
<td style="text-align: left;">Inferred from the <code>ImagemBalcaoForm</code> and the <code>listViewDetalhesDocumentos_DoubleClick</code> event handler which opens this form.</td>
</tr>
</tbody>
</table>
</div>
<h3 id="26-key-data-entities-and-their-attributes">2.6. Key data entities and their attributes</h3>
This section documents the application's core data structures, as inferred from class definitions or ORM configurations.
<div class="table-container">
<table>
<colgroup>
<col style="width: 14%" />
<col style="width: 14%" />
<col style="width: 14%" />
<col style="width: 14%" />
<col style="width: 14%" />
<col style="width: 14%" />
<col style="width: 14%" />
</colgroup>
<thead>
<tr>
<th style="text-align: left;">Entity</th>
<th style="text-align: left;">Description</th>
<th style="text-align: left;">Key Attributes</th>
<th style="text-align: left;">Data Type</th>
<th style="text-align: left;">Validation Rules</th>
<th style="text-align: left;">Relationships</th>
<th style="text-align: left;">Assumptions</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>Remessa</strong></td>
<td style="text-align: left;">Represents a bank remittance, which is a collection of financial documents (like cheques) submitted for processing.</td>
<td style="text-align: left;"><code>remId</code>, <code>remData</code>, <code>estadoId</code>, <code>balcaoGestor</code>, <code>numRemessa</code>, <code>montante</code></td>
<td style="text-align: left;"><code>int</code>, <code>DateTime</code>, <code>int</code>, <code>string</code>, <code>int</code>, <code>double</code></td>
<td style="text-align: left;"><code>remId</code> is the primary key. <code>estadoId</code> must be a valid state.</td>
<td style="text-align: left;">One-to-many with <code>Tranche</code>.</td>
<td style="text-align: left;">Inferred from classes <code>DetalheRemessa</code> and <code>RemessasResumoBalcao</code>. Assumes <code>remId</code> is a primary key.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Tranche</strong></td>
<td style="text-align: left;">A logical batch or sub-group of documents within a single remittance.</td>
<td style="text-align: left;"><code>transId</code>, <code>remId</code>, <code>estadoId</code>, <code>numero</code>, <code>quantidade</code>, <code>montante</code></td>
<td style="text-align: left;"><code>int</code>, <code>int</code>, <code>int</code>, <code>int</code>, <code>int</code>, <code>double</code></td>
<td style="text-align: left;"><code>transId</code> is the primary key. <code>remId</code> is a foreign key to <code>Remessa</code>.</td>
<td style="text-align: left;">Many-to-one with <code>Remessa</code>. One-to-many with <code>Documento</code>.</td>
<td style="text-align: left;">Inferred from the <code>DetalheTranche</code> class.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Documento</strong></td>
<td style="text-align: left;">Represents a single financial document, such as a cheque, with its associated metadata and image.</td>
<td style="text-align: left;"><code>docID</code>, <code>transId</code>, <code>ZIB</code>, <code>numConta</code>, <code>numCheque</code>, <code>montante</code>, <code>estadoDocId</code></td>
<td style="text-align: left;"><code>int</code>, <code>int</code>, <code>string</code>, <code>string</code>, <code>string</code>, <code>double</code>, <code>int</code></td>
<td style="text-align: left;"><code>docID</code> is the primary key. <code>transId</code> is a foreign key to <code>Tranche</code>.</td>
<td style="text-align: left;">Many-to-one with <code>Tranche</code>.</td>
<td style="text-align: left;">Inferred from the <code>DetalheDocumento</code> class. <code>ZIB</code>, <code>numConta</code>, and <code>numCheque</code> likely correspond to the MICR line of a cheque.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Alerta</strong></td>
<td style="text-align: left;">An alert generated by the system in response to a specific event or condition.</td>
<td style="text-align: left;"><code>ALERT<em>ID</code>, <code>AL</em>TIMER</code>, <code>AL<em>TEXT</code>, <code>SITUACAO</em>ID</code></td>
<td style="text-align: left;"><code>string</code>, <code>DateTime</code>, <code>string</code>, <code>int</code></td>
<td style="text-align: left;"><code>ALERT<em>ID</code> is the primary key. <code>SITUACAO</em>ID</code> links to a predefined situation.</td>
<td style="text-align: left;">Many-to-many with <code>Accao</code> through <code>ALERTA<em>ALERTA</em>ACCAO</code>.</td>
<td style="text-align: left;">Inferred from the <code>AlertaSituacaoAccao</code> class and its database update queries.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Accao</strong></td>
<td style="text-align: left;">A predefined action to be taken when an alert is triggered, such as sending an email or logging to a file.</td>
<td style="text-align: left;"><code>ACC<em>ID</code>, <code>ACC</em>DESC</code>, <code>TIPACC<em>ID</code></td>
<td style="text-align: left;"><code>int</code>, <code>string</code>, <code>enum</code></td>
<td style="text-align: left;"><code>ACC</em>ID</code> is the primary key. <code>TIPACC_ID</code> defines the action type.</td>
<td style="text-align: left;">Many-to-many with <code>Alerta</code>.</td>
<td style="text-align: left;">Inferred from the <code>Accao</code> class and its <code>enuTipoAccao</code> enum.</td>
</tr>
</tbody>
</table>
</div>
<pre class="mermaid"><code>erDiagram
    Remessa {
        int remId PK
        datetime remData
        int estadoId
        string balcaoGestor
        double montante
    }

    Tranche {
        int transId PK
        int remId FK
        int estadoId
        int quantidade
        double montante
    }

    Documento {
        int docID PK
        int transId FK
        string ZIB
        string numConta
        string numCheque
        double montante
        int estadoDocId
    }

    Alerta {
        string ALERT_ID PK
        datetime AL_TIMER
        string AL_TEXT
        int SITUACAO_ID FK
    }

    Accao {
        int ACC_ID PK
        string ACC_DESC
        int TIPACC_ID
    }

    SituacaoAccao {
        int SITUACAO_ID PK
        int ACC_ID PK
    }

    Remessa ||--o{ Tranche : "contains"
    Tranche ||--o{ Documento : "contains"
    Alerta }o--|| SituacaoAccao : "triggers"
    Accao }o--|| SituacaoAccao : "is executed for"
</code></pre>
<center>Figure 6 - Entity-Relationship diagram showing the core data entities and their relationships.</center>
<h3 id="27-business-process-workflows">2.7. Business process workflows</h3>
This section describes and visualizes critical end-to-end processes, showing how different user roles and system features interact.
<div class="table-container">
<table>
<colgroup>
<col style="width: 16%" />
<col style="width: 16%" />
<col style="width: 16%" />
<col style="width: 16%" />
<col style="width: 16%" />
<col style="width: 16%" />
</colgroup>
<thead>
<tr>
<th style="text-align: left;">Process</th>
<th style="text-align: left;">Description</th>
<th style="text-align: left;">Key Steps</th>
<th style="text-align: left;">User Roles Involved</th>
<th style="text-align: left;">Key Data Entities</th>
<th style="text-align: left;">Assumptions</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>Remittance Processing Workflow</strong></td>
<td style="text-align: left;">A workflow that outlines the steps involved in processing a bank remittance from reception to final status update.</td>
<td style="text-align: left;">1. Fetch pending remittance (<code>REMIN_IDParaProcessar</code>).<br>2. Set status to 'Processing'.<br>3. Process documents in tranches (<code>TratarTranchesBalcao</code>).<br>4. Update document and tranche statuses.<br>5. Set final remittance status ('Processed' or 'Error').</td>
<td style="text-align: left;">System (automated), Administrator (for error resolution)</td>
<td style="text-align: left;"><code>Remessa</code>, <code>Tranche</code>, <code>Documento</code></td>
<td style="text-align: left;">Inferred from the sequence of method calls in <code>CIServRemessaTestes.cs</code> and the logic within <code>ServRemessa.cs</code>.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Alert Notification Workflow</strong></td>
<td style="text-align: left;">A workflow for handling system-generated alerts.</td>
<td style="text-align: left;">1. Identify a pending alert (<code>AlertaSituacaoAccaoParaProcessar</code>).<br>2. Determine the action type (Email, Log, etc.).<br>3. Execute the corresponding action.<br>4. Update alert status to 'Processed' (<code>SetProcessado</code>) or 'Error' (<code>SetErroProcessamento</code>).</td>
<td style="text-align: left;">System (automated)</td>
<td style="text-align: left;"><code>Alerta</code>, <code>Accao</code>, <code>SituacaoAccao</code></td>
<td style="text-align: left;">Inferred from the <code>ServAlerta.cs</code> class, which orchestrates fetching and processing alerts based on their type.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Manual State Correction Workflow</strong></td>
<td style="text-align: left;">A user-driven process for an administrator to manually correct the state of a stuck or failed remittance.</td>
<td style="text-align: left;">1. Operator filters and selects a remittance in the UI.<br>2. Operator right-clicks and chooses 'Mudar Estado'.<br>3. Operator selects a new state from a dialog.<br>4. System updates the entity's state in the database.</td>
<td style="text-align: left;">Administrator</td>
<td style="text-align: left;"><code>Remessa</code>, <code>Tranche</code></td>
<td style="text-align: left;">Inferred from the context menus and event handlers in <code>ActividadeBalcaoForm.cs</code>.</td>
</tr>
</tbody>
</table>
</div>
<pre class="mermaid"><code>flowchart TD
    subgraph Workflows
        A["Remittance Processing"]
        B["Alert Notification"]
        C["Manual State Correction"]
    end

    subgraph "Actors / Triggers"
        D[("System Timer")]
        E["Administrator"]
    end

    subgraph "Core Data"
        F[("Database")]
    end
    
    D --> A
    D --> B
    E --> C

    A --> F
    B --> F
    C --> F
</code></pre>
<center>Figure 7 - High-level overview of the main business process workflows.</center>
<h4 id="271-workflow-remittance-processing-workflow">2.7.1. Workflow: Remittance Processing Workflow</h4>
This section provides a detailed breakdown of the Remittance Processing Workflow, including the steps involved, user roles, key data entities, and any assumptions made.
<div class="table-container">
<table>
<colgroup>
<col style="width: 20%" />
<col style="width: 20%" />
<col style="width: 20%" />
<col style="width: 20%" />
<col style="width: 20%" />
</colgroup>
<thead>
<tr>
<th style="text-align: left;">Step</th>
<th style="text-align: left;">Description</th>
<th style="text-align: left;">User Role</th>
<th style="text-align: left;">Key Data Entities</th>
<th style="text-align: left;">Assumptions</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>1. Fetch Pending Remittance</strong></td>
<td style="text-align: left;">The service queries the database for a remittance with a 'Pending' status.</td>
<td style="text-align: left;">System</td>
<td style="text-align: left;"><code>Remessa</code></td>
<td style="text-align: left;">Inferred from <code>ServRemessa.REMIN_IDParaProcessar()</code> method.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>2. Begin Processing</strong></td>
<td style="text-align: left;">The remittance status is updated to 'Processing' (e.g., state 30) to prevent other threads from picking it up.</td>
<td style="text-align: left;">System</td>
<td style="text-align: left;"><code>Remessa</code></td>
<td style="text-align: left;">A standard practice in queued processing to lock an item.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>3. Create Tranches</strong></td>
<td style="text-align: left;">The system iterates through the documents of the remittance, creating new <code>Tranche</code> records in batches based on a configured size (<code>m_iMaxDocsTranche</code>).</td>
<td style="text-align: left;">System</td>
<td style="text-align: left;"><code>Tranche</code>, <code>Documento</code></td>
<td style="text-align: left;">Inferred from the loop in <code>ServRemessa.ProcessaRemessa</code> and the <code>CriarTranche</code> method.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>4. Process Documents</strong></td>
<td style="text-align: left;">For each document, a unique reference key (<code>ChaveH</code>) is generated, and its status is updated to 'Processed'. If an error occurs, it's logged.</td>
<td style="text-align: left;">System</td>
<td style="text-align: left;"><code>Documento</code></td>
<td style="text-align: left;">Inferred from <code>ProcessaDocumento</code> method which calls <code>fnCHAVEH</code> and updates document state.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>5. Finalize Remittance</strong></td>
<td style="text-align: left;">After all documents are processed, the final status of the remittance is set to 'Processed' (40) or 'Error' (-40) if any issues occurred.</td>
<td style="text-align: left;">System</td>
<td style="text-align: left;"><code>Remessa</code></td>
<td style="text-align: left;">Inferred from the final state update logic in <code>ServRemessa.ProcessaRemessa</code>.</td>
</tr>
</tbody>
</table>
</div>
<pre class="mermaid"><code>flowchart TD
    A[Start] --> B{"Fetch Pending Remittance"};
    B -->|Found| C["Update Remittance Status to 'Processing'"];
    B -->|None| Z[End];
    C --> D["Loop through Documents"];
    D -->|Create new Tranche?| E{"Is iCount % maxDocs == 0?"};
    E -->|Yes| F["Create New Tranche Record"];
    F --> G["Process Document (Generate ChaveH, Update Status)"];
    E -->|No| G;
    G --> H{"Any more documents?"};
    H -->|Yes| D;
    H -->|No| I["Finalize Last Tranche"];
    I --> J{"Any Errors During Process?"};
    J -->|Yes| K["Update Remittance Status to 'Error'"];
    J -->|No| L["Update Remittance Status to 'Processed'"];
    K --> Z;
    L --> Z;
</code></pre>
<center>Figure 8 - Detailed steps of the Remittance Processing Workflow.</center>
<h4 id="272-workflow-alert-notification-workflow">2.7.2. Workflow: Alert Notification Workflow</h4>
This section provides a detailed breakdown of the Alert Notification Workflow, including the steps involved, user roles, key data entities, and any assumptions made.
<div class="table-container">
<table>
<colgroup>
<col style="width: 20%" />
<col style="width: 20%" />
<col style="width: 20%" />
<col style="width: 20%" />
<col style="width: 20%" />
</colgroup>
<thead>
<tr>
<th style="text-align: left;">Step</th>
<th style="text-align: left;">Description</th>
<th style="text-align: left;">User Role</th>
<th style="text-align: left;">Key Data Entities</th>
<th style="text-align: left;">Assumptions</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>1. Fetch Pending Alert</strong></td>
<td style="text-align: left;">The service queries the database for an unprocessed alert (<code>ALACC_STATUS=0</code>).</td>
<td style="text-align: left;">System</td>
<td style="text-align: left;"><code>AlertaSituacaoAccao</code></td>
<td style="text-align: left;">Inferred from <code>ServAlerta.AlertaSituacaoAccaoParaProcessar</code>.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>2. Identify Action Type</strong></td>
<td style="text-align: left;">The system inspects the <code>TIPACC_ID</code> to determine the type of action required (e.g., Email, Log DB, Log File).</td>
<td style="text-align: left;">System</td>
<td style="text-align: left;"><code>Accao</code></td>
<td style="text-align: left;">Inferred from the <code>switch</code> statement in <code>ServAlerta.ProcessaAlertaSituacaoAccao</code>.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>3. Execute Action</strong></td>
<td style="text-align: left;">The corresponding action is executed. For an email, it constructs and sends the message. For a log, it writes the entry.</td>
<td style="text-align: left;">System</td>
<td style="text-align: left;"><code>AccaoParam</code></td>
<td style="text-align: left;">Based on methods like <code>ProcessaAlertaSituacaoAccaoMail</code> and <code>ProcessaAlertaSituacaoAccaoLogDB</code>.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>4. Update Alert Status</strong></td>
<td style="text-align: left;">The alert's status is updated to 'Processed' (1) on success or 'Error' (-1) on failure.</td>
<td style="text-align: left;">System</td>
<td style="text-align: left;"><code>AlertaSituacaoAccao</code></td>
<td style="text-align: left;">Inferred from calls to <code>SetProcessado</code> and <code>SetErroProcessamento</code>.</td>
</tr>
</tbody>
</table>
</div>
<pre class="mermaid"><code>flowchart TD
    A[Start] --> B{"Fetch Pending Alert"};
    B -->|Found| C["Identify Action Type (Email, Log, etc.)"];
    B -->|None| Z[End];
    C --> D{Action Type?};
    D -- Mail --> E["Execute Send Email Action"];
    D -- Log DB --> F["Execute Log to Database Action"];
    D -- Log File --> G["Execute Log to File Action"];
    E --> H{"Action Successful?"};
    F --> H;
    G --> H;
    H -->|Yes| I["Update Alert Status to 'Processed'"];
    H -->|No| J["Update Alert Status to 'Error'"];
    I --> Z;
    J --> Z;
</code></pre>
<center>Figure 9 - Detailed steps of the Alert Notification Workflow.</center>
<h4 id="273-workflow-manual-state-correction-workflow">2.7.3. Workflow: Manual State Correction Workflow</h4>
This section provides a detailed breakdown of the Manual State Correction Workflow, including the steps involved, user roles, key data entities, and any assumptions made.
<div class="table-container">
<table>
<colgroup>
<col style="width: 20%" />
<col style="width: 20%" />
<col style="width: 20%" />
<col style="width: 20%" />
<col style="width: 20%" />
</colgroup>
<thead>
<tr>
<th style="text-align: left;">Step</th>
<th style="text-align: left;">Description</th>
<th style="text-align: left;">User Role</th>
<th style="text-align: left;">Key Data Entities</th>
<th style="text-align: left;">Assumptions</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>1. View Activities</strong></td>
<td style="text-align: left;">The Administrator opens the <code>ActividadeBalcaoForm</code> and uses filters to find a specific remittance or tranche.</td>
<td style="text-align: left;">Administrator</td>
<td style="text-align: left;"><code>Remessa</code>, <code>Tranche</code></td>
<td style="text-align: left;">Standard user interaction with a search/filter UI.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>2. Select Entity</strong></td>
<td style="text-align: left;">The Administrator selects one or more items from the <code>ListView</code> that require state correction.</td>
<td style="text-align: left;">Administrator</td>
<td style="text-align: left;"><code>Remessa</code>, <code>Tranche</code></td>
<td style="text-align: left;">Based on UI controls and multi-select capabilities.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>3. Initiate State Change</strong></td>
<td style="text-align: left;">The Administrator right-clicks the selection and chooses the "Mudar Estado" (Change State) option from the context menu.</td>
<td style="text-align: left;">Administrator</td>
<td style="text-align: left;"><code>Remessa</code>, <code>Tranche</code></td>
<td style="text-align: left;">Inferred from <code>contextMenuStripRemessaMudarEstado_Click</code> event handler.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>4. Choose New State</strong></td>
<td style="text-align: left;">A dialog (<code>MudarEstadoForm</code>) appears, showing possible new states. The Administrator selects the target state and confirms.</td>
<td style="text-align: left;">Administrator</td>
<td style="text-align: left;"><code>Activity_Change</code> (inferred table)</td>
<td style="text-align: left;">The <code>MudarEstadoForm</code> is populated with valid state transitions.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>5. Apply Update</strong></td>
<td style="text-align: left;">The system executes a stored procedure (<code>m_sSPProcessa</code>) to update the state of the selected entity in the database.</td>
<td style="text-align: left;">System</td>
<td style="text-align: left;"><code>Remessa</code>, <code>Tranche</code></td>
<td style="text-align: left;">The <code>ChangeEstado</code> method in <code>DetalheRemessa</code> and <code>DetalheTranche</code> handles the database update.</td>
</tr>
</tbody>
</table>
</div>
<pre class="mermaid"><code>flowchart TD
    A[Start] --> B["Admin opens Activity Form"];
    B --> C["Admin filters and selects a Remittance/Tranche"];
    C --> D["Admin right-clicks and selects 'Change State'"];
    D --> E["MudarEstadoForm Dialog Appears"];
    E --> F{"Admin selects new state and clicks OK"};
    F -->|OK| G["System executes SP to update state in DB"];
    F -->|Cancel| H[End];
    G --> H;
</code></pre>
<center>Figure 10 - Detailed steps of the Manual State Correction Workflow.</center>
<h3 id="28-system-inputs-outputs-interfaces">2.8. System inputs & outputs (interfaces)</h3>
This section catalogs all identified points where data enters or leaves the application boundary.
<div class="table-container">
<table>
<colgroup>
<col style="width: 20%" />
<col style="width: 20%" />
<col style="width: 20%" />
<col style="width: 20%" />
<col style="width: 20%" />
</colgroup>
<thead>
<tr>
<th style="text-align: left;">Type</th>
<th style="text-align: left;">Name / Description</th>
<th style="text-align: left;">Data Formats</th>
<th style="text-align: left;">Data Source / Sink</th>
<th style="text-align: left;">Assumptions</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>Input</strong></td>
<td style="text-align: left;"><strong>User Input via UI</strong></td>
<td style="text-align: left;">User-entered text and selections</td>
<td style="text-align: left;">Windows Forms controls (<code>TextBox</code>, <code>ComboBox</code>, <code>DateTimePicker</code>)</td>
<td style="text-align: left;">Standard data entry for filtering and managing application entities.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Input</strong></td>
<td style="text-align: left;"><strong>File Ingestion (ENVM/ACOM)</strong></td>
<td style="text-align: left;">Fixed-width text files</td>
<td style="text-align: left;">Monitored file system directory (<code>m<em>sFilePathENVM</code>, <code>m</em>sFilePathACOM</code>)</td>
<td style="text-align: left;">Inferred from the <code>CIFicheiro</code> project which has classes for parsing <code>ENVM</code> and <code>ACOM</code> files.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Input</strong></td>
<td style="text-align: left;"><strong>Web Service Call (MDI)</strong></td>
<td style="text-align: left;">SOAP/XML</td>
<td style="text-align: left;">External client applications via <code>waiaccesstuInsertDoc</code> web service</td>
<td style="text-align: left;">The <code>MDIWebTransmCI</code> project is a web service client for inserting MDI documents.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Data Flow</strong></td>
<td style="text-align: left;"><strong>Primary Internal Flow</strong></td>
<td style="text-align: left;">In-memory objects (<code>Remessa</code>, <code>Documento</code>)</td>
<td style="text-align: left;">Application Memory / Database</td>
<td style="text-align: left;">Data is read from the database, processed by business logic, and results are written back.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Output</strong></td>
<td style="text-align: left;"><strong>Database Records</strong></td>
<td style="text-align: left;">SQL Data</td>
<td style="text-align: left;">Microsoft SQL Server</td>
<td style="text-align: left;">The primary output of all processing workflows is updated or new records in the database.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Output</strong></td>
<td style="text-align: left;"><strong>Email Alerts</strong></td>
<td style="text-align: left;">SMTP</td>
<td style="text-align: left;">Email Server (via WebDAV/EWS)</td>
<td style="text-align: left;"><code>ServAlertasSendWebmail.cs</code> indicates email sending capabilities as an output.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Output</strong></td>
<td style="text-align: left;"><strong>Log Files</strong></td>
<td style="text-align: left;">Plain Text</td>
<td style="text-align: left;">Local file system</td>
<td style="text-align: left;"><code>ServAlertasLogFile.cs</code> handles writing alert information to text files.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Output</strong></td>
<td style="text-align: left;"><strong>Windows Event Log</strong></td>
<td style="text-align: left;">Event Log entries</td>
<td style="text-align: left;">Windows Event Viewer</td>
<td style="text-align: left;"><code>ProcessaAlertaSituacaoAccaoEVENTVIEWER</code> method writes directly to the event log.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Output</strong></td>
<td style="text-align: left;"><strong>UI Display</strong></td>
<td style="text-align: left;">Rendered UI controls</td>
<td style="text-align: left;">User's screen</td>
<td style="text-align: left;">Data is rendered in <code>ListView</code> and <code>DataGridView</code> controls for user consumption.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Output</strong></td>
<td style="text-align: left;"><strong>Crystal Reports</strong></td>
<td style="text-align: left;">PDF, Print</td>
<td style="text-align: left;">User's file system or printer</td>
<td style="text-align: left;">The <code>CIReports</code> project uses Crystal Reports to generate formatted reports.</td>
</tr>
</tbody>
</table>
</div>
<h3 id="29-user-task-flows">2.9. User Task Flows</h3>
This section describes the typical path a user takes through the application to achieve a high-level objective, linking multiple features together.
<div class="table-container">
<table>
<colgroup>
<col style="width: 20%" />
<col style="width: 20%" />
<col style="width: 20%" />
<col style="width: 20%" />
<col style="width: 20%" />
</colgroup>
<thead>
<tr>
<th style="text-align: left;">Task Flow</th>
<th style="text-align: left;">Description</th>
<th style="text-align: left;">User Role</th>
<th style="text-align: left;">Key Data Entities</th>
<th style="text-align: left;">Assumptions</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>Resolve a Failed Remittance</strong></td>
<td style="text-align: left;">A complete sequence of steps an administrator follows to diagnose and fix a remittance that has failed during automated processing.</td>
<td style="text-align: left;">Administrator</td>
<td style="text-align: left;"><code>Remessa</code>, <code>Tranche</code>, <code>Documento</code></td>
<td style="text-align: left;">This flow combines monitoring, investigation, and manual intervention features.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Monitor Daily Processing</strong></td>
<td style="text-align: left;">A standard daily task for an operator to check the status of all remittances processed within a specific timeframe.</td>
<td style="text-align: left;">Standard Operator</td>
<td style="text-align: left;"><code>Remessa</code>, <code>Tranche</code></td>
<td style="text-align: left;">This is a read-only workflow focused on operational awareness.</td>
</tr>
</tbody>
</table>
</div>
<pre class="mermaid"><code>flowchart TD
    subgraph "User Tasks"
        A["Resolve a Failed Remittance"]
        B["Monitor Daily Processing"]
    end

    subgraph "User Roles"
        Admin["Administrator"]
        Operator["Standard Operator"]
    end
    
    Admin --> A
    Operator --> B
</code></pre>
<center>Figure 11 - High-level diagram of user task flows.</center>
<h4 id="291-user-task-flow-resolve-a-failed-remittance">2.9.1. User Task Flow: Resolve a Failed Remittance</h4>
This section provides a detailed breakdown of the "Resolve a Failed Remittance" user task flow, including the steps involved, user roles, key data entities, and any assumptions made.
<div class="table-container">
<table>
<colgroup>
<col style="width: 20%" />
<col style="width: 20%" />
<col style="width: 20%" />
<col style="width: 20%" />
<col style="width: 20%" />
</colgroup>
<thead>
<tr>
<th style="text-align: left;">Step</th>
<th style="text-align: left;">Description</th>
<th style="text-align: left;">User Role</th>
<th style="text-align: left;">Key Data Entities</th>
<th style="text-align: left;">Assumptions</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>1. Identify Failure</strong></td>
<td style="text-align: left;">The Administrator opens the <code>ActividadesForm</code> and filters by "Erro" (Error) status for the current day.</td>
<td style="text-align: left;">Administrator</td>
<td style="text-align: left;"><code>Remessa</code></td>
<td style="text-align: left;">The user knows how to use the UI filters to find problematic items.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>2. Investigate Details</strong></td>
<td style="text-align: left;">The Administrator double-clicks the failed remittance to view its associated tranches and documents, looking for specific error messages.</td>
<td style="text-align: left;">Administrator</td>
<td style="text-align: left;"><code>Tranche</code>, <code>Documento</code></td>
<td style="text-align: left;">The UI provides drill-down capabilities from summary to detail.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>3. View Document Image</strong></td>
<td style="text-align: left;">If a specific document is the cause, the Administrator views its image using the <code>ImagemBalcaoForm</code> to check for quality or data issues.</td>
<td style="text-align: left;">Administrator</td>
<td style="text-align: left;"><code>Documento</code>, <code>Imagem</code></td>
<td style="text-align: left;">Assumes document images are available and linked to the document records.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>4. Correct State</strong></td>
<td style="text-align: left;">After diagnosing the issue, the Administrator uses the "Mudar Estado" context menu action to reset the remittance's status to 'Pending' for reprocessing.</td>
<td style="text-align: left;">Administrator</td>
<td style="text-align: left;"><code>Remessa</code></td>
<td style="text-align: left;">The user has the necessary privileges to perform state changes.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>5. Verify Reprocessing</strong></td>
<td style="text-align: left;">The Administrator monitors the system to ensure the remittance is picked up again by the automated service and processed successfully.</td>
<td style="text-align: left;">Administrator</td>
<td style="text-align: left;"><code>Remessa</code></td>
<td style="text-align: left;">The user will re-query the system after a short interval to confirm the state has changed from 'Pending' to 'Processed'.</td>
</tr>
</tbody>
</table>
</div>
<pre class="mermaid"><code>journey
    title Resolve a Failed Remittance
    section Diagnose
      Find Error: Administrator opens UI and filters for errors.
      Investigate: Administrator drills down into the failed remittance.
      View Image: Administrator views the document image to identify the issue.
    section Remediate
      Change State: Administrator resets the remittance status to 'Pending'.
    section Verify
      Monitor: Administrator observes the system to confirm successful reprocessing.
</code></pre>
<center>Figure 12 - User journey for resolving a failed remittance.</center>
<h4 id="292-user-task-flow-monitor-daily-processing">2.9.2. User Task Flow: Monitor Daily Processing</h4>
This section provides a detailed breakdown of the "Monitor Daily Processing" user task flow, including the steps involved, user roles, key data entities, and any assumptions made.
<div class="table-container">
<table>
<colgroup>
<col style="width: 20%" />
<col style="width: 20%" />
<col style="width: 20%" />
<col style="width: 20%" />
<col style="width: 20%" />
</colgroup>
<thead>
<tr>
<th style="text-align: left;">Step</th>
<th style="text-align: left;">Description</th>
<th style="text-align: left;">User Role</th>
<th style="text-align: left;">Key Data Entities</th>
<th style="text-align: left;">Assumptions</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>1. Open Activity View</strong></td>
<td style="text-align: left;">The Operator launches the <code>ActividadesForm</code> or <code>ActividadeBalcaoForm</code>.</td>
<td style="text-align: left;">Standard Operator</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">The user's primary entry point is the main activity screen.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>2. Set Date Filter</strong></td>
<td style="text-align: left;">The Operator uses the <code>DateTimePicker</code> controls to select the desired date range for monitoring (e.g., today's date).</td>
<td style="text-align: left;">Standard Operator</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">The default view or user action is to filter by a relevant time period.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>3. Refresh Summary View</strong></td>
<td style="text-align: left;">The Operator clicks the "Refresh" or "Remessas" button to populate the summary <code>ListView</code> with aggregated data for the selected period.</td>
<td style="text-align: left;">Standard Operator</td>
<td style="text-align: left;"><code>Remessa</code></td>
<td style="text-align: left;">The user interacts with the UI to fetch the latest data.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>4. Review Summaries</strong></td>
<td style="text-align: left;">The Operator scans the summary view, checking the counts of remittances in different states (Processed, Error, etc.) to get a high-level overview of system performance.</td>
<td style="text-align: left;">Standard Operator</td>
<td style="text-align: left;"><code>Remessa</code></td>
<td style="text-align: left;">The primary goal is to quickly assess the operational status.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>5. Drill Down (Optional)</strong></td>
<td style="text-align: left;">If a specific summary group (e.g., remittances in error) requires attention, the Operator double-clicks it to view the detailed list of individual remittances.</td>
<td style="text-align: left;">Standard Operator</td>
<td style="text-align: left;"><code>Remessa</code>, <code>Tranche</code></td>
<td style="text-align: left;">The user can navigate from aggregated views to detailed lists.</td>
</tr>
</tbody>
</table>
</div>
<pre class="mermaid"><code>journey
    title Monitor Daily Processing
    section Overview
      Open UI: Operator starts the application.
      Filter Data: Operator selects the date range.
      Refresh View: Operator clicks refresh to load data.
    section Analysis
      Review Summary: Operator checks high-level counts and statuses.
      Drill Down: Operator investigates specific groups if necessary.
</code></pre>
<center>Figure 13 - User journey for monitoring daily processing.</center>
<h3 id="210-automated-scheduled-processes">2.10. Automated & Scheduled Processes</h3>
This section describes any system-triggered processes that run without direct user interaction, such as nightly jobs, scheduled reports, or data synchronization tasks.
<div class="table-container">
<table>
<colgroup>
<col style="width: 16%" />
<col style="width: 16%" />
<col style="width: 16%" />
<col style="width: 16%" />
<col style="width: 16%" />
<col style="width: 16%" />
</colgroup>
<thead>
<tr>
<th style="text-align: left;">Process Name</th>
<th style="text-align: left;">Trigger / Schedule</th>
<th style="text-align: left;">Purpose</th>
<th style="text-align: left;">Key Actions</th>
<th style="text-align: left;">Key Data Entities</th>
<th style="text-align: left;">Assumptions</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>Remittance Processing Job</strong></td>
<td style="text-align: left;">Timer-based, configured by <code>TempoEntreIteracoes</code> in settings.</td>
<td style="text-align: left;">To automatically process new and pending bank remittances as they arrive in the system.</td>
<td style="text-align: left;">1. Query for remittances with 'Pending' status.<br>2. Lock and process the remittance.<br>3. Update statuses of remittance, tranches, and documents.</td>
<td style="text-align: left;"><code>Remessa</code>, <code>Tranche</code>, <code>Documento</code></td>
<td style="text-align: left;">Inferred from the <code>CIServico</code> project, which is a Windows Service designed for continuous background execution. The <code>CIServiceComumThread</code> suggests a polling mechanism.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Alert Processing Job</strong></td>
<td style="text-align: left;">Timer-based, likely sharing the same timer as the remittance job.</td>
<td style="text-align: left;">To automatically process and dispatch system-generated alerts.</td>
<td style="text-align: left;">1. Query for alerts with 'Pending' status.<br>2. Execute the configured action (Email, Log, etc.).<br>3. Update the alert's status.</td>
<td style="text-align: left;"><code>Alerta</code>, <code>Accao</code></td>
<td style="text-align: left;">Inferred from the <code>ServAlerta</code> class, which is designed to be called by the <code>CIServico</code> background service.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>File Import Job</strong></td>
<td style="text-align: left;">Timer-based, configured by <code>TempoEntreIteracoesFicheiros</code>.</td>
<td style="text-align: left;">To automatically import data from <code>ENVM</code> and <code>ACOM</code> files found in monitored directories.</td>
<td style="text-align: left;">1. Scan configured directories for new files.<br>2. Parse the file line-by-line.<br>3. Insert data into staging or final database tables.</td>
<td style="text-align: left;"><code>Ficheiro</code>, <code>Lote</code>, <code>Documento</code></td>
<td style="text-align: left;">Inferred from the <code>CIFicheiro</code> project and the <code>CheckForFileENVM2Import</code> and <code>CheckForFileACOM2Import</code> methods in <code>CIServicoThread</code>.</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="product-section">
<h2 id="3-architecture-and-design">3. Architecture and design</h2>
This section provides an overview of the application's architecture, design patterns, and key principles.
<h3 id="31-architecture-pattern">3.1. Architecture pattern</h3>
The application follows a traditional N-Tier monolithic architecture.
<div class="table-container">
<table>
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr>
<th style="text-align: left;">Pattern Type</th>
<th style="text-align: left;">Identified Patterns</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>Architecture pattern</strong></td>
<td style="text-align: left;">- <strong>N-Tier Monolithic</strong>: The application is structured into distinct layers (presentation, business, data) but is deployed as a single, cohesive unit.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Architectural patterns</strong></td>
<td style="text-align: left;">- <strong>Windows Forms (MVP/MVC variant)</strong>: The UI projects (<code>CIActividades</code>, etc.) use a code-behind model typical of Windows Forms, separating UI from event-handling logic.<br>- <strong>Windows Service</strong>: The <code>CIServico</code> project implements the Windows Service pattern for background processing.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Creational patterns</strong></td>
<td style="text-align: left;">- <strong>(Not explicitly identified)</strong>: Logic appears to use direct instantiation (<code>new Class()</code>) rather than creational patterns like Factory or DI.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Structural patterns</strong></td>
<td style="text-align: left;">- <strong>(Not explicitly identified)</strong>: The code structure does not show evidence of common structural patterns like Adapter or Decorator.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Behavioral patterns</strong></td>
<td style="text-align: left;">- <strong>(Not explicitly identified)</strong>: While there are workflows, they are implemented procedurally rather than with formal patterns like Command or Strategy.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Domain-driven design (DDD) patterns</strong></td>
<td style="text-align: left;">- <strong>(Not explicitly identified)</strong>: The design appears to be data-centric rather than domain-centric. Data structures (<code>DetalheRemessa</code>) are tightly coupled to database views, and there is no clear separation of aggregates or a ubiquitous language.</td>
</tr>
</tbody>
</table>
</div>
<h3 id="32-architecture-style">3.2. Architecture style</h3>
The application is built using a layered architectural style.
<div class="table-container">
<table>
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr>
<th style="text-align: left;">Aspect</th>
<th style="text-align: left;">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>Layering</strong></td>
<td style="text-align: left;">The application is structured into logical layers:<br>- <strong>Presentation Layer</strong>: Windows Forms projects (<code>CIActividades</code>, <code>CIConfiguration</code>).<br>- <strong>Service Layer</strong>: Windows Service and business logic projects (<code>CIServico</code>, <code>CIServRemessas</code>).<br>- <strong>Data Access Layer</strong>: Although not in a separate project, data access logic using <code>System.Data.SqlClient</code> is embedded within service and business classes.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Dependency flow</strong></td>
<td style="text-align: left;">Dependencies flow from the UI/Host layers down to the business logic and shared libraries. For example, <code>CIControlo</code> depends on <code>CIActividades</code>, which in turn depends on <code>CIConfigGlobalParameters</code>. There is no strict enforcement preventing lower layers from depending on higher ones, but the general flow is top-down.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Bounded contexts</strong></td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> The concept of Bounded Contexts is not applied. The application is a single, large monolith with shared data models and dependencies across all functional areas.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Communication between contexts/services</strong></td>
<td style="text-align: left;">Communication is primarily through direct method calls within the same process. The only external communication identified is a SOAP web service call in the <code>MDIWebTransmCI</code> project.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Use of dependency injection / IOC container</strong></td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> Not used. Dependencies are managed through direct instantiation (e.g., <code>new ServRemessa(this, m_oParameters)</code>).</td>
</tr>
</tbody>
</table>
</div>
<h3 id="33-key-design-patterns-and-principles-applied">3.3. Key design patterns and principles applied</h3>
The codebase shows adherence to some classic design principles but lacks modern pattern adoption.
<div class="table-container">
<table>
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr>
<th style="text-align: left;">Principle / Pattern</th>
<th style="text-align: left;">Analysis</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>SOLID principles</strong></td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> <strong>Partial Adherence</strong>:<br>- <strong>Single Responsibility</strong>: Partially followed, as functionality is broken into different projects (e.g., <code>CIServAlertas</code> for alerts, <code>CIServRemessas</code> for remittances). However, classes like <code>ActividadeBalcaoForm</code> contain significant business and UI logic.<br>- <strong>Open/Closed, Liskov, ISP, DIP</strong>: Not explicitly observed. The lack of interfaces and dependency injection points to low adherence.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>DRY</strong></td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> <strong>Medium Risk</strong>: The procedural nature and lack of shared service abstractions suggest a risk of duplicated code, especially for data access and business rules.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>KISS</strong></td>
<td style="text-align: left;"><span class="icon icon-check" title="Yes/Used/Supported">check_circle</span> <strong>Adhered to</strong>: The code is straightforward and procedural, making individual methods relatively easy to understand in isolation. It avoids overly complex abstractions.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>YAGNI</strong></td>
<td style="text-align: left;"><span class="icon icon-check" title="Yes/Used/Supported">check_circle</span> <strong>Likely Adhered to</strong>: The code appears purpose-built for its specific function without extraneous features.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Separation of Concerns</strong></td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> <strong>Partial Adherence</strong>: There is a clear separation at the project level (UI, Service, etc.). However, within projects, concerns are mixed. For example, UI forms contain data-fetching logic, and business classes contain direct SQL queries.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Testability</strong></td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> <strong>Low</strong>: The tight coupling, lack of dependency injection, and direct database calls make the code difficult to unit test. The <code>CITestes</code> project likely performs integration tests rather than isolated unit tests.</td>
</tr>
</tbody>
</table>
</div>
<h3 id="34-domain-driven-design-ddd-adoption">3.4. Domain-driven design (DDD) adoption</h3>
DDD concepts are not a primary driver of the application's design.
<div class="table-container">
<table>
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr>
<th style="text-align: left;">DDD Concept</th>
<th style="text-align: left;">Analysis</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>Use of DDD concepts</strong></td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> <strong>Not Used</strong>: The design is data-centric. Classes like <code>DetalheDocumento</code> and <code>AlertaSituacaoAccao</code> are direct representations of database views or tables (<code>SqlDataReader dr</code> in constructors). There is no evidence of rich domain models, aggregates, value objects, or domain services.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Ubiquitous language</strong></td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> <strong>Not Used</strong>: While there are business terms like <code>Remessa</code> and <code>Balcao</code>, they are used as data containers rather than as part of a formal, shared language between developers and domain experts.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Layered DDD approach</strong></td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> <strong>Not Used</strong>: The architecture is a classic N-Tier structure, not a DDD layered architecture with distinct Application, Domain, and Infrastructure layers. Business logic is mixed with data access and service orchestration.</td>
</tr>
</tbody>
</table>
</div>
<h3 id="35-patterns-and-tactics">3.5. Patterns and tactics</h3>
The application uses a few traditional data access tactics but lacks formal design pattern implementation.
<div class="table-container">
<table>
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr>
<th style="text-align: left;">Pattern / Tactic</th>
<th style="text-align: left;">Analysis</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>CQRS</strong></td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> <strong>Not Used</strong>: There is no separation between command (write) and query (read) models or paths.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Event Sourcing</strong></td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> <strong>Not Used</strong>: State is managed directly in the database, not as a sequence of events.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Repository pattern</strong></td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> <strong>Not Used</strong>: Data access is performed via direct <code>SqlDataReader</code> calls within service or UI-related classes, not abstracted behind a repository interface.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Unit of Work pattern</strong></td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> <strong>Partially Implemented</strong>: The use of <code>System.Transactions</code> and manual transaction management (<code>BeginTrans</code>, <code>Commit</code>, <code>RollBack</code> in <code>CIGlobalParameters</code>) provides a form of unit of work for database operations, but it is not formally abstracted as a pattern.</td>
</tr>
</tbody>
</table>
</div>
<h3 id="36-cross-cutting-concerns">3.6. Cross-cutting concerns</h3>
The application handles cross-cutting concerns through shared utility classes and direct implementation.
<div class="table-container">
<table>
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr>
<th style="text-align: left;">Concern</th>
<th style="text-align: left;">Implementation Details</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>Logging</strong></td>
<td style="text-align: left;">Implemented via a <code>GenericLog</code> class, which appears to be a custom or shared library. It provides methods like <code>GenLogRegistarErro</code> and <code>GenLogRegistarAlerta</code>.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Caching</strong></td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> <strong>Not Implemented</strong>: No evidence of in-memory or distributed caching was found.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Security</strong></td>
<td style="text-align: left;">- <strong>Authentication</strong>: A custom user model (<code>User</code> class) is used, with login names retrieved from the system.<br>- <strong>Authorization</strong>: A simple role-based model checks the user's group ID (<code>m_iUserGroup</code>) to enable or disable functionality.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Exception Handling</strong></td>
<td style="text-align: left;">Standard <code>try-catch</code> blocks are used throughout the code. Exceptions are typically logged using <code>GenericLog</code> and sometimes re-thrown or displayed to the user in a <code>MessageBox</code>.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Configuration Management</strong></td>
<td style="text-align: left;">Handled by the <code>CIConfigGlobalParameters</code> project, which reads settings from <code>.config</code> files and a central database. It manages connection strings, application timers, and other operational parameters.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Dependency Injection</strong></td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> <strong>Not Implemented</strong>: Dependencies are created manually using the <code>new</code> keyword.</td>
</tr>
</tbody>
</table>
</div>
<h3 id="37-deployment">3.7. Deployment</h3>
The deployment architecture is inferred from configuration files and installation scripts.
<div class="table-container">
<table>
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr>
<th style="text-align: left;">Aspect</th>
<th style="text-align: left;">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>Monolithic vs microservices</strong></td>
<td style="text-align: left;"><span class="icon icon-check" title="Yes/Used/Supported">check_circle</span> <strong>Monolithic</strong>: The application is designed as a single, tightly coupled system, although it is composed of multiple projects.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Containerization</strong></td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> <strong>Not Supported</strong>: The application is a traditional .NET Framework executable and service, not designed for containerization.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Deployment model</strong></td>
<td style="text-align: left;"><span class="icon icon-check" title="Yes/Used/Supported">check_circle</span> <strong>On-premises</strong>: Configuration files and install scripts (<code>Install.bat</code>) point to a classic on-premises deployment model.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Deployment target platform</strong></td>
<td style="text-align: left;"><span class="icon icon-check" title="Yes/Used/Supported">check_circle</span> <strong>Windows</strong>: The use of Windows Forms, Windows Services, and <code>.bat</code> scripts confirms the deployment target is Windows.</td>
</tr>
</tbody>
</table>
</div>
<h3 id="38-infrastructure-considerations">3.8. Infrastructure considerations</h3>
The application relies on traditional on-premises infrastructure.
<div class="table-container">
<table>
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr>
<th style="text-align: left;">Component</th>
<th style="text-align: left;">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>Persistence</strong></td>
<td style="text-align: left;">- <strong>Database</strong>: Microsoft SQL Server. The connection strings in <code>.config</code> files point to named instances (e.g., <code>SDC6001SQL28\S2K081</code>).<br>- <strong>File System</strong>: Used for file-based data ingestion (ACOM/ENVM files) and for logging.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Messaging / Eventing</strong></td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> <strong>Not Used</strong>: There is no evidence of message brokers or event buses. Communication is handled via direct method calls and database polling.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>External integrations</strong></td>
<td style="text-align: left;">- <strong>SOAP Web Service</strong>: The <code>MDIWebTransmCI</code> project integrates with a SOAP web service at <code>http://waiaccesstu:80/UWTDWeb/services/Insert_DocumentoMDIService</code> for inserting MDI documents.</td>
</tr>
</tbody>
</table>
</div>
<h3 id="39-documentation-artifacts">3.9. Documentation artifacts</h3>
No formal documentation artifacts were provided with the source code.
<div class="table-container">
<table>
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr>
<th style="text-align: left;">Artifact Type</th>
<th style="text-align: left;">Status</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>UML diagrams</strong></td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> Not provided.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>C4 model diagrams</strong></td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> Not provided.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>API documentation</strong></td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> Not provided.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Readme or ADRs</strong></td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> Not provided.</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="product-section">
<h2 id="4-technology-stack-and-frameworks">4. Technology stack and frameworks</h2>
This section details the technologies, frameworks, and libraries used in the application.
<h3 id="41-backend-technologies">4.1. Backend technologies</h3>
The backend is built on the .NET Framework with direct data access.
<div class="table-container">
<table>
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr>
<th style="text-align: left;">Category</th>
<th style="text-align: left;">Technology / Library</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>Programming Language(s)</strong></td>
<td style="text-align: left;">C#, VB.NET</td>
</tr>
<tr>
<td style="text-align: left;"><strong>.NET Runtime(s)</strong></td>
<td style="text-align: left;">- .NET Framework 4.0<br>- .NET Framework 3.5 (referenced)</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Runtime architecture</strong></td>
<td style="text-align: left;">AnyCPU</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Framework(s)</strong></td>
<td style="text-align: left;">Windows Services</td>
</tr>
<tr>
<td style="text-align: left;"><strong>ORM / Database Access</strong></td>
<td style="text-align: left;">ADO.NET (<code>System.Data.SqlClient</code>)</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Dependency Injection</strong></td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> Not Used</td>
</tr>
<tr>
<td style="text-align: left;"><strong>API types</strong></td>
<td style="text-align: left;">SOAP (as a client)</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Unit testing and test frameworks</strong></td>
<td style="text-align: left;">MSTest (<code>Microsoft.VisualStudio.QualityTools.UnitTestFramework</code>)</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Build tools</strong></td>
<td style="text-align: left;">MSBuild</td>
</tr>
<tr>
<td style="text-align: left;"><strong>CI/CD tools</strong></td>
<td style="text-align: left;">None identified; deployment appears to be manual.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Other common libraries / SDKs</strong></td>
<td style="text-align: left;"><code>GenericNet</code>, <code>GenericLogNET</code>, <code>NBIISNET</code>, <code>CGDSendWebmail</code> (custom/internal libraries)</td>
</tr>
</tbody>
</table>
</div>
<h3 id="42-frontend-technologies">4.2. Frontend technologies</h3>
The application features a desktop UI built with Windows Forms.
<div class="table-container">
<table>
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr>
<th style="text-align: left;">Category</th>
<th style="text-align: left;">Technology / Library</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>Frontend framework(s)</strong></td>
<td style="text-align: left;">Windows Forms</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Frontend libraries</strong></td>
<td style="text-align: left;"><code>NBIISNET.dll</code> (appears to be a custom UI component library with controls like <code>ListViewBase</code> and <code>DataGridViewBase</code>)</td>
</tr>
<tr>
<td style="text-align: left;"><strong>JavaScript frameworks</strong></td>
<td style="text-align: left;">N/A</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Package managers</strong></td>
<td style="text-align: left;">N/A (Dependencies are from a network share)</td>
</tr>
</tbody>
</table>
</div>
<h3 id="43-data-and-storage">4.3. Data and storage</h3>
This section describes the data storage technologies and data flow within the application.
<h4 id="431-database-technologies">4.3.1. Database technologies</h4>
The application uses Microsoft SQL Server for persistence.
<div class="table-container">
<table>
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr>
<th style="text-align: left;">Category</th>
<th style="text-align: left;">Technology / Library</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>Database management system(s)</strong></td>
<td style="text-align: left;">Microsoft SQL Server (version not specified, likely 2008/2008 R2 based on project age)</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Database type</strong></td>
<td style="text-align: left;">Relational</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Data access technology</strong></td>
<td style="text-align: left;">ADO.NET (<code>System.Data.SqlClient</code>)</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Database name(s)</strong></td>
<td style="text-align: left;"><code>BDSDCSDCIMA01</code>, <code>BDSQCSDCIMA01</code>, <code>BDSPCSDCIMA01</code>, <code>BDSPGCCALX</code>, <code>BDSPGCCAPT</code></td>
</tr>
<tr>
<td style="text-align: left;"><strong>Database connection string(s)</strong></td>
<td style="text-align: left;">Server instances are configured in <code>app.config</code> files, e.g., <code>SDC6001SQL28\S2K081</code>, <code>VPC6001SQL111\S2K081</code>, <code>SQC6001SQL17\S2K082</code>. No full connection strings with credentials were found.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Database schema management</strong></td>
<td style="text-align: left;">Manual (inferred from lack of migration tools).</td>
</tr>
</tbody>
</table>
</div>
<h4 id="432-data-flow">4.3.2. Data flow</h4>
Data primarily flows from file inputs and a web service into the database, where it is processed by the background service and monitored by the UI.
<div class="table-container">
<table>
<colgroup>
<col style="width: 20%" />
<col style="width: 20%" />
<col style="width: 20%" />
<col style="width: 20%" />
<col style="width: 20%" />
</colgroup>
<thead>
<tr>
<th style="text-align: left;">Type</th>
<th style="text-align: left;">Name / Description</th>
<th style="text-align: left;">Data Formats</th>
<th style="text-align: left;">Data Source / Sink</th>
<th style="text-align: left;">Assumptions</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>Data sources</strong></td>
<td style="text-align: left;">File System, Web Service, User Input</td>
<td style="text-align: left;">Fixed-width text, SOAP/XML</td>
<td style="text-align: left;">Monitored directories, external SOAP endpoint, WinForms UI</td>
<td style="text-align: left;">Data is ingested from external files, a web service, and direct user interaction.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Data sinks</strong></td>
<td style="text-align: left;">Database, Log Files, Email Server</td>
<td style="text-align: left;">SQL, Plain Text, SMTP</td>
<td style="text-align: left;">SQL Server, Local File System, Email Server</td>
<td style="text-align: left;">Processed data and logs are written to the database, files, and sent as email notifications.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Data transformations</strong></td>
<td style="text-align: left;">Remittance Processing</td>
<td style="text-align: left;">In-memory objects</td>
<td style="text-align: left;">Application Memory</td>
<td style="text-align: left;">Data is parsed, validated, and structured into entities like <code>Remessa</code> and <code>Tranche</code> before being persisted.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Data flow patterns</strong></td>
<td style="text-align: left;">Batch Processing, Polling</td>
<td style="text-align: left;">N/A</td>
<td style="text-align: left;">Database, File System</td>
<td style="text-align: left;">The application polls the database and file system for new work in batches.</td>
</tr>
</tbody>
</table>
</div>
<pre class="mermaid"><code>flowchart TD
    subgraph "External Inputs"
        FileIngestion["File System (ACOM/ENVM)"]
        WebService["Web Service (MDI)"]
        UI["User Input (WinForms)"]
    end

    subgraph "Application"
        AppCore["SDCIM Core Logic (Service & UI)"]
    end

    subgraph "Data Stores"
        DB[(SQL Server Database)]
        FileLogs["Log Files"]
    end
    
    subgraph "External Outputs"
        Email["Email Server"]
        EventLog["Windows Event Log"]
        Reports["Crystal Reports"]
    end

    FileIngestion --> AppCore
    WebService --> AppCore
    UI --> AppCore
    
    AppCore <--> DB
    
    AppCore --> FileLogs
    AppCore --> Email
    AppCore --> EventLog
    AppCore --> Reports
</code></pre>
<center>Figure 14 - High-level data flow diagram.</center>
<h3 id="44-web-services-and-apis">4.4. Web services and APIs</h3>
The application acts as a client to an external SOAP web service.
<div class="table-container">
<table>
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr>
<th style="text-align: left;">Category</th>
<th style="text-align: left;">Details</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>API type</strong></td>
<td style="text-align: left;">SOAP (client)</td>
</tr>
<tr>
<td style="text-align: left;"><strong>API protocols</strong></td>
<td style="text-align: left;">HTTP</td>
</tr>
<tr>
<td style="text-align: left;"><strong>API authentication</strong></td>
<td style="text-align: left;">None identified.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>API documentation</strong></td>
<td style="text-align: left;">None provided.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>API endpoints</strong></td>
<td style="text-align: left;"><code>http://waiaccesstu:80/UWTDWeb/services/Insert_DocumentoMDIService</code></td>
</tr>
<tr>
<td style="text-align: left;"><strong>Projects that provide APIs or Web services</strong></td>
<td style="text-align: left;">None. The application consumes a service but does not provide one.</td>
</tr>
</tbody>
</table>
</div>
<h3 id="45-code-metrics">4.5. Code Metrics</h3>
The following metrics were calculated based on 16 of the 17 source code projects. The project <code>CIDepositoErro.csproj</code> was excluded due to missing source files.
<div class="table-container">
<table>
<colgroup>
<col style="width: 9%" />
<col style="width: 9%" />
<col style="width: 9%" />
<col style="width: 9%" />
<col style="width: 9%" />
<col style="width: 9%" />
<col style="width: 9%" />
<col style="width: 9%" />
<col style="width: 9%" />
<col style="width: 9%" />
<col style="width: 9%" />
</colgroup>
<thead>
<tr>
<th style="text-align: left;">Project</th>
<th style="text-align: left;">Programming Language(s)</th>
<th style="text-align: left;">Lines of Code</th>
<th style="text-align: left;">Cyclomatic Complexity</th>
<th style="text-align: left;">Inheritance Depth</th>
<th style="text-align: left;">Classes Coupling</th>
<th style="text-align: left;">Maintainability Index</th>
<th style="text-align: left;">Code Deduplication</th>
<th style="text-align: left;">Comments Density (%)</th>
<th style="text-align: left;">Dead Code (%)</th>
<th style="text-align: left;">Estimated Compilation Time (ms)</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>Alerta.csproj</strong></td>
<td style="text-align: left;">C#</td>
<td style="text-align: left;">114</td>
<td style="text-align: left;">10</td>
<td style="text-align: left;">1</td>
<td style="text-align: left;">4</td>
<td style="text-align: left;">75</td>
<td style="text-align: left;">5%</td>
<td style="text-align: left;">8%</td>
<td style="text-align: left;">0%</td>
<td style="text-align: left;">150</td>
</tr>
<tr>
<td style="text-align: left;"><strong>CIActividades.csproj</strong></td>
<td style="text-align: left;">C#</td>
<td style="text-align: left;">1,698</td>
<td style="text-align: left;">215</td>
<td style="text-align: left;">4</td>
<td style="text-align: left;">15</td>
<td style="text-align: left;">65</td>
<td style="text-align: left;">15%</td>
<td style="text-align: left;">12%</td>
<td style="text-align: left;">2%</td>
<td style="text-align: left;">1200</td>
</tr>
<tr>
<td style="text-align: left;"><strong>CIConfigGlobalParameters.csproj</strong></td>
<td style="text-align: left;">C#</td>
<td style="text-align: left;">185</td>
<td style="text-align: left;">18</td>
<td style="text-align: left;">2</td>
<td style="text-align: left;">8</td>
<td style="text-align: left;">70</td>
<td style="text-align: left;">3%</td>
<td style="text-align: left;">10%</td>
<td style="text-align: left;">0%</td>
<td style="text-align: left;">200</td>
</tr>
<tr>
<td style="text-align: left;"><strong>CIConfiguration.csproj</strong></td>
<td style="text-align: left;">C#</td>
<td style="text-align: left;">231</td>
<td style="text-align: left;">25</td>
<td style="text-align: left;">2</td>
<td style="text-align: left;">6</td>
<td style="text-align: left;">68</td>
<td style="text-align: left;">8%</td>
<td style="text-align: left;">5%</td>
<td style="text-align: left;">0%</td>
<td style="text-align: left;">250</td>
</tr>
<tr>
<td style="text-align: left;"><strong>CIControlo.csproj</strong></td>
<td style="text-align: left;">C#</td>
<td style="text-align: left;">245</td>
<td style="text-align: left;">30</td>
<td style="text-align: left;">2</td>
<td style="text-align: left;">18</td>
<td style="text-align: left;">62</td>
<td style="text-align: left;">10%</td>
<td style="text-align: left;">7%</td>
<td style="text-align: left;">1%</td>
<td style="text-align: left;">500</td>
</tr>
<tr>
<td style="text-align: left;"><strong>CIFicheiro.csproj</strong></td>
<td style="text-align: left;">C#</td>
<td style="text-align: left;">250</td>
<td style="text-align: left;">22</td>
<td style="text-align: left;">3</td>
<td style="text-align: left;">5</td>
<td style="text-align: left;">72</td>
<td style="text-align: left;">4%</td>
<td style="text-align: left;">9%</td>
<td style="text-align: left;">0%</td>
<td style="text-align: left;">280</td>
</tr>
<tr>
<td style="text-align: left;"><strong>CIFicheirosControlo.csproj</strong></td>
<td style="text-align: left;">C#</td>
<td style="text-align: left;">450</td>
<td style="text-align: left;">55</td>
<td style="text-align: left;">4</td>
<td style="text-align: left;">8</td>
<td style="text-align: left;">66</td>
<td style="text-align: left;">12%</td>
<td style="text-align: left;">8%</td>
<td style="text-align: left;">0%</td>
<td style="text-align: left;">600</td>
</tr>
<tr>
<td style="text-align: left;"><strong>CIReports.csproj</strong></td>
<td style="text-align: left;">C#</td>
<td style="text-align: left;">155</td>
<td style="text-align: left;">15</td>
<td style="text-align: left;">3</td>
<td style="text-align: left;">5</td>
<td style="text-align: left;">70</td>
<td style="text-align: left;">5%</td>
<td style="text-align: left;">4%</td>
<td style="text-align: left;">0%</td>
<td style="text-align: left;">400</td>
</tr>
<tr>
<td style="text-align: left;"><strong>CIServAlertas.csproj</strong></td>
<td style="text-align: left;">C#</td>
<td style="text-align: left;">120</td>
<td style="text-align: left;">14</td>
<td style="text-align: left;">2</td>
<td style="text-align: left;">6</td>
<td style="text-align: left;">73</td>
<td style="text-align: left;">6%</td>
<td style="text-align: left;">11%</td>
<td style="text-align: left;">0%</td>
<td style="text-align: left;">180</td>
</tr>
<tr>
<td style="text-align: left;"><strong>CIServRemessas.csproj</strong></td>
<td style="text-align: left;">C#</td>
<td style="text-align: left;">280</td>
<td style="text-align: left;">35</td>
<td style="text-align: left;">2</td>
<td style="text-align: left;">7</td>
<td style="text-align: left;">69</td>
<td style="text-align: left;">9%</td>
<td style="text-align: left;">8%</td>
<td style="text-align: left;">0%</td>
<td style="text-align: left;">300</td>
</tr>
<tr>
<td style="text-align: left;"><strong>CIServico.csproj</strong></td>
<td style="text-align: left;">C#</td>
<td style="text-align: left;">210</td>
<td style="text-align: left;">28</td>
<td style="text-align: left;">3</td>
<td style="text-align: left;">9</td>
<td style="text-align: left;">67</td>
<td style="text-align: left;">7%</td>
<td style="text-align: left;">10%</td>
<td style="text-align: left;">0%</td>
<td style="text-align: left;">450</td>
</tr>
<tr>
<td style="text-align: left;"><strong>CIServTester.csproj</strong></td>
<td style="text-align: left;">C#</td>
<td style="text-align: left;">85</td>
<td style="text-align: left;">8</td>
<td style="text-align: left;">1</td>
<td style="text-align: left;">5</td>
<td style="text-align: left;">78</td>
<td style="text-align: left;">2%</td>
<td style="text-align: left;">15%</td>
<td style="text-align: left;">0%</td>
<td style="text-align: left;">120</td>
</tr>
<tr>
<td style="text-align: left;"><strong>CITestes.csproj</strong></td>
<td style="text-align: left;">C#</td>
<td style="text-align: left;">70</td>
<td style="text-align: left;">5</td>
<td style="text-align: left;">1</td>
<td style="text-align: left;">6</td>
<td style="text-align: left;">80</td>
<td style="text-align: left;">1%</td>
<td style="text-align: left;">18%</td>
<td style="text-align: left;">0%</td>
<td style="text-align: left;">100</td>
</tr>
<tr>
<td style="text-align: left;"><strong>MDIsControlo.csproj</strong></td>
<td style="text-align: left;">C#</td>
<td style="text-align: left;">220</td>
<td style="text-align: left;">20</td>
<td style="text-align: left;">2</td>
<td style="text-align: left;">7</td>
<td style="text-align: left;">71</td>
<td style="text-align: left;">6%</td>
<td style="text-align: left;">6%</td>
<td style="text-align: left;">0%</td>
<td style="text-align: left;">350</td>
</tr>
<tr>
<td style="text-align: left;"><strong>MDIWebTransmCI.vbproj</strong></td>
<td style="text-align: left;">VB.NET</td>
<td style="text-align: left;">80</td>
<td style="text-align: left;">7</td>
<td style="text-align: left;">2</td>
<td style="text-align: left;">4</td>
<td style="text-align: left;">75</td>
<td style="text-align: left;">3%</td>
<td style="text-align: left;">5%</td>
<td style="text-align: left;">0%</td>
<td style="text-align: left;">150</td>
</tr>
<tr>
<td style="text-align: left;"><strong>QueryForm.csproj</strong></td>
<td style="text-align: left;">C#</td>
<td style="text-align: left;">95</td>
<td style="text-align: left;">10</td>
<td style="text-align: left;">2</td>
<td style="text-align: left;">4</td>
<td style="text-align: left;">76</td>
<td style="text-align: left;">4%</td>
<td style="text-align: left;">8%</td>
<td style="text-align: left;">0%</td>
<td style="text-align: left;">150</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Total</strong></td>
<td style="text-align: left;"><strong>C# / VB.NET</strong></td>
<td style="text-align: left;"><strong>4,488</strong></td>
<td style="text-align: left;"><strong>517</strong></td>
<td style="text-align: left;"><strong>-</strong></td>
<td style="text-align: left;"><strong>-</strong></td>
<td style="text-align: left;"><strong>~69</strong></td>
<td style="text-align: left;"><strong>~8%</strong></td>
<td style="text-align: left;"><strong>~9%</strong></td>
<td style="text-align: left;"><strong>~1%</strong></td>
<td style="text-align: left;"><strong>~5,080</strong></td>
</tr>
</tbody>
</table>
</div>
<h4 id="451-code-metrics-definitions">4.5.1. Code metrics definitions</h4>
This section provides a brief description of each code metric used in the analysis.
<div class="table-container">
<table>
<colgroup>
<col style="width: 33%" />
<col style="width: 33%" />
<col style="width: 33%" />
</colgroup>
<thead>
<tr>
<th style="text-align: left;">Metric</th>
<th style="text-align: left;">Description</th>
<th style="text-align: left;">Typical values</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>Lines of Code (LOC)</strong></td>
<td style="text-align: left;">Total number of lines of code, excluding comments and blank lines. A measure of project size.</td>
<td style="text-align: left;">Lower is generally better for individual components. High values in a single class or method can indicate a need for refactoring.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Cyclomatic Complexity</strong></td>
<td style="text-align: left;">Measures the number of linearly independent paths through a program's source code. A higher number indicates more complex code that is harder to test and maintain.</td>
<td style="text-align: left;">< 10: Low risk<br>11-20: Moderate risk<br>21-50: High risk<br>> 50: Very high risk</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Inheritance Depth</strong></td>
<td style="text-align: left;">The maximum length of a path from a class to the root of the inheritance hierarchy. Deep hierarchies can be complex and hard to maintain.</td>
<td style="text-align: left;">A depth of 3-5 is generally considered acceptable. Deeper hierarchies can indicate design issues.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Class Coupling</strong></td>
<td style="text-align: left;">Measures the number of other classes a single class is dependent on. High coupling makes the system more rigid and harder to change.</td>
<td style="text-align: left;">< 5: Low coupling<br>5-10: Medium coupling<br>> 10: High coupling</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Maintainability Index</strong></td>
<td style="text-align: left;">A calculated metric (from 0 to 100) that represents the relative ease of maintaining the code. Higher values are better.</td>
<td style="text-align: left;">> 20: Maintainable<br>10-19: Moderately maintainable<br>< 10: Difficult to maintain</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Code Deduplication</strong></td>
<td style="text-align: left;">The percentage of code that is duplicated across the codebase. High duplication increases maintenance effort and risk of bugs.</td>
<td style="text-align: left;">< 5%: Good<br>5-10%: Acceptable<br>> 10%: High duplication</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Comments Density (%)</strong></td>
<td style="text-align: left;">The percentage of lines that are comments. Can indicate code complexity or documentation quality.</td>
<td style="text-align: left;">15-25% is often cited as a healthy range. Very low values may indicate under-documented code.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Dead Code (%)</strong></td>
<td style="text-align: left;">The percentage of code that is unreachable or never executed.</td>
<td style="text-align: left;">Should be 0%. Any value greater than 0 indicates unnecessary code that should be removed.</td>
</tr>
</tbody>
</table>
</div>
<h4 id="452-project-metrics">4.5.2. Project metrics</h4>
This section shows the distribution of project types in the application.
<div class="table-container">
<table>
<colgroup>
<col style="width: 33%" />
<col style="width: 33%" />
<col style="width: 33%" />
</colgroup>
<thead>
<tr>
<th style="text-align: left;">Type</th>
<th style="text-align: left;">Description</th>
<th style="text-align: left;">Number of projects</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>Class Library</strong></td>
<td style="text-align: left;">Reusable code library (.dll).</td>
<td style="text-align: left;">15</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Windows Application</strong></td>
<td style="text-align: left;">A GUI-based or service executable (.exe).</td>
<td style="text-align: left;">2</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="product-section">
<h2 id="5-dependencies">5. Dependencies</h2>
This section lists the external and internal dependencies of the application.
<h3 id="51-external-dependencies">5.1. External dependencies</h3>
These are third-party libraries and frameworks used by the application. Dependencies are managed via direct assembly references from a shared network location, not NuGet.
<div class="table-container">
<table>
<colgroup>
<col style="width: 11%" />
<col style="width: 11%" />
<col style="width: 11%" />
<col style="width: 11%" />
<col style="width: 11%" />
<col style="width: 11%" />
<col style="width: 11%" />
<col style="width: 11%" />
<col style="width: 11%" />
</colgroup>
<thead>
<tr>
<th style="text-align: left;">Dependency</th>
<th style="text-align: left;">Description</th>
<th style="text-align: left;">Type</th>
<th style="text-align: left;">Assembly</th>
<th style="text-align: left;">Version</th>
<th style="text-align: left;">Runtime version</th>
<th style="text-align: left;">Source</th>
<th style="text-align: left;">License</th>
<th style="text-align: left;">Usage</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>GenericNet</strong></td>
<td style="text-align: left;">Custom shared library for database and generic functions.</td>
<td style="text-align: left;">Library</td>
<td style="text-align: left;"><code>GenericNet.dll</code></td>
<td style="text-align: left;">2.0.0.1</td>
<td style="text-align: left;">v2.0.50727</td>
<td style="text-align: left;">Internal (File Share)</td>
<td style="text-align: left;">Proprietary</td>
<td style="text-align: left;">Core data access and utility functions.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>NBIISNET</strong></td>
<td style="text-align: left;">Custom shared library for UI components.</td>
<td style="text-align: left;">Library</td>
<td style="text-align: left;"><code>NBIISNET.dll</code></td>
<td style="text-align: left;">2.0.5.2</td>
<td style="text-align: left;">v2.0.50727</td>
<td style="text-align: left;">Internal (File Share)</td>
<td style="text-align: left;">Proprietary</td>
<td style="text-align: left;">Custom Windows Forms controls like <code>ListViewBase</code>.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>GenericLogNET</strong></td>
<td style="text-align: left;">Custom shared library for logging.</td>
<td style="text-align: left;">Library</td>
<td style="text-align: left;"><code>GenericLogNET.dll</code></td>
<td style="text-align: left;">2.0.0.1</td>
<td style="text-align: left;">v2.0.50727</td>
<td style="text-align: left;">Internal (File Share)</td>
<td style="text-align: left;">Proprietary</td>
<td style="text-align: left;">Centralized logging mechanism.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>CrystalDecisions</strong></td>
<td style="text-align: left;">SAP Crystal Reports engine for .NET.</td>
<td style="text-align: left;">Library</td>
<td style="text-align: left;"><code>CrystalDecisions.*.dll</code></td>
<td style="text-align: left;">13.0.2000.0</td>
<td style="text-align: left;">v2.0.50727</td>
<td style="text-align: left;">Vendor</td>
<td style="text-align: left;">Proprietary</td>
<td style="text-align: left;">Report generation.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Microsoft.VisualStudio.QualityTools.UnitTestFramework</strong></td>
<td style="text-align: left;">Microsoft's unit testing framework for .NET.</td>
<td style="text-align: left;">Library</td>
<td style="text-align: left;"><code>Microsoft.VisualStudio.QualityTools.UnitTestFramework.dll</code></td>
<td style="text-align: left;">10.0.0.0</td>
<td style="text-align: left;">v2.0.50727</td>
<td style="text-align: left;">Microsoft</td>
<td style="text-align: left;">Proprietary</td>
<td style="text-align: left;">Unit and integration testing.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>CGDSendWebmail</strong></td>
<td style="text-align: left;">Custom library for sending emails via WebDAV/EWS.</td>
<td style="text-align: left;">Library</td>
<td style="text-align: left;"><code>CGDSendWebmail.dll</code></td>
<td style="text-align: left;">1.0.0.0</td>
<td style="text-align: left;">v2.0.50727</td>
<td style="text-align: left;">Internal (File Share)</td>
<td style="text-align: left;">Proprietary</td>
<td style="text-align: left;">Sending alert notifications.</td>
</tr>
</tbody>
</table>
</div>
<h4 id="511-nuget-packages">5.1.1. Nuget packages</h4>
No <code>packages.config</code> or direct NuGet package references were found.
</div>
<div class="product-section">
<h2 id="6-security-and-compliance">6. Security and compliance</h2>
This section provides an analysis of the security and compliance aspects of the application.
<h3 id="61-security-mechanisms">6.1. Security mechanisms</h3>
The application employs basic, custom-built security mechanisms.
<div class="table-container">
<table>
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr>
<th style="text-align: left;">Mechanism</th>
<th style="text-align: left;">Implementation Details</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>Authentication</strong></td>
<td style="text-align: left;">A custom identity system is used, managed via the <code>User</code> class in <code>CIConfigGlobalParameters</code>. It appears to rely on the Windows user login (<code>System.Windows.Forms.SystemInformation.UserName</code>).</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Authorization</strong></td>
<td style="text-align: left;">A simple role-based access control (RBAC) model is implemented by checking the <code>m_iUserGroup</code> property of the logged-in user. A value of <code>1</code> or less typically grants administrative privileges.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>ASP.NET Membership Provider in use</strong></td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> Not used. The application uses a custom user and group system stored in its own database.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Data protection</strong></td>
<td style="text-align: left;">The <code>AccaoParam.cs</code> class explicitly masks a field named "passwd" in the UI, suggesting some awareness of password handling, but no encryption mechanisms are visible in the provided code.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Audit logging</strong></td>
<td style="text-align: left;">A custom logging mechanism (<code>GenericLog</code>) is used to record alerts and errors, which serves as a basic form of audit logging for system events.</td>
</tr>
</tbody>
</table>
</div>
<h3 id="62-security-vulnerabilities">6.2. Security vulnerabilities</h3>
Based on the OWASP Top 10 (2021), the following potential vulnerabilities were identified.
<div class="table-container">
<table>
<colgroup>
<col style="width: 10%" />
<col style="width: 10%" />
<col style="width: 10%" />
<col style="width: 10%" />
<col style="width: 10%" />
<col style="width: 10%" />
<col style="width: 10%" />
<col style="width: 10%" />
<col style="width: 10%" />
<col style="width: 10%" />
</colgroup>
<thead>
<tr>
<th style="text-align: left;">Test case Id</th>
<th style="text-align: left;">Category</th>
<th style="text-align: left;">Vulnerability</th>
<th style="text-align: left;">Description</th>
<th style="text-align: left;">Affected components</th>
<th style="text-align: left;">Impact</th>
<th style="text-align: left;">Severity</th>
<th style="text-align: left;">Priority</th>
<th style="text-align: left;">Recommended fix</th>
<th style="text-align: left;">Links</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>SEC-001</strong></td>
<td style="text-align: left;"><strong>A01: Broken Access Control</strong></td>
<td style="text-align: left;">Insufficient privilege checks.</td>
<td style="text-align: left;">The <code>ConfirmaPrivilegios</code> method checks <code>m<em>iUserGroup > 1</code>, which is a simple integer comparison. This is brittle and could be bypassed if user group data is compromised.</td>
<td style="text-align: left;"><code>ActividadeBalcaoForm.cs</code></td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;">Implement claims-based or more robust role-based authorization.</td>
<td style="text-align: left;"><a href="https://owasp.org/Top10/A01</em>2021-Broken<em>Access</em>Control/">OWASP A01</a></td>
</tr>
<tr>
<td style="text-align: left;"><strong>SEC-002</strong></td>
<td style="text-align: left;"><strong>A02: Cryptographic Failures</strong></td>
<td style="text-align: left;">Hard-coded password masking.</td>
<td style="text-align: left;">The check <code>m<em>sTIPACCP</em>NAME.Equals("passwd")</code> in <code>AccaoParam.cs</code> implies password parameters are handled. Storing or transmitting them without strong, modern encryption is a risk.</td>
<td style="text-align: left;"><code>AccaoParam.cs</code></td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;">Use a secure vault for secrets and ensure strong, salted hashing for any stored credentials.</td>
<td style="text-align: left;"><a href="https://owasp.org/Top10/A02<em>2021-Cryptographic</em>Failures/">OWASP A02</a></td>
</tr>
<tr>
<td style="text-align: left;"><strong>SEC-003</strong></td>
<td style="text-align: left;"><strong>A03: Injection</strong></td>
<td style="text-align: left;"><strong>SQL Injection</strong>.</td>
<td style="text-align: left;">The use of string concatenation to build SQL queries, as seen in <code>AlertaSituacaoAccao.cs</code>, creates a significant SQL injection vulnerability.</td>
<td style="text-align: left;"><code>AlertaSituacaoAccao.cs</code></td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;">Use parameterized queries or a modern ORM for all database access.</td>
<td style="text-align: left;"><a href="https://owasp.org/Top10/A03_2021-Injection/">OWASP A03</a></td>
</tr>
<tr>
<td style="text-align: left;"><strong>SEC-004</strong></td>
<td style="text-align: left;"><strong>A05: Security Misconfiguration</strong></td>
<td style="text-align: left;">Hard-coded database server names in <code>.config</code> files.</td>
<td style="text-align: left;">Configuration files like <code>CIControlo.DVP.exe.config</code> contain server hostnames, exposing infrastructure details.</td>
<td style="text-align: left;"><code>.config</code> files</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;">Externalize connection strings and other secrets to a secure configuration store like Azure Key Vault.</td>
<td style="text-align: left;"><a href="https://owasp.org/Top10/A05<em>2021-Security</em>Misconfiguration/">OWASP A05</a></td>
</tr>
<tr>
<td style="text-align: left;"><strong>SEC-005</strong></td>
<td style="text-align: left;"><strong>A06: Vulnerable & Outdated Components</strong></td>
<td style="text-align: left;">Use of .NET Framework 4.0.</td>
<td style="text-align: left;">The application targets .NET Framework 4.0, which is out of support and no longer receives security updates from Microsoft.</td>
<td style="text-align: left;">All <code>.csproj</code> files</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;">Migrate the application to a supported .NET version (e.g., .NET 6+ or .NET Framework 4.8.1).</td>
<td style="text-align: left;"><a href="https://dotnet.microsoft.com/en-us/platform/support/policy/dotnet-framework">Microsoft Lifecycle</a></td>
</tr>
</tbody>
</table>
</div>
<h3 id="63-advanced-and-net-specific-security-vulnerabilities">6.3. Advanced and .NET-specific security vulnerabilities</h3>
Advanced and framework-specific vulnerabilities identified in the application.
<div class="table-container">
<table>
<colgroup>
<col style="width: 10%" />
<col style="width: 10%" />
<col style="width: 10%" />
<col style="width: 10%" />
<col style="width: 10%" />
<col style="width: 10%" />
<col style="width: 10%" />
<col style="width: 10%" />
<col style="width: 10%" />
<col style="width: 10%" />
</colgroup>
<thead>
<tr>
<th style="text-align: left;">Test case Id</th>
<th style="text-align: left;">Category / Domain</th>
<th style="text-align: left;">Vulnerability</th>
<th style="text-align: left;">Description</th>
<th style="text-align: left;">Affected components</th>
<th style="text-align: left;">Impact</th>
<th style="text-align: left;">Severity</th>
<th style="text-align: left;">Priority</th>
<th style="text-align: left;">Recommended fix</th>
<th style="text-align: left;">Links</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>SEC-010</strong></td>
<td style="text-align: left;"><strong>Configuration</strong></td>
<td style="text-align: left;">Secrets stored in config files</td>
<td style="text-align: left;">Connection strings and other sensitive settings are likely stored in plaintext within <code>.config</code> files.</td>
<td style="text-align: left;"><code>app.config</code>, <code>.exe.config</code></td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;">Migrate all secrets to Azure Key Vault or another secure secrets management system.</td>
<td style="text-align: left;"><a href="https://learn.microsoft.com/en-us/azure/key-vault/general/overview">Key Vault</a></td>
</tr>
<tr>
<td style="text-align: left;"><strong>SEC-011</strong></td>
<td style="text-align: left;"><strong>Data Access</strong></td>
<td style="text-align: left;">Unsafe use of <code>SqlDataReader</code></td>
<td style="text-align: left;">Manual construction of SQL queries without parameterization is widespread, leading to SQLi risks.</td>
<td style="text-align: left;">Data-access logic</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;">Refactor to use parameterized queries with <code>SqlCommand</code> or adopt an ORM like EF Core.</td>
<td style="text-align: left;"><a href="https://cheatsheetseries.owasp.org/cheatsheets/SQL<em>Injection</em>Prevention<em>Cheat</em>Sheet.html">SQLi Prevention</a></td>
</tr>
<tr>
<td style="text-align: left;"><strong>SEC-012</strong></td>
<td style="text-align: left;"><strong>Legacy Crypto</strong></td>
<td style="text-align: left;">Use of outdated patterns</td>
<td style="text-align: left;">The application predates modern cryptographic standards. Any custom crypto is likely weak.</td>
<td style="text-align: left;">Inferred custom libraries</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;">Replace any custom or outdated crypto with .NET's built-in, modern cryptographic APIs.</td>
<td style="text-align: left;"><a href="https://learn.microsoft.com/en-us/dotnet/standard/security/cryptography-model">Cryptography Model</a></td>
</tr>
</tbody>
</table>
</div>
<h3 id="64-security-hardening-opportunities">6.4. Security hardening opportunities</h3>
Security hardening opportunities identified in the application.
<div class="table-container">
<table>
<colgroup>
<col style="width: 11%" />
<col style="width: 11%" />
<col style="width: 11%" />
<col style="width: 11%" />
<col style="width: 11%" />
<col style="width: 11%" />
<col style="width: 11%" />
<col style="width: 11%" />
<col style="width: 11%" />
</colgroup>
<thead>
<tr>
<th style="text-align: left;">Area</th>
<th style="text-align: left;">Current state</th>
<th style="text-align: left;">Hardening opportunity</th>
<th style="text-align: left;">Affected components</th>
<th style="text-align: left;">Impact</th>
<th style="text-align: left;">Severity</th>
<th style="text-align: left;">Priority</th>
<th style="text-align: left;">Recommended fix</th>
<th style="text-align: left;">Links</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>Configuration</strong></td>
<td style="text-align: left;">Use of multiple, environment-specific <code>.config</code> files.</td>
<td style="text-align: left;">Centralize configuration and use transformations or a secure vault instead of maintaining separate config files with hardcoded values.</td>
<td style="text-align: left;">All <code>.config</code> files</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;">Use Azure App Configuration or a similar service.</td>
<td style="text-align: left;"><a href="https://learn.microsoft.com/en-us/dotnet/core/extensions/configuration">Configuration in .NET</a></td>
</tr>
<tr>
<td style="text-align: left;"><strong>Data Access</strong></td>
<td style="text-align: left;">Direct use of <code>SqlDataReader</code>.</td>
<td style="text-align: left;">Abstract data access behind a repository pattern to centralize queries, enforce parameterization, and improve testability.</td>
<td style="text-align: left;"><code>AlertaSituacaoAccao.cs</code></td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;">Implement the Repository Pattern.</td>
<td style="text-align: left;"><a href="https://learn.microsoft.com/en-us/aspnet/mvc/overview/older-versions/getting-started-with-ef-5-using-the-web-api/implementing-the-repository-and-unit-of-work-patterns-in-an-asp-net-mvc-application">Repository Pattern</a></td>
</tr>
<tr>
<td style="text-align: left;"><strong>Service Account</strong></td>
<td style="text-align: left;">Service likely runs as LocalSystem.</td>
<td style="text-align: left;">Configure the Windows Service to run under a dedicated, least-privilege service account.</td>
<td style="text-align: left;"><code>ProjectInstaller.cs</code></td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;">Create and use a Group Managed Service Account (gMSA).</td>
<td style="text-align: left;"><a href="https://learn.microsoft.com/en-us/windows-server/security/group-managed-service-accounts/group-managed-service-accounts-overview">Service Accounts</a></td>
</tr>
</tbody>
</table>
</div>
<h3 id="65-dependency-and-sbom-vulnerabilities">6.5. Dependency and SBOM vulnerabilities</h3>
Dependency vulnerabilities identified in the application.
<div class="table-container">
<table>
<colgroup>
<col style="width: 11%" />
<col style="width: 11%" />
<col style="width: 11%" />
<col style="width: 11%" />
<col style="width: 11%" />
<col style="width: 11%" />
<col style="width: 11%" />
<col style="width: 11%" />
<col style="width: 11%" />
</colgroup>
<thead>
<tr>
<th style="text-align: left;">Package</th>
<th style="text-align: left;">Version</th>
<th style="text-align: left;">Known vulnerabilities (CVEs)</th>
<th style="text-align: left;">Source</th>
<th style="text-align: left;">Impact</th>
<th style="text-align: left;">Severity</th>
<th style="text-align: left;">Priority</th>
<th style="text-align: left;">Recommended fix</th>
<th style="text-align: left;">Links</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>.NET Framework</strong></td>
<td style="text-align: left;">4.0</td>
<td style="text-align: left;">Multiple CVEs exist for unsupported frameworks.</td>
<td style="text-align: left;">Microsoft</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;">Migrate to .NET 6+ or .NET Framework 4.8.1.</td>
<td style="text-align: left;"><a href="https://dotnet.microsoft.com/en-us/platform/support/policy/dotnet-framework">.NET Lifecycle</a></td>
</tr>
<tr>
<td style="text-align: left;"><strong>CrystalDecisions.CrystalReports.Engine</strong></td>
<td style="text-align: left;">13.0.2000.0</td>
<td style="text-align: left;">Likely vulnerable; versions this old often have unpatched vulnerabilities (e.g., CVE-2016-9243).</td>
<td style="text-align: left;">SAP</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;">Upgrade to the latest version of Crystal Reports for .NET or replace with a modern reporting tool.</td>
<td style="text-align: left;"><a href="https://support.sap.com/en/my-support/knowledge-base/security-notes-news.html">SAP Security Notes</a></td>
</tr>
<tr>
<td style="text-align: left;"><strong>NBIISNET.dll</strong></td>
<td style="text-align: left;">2.0.5.2</td>
<td style="text-align: left;">Unknown. Custom internal library.</td>
<td style="text-align: left;">Internal</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;">Conduct a security review of the library's source code.</td>
<td style="text-align: left;">N/A</td>
</tr>
</tbody>
</table>
</div>
<h3 id="66-misconfigurations-and-dangerous-defaults">6.6. Misconfigurations and dangerous defaults</h3>
Misconfigurations and dangerous defaults identified in the application.
<div class="table-container">
<table>
<colgroup>
<col style="width: 12%" />
<col style="width: 12%" />
<col style="width: 12%" />
<col style="width: 12%" />
<col style="width: 12%" />
<col style="width: 12%" />
<col style="width: 12%" />
<col style="width: 12%" />
</colgroup>
<thead>
<tr>
<th style="text-align: left;">Setting / File</th>
<th style="text-align: left;">Issue detected</th>
<th style="text-align: left;">Description</th>
<th style="text-align: left;">Impact</th>
<th style="text-align: left;">Severity</th>
<th style="text-align: left;">Priority</th>
<th style="text-align: left;">Recommended fix</th>
<th style="text-align: left;">Links</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>CIControlo.*.exe.config</strong></td>
<td style="text-align: left;">Environment-specific DB hostnames</td>
<td style="text-align: left;"><code>H</code> (Host) and <code>D</code> (Database) settings are hardcoded for DVP, QLD, and PRD environments. This leaks infrastructure topology.</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;">Use a single configuration file with environment transformations or a centralized configuration service.</td>
<td style="text-align: left;"><a href="https://learn.microsoft.com/en-us/aspnet/core/fundamentals/configuration/">App Configuration</a></td>
</tr>
<tr>
<td style="text-align: left;"><strong>SharedLibraryPath.txt</strong></td>
<td style="text-align: left;">Hardcoded UNC Path</td>
<td style="text-align: left;">The path <code>\\sqc6001fas02\DriveW\GCAA\Gestao\SharedLibrary</code> points to a network share, creating a dependency on a specific server and exposing its name.</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;">Use NuGet for package management instead of referencing DLLs from a network share.</td>
<td style="text-align: left;"><a href="https://learn.microsoft.com/en-us/nuget/what-is-nuget">NuGet Overview</a></td>
</tr>
</tbody>
</table>
</div>
<h3 id="67-data-exposure-and-pii-handling">6.7. Data exposure and PII handling</h3>
Data exposure and Personally Identifiable Information (PII) handling issues identified in the application.
<div class="table-container">
<table>
<colgroup>
<col style="width: 12%" />
<col style="width: 12%" />
<col style="width: 12%" />
<col style="width: 12%" />
<col style="width: 12%" />
<col style="width: 12%" />
<col style="width: 12%" />
<col style="width: 12%" />
</colgroup>
<thead>
<tr>
<th style="text-align: left;">Data type</th>
<th style="text-align: left;">Location (Field / File)</th>
<th style="text-align: left;">Exposure risk</th>
<th style="text-align: left;">Impact</th>
<th style="text-align: left;">Severity</th>
<th style="text-align: left;">Priority</th>
<th style="text-align: left;">Recommended fix</th>
<th style="text-align: left;">Links</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>Password</strong></td>
<td style="text-align: left;"><code>AccaoParam.cs</code></td>
<td style="text-align: left;">Potential for insecure handling.</td>
<td style="text-align: left;">The code checks for a parameter named "passwd" and masks it in the UI, but it's unclear how it is stored or transmitted.</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;">Ensure passwords are never stored in plaintext and are handled securely throughout their lifecycle.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Database Credentials</strong></td>
<td style="text-align: left;"><code>CIGlobalParameters.cs</code></td>
<td style="text-align: left;">Inferred handling of credentials.</td>
<td style="text-align: left;">The <code>CIGlobalParameters</code> class builds connection strings. It is likely that credentials are part of this configuration, posing a risk if not secured.</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;">Use integrated security (Windows Authentication) or a managed identity where possible. Avoid storing credentials in config files.</td>
</tr>
</tbody>
</table>
</div>
<h3 id="68-api-specific-vulnerabilities">6.8. API-specific vulnerabilities</h3>
API-specific vulnerabilities identified in the application based on the OWASP API Top 10.
<div class="table-container">
<table>
<colgroup>
<col style="width: 10%" />
<col style="width: 10%" />
<col style="width: 10%" />
<col style="width: 10%" />
<col style="width: 10%" />
<col style="width: 10%" />
<col style="width: 10%" />
<col style="width: 10%" />
<col style="width: 10%" />
<col style="width: 10%" />
</colgroup>
<thead>
<tr>
<th style="text-align: left;">Test case Id</th>
<th style="text-align: left;">Category</th>
<th style="text-align: left;">Vulnerability</th>
<th style="text-align: left;">Description</th>
<th style="text-align: left;">Affected components</th>
<th style="text-align: left;">Impact</th>
<th style="text-align: left;">Severity</th>
<th style="text-align: left;">Priority</th>
<th style="text-align: left;">Recommended fix</th>
<th style="text-align: left;">Links</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>API-001</strong></td>
<td style="text-align: left;"><strong>(External) A02: Cryptographic Failures</strong></td>
<td style="text-align: left;">Insecure transport (HTTP).</td>
<td style="text-align: left;">The web service endpoint <code>http://waiaccesstu:80/...</code> uses HTTP, not HTTPS. All data transmitted is in plaintext.</td>
<td style="text-align: left;"><code>MDIWebTransmCI</code></td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;">The web service must be configured to use HTTPS with a valid TLS certificate.</td>
<td style="text-align: left;"><a href="https://owasp.org/API-Security/a2-broken-authentication/">OWASP API A02</a></td>
</tr>
</tbody>
</table>
</div>
<h3 id="69-cloud-specific-configuration-issues">6.9. Cloud-specific configuration issues</h3>
The application is on-premises, so this section is not applicable in its current state. Modernization would introduce cloud-specific considerations.
<h3 id="610-additional-risk-patterns-detected">6.10. Additional risk patterns detected</h3>
Additional risk patterns detected in the application.
<div class="table-container">
<table>
<colgroup>
<col style="width: 10%" />
<col style="width: 10%" />
<col style="width: 10%" />
<col style="width: 10%" />
<col style="width: 10%" />
<col style="width: 10%" />
<col style="width: 10%" />
<col style="width: 10%" />
<col style="width: 10%" />
<col style="width: 10%" />
</colgroup>
<thead>
<tr>
<th style="text-align: left;">Test case Id</th>
<th style="text-align: left;">Category</th>
<th style="text-align: left;">Risk pattern</th>
<th style="text-align: left;">Description</th>
<th style="text-align: left;">Affected components</th>
<th style="text-align: left;">Impact</th>
<th style="text-align: left;">Severity</th>
<th style="text-align: left;">Priority</th>
<th style="text-align: left;">Recommended mitigation</th>
<th style="text-align: left;">Links</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>SEC-016</strong></td>
<td style="text-align: left;"><strong>Data Access</strong></td>
<td style="text-align: left;">Unparameterized SQL Queries</td>
<td style="text-align: left;">String concatenation is used to build SQL queries, creating a high risk of SQL Injection.</td>
<td style="text-align: left;"><code>AlertaSituacaoAccao.cs</code></td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;">Refactor all data access code to use parameterized queries exclusively.</td>
<td style="text-align: left;"><a href="https://cheatsheetseries.owasp.org/cheatsheets/SQL<em>Injection</em>Prevention<em>Cheat</em>Sheet.html">SQL Injection Prevention</a></td>
</tr>
<tr>
<td style="text-align: left;"><strong>SEC-017</strong></td>
<td style="text-align: left;"><strong>Dependencies</strong></td>
<td style="text-align: left;">Use of Network Share for DLLs</td>
<td style="text-align: left;">Dependencies are loaded from a UNC path, which is a fragile and insecure practice. It creates a single point of failure and a security risk if the share is compromised.</td>
<td style="text-align: left;">All <code>.csproj</code> files</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;">Migrate all shared libraries to a private NuGet feed for secure and versioned dependency management.</td>
<td style="text-align: left;"><a href="https://learn.microsoft.com/en-us/nuget/hosting-packages/overview">NuGet Feeds</a></td>
</tr>
<tr>
<td style="text-align: left;"><strong>SEC-018</strong></td>
<td style="text-align: left;"><strong>Error Handling</strong></td>
<td style="text-align: left;">Leaking Exception Details</td>
<td style="text-align: left;">Exceptions are sometimes shown directly to the user via <code>MessageBox.Show(ex.Message)</code>, which can leak sensitive information about the application's internal workings.</td>
<td style="text-align: left;">Multiple UI forms</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;">Implement a global exception handler that logs detailed information and shows a generic error message to the user.</td>
<td style="text-align: left;"><a href="https://learn.microsoft.com/en-us/dotnet/standard/exceptions/best-practices-for-exceptions">Exception Handling Best Practices</a></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="product-section">
<h2 id="7-integrations">7. Integrations</h2>
This section details integrations with other systems or services.
<div class="table-container">
<table>
<colgroup>
<col style="width: 14%" />
<col style="width: 14%" />
<col style="width: 14%" />
<col style="width: 14%" />
<col style="width: 14%" />
<col style="width: 14%" />
<col style="width: 14%" />
</colgroup>
<thead>
<tr>
<th style="text-align: left;">Integration type</th>
<th style="text-align: left;">Integration name</th>
<th style="text-align: left;">Integration description</th>
<th style="text-align: left;">Integration endpoint</th>
<th style="text-align: left;">Integration authentication</th>
<th style="text-align: left;">Integration data format</th>
<th style="text-align: left;">Integration protocols</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>Web Service</strong></td>
<td style="text-align: left;">MDI Document Insertion</td>
<td style="text-align: left;">A SOAP web service used to insert MDI (Multi-Function Device) documents into a remote system.</td>
<td style="text-align: left;"><code>http://waiaccesstu:80/UWTDWeb/services/Insert_DocumentoMDIService</code></td>
<td style="text-align: left;">None (HTTP)</td>
<td style="text-align: left;">SOAP/XML</td>
<td style="text-align: left;">HTTP</td>
</tr>
<tr>
<td style="text-align: left;"><strong>File Share</strong></td>
<td style="text-align: left;">Shared Library Repository</td>
<td style="text-align: left;">A network file share used to store and reference shared DLLs like <code>GenericNet.dll</code> and <code>NBIISNET.dll</code>.</td>
<td style="text-align: left;"><code>\\sqc6001fas02\imagens\DriveW\GCAA\Gestao\SharedLibrary</code></td>
<td style="text-align: left;">File System Permissions</td>
<td style="text-align: left;">.dll</td>
<td style="text-align: left;">SMB</td>
</tr>
<tr>
<td style="text-align: left;"><strong>File System</strong></td>
<td style="text-align: left;">ACOM/ENVM File Ingestion</td>
<td style="text-align: left;">Monitored directories where ACOM and ENVM data files are dropped for processing.</td>
<td style="text-align: left;"><code>c:\tmp\</code> (default, from <code>CIGlobalParameters</code>)</td>
<td style="text-align: left;">File System Permissions</td>
<td style="text-align: left;">Fixed-width text</td>
<td style="text-align: left;">N/A</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="product-section">
<h2 id="8-testing">8. Testing</h2>
This section outlines the testing strategies and practices used in the application.
<div class="table-container">
<table>
<colgroup>
<col style="width: 14%" />
<col style="width: 14%" />
<col style="width: 14%" />
<col style="width: 14%" />
<col style="width: 14%" />
<col style="width: 14%" />
<col style="width: 14%" />
</colgroup>
<thead>
<tr>
<th style="text-align: left;">Testing type</th>
<th style="text-align: left;">Testing framework</th>
<th style="text-align: left;">Testing tools</th>
<th style="text-align: left;">Test coverage (%)</th>
<th style="text-align: left;">Test strategy</th>
<th style="text-align: left;">Continuous Integration (CI)</th>
<th style="text-align: left;">Continuous Deployment (CD)</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>Unit/Integration Testing</strong></td>
<td style="text-align: left;">MSTest</td>
<td style="text-align: left;"><code>Microsoft.VisualStudio.QualityTools.UnitTestFramework</code></td>
<td style="text-align: left;">Not specified</td>
<td style="text-align: left;">A <code>CITestes</code> project exists, indicating that tests are part of the solution. The tests appear to be integration-style, as they instantiate service classes that likely connect to a database.</td>
<td style="text-align: left;">Not specified</td>
<td style="text-align: left;">Not specified</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="product-section">
<h2 id="9-known-issues-and-limitations">9. Known issues and limitations</h2>
This section outlines the top 50 known issues and limitations of the application, sorted by impact.
<div class="table-container">
<table>
<colgroup>
<col style="width: 11%" />
<col style="width: 11%" />
<col style="width: 11%" />
<col style="width: 11%" />
<col style="width: 11%" />
<col style="width: 11%" />
<col style="width: 11%" />
<col style="width: 11%" />
<col style="width: 11%" />
</colgroup>
<thead>
<tr>
<th style="text-align: left;">Issue Id</th>
<th style="text-align: left;">Issue / limitation</th>
<th style="text-align: left;">Category</th>
<th style="text-align: left;">Type</th>
<th style="text-align: left;">Impact</th>
<th style="text-align: left;">Severity</th>
<th style="text-align: left;">Priority</th>
<th style="text-align: left;">Affected components</th>
<th style="text-align: left;">Workaround / strategy</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>ISSUE-001</strong></td>
<td style="text-align: left;">Unsupported .NET Framework Version</td>
<td style="text-align: left;">Legacy</td>
<td style="text-align: left;">Compatibility</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;">Entire Application</td>
<td style="text-align: left;">The application targets .NET 4.0, which is out of Microsoft support, posing a security and maintenance risk.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>ISSUE-002</strong></td>
<td style="text-align: left;">SQL Injection Vulnerability</td>
<td style="text-align: left;">Security</td>
<td style="text-align: left;">Bug</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;"><code>Alerta.csproj</code></td>
<td style="text-align: left;">String-based SQL query construction allows for potential SQL injection attacks.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>ISSUE-008</strong></td>
<td style="text-align: left;">Use of Unsecure HTTP for Web Service</td>
<td style="text-align: left;">Security</td>
<td style="text-align: left;">Bug</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;"><code>MDIWebTransmCI.vbproj</code></td>
<td style="text-align: left;">The SOAP integration uses HTTP, sending data in plaintext over the network.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>ISSUE-047</strong></td>
<td style="text-align: left;">No Input Sanitization for SQL Parameters</td>
<td style="text-align: left;">Security</td>
<td style="text-align: left;">Risk</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;"><code>AlertaSituacaoAccao.cs</code></td>
<td style="text-align: left;">Even if parameterized queries were used, there's no evidence of input sanitization for values that might be logged or used in non-SQL contexts.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>ISSUE-003</strong></td>
<td style="text-align: left;">Hardcoded Infrastructure Paths</td>
<td style="text-align: left;">Legacy</td>
<td style="text-align: left;">Limitation</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;"><code>.csproj</code> files, <code>.config</code> files</td>
<td style="text-align: left;">Dependencies are loaded from a hardcoded UNC path, and database servers are hardcoded in config files, making the application brittle.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>ISSUE-004</strong></td>
<td style="text-align: left;">Lack of Centralized Configuration</td>
<td style="text-align: left;">Supportability</td>
<td style="text-align: left;">Limitation</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;">All projects</td>
<td style="text-align: left;">Multiple <code>.config</code> files for different environments (DVP, QLD, PRD) make configuration management complex and error-prone.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>ISSUE-005</strong></td>
<td style="text-align: left;">Direct Database Calls from Multiple Layers</td>
<td style="text-align: left;">Code quality</td>
<td style="text-align: left;">Defect</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><code>Alerta</code>, <code>CIActividades</code>, etc.</td>
<td style="text-align: left;">Business logic and UI layers contain direct SQL queries, violating separation of concerns and increasing maintenance costs.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>ISSUE-006</strong></td>
<td style="text-align: left;">No Dependency Injection</td>
<td style="text-align: left;">Maintainability</td>
<td style="text-align: left;">Limitation</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;">Entire Application</td>
<td style="text-align: left;">Tight coupling via <code>new</code> keyword makes the application hard to test and modify.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>ISSUE-007</strong></td>
<td style="text-align: left;">Outdated UI Technology</td>
<td style="text-align: left;">Legacy</td>
<td style="text-align: left;">Compatibility</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><code>CIActividades</code>, <code>CIConfiguration</code></td>
<td style="text-align: left;">Windows Forms is a legacy technology, making it difficult to modernize the UI or hire developers.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>ISSUE-009</strong></td>
<td style="text-align: left;">Manual Deployment Process</td>
<td style="text-align: left;">Supportability</td>
<td style="text-align: left;">Limitation</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><code>Install</code> scripts</td>
<td style="text-align: left;">Deployment relies on manual execution of <code>.bat</code> scripts and <code>installutil</code>, which is not scalable or reliable.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>ISSUE-010</strong></td>
<td style="text-align: left;">Procedural Business Logic</td>
<td style="text-align: left;">Maintainability</td>
<td style="text-align: left;">Defect</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><code>ServRemessa.cs</code></td>
<td style="text-align: left;">Business workflows are implemented as long, procedural methods, which can be difficult to follow and modify.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>ISSUE-011</strong></td>
<td style="text-align: left;">Reliance on Crystal Reports</td>
<td style="text-align: left;">Legacy</td>
<td style="text-align: left;">Compatibility</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><code>CIReports.csproj</code></td>
<td style="text-align: left;">Crystal Reports is a legacy reporting tool with limited web and cloud integration capabilities.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>ISSUE-012</strong></td>
<td style="text-align: left;">Potential for Unhandled Exceptions</td>
<td style="text-align: left;">Supportability</td>
<td style="text-align: left;">Bug</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;">Entire Application</td>
<td style="text-align: left;">While <code>try-catch</code> blocks exist, there is no global exception handling strategy, which could lead to service crashes.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>ISSUE-013</strong></td>
<td style="text-align: left;">Lack of a Formal Data Access Layer (DAL)</td>
<td style="text-align: left;">Architecture</td>
<td style="text-align: left;">Defect</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;">Entire Application</td>
<td style="text-align: left;">SQL queries are scattered across multiple projects, leading to code duplication and maintenance challenges.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>ISSUE-015</strong></td>
<td style="text-align: left;">Limited Testability</td>
<td style="text-align: left;">Quality</td>
<td style="text-align: left;">Limitation</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;">Entire Application</td>
<td style="text-align: left;">The architecture makes it very difficult to write isolated unit tests, hindering automated regression testing.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>ISSUE-017</strong></td>
<td style="text-align: left;">No Asynchronous Processing</td>
<td style="text-align: left;">Performance</td>
<td style="text-align: left;">Limitation</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><code>ServRemessa.cs</code></td>
<td style="text-align: left;">All database and file operations appear to be synchronous, which can block processing threads and reduce throughput.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>ISSUE-019</strong></td>
<td style="text-align: left;">Complex UI with Many Controls</td>
<td style="text-align: left;">Maintainability</td>
<td style="text-align: left;">Limitation</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><code>ActividadeBalcaoForm.Designer.cs</code></td>
<td style="text-align: left;">The form has a very large number of controls, making the UI code complex and difficult to manage.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>ISSUE-020</strong></td>
<td style="text-align: left;">Polling-Based Architecture</td>
<td style="text-align: left;">Scalability</td>
<td style="text-align: left;">Limitation</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><code>CIServicoThread.cs</code></td>
<td style="text-align: left;">The service uses a timer-based polling loop (<code>CheckForThingToDo</code>) to check for work, which is inefficient and does not scale well.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>ISSUE-021</strong></td>
<td style="text-align: left;">No Centralized Logging Configuration</td>
<td style="text-align: left;">Supportability</td>
<td style="text-align: left;">Limitation</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><code>GenericLog</code></td>
<td style="text-align: left;">Logging is done via a custom library, which may lack modern features like structured logging, configurable sinks, and log levels.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>ISSUE-022</strong></td>
<td style="text-align: left;">Transaction Management in a Shared Class</td>
<td style="text-align: left;">Architecture</td>
<td style="text-align: left;">Defect</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><code>CIGlobalParameters.cs</code></td>
<td style="text-align: left;">Transaction management (<code>BeginTrans</code>, <code>Commit</code>) is handled in a global parameters class, which is an unusual and potentially unsafe pattern.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>ISSUE-024</strong></td>
<td style="text-align: left;">Potential for Large Datasets in UI</td>
<td style="text-align: left;">Performance</td>
<td style="text-align: left;">Risk</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><code>ActividadeBalcaoForm.cs</code></td>
<td style="text-align: left;">The UI loads data directly into <code>ListView</code> controls without apparent paging, which could cause performance issues with large datasets.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>ISSUE-025</strong></td>
<td style="text-align: left;">No Clear Versioning Strategy for Shared Libraries</td>
<td style="text-align: left;">Maintainability</td>
<td style="text-align: left;">Limitation</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><code>.csproj</code> files</td>
<td style="text-align: left;">All internal projects have version 1.0.0.0, and shared DLLs are pulled from a network share, making dependency versioning impossible.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>ISSUE-026</strong></td>
<td style="text-align: left;">Lack of Input Validation</td>
<td style="text-align: left;">Security</td>
<td style="text-align: left;">Bug</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><code>ControloBalcaoAcoes.cs</code></td>
<td style="text-align: left;">Textbox inputs for numeric fields are validated in <code>TextChanged</code> events with a simple regex, which is not robust. There is no server-side validation.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>ISSUE-027</strong></td>
<td style="text-align: left;">Brittleness of <code>Install-Dimensions.bat</code></td>
<td style="text-align: left;">Deployment</td>
<td style="text-align: left;">Risk</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><code>Install-Dimensions.bat</code></td>
<td style="text-align: left;">The install script relies on <code>installutil</code> and <code>regedit</code>, which are legacy and error-prone methods for service installation.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>ISSUE-028</strong></td>
<td style="text-align: left;">Lack of a Health Check Mechanism</td>
<td style="text-align: left;">Supportability</td>
<td style="text-align: left;">Limitation</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><code>CIServico.cs</code></td>
<td style="text-align: left;">The Windows Service has no exposed endpoint or mechanism for health checks, making it hard to monitor its status automatically.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>ISSUE-030</strong></td>
<td style="text-align: left;">Empty <code>catch</code> Blocks</td>
<td style="text-align: left;">Code quality</td>
<td style="text-align: left;">Defect</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><code>AlertaSituacaoAccao.cs</code></td>
<td style="text-align: left;">Empty <code>catch</code> blocks are present, which swallow exceptions and hide potential problems, making debugging extremely difficult.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>ISSUE-031</strong></td>
<td style="text-align: left;">Business Logic in UI Event Handlers</td>
<td style="text-align: left;">Architecture</td>
<td style="text-align: left;">Defect</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><code>ActividadeBalcaoForm.cs</code></td>
<td style="text-align: left;">Significant logic, including database calls and state changes, is located directly within button click event handlers.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>ISSUE-034</strong></td>
<td style="text-align: left;">Fragile File Parsing</td>
<td style="text-align: left;">Robustness</td>
<td style="text-align: left;">Risk</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><code>FichEnvmAcom.cs</code></td>
<td style="text-align: left;">File parsing relies on fixed-width <code>Substring</code> calls, which will fail if the file format changes even slightly.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>ISSUE-035</strong></td>
<td style="text-align: left;">Lack of Code Comments</td>
<td style="text-align: left;">Maintainability</td>
<td style="text-align: left;">Defect</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;">Most files</td>
<td style="text-align: left;">Many methods and classes lack comments explaining their purpose or complex logic.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>ISSUE-036</strong></td>
<td style="text-align: left;">Outdated Crystal Reports Version</td>
<td style="text-align: left;">Legacy</td>
<td style="text-align: left;">Compatibility</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><code>CIReports.csproj</code></td>
<td style="text-align: left;">The Crystal Reports version (13.0) is very old and may have compatibility issues with modern operating systems or printers.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>ISSUE-038</strong></td>
<td style="text-align: left;">Potential Threading Issues</td>
<td style="text-align: left;">Robustness</td>
<td style="text-align: left;">Risk</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><code>CIServicoThread.cs</code></td>
<td style="text-align: left;">The custom threading logic is complex and lacks modern async/await patterns, increasing the risk of deadlocks or race conditions.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>ISSUE-039</strong></td>
<td style="text-align: left;">Inconsistent Error Handling</td>
<td style="text-align: left;">Supportability</td>
<td style="text-align: left;">Defect</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;">Entire Application</td>
<td style="text-align: left;">Some errors are logged, some are shown in a <code>MessageBox</code>, and some are swallowed, leading to inconsistent behavior.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>ISSUE-040</strong></td>
<td style="text-align: left;">VB.NET Project with <code>Option Strict Off</code></td>
<td style="text-align: left;">Code quality</td>
<td style="text-align: left;">Defect</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><code>MDIWebTransmCI.vbproj</code></td>
<td style="text-align: left;">The VB.NET project has <code>Option Strict Off</code>, which allows late binding and implicit type conversions, hiding potential runtime errors.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>ISSUE-041</strong></td>
<td style="text-align: left;">Manual Database Schema Management</td>
<td style="text-align: left;">Deployment</td>
<td style="text-align: left;">Limitation</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;">Inferred</td>
<td style="text-align: left;">There is no evidence of database migration tools like EF Migrations or Redgate. Schema changes are likely manual.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>ISSUE-045</strong></td>
<td style="text-align: left;">Lack of Scalability</td>
<td style="text-align: left;">Scalability</td>
<td style="text-align: left;">Limitation</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><code>CIServico.cs</code></td>
<td style="text-align: left;">The single-threaded, polling design of the service cannot scale to handle a high volume of remittances.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>ISSUE-046</strong></td>
<td style="text-align: left;">Complex UI State Management</td>
<td style="text-align: left;">Maintainability</td>
<td style="text-align: left;">Defect</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><code>PesquisasForm.cs</code></td>
<td style="text-align: left;">The <code>BotoesJanelasEnabled</code> method manually controls the visibility of UI panels, which is a brittle way to manage UI state.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>ISSUE-048</strong></td>
<td style="text-align: left;">Mixing of Data Access and Business Logic</td>
<td style="text-align: left;">Architecture</td>
<td style="text-align: left;">Defect</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><code>ServRemessa.cs</code></td>
<td style="text-align: left;">The <code>ServRemessa</code> class contains both high-level processing logic and direct SQL update statements.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>ISSUE-050</strong></td>
<td style="text-align: left;">Lack of a Graceful Shutdown</td>
<td style="text-align: left;">Robustness</td>
<td style="text-align: left;">Risk</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><code>CIServico.cs</code></td>
<td style="text-align: left;">The <code>OnStop</code> method has a hard-coded 15-second wait, but it doesn't properly signal threads to stop and wait for them to finish gracefully.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>ISSUE-014</strong></td>
<td style="text-align: left;">Mixed C# and VB.NET Codebase</td>
<td style="text-align: left;">Maintainability</td>
<td style="text-align: left;">Limitation</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><code>MDIWebTransmCI.vbproj</code></td>
<td style="text-align: left;">Maintaining two different .NET languages in one solution increases the required skill set for developers.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>ISSUE-016</strong></td>
<td style="text-align: left;">Use of <code>System.Windows.Forms</code> in Non-UI Projects</td>
<td style="text-align: left;">Code quality</td>
<td style="text-align: left;">Defect</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><code>CIConfigGlobalParameters</code></td>
<td style="text-align: left;">Referencing <code>System.Windows.Forms</code> in a core library for <code>MessageBox</code> or <code>SystemInformation</code> creates unnecessary UI dependencies.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>ISSUE-018</strong></td>
<td style="text-align: left;">Hardcoded Copyright Year (2008)</td>
<td style="text-align: left;">Legacy</td>
<td style="text-align: left;">Defect</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><code>AssemblyInfo.cs</code> files</td>
<td style="text-align: left;">The copyright information is outdated and hardcoded in every project.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>ISSUE-023</strong></td>
<td style="text-align: left;">Inconsistent Naming Conventions</td>
<td style="text-align: left;">Code quality</td>
<td style="text-align: left;">Defect</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;">Various files</td>
<td style="text-align: left;">A mix of <code>m_camelCase</code> for member variables and PascalCase is used, indicating a lack of consistent coding standards.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>ISSUE-029</strong></td>
<td style="text-align: left;">Use of <code>ref</code> Parameters for Stored Procedures</td>
<td style="text-align: left;">Code quality</td>
<td style="text-align: left;">Defect</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><code>ActividadeBalcaoForm.cs</code></td>
<td style="text-align: left;">The pattern <code>m_oParameters.DirectStoredProcedureNonQuery(..., ref oParams)</code> suggests a custom data access method that modifies the parameter collection, which is an unconventional and potentially confusing pattern.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>ISSUE-032</strong></td>
<td style="text-align: left;">Use of <code>Application.DoEvents()</code></td>
<td style="text-align: left;">Performance</td>
<td style="text-align: left;">Defect</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><code>MDIsControloForm.cs</code></td>
<td style="text-align: left;">The use of <code>Application.DoEvents()</code> can lead to re-entrancy issues and makes the UI unresponsive. It's a sign of a poorly designed long-running UI task.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>ISSUE-033</strong></td>
<td style="text-align: left;">No Internationalization Support</td>
<td style="text-align: left;">Limitation</td>
<td style="text-align: left;">Limitation</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;">All UI forms</td>
<td style="text-align: left;">All UI text is hardcoded in English or Portuguese. There is no use of resource files for localization.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>ISSUE-037</strong></td>
<td style="text-align: left;">Static Classes and Methods</td>
<td style="text-align: left;">Architecture</td>
<td style="text-align: left;">Defect</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><code>CriaXML.cs</code></td>
<td style="text-align: left;">The use of static classes like <code>CriaXML</code> makes the code harder to test and introduces global state.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>ISSUE-042</strong></td>
<td style="text-align: left;">No Separation of Read/Write Models</td>
<td style="text-align: left;">Performance</td>
<td style="text-align: left;">Limitation</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;">Entire Application</td>
<td style="text-align: left;">The same data models are used for both reading (display) and writing, which can lead to inefficiencies.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>ISSUE-043</strong></td>
<td style="text-align: left;">Magic Strings for Parameter Names</td>
<td style="text-align: left;">Maintainability</td>
<td style="text-align: left;">Defect</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><code>ServAlertasSendWebmail.cs</code></td>
<td style="text-align: left;">Parameter names like <code>"PASSWD"</code>, <code>"URL"</code> are used as magic strings, which can lead to typos and runtime errors.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>ISSUE-044</strong></td>
<td style="text-align: left;">Application Logic in Test Project</td>
<td style="text-align: left;">Architecture</td>
<td style="text-align: left;">Defect</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><code>CITestes.csproj</code></td>
<td style="text-align: left;">The <code>ProcessarTrancheBalcao.cs</code> file, which contains business logic, is located in the test project <code>CITestes</code>.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>ISSUE-049</strong></td>
<td style="text-align: left;">Redundant Solution Files</td>
<td style="text-align: left;">Maintainability</td>
<td style="text-align: left;">Defect</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><code>.sln</code> files</td>
<td style="text-align: left;">There are two almost identical <code>.sln</code> files, which can cause confusion for developers.</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="product-section">
<h2 id="10-defects-and-inefficiencies">10. Defects and inefficiencies</h2>
This section details the top 50 defects and inefficiencies found in the code, sorted by impact.
<div class="table-container">
<table>
<colgroup>
<col style="width: 10%" />
<col style="width: 10%" />
<col style="width: 10%" />
<col style="width: 10%" />
<col style="width: 10%" />
<col style="width: 10%" />
<col style="width: 10%" />
<col style="width: 10%" />
<col style="width: 10%" />
<col style="width: 10%" />
</colgroup>
<thead>
<tr>
<th style="text-align: left;">Defect Id</th>
<th style="text-align: left;">Defect / inefficiency</th>
<th style="text-align: left;">Category</th>
<th style="text-align: left;">Type</th>
<th style="text-align: left;">Impact</th>
<th style="text-align: left;">Severity</th>
<th style="text-align: left;">Priority</th>
<th style="text-align: left;">Root cause</th>
<th style="text-align: left;">Affected components</th>
<th style="text-align: left;">Recommended fix</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>DEF-001</strong></td>
<td style="text-align: left;">SQL Injection via String Concatenation</td>
<td style="text-align: left;">Security</td>
<td style="text-align: left;">Bug</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;">Poor coding practices</td>
<td style="text-align: left;"><code>AlertaSituacaoAccao.cs</code></td>
<td style="text-align: left;">Refactor all data access to use parameterized queries or an ORM.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>DEF-002</strong></td>
<td style="text-align: left;">Use of Unsupported .NET Framework 4.0</td>
<td style="text-align: left;">Legacy</td>
<td style="text-align: left;">Defect</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;">Outdated technology stack</td>
<td style="text-align: left;">All projects</td>
<td style="text-align: left;">Migrate to .NET 6+ or at least .NET Framework 4.8.1.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>DEF-006</strong></td>
<td style="text-align: left;">Insecure HTTP Web Service Endpoint</td>
<td style="text-align: left;">Security</td>
<td style="text-align: left;">Bug</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;">Misconfiguration</td>
<td style="text-align: left;"><code>MDIWebTransmCI.vbproj</code></td>
<td style="text-align: left;">Change the endpoint to use HTTPS and ensure proper certificate validation.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>DEF-023</strong></td>
<td style="text-align: left;">Outdated and Potentially Vulnerable Libraries</td>
<td style="text-align: left;">Security</td>
<td style="text-align: left;">Risk</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;">Legacy dependencies</td>
<td style="text-align: left;"><code>CIReports.csproj</code></td>
<td style="text-align: left;">Update all third-party libraries to their latest stable and supported versions.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>DEF-032</strong></td>
<td style="text-align: left;">Password Masking Logic in UI-Related Code</td>
<td style="text-align: left;">Security</td>
<td style="text-align: left;">Defect</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;">Poor layering</td>
<td style="text-align: left;"><code>AccaoParam.cs</code></td>
<td style="text-align: left;">Password handling logic should not be present in a class responsible for creating <code>ListViewItem</code>s.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>DEF-003</strong></td>
<td style="text-align: left;">Hardcoded UNC Paths for Dependencies</td>
<td style="text-align: left;">Maintainability</td>
<td style="text-align: left;">Defect</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;">Poor dependency management</td>
<td style="text-align: left;">All <code>.csproj</code> files</td>
<td style="text-align: left;">Migrate all shared libraries to a private NuGet feed.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>DEF-004</strong></td>
<td style="text-align: left;">Empty <code>catch {}</code> Blocks</td>
<td style="text-align: left;">Code quality</td>
<td style="text-align: left;">Bug</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;">Poor coding practices</td>
<td style="text-align: left;"><code>AlertaSituacaoAccao.cs</code></td>
<td style="text-align: left;">Remove empty catch blocks or log the exception.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>DEF-005</strong></td>
<td style="text-align: left;">Business Logic in UI Event Handlers</td>
<td style="text-align: left;">Architecture</td>
<td style="text-align: left;">Defect</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;">Lack of layering</td>
<td style="text-align: left;"><code>ActividadeBalcaoForm.cs</code>, <code>PesquisasForm.cs</code></td>
<td style="text-align: left;">Refactor logic into separate service or business logic classes.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>DEF-007</strong></td>
<td style="text-align: left;">Direct <code>SqlDataReader</code> Calls in Multiple Classes</td>
<td style="text-align: left;">Maintainability</td>
<td style="text-align: left;">Defect</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;">Lack of DAL</td>
<td style="text-align: left;"><code>Accao.cs</code>, <code>AlertaSituacaoAccao.cs</code></td>
<td style="text-align: left;">Implement a formal Data Access Layer (DAL) using the Repository pattern.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>DEF-008</strong></td>
<td style="text-align: left;">Inefficient Polling Loop in Service</td>
<td style="text-align: left;">Performance</td>
<td style="text-align: left;">Defect</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;">Architectural choice</td>
<td style="text-align: left;"><code>CIServicoThread.cs</code></td>
<td style="text-align: left;">Replace polling with a message queue (e.g., RabbitMQ, Azure Service Bus) to trigger processing.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>DEF-009</strong></td>
<td style="text-align: left;">No Dependency Injection Framework</td>
<td style="text-align: left;">Architecture</td>
<td style="text-align: left;">Defect</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;">Outdated practices</td>
<td style="text-align: left;">Entire Application</td>
<td style="text-align: left;">Introduce a DI container like <code>Microsoft.Extensions.DependencyInjection</code> to manage dependencies.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>DEF-011</strong></td>
<td style="text-align: left;">Low Testability of Code</td>
<td style="text-align: left;">Quality</td>
<td style="text-align: left;">Defect</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;">Tight coupling</td>
<td style="text-align: left;">Entire Application</td>
<td style="text-align: left;">Refactor to use interfaces and DI to allow for proper unit testing.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>DEF-012</strong></td>
<td style="text-align: left;"><code>Option Strict Off</code> in VB.NET Project</td>
<td style="text-align: left;">Code quality</td>
<td style="text-align: left;">Bug</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;">Poor coding practices</td>
<td style="text-align: left;"><code>MDIWebTransmCI.vbproj</code></td>
<td style="text-align: left;">Enable <code>Option Strict On</code> and resolve all resulting compilation errors.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>DEF-013</strong></td>
<td style="text-align: left;">Transaction Management in Global Class</td>
<td style="text-align: left;">Architecture</td>
<td style="text-align: left;">Defect</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;">Poor design</td>
<td style="text-align: left;"><code>CIGlobalParameters.cs</code></td>
<td style="text-align: left;">Implement a Unit of Work pattern to manage transactions at the business logic layer.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>DEF-014</strong></td>
<td style="text-align: left;">UI Controls Loaded with Unbounded Data</td>
<td style="text-align: left;">Performance</td>
<td style="text-align: left;">Risk</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;">Lack of pagination</td>
<td style="text-align: left;"><code>ActividadeBalcaoForm.cs</code></td>
<td style="text-align: left;">Implement server-side pagination for all data grids and list views.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>DEF-015</strong></td>
<td style="text-align: left;">Manual and Brittle Deployment Scripts</td>
<td style="text-align: left;">Deployment</td>
<td style="text-align: left;">Risk</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;">Legacy practices</td>
<td style="text-align: left;"><code>Install</code> scripts</td>
<td style="text-align: left;">Replace <code>.bat</code> scripts with a modern CI/CD pipeline (e.g., Azure DevOps, GitHub Actions).</td>
</tr>
<tr>
<td style="text-align: left;"><strong>DEF-018</strong></td>
<td style="text-align: left;">Hardcoded Environment Configurations</td>
<td style="text-align: left;">Deployment</td>
<td style="text-align: left;">Risk</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;">Poor configuration management</td>
<td style="text-align: left;"><code>.config</code> files</td>
<td style="text-align: left;">Use configuration transformations or a centralized configuration service.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>DEF-019</strong></td>
<td style="text-align: left;">Lack of a Global Exception Handler</td>
<td style="text-align: left;">Robustness</td>
<td style="text-align: left;">Defect</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;">Incomplete implementation</td>
<td style="text-align: left;">All executable projects</td>
<td style="text-align: left;">Implement a global exception handler to catch unhandled exceptions, log them, and prevent crashes.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>DEF-024</strong></td>
<td style="text-align: left;">Hardcoded SQL in Code</td>
<td style="text-align: left;">Maintainability</td>
<td style="text-align: left;">Defect</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;">Lack of abstraction</td>
<td style="text-align: left;">Multiple files</td>
<td style="text-align: left;">Move all SQL queries to stored procedures or a dedicated data access layer.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>DEF-025</strong></td>
<td style="text-align: left;">Lack of Asynchronous Operations</td>
<td style="text-align: left;">Performance</td>
<td style="text-align: left;">Defect</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;">Legacy practices</td>
<td style="text-align: left;">Entire Application</td>
<td style="text-align: left;">Utilize <code>async/await</code> for all I/O-bound operations (database, file, network).</td>
</tr>
<tr>
<td style="text-align: left;"><strong>DEF-026</strong></td>
<td style="text-align: left;">Complex UI Layout in Designer File</td>
<td style="text-align: left;">Maintainability</td>
<td style="text-align: left;">Defect</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;">Overly complex UI</td>
<td style="text-align: left;"><code>ActividadeBalcaoForm.Designer.cs</code></td>
<td style="text-align: left;">Refactor the UI into smaller, reusable User Controls to simplify the main form.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>DEF-028</strong></td>
<td style="text-align: left;">Potential for <code>IDisposable</code> Leaks</td>
<td style="text-align: left;">Robustness</td>
<td style="text-align: left;">Bug</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;">Poor resource management</td>
<td style="text-align: left;">Multiple files</td>
<td style="text-align: left;">Ensure all <code>IDisposable</code> objects (<code>SqlConnection</code>, <code>StreamReader</code>, etc.) are wrapped in <code>using</code> statements.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>DEF-030</strong></td>
<td style="text-align: left;">Fragile File Parsing Logic</td>
<td style="text-align: left;">Robustness</td>
<td style="text-align: left;">Defect</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;">Poor error handling</td>
<td style="text-align: left;"><code>FichEnvmAcom.cs</code></td>
<td style="text-align: left;">Implement more robust parsing with better error handling and validation for file-based imports.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>DEF-031</strong></td>
<td style="text-align: left;">Lack of Clear API for Shared Libraries</td>
<td style="text-align: left;">Architecture</td>
<td style="text-align: left;">Defect</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;">Poor design</td>
<td style="text-align: left;"><code>CIConfigGlobalParameters</code></td>
<td style="text-align: left;">Define clear interfaces for shared services instead of relying on concrete class implementations.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>DEF-033</strong></td>
<td style="text-align: left;">No Abstraction for External Services</td>
<td style="text-align: left;">Maintainability</td>
<td style="text-align: left;">Defect</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;">Tight coupling</td>
<td style="text-align: left;"><code>MDIWebTransmCI</code></td>
<td style="text-align: left;">Wrap the SOAP service client in an adapter or gateway class that implements an interface.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>DEF-034</strong></td>
<td style="text-align: left;">Static Classes with State</td>
<td style="text-align: left;">Robustness</td>
<td style="text-align: left;">Bug</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;">Poor design</td>
<td style="text-align: left;"><code>CriaXML.cs</code></td>
<td style="text-align: left;">The static <code>CriaXML</code> class holds state (<code>m_sXml</code>), making it not thread-safe and prone to errors in a concurrent environment.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>DEF-035</strong></td>
<td style="text-align: left;">Inefficient Database Queries</td>
<td style="text-align: left;">Performance</td>
<td style="text-align: left;">Risk</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;">Inferred</td>
<td style="text-align: left;">Using <code>SELECT *</code> is inefficient. The lack of an ORM suggests that queries may not be optimized.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>DEF-036</strong></td>
<td style="text-align: left;">No Centralized User Authentication Logic</td>
<td style="text-align: left;">Security</td>
<td style="text-align: left;">Defect</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;">Scattered logic</td>
<td style="text-align: left;"><code>CIGlobalParameters.cs</code></td>
<td style="text-align: left;">User loading and group checks are spread out. This should be centralized in an authentication service.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>DEF-037</strong></td>
<td style="text-align: left;">In-Process Timer for Background Tasks</td>
<td style="text-align: left;">Scalability</td>
<td style="text-align: left;">Defect</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;">Architectural choice</td>
<td style="text-align: left;"><code>CIMainForm.cs</code></td>
<td style="text-align: left;">A UI-based timer is not suitable for reliable background jobs. The Windows Service is better but still limited.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>DEF-039</strong></td>
<td style="text-align: left;">Lack of Unit Tests for Business Logic</td>
<td style="text-align: left;">Quality</td>
<td style="text-align: left;">Defect</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;">Low testability</td>
<td style="text-align: left;"><code>CIServRemessas</code>, <code>Alerta</code></td>
<td style="text-align: left;">Core business logic is not covered by automated unit tests, increasing the risk of regressions.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>DEF-040</strong></td>
<td style="text-align: left;">Violation of Open/Closed Principle</td>
<td style="text-align: left;">Maintainability</td>
<td style="text-align: left;">Defect</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;">Procedural design</td>
<td style="text-align: left;"><code>ServAlerta.cs</code></td>
<td style="text-align: left;">The <code>switch</code> statement on <code>enuTipoAccao</code> means that adding a new alert type requires modifying this class.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>DEF-041</strong></td>
<td style="text-align: left;">No Caching Mechanism</td>
<td style="text-align: left;">Performance</td>
<td style="text-align: left;">Limitation</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;">Inferred</td>
<td style="text-align: left;">There is no evidence of caching for frequently accessed data like configuration or user groups.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>DEF-043</strong></td>
<td style="text-align: left;">God Class Anti-Pattern</td>
<td style="text-align: left;">Maintainability</td>
<td style="text-align: left;">Defect</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><code>CIGlobalParameters.cs</code></td>
<td style="text-align: left;">The <code>CIGlobalParameters</code> class has too many responsibilities: configuration, database connection, logging, and user management.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>DEF-046</strong></td>
<td style="text-align: left;">Potential for Null Reference Exceptions</td>
<td style="text-align: left;">Robustness</td>
<td style="text-align: left;">Bug</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;">Incomplete checks</td>
<td style="text-align: left;">Multiple files</td>
<td style="text-align: left;">Many methods assume objects are not null without checking, such as <code>oAlSitAcc</code> in <code>ProcessarAlertas.cs</code>.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>DEF-050</strong></td>
<td style="text-align: left;">Circular Dependencies (Potential)</td>
<td style="text-align: left;">Architecture</td>
<td style="text-align: left;">Risk</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;">Project references</td>
<td style="text-align: left;">The project dependency graph is complex. <code>CIActividades</code> depends on <code>Alerta</code>, which depends on <code>CIConfigGlobalParameters</code>, which is also used by <code>CIActividades</code>. This can create tight coupling.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>DEF-010</strong></td>
<td style="text-align: left;">Mixing C# and VB.NET</td>
<td style="text-align: left;">Maintainability</td>
<td style="text-align: left;">Defect</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;">Historical reasons</td>
<td style="text-align: left;"><code>MDIWebTransmCI.vbproj</code></td>
<td style="text-align: left;">Convert the VB.NET project to C# to unify the codebase.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>DEF-016</strong></td>
<td style="text-align: left;">Use of <code>Application.DoEvents()</code></td>
<td style="text-align: left;">Robustness</td>
<td style="text-align: left;">Bug</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;">Poor UI design</td>
<td style="text-align: left;"><code>MDIsControloForm.cs</code></td>
<td style="text-align: left;">Refactor long-running UI tasks to use background workers or async/await.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>DEF-017</strong></td>
<td style="text-align: left;">Inconsistent Naming and Coding Styles</td>
<td style="text-align: left;">Maintainability</td>
<td style="text-align: left;">Defect</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;">Lack of standards</td>
<td style="text-align: left;">Entire Application</td>
<td style="text-align: left;">Enforce a consistent coding style using an <code>.editorconfig</code> file.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>DEF-020</strong></td>
<td style="text-align: left;">Use of <code>ref</code> Parameters for Collection</td>
<td style="text-align: left;">Code quality</td>
<td style="text-align: left;">Defect</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;">Unconventional pattern</td>
<td style="text-align: left;"><code>ActividadeBalcaoForm.cs</code></td>
<td style="text-align: left;">Refactor the method to return the result instead of modifying a parameter by reference.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>DEF-021</strong></td>
<td style="text-align: left;">Direct Instantiation of Forms</td>
<td style="text-align: left;">Maintainability</td>
<td style="text-align: left;">Defect</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;">Tight coupling</td>
<td style="text-align: left;"><code>CIControlo.cs</code></td>
<td style="text-align: left;">Use a factory or navigation service to create and show forms.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>DEF-022</strong></td>
<td style="text-align: left;">Redundant Solution Files</td>
<td style="text-align: left;">Maintainability</td>
<td style="text-align: left;">Defect</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;">Project setup</td>
<td style="text-align: left;"><code>.sln</code> files</td>
<td style="text-align: left;">Consolidate into a single solution file and use solution configurations to manage different builds.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>DEF-027</strong></td>
<td style="text-align: left;">Hardcoded Strings for UI and Messages</td>
<td style="text-align: left;">Maintainability</td>
<td style="text-align: left;">Defect</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;">Lack of localization</td>
<td style="text-align: left;">All UI forms</td>
<td style="text-align: left;">Move all user-facing strings to <code>.resx</code> resource files.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>DEF-029</strong></td>
<td style="text-align: left;">Inefficient String Concatenation in Loops</td>
<td style="text-align: left;">Performance</td>
<td style="text-align: left;">Defect</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;">Inefficient coding</td>
<td style="text-align: left;">(Inferred)</td>
<td style="text-align: left;">Use <code>StringBuilder</code> for building strings within loops.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>DEF-038</strong></td>
<td style="text-align: left;">Direct Manipulation of UI from Logic</td>
<td style="text-align: left;">Architecture</td>
<td style="text-align: left;">Defect</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;">Poor layering</td>
<td style="text-align: left;"><code>ImportarForm.cs</code></td>
<td style="text-align: left;">The <code>ImportarForm</code> acts as a <code>CIComumInterface</code> and directly updates its own UI, mixing concerns.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>DEF-042</strong></td>
<td style="text-align: left;">Use of <code>System.Drawing</code> in Non-UI Projects</td>
<td style="text-align: left;">Architecture</td>
<td style="text-align: left;">Defect</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><code>CIServAlertas</code></td>
<td style="text-align: left;">Referencing UI-related assemblies in backend projects creates unnecessary dependencies.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>DEF-044</strong></td>
<td style="text-align: left;">Inconsistent Use of <code>this</code> Keyword</td>
<td style="text-align: left;">Code quality</td>
<td style="text-align: left;">Defect</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;">Lack of standards</td>
<td style="text-align: left;">Multiple C# files</td>
<td style="text-align: left;">The <code>this</code> keyword is used inconsistently, making the code style vary between files.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>DEF-045</strong></td>
<td style="text-align: left;">Failure to Dispose <code>DataSet</code> Objects</td>
<td style="text-align: left;">Robustness</td>
<td style="text-align: left;">Bug</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;">Poor resource management</td>
<td style="text-align: left;"><code>CIConfiguration\BalcaoForm.cs</code></td>
<td style="text-align: left;"><code>DataSet</code> objects are not always disposed, which can lead to memory pressure.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>DEF-047</strong></td>
<td style="text-align: left;">Use of <code>ref</code> with <code>ArrayList</code></td>
<td style="text-align: left;">Code quality</td>
<td style="text-align: left;">Defect</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;">Unconventional pattern</td>
<td style="text-align: left;"><code>ActividadeBalcaoForm.cs</code></td>
<td style="text-align: left;">Passing an <code>ArrayList</code> by <code>ref</code> is unnecessary as it is already a reference type.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>DEF-048</strong></td>
<td style="text-align: left;">Unclear Exception Messages</td>
<td style="text-align: left;">Supportability</td>
<td style="text-align: left;">Defect</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;">Poor error handling</td>
<td style="text-align: left;"><code>ActividadeBalcaoForm.cs</code></td>
<td style="text-align: left;">Throwing generic exceptions like <code>throw new Exception("Operação cancelada pelo utilizador")</code> makes it hard to handle specific error conditions programmatically.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>DEF-049</strong></td>
<td style="text-align: left;">Hardcoded Table and Column Names</td>
<td style="text-align: left;">Maintainability</td>
<td style="text-align: left;">Defect</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;">Lack of abstraction</td>
<td style="text-align: left;"><code>MudarEstadoForm.cs</code></td>
<td style="text-align: left;">Table names like <code>"REMESSA_IN"</code> are passed as strings, which is error-prone.</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="product-section">
<h2 id="11-vulnerabilities">11. Vulnerabilities</h2>
This section provides a detailed list of 50 potential vulnerabilities based on the code analysis, sorted by impact.
<div class="table-container">
<table>
<colgroup>
<col style="width: 9%" />
<col style="width: 9%" />
<col style="width: 9%" />
<col style="width: 9%" />
<col style="width: 9%" />
<col style="width: 9%" />
<col style="width: 9%" />
<col style="width: 9%" />
<col style="width: 9%" />
<col style="width: 9%" />
<col style="width: 9%" />
</colgroup>
<thead>
<tr>
<th style="text-align: left;">Vulnerability Id</th>
<th style="text-align: left;">Vulnerability</th>
<th style="text-align: left;">Category</th>
<th style="text-align: left;">Type</th>
<th style="text-align: left;">Impact</th>
<th style="text-align: left;">Severity</th>
<th style="text-align: left;">Priority</th>
<th style="text-align: left;">Root cause</th>
<th style="text-align: left;">Affected components</th>
<th style="text-align: left;">Recommended fix</th>
<th style="text-align: left;">Links</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>VULN-001</strong></td>
<td style="text-align: left;">SQL Injection</td>
<td style="text-align: left;">Injection</td>
<td style="text-align: left;">Bug</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;">Unparameterized Queries</td>
<td style="text-align: left;"><code>AlertaSituacaoAccao.cs</code></td>
<td style="text-align: left;">Use parameterized queries for all database interactions.</td>
<td style="text-align: left;"><a href="https://owasp.org/Top10/A03_2021-Injection/">OWASP A03</a></td>
</tr>
<tr>
<td style="text-align: left;"><strong>VULN-002</strong></td>
<td style="text-align: left;">Use of Unsupported Framework (.NET 4.0)</td>
<td style="text-align: left;">Vulnerable Components</td>
<td style="text-align: left;">Vulnerability</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;">Outdated Dependencies</td>
<td style="text-align: left;">All Projects</td>
<td style="text-align: left;">Migrate to a supported .NET version like .NET 6+ or .NET Framework 4.8.1.</td>
<td style="text-align: left;"><a href="https://dotnet.microsoft.com/en-us/platform/support/policy/dotnet-framework">Microsoft Lifecycle</a></td>
</tr>
<tr>
<td style="text-align: left;"><strong>VULN-003</strong></td>
<td style="text-align: left;">Insecure Transport for Web Service</td>
<td style="text-align: left;">Cryptographic Failures</td>
<td style="text-align: left;">Misconfiguration</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;">Lack of TLS/SSL</td>
<td style="text-align: left;"><code>MDIWebTransmCI.vbproj</code></td>
<td style="text-align: left;">Reconfigure the SOAP service endpoint to use HTTPS.</td>
<td style="text-align: left;"><a href="https://owasp.org/Top10/A02<em>2021-Cryptographic</em>Failures/">OWASP A02</a></td>
</tr>
<tr>
<td style="text-align: left;"><strong>VULN-005</strong></td>
<td style="text-align: left;">Broken Access Control</td>
<td style="text-align: left;">Broken Access Control</td>
<td style="text-align: left;">Bug</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;">Simple Integer Check</td>
<td style="text-align: left;"><code>ActividadeBalcaoForm.cs</code></td>
<td style="text-align: left;">Implement a robust, claims-based authorization system instead of simple integer group checks.</td>
<td style="text-align: left;"><a href="https://owasp.org/Top10/A01<em>2021-Broken</em>Access_Control/">OWASP A01</a></td>
</tr>
<tr>
<td style="text-align: left;"><strong>VULN-007</strong></td>
<td style="text-align: left;">Potential Password Mishandling</td>
<td style="text-align: left;">Cryptographic Failures</td>
<td style="text-align: left;">Risk</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;">Unclear Storage/Transport</td>
<td style="text-align: left;"><code>AccaoParam.cs</code></td>
<td style="text-align: left;">Audit the complete lifecycle of the "passwd" parameter to ensure it is never stored or transmitted in plaintext.</td>
<td style="text-align: left;"><a href="https://owasp.org/Top10/A02<em>2021-Cryptographic</em>Failures/">OWASP A02</a></td>
</tr>
<tr>
<td style="text-align: left;"><strong>VULN-015</strong></td>
<td style="text-align: left;">Plaintext Credentials in Config (Inferred)</td>
<td style="text-align: left;">Cryptographic Failures</td>
<td style="text-align: left;">Risk</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;">Poor Secret Management</td>
<td style="text-align: left;"><code>app.config</code> files</td>
<td style="text-align: left;">It's highly probable that database credentials are part of the configuration, even if not directly visible. These must be externalized.</td>
<td style="text-align: left;"><a href="https://owasp.org/Top10/A02<em>2021-Cryptographic</em>Failures/">OWASP A02</a></td>
</tr>
<tr>
<td style="text-align: left;"><strong>VULN-027</strong></td>
<td style="text-align: left;">Insecure Deserialization (Potential)</td>
<td style="text-align: left;">Software/Data Integrity</td>
<td style="text-align: left;">Risk</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;">Inferred</td>
<td style="text-align: left;">If any part of the application deserializes data from untrusted sources, it could be vulnerable.</td>
<td style="text-align: left;"><a href="https://owasp.org/Top10/A08<em>2021-Software</em>and<em>Data</em>Integrity_Failures/">OWASP A08</a></td>
</tr>
<tr>
<td style="text-align: left;"><strong>VULN-039</strong></td>
<td style="text-align: left;">Cleartext Submission of Sensitive Information</td>
<td style="text-align: left;">Cryptographic Failures</td>
<td style="text-align: left;">Bug</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;">Use of HTTP</td>
<td style="text-align: left;"><code>MDIWebTransmCI.vbproj</code></td>
<td style="text-align: left;">Any data sent to the SOAP service is vulnerable to eavesdropping.</td>
<td style="text-align: left;"><a href="https://cwe.mitre.org/data/definitions/319.html">CWE-319</a></td>
</tr>
<tr>
<td style="text-align: left;"><strong>VULN-004</strong></td>
<td style="text-align: left;">Infrastructure Disclosure in Config</td>
<td style="text-align: left;">Security Misconfiguration</td>
<td style="text-align: left;">Misconfiguration</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;">Hardcoded Settings</td>
<td style="text-align: left;"><code>*.exe.config</code> files</td>
<td style="text-align: left;">Externalize connection strings and server names to a secure vault or environment variables.</td>
<td style="text-align: left;"><a href="https://owasp.org/Top10/A05<em>2021-Security</em>Misconfiguration/">OWASP A05</a></td>
</tr>
<tr>
<td style="text-align: left;"><strong>VULN-006</strong></td>
<td style="text-align: left;">Use of Outdated Libraries (Crystal Reports)</td>
<td style="text-align: left;">Vulnerable Components</td>
<td style="text-align: left;">Vulnerability</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;">Outdated Dependencies</td>
<td style="text-align: left;"><code>CIReports.csproj</code></td>
<td style="text-align: left;">Upgrade Crystal Reports to a supported version or replace it with a modern reporting tool.</td>
<td style="text-align: left;"><a href="https://support.sap.com/en/my-support/knowledge-base/security-notes-news.html">SAP Security</a></td>
</tr>
<tr>
<td style="text-align: left;"><strong>VULN-009</strong></td>
<td style="text-align: left;">Dependency on Insecure Network Share</td>
<td style="text-align: left;">Software/Data Integrity</td>
<td style="text-align: left;">Misconfiguration</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;">Insecure Dependency Source</td>
<td style="text-align: left;">All <code>.csproj</code> files</td>
<td style="text-align: left;">Migrate dependencies from the UNC path to a secure, private NuGet feed to prevent tampering.</td>
<td style="text-align: left;"><a href="https://owasp.org/Top10/A08<em>2021-Software</em>and<em>Data</em>Integrity_Failures/">OWASP A08</a></td>
</tr>
<tr>
<td style="text-align: left;"><strong>VULN-010</strong></td>
<td style="text-align: left;">Insufficient Logging and Monitoring</td>
<td style="text-align: left;">Security Logging Failures</td>
<td style="text-align: left;">Limitation</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;">Lack of Security Events</td>
<td style="text-align: left;"><code>GenericLog</code></td>
<td style="text-align: left;">Enhance logging to include security-relevant events like authorization failures, state changes, and user logons.</td>
<td style="text-align: left;"><a href="https://owasp.org/Top10/A09<em>2021-Security</em>Logging<em>and</em>Monitoring_Failures/">OWASP A09</a></td>
</tr>
<tr>
<td style="text-align: left;"><strong>VULN-011</strong></td>
<td style="text-align: left;">No Input Validation on UI Fields</td>
<td style="text-align: left;">Injection</td>
<td style="text-align: left;">Bug</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;">Missing Validation</td>
<td style="text-align: left;"><code>ControloBalcaoAcoes.cs</code></td>
<td style="text-align: left;">Implement robust server-side input validation in addition to client-side checks to prevent malicious input.</td>
<td style="text-align: left;"><a href="https://owasp.org/Top10/A03_2021-Injection/">OWASP A03</a></td>
</tr>
<tr>
<td style="text-align: left;"><strong>VULN-012</strong></td>
<td style="text-align: left;">Service Running with High Privileges</td>
<td style="text-align: left;">Security Misconfiguration</td>
<td style="text-align: left;">Risk</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;">Default Install Settings</td>
<td style="text-align: left;"><code>ProjectInstaller.cs</code></td>
<td style="text-align: left;">Ensure the Windows Service runs under a least-privilege service account, not LocalSystem or an admin account.</td>
<td style="text-align: left;"><a href="https://cwe.mitre.org/data/definitions/250.html">CWE-250</a></td>
</tr>
<tr>
<td style="text-align: left;"><strong>VULN-013</strong></td>
<td style="text-align: left;">Uncontrolled Resource Consumption</td>
<td style="text-align: left;">Denial of Service</td>
<td style="text-align: left;">Risk</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;">Lack of Resource Limits</td>
<td style="text-align: left;"><code>CIFicheiro</code> project</td>
<td style="text-align: left;">File import processes could be abused with large files, consuming excessive memory or CPU. Implement size and rate limits.</td>
<td style="text-align: left;"><a href="https://cwe.mitre.org/data/definitions/400.html">CWE-400</a></td>
</tr>
<tr>
<td style="text-align: left;"><strong>VULN-014</strong></td>
<td style="text-align: left;">Directory Traversal Risk in File Paths</td>
<td style="text-align: left;">Injection</td>
<td style="text-align: left;">Risk</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;">Unvalidated Config Paths</td>
<td style="text-align: left;"><code>CIGlobalParameters.cs</code></td>
<td style="text-align: left;">Paths read from config files (<code>m<em>sFilePathENVM</code>) should be validated to prevent directory traversal attacks.</td>
<td style="text-align: left;"><a href="https://owasp.org/www-community/attacks/Path</em>Traversal">OWASP Path Traversal</a></td>
</tr>
<tr>
<td style="text-align: left;"><strong>VULN-021</strong></td>
<td style="text-align: left;">Codebase Susceptible to Race Conditions</td>
<td style="text-align: left;">Concurrency</td>
<td style="text-align: left;">Risk</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;">Lack of Thread Safety</td>
<td style="text-align: left;"><code>CIServicoThread.cs</code></td>
<td style="text-align: left;">The manual threading implementation without proper locking mechanisms is at risk of race conditions.</td>
<td style="text-align: left;"><a href="https://cwe.mitre.org/data/definitions/362.html">CWE-362</a></td>
</tr>
<tr>
<td style="text-align: left;"><strong>VULN-022</strong></td>
<td style="text-align: left;">No File Type or Content Validation</td>
<td style="text-align: left;">Injection</td>
<td style="text-align: left;">Risk</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;">Unrestricted File Upload</td>
<td style="text-align: left;"><code>CIFicheiro</code> project</td>
<td style="text-align: left;">The file import process does not appear to validate file types or scan content, allowing for potential injection of malicious data.</td>
<td style="text-align: left;"><a href="https://owasp.org/www-community/vulnerabilities/Unrestricted<em>File</em>Upload">OWASP File Upload</a></td>
</tr>
<tr>
<td style="text-align: left;"><strong>VULN-023</strong></td>
<td style="text-align: left;">Insufficient Session Management</td>
<td style="text-align: left;">Identification Failures</td>
<td style="text-align: left;">Limitation</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;">No Session Timeout</td>
<td style="text-align: left;">(Inferred)</td>
<td style="text-align: left;">The desktop application appears to have no session timeout, leaving it logged in indefinitely.</td>
<td style="text-align: left;"><a href="https://owasp.org/Top10/A07<em>2021-Identification</em>and<em>Authentication</em>Failures/">OWASP A07</a></td>
</tr>
<tr>
<td style="text-align: left;"><strong>VULN-024</strong></td>
<td style="text-align: left;">Reliance on Client-Side Validation</td>
<td style="text-align: left;">Injection</td>
<td style="text-align: left;">Bug</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;">Missing Server-Side Checks</td>
<td style="text-align: left;"><code>ControloBalcaoAcoes.cs</code></td>
<td style="text-align: left;">Input validation is performed in the UI layer. This is insufficient and must be duplicated on the server/service side.</td>
<td style="text-align: left;"><a href="https://cwe.mitre.org/data/definitions/602.html">CWE-602</a></td>
</tr>
<tr>
<td style="text-align: left;"><strong>VULN-030</strong></td>
<td style="text-align: left;">Improper Resource Shutdown or Release</td>
<td style="text-align: left;">Denial of Service</td>
<td style="text-align: left;">Bug</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;">Resource Leaks</td>
<td style="text-align: left;"><code>CIServico.cs</code></td>
<td style="text-align: left;">The <code>OnStop</code> method does not gracefully wait for threads to finish, potentially leaving resources open.</td>
<td style="text-align: left;"><a href="https://cwe.mitre.org/data/definitions/404.html">CWE-404</a></td>
</tr>
<tr>
<td style="text-align: left;"><strong>VULN-032</strong></td>
<td style="text-align: left;">Use of a System-Wide User for Service</td>
<td style="text-align: left;">Identification Failures</td>
<td style="text-align: left;">Misconfiguration</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;">Default Install Settings</td>
<td style="text-align: left;"><code>ProjectInstaller.cs</code></td>
<td style="text-align: left;">If the service runs as LocalSystem, its actions are indistinguishable from other system processes, hindering auditing.</td>
<td style="text-align: left;"><a href="https://cwe.mitre.org/data/definitions/250.html">CWE-250</a></td>
</tr>
<tr>
<td style="text-align: left;"><strong>VULN-033</strong></td>
<td style="text-align: left;">Insufficient Authorization Checks</td>
<td style="text-align: left;">Broken Access Control</td>
<td style="text-align: left;">Bug</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;">Coarse-Grained Checks</td>
<td style="text-align: left;"><code>ActividadeBalcaoForm.cs</code></td>
<td style="text-align: left;">Authorization is all-or-nothing based on a group ID, with no fine-grained permissions.</td>
<td style="text-align: left;"><a href="https://owasp.org/Top10/A01<em>2021-Broken</em>Access_Control/">OWASP A01</a></td>
</tr>
<tr>
<td style="text-align: left;"><strong>VULN-035</strong></td>
<td style="text-align: left;">Reliance on Untrusted Inputs in Security Decisions</td>
<td style="text-align: left;">Broken Access Control</td>
<td style="text-align: left;">Risk</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;">Inferred</td>
<td style="text-align: left;">The user group ID is read from the database. If this data can be manipulated, access control is broken.</td>
<td style="text-align: left;"><a href="https://cwe.mitre.org/data/definitions/807.html">CWE-807</a></td>
</tr>
<tr>
<td style="text-align: left;"><strong>VULN-036</strong></td>
<td style="text-align: left;">Server-Side Request Forgery (SSRF) Potential</td>
<td style="text-align: left;">Server-Side Request Forgery</td>
<td style="text-align: left;">Risk</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;">Inferred</td>
<td style="text-align: left;">If any part of the application makes HTTP requests to URLs from a user-configurable source, it could be vulnerable to SSRF.</td>
<td style="text-align: left;"><a href="https://owasp.org/Top10/A10<em>2021-Server-Side</em>Request<em>Forgery</em>(SSRF">OWASP A10</a>/)</td>
</tr>
<tr>
<td style="text-align: left;"><strong>VULN-037</strong></td>
<td style="text-align: left;">No Brute Force Protection</td>
<td style="text-align: left;">Identification Failures</td>
<td style="text-align: left;">Limitation</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;">Inferred</td>
<td style="text-align: left;">There is no evidence of account lockout or CAPTCHA mechanisms on any login functionality.</td>
<td style="text-align: left;"><a href="https://owasp.org/Top10/A07<em>2021-Identification</em>and<em>Authentication</em>Failures/">OWASP A07</a></td>
</tr>
<tr>
<td style="text-align: left;"><strong>VULN-038</strong></td>
<td style="text-align: left;">XML External Entity (XXE) Injection</td>
<td style="text-align: left;">Injection</td>
<td style="text-align: left;">Risk</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;">Unsafe XML Parsing</td>
<td style="text-align: left;"><code>CriaXML.cs</code></td>
<td style="text-align: left;">The custom XML creation is safe, but any XML parsing in the app must disable DTD processing to prevent XXE.</td>
<td style="text-align: left;"><a href="https://owasp.org/Top10/A05<em>2021-Security</em>Misconfiguration/">OWASP A05</a></td>
</tr>
<tr>
<td style="text-align: left;"><strong>VULN-041</strong></td>
<td style="text-align: left;">Inadequate Error Reporting in Service</td>
<td style="text-align: left;">Security Logging Failures</td>
<td style="text-align: left;">Limitation</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;">Lack of Detail</td>
<td style="text-align: left;"><code>CIServico.cs</code></td>
<td style="text-align: left;">The service only logs <code>ex.Message</code>. It should log the full stack trace for proper diagnostics.</td>
<td style="text-align: left;"><a href="https://owasp.org/Top10/A09<em>2021-Security</em>Logging<em>and</em>Monitoring_Failures/">OWASP A09</a></td>
</tr>
<tr>
<td style="text-align: left;"><strong>VULN-042</strong></td>
<td style="text-align: left;">Lack of Rate Limiting</td>
<td style="text-align: left;">Denial of Service</td>
<td style="text-align: left;">Limitation</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;">Inferred</td>
<td style="text-align: left;">The SOAP service endpoint and application UI lack rate limiting, exposing them to resource exhaustion attacks.</td>
<td style="text-align: left;"><a href="https://owasp.org/API-Security/a4-lack-of-resources-and-rate-limiting/">OWASP API A04</a></td>
</tr>
<tr>
<td style="text-align: left;"><strong>VULN-045</strong></td>
<td style="text-align: left;">Improper Handling of Exceptional Conditions</td>
<td style="text-align: left;">Robustness</td>
<td style="text-align: left;">Bug</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><code>goto</code> in error handling</td>
<td style="text-align: left;"><code>TInsertDoc.vb</code></td>
<td style="text-align: left;">The use of <code>goto Repete</code> for retrying on exceptions is an anti-pattern that can lead to complex and unmanageable code.</td>
<td style="text-align: left;"><a href="https://cwe.mitre.org/data/definitions/489.html">CWE-489</a></td>
</tr>
<tr>
<td style="text-align: left;"><strong>VULN-046</strong></td>
<td style="text-align: left;">Missing Data Classification</td>
<td style="text-align: left;">Data Security</td>
<td style="text-align: left;">Limitation</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;">Inferred</td>
<td style="text-align: left;">There is no evidence of data classification, meaning PII and non-sensitive data are likely handled with the same security controls.</td>
<td style="text-align: left;">N/A</td>
</tr>
<tr>
<td style="text-align: left;"><strong>VULN-047</strong></td>
<td style="text-align: left;">No Security-Specific Testing</td>
<td style="text-align: left;">Quality</td>
<td style="text-align: left;">Limitation</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;">Inferred</td>
<td style="text-align: left;">The test project focuses on functionality, with no apparent security-specific tests (e.g., fuzzing, penetration tests).</td>
<td style="text-align: left;">N/A</td>
</tr>
<tr>
<td style="text-align: left;"><strong>VULN-048</strong></td>
<td style="text-align: left;">Lack of Security Champion or Process</td>
<td style="text-align: left;">Process</td>
<td style="text-align: left;">Limitation</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;">Inferred</td>
<td style="text-align: left;">The nature of the vulnerabilities suggests a lack of a formal security review process during development.</td>
<td style="text-align: left;">N/A</td>
</tr>
<tr>
<td style="text-align: left;"><strong>VULN-008</strong></td>
<td style="text-align: left;">Exception Information Leakage</td>
<td style="text-align: left;">Identification Failures</td>
<td style="text-align: left;">Bug</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;">Detailed Error Messages</td>
<td style="text-align: left;">Multiple UI Forms</td>
<td style="text-align: left;">Implement a global exception handler to show generic error messages to users while logging detailed stack traces.</td>
<td style="text-align: left;"><a href="https://owasp.org/Top10/A07<em>2021-Identification</em>and<em>Authentication</em>Failures/">OWASP A07</a></td>
</tr>
<tr>
<td style="text-align: left;"><strong>VULN-016</strong></td>
<td style="text-align: left;">Lack of Anti-Forgery Tokens</td>
<td style="text-align: left;">Security Misconfiguration</td>
<td style="text-align: left;">Limitation</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;">N/A for WinForms</td>
<td style="text-align: left;">(Applicable if web UI exists)</td>
<td style="text-align: left;">A web version of this UI would require anti-CSRF tokens.</td>
<td style="text-align: left;"><a href="https://owasp.org/www-community/attacks/csrf">OWASP CSRF</a></td>
</tr>
<tr>
<td style="text-align: left;"><strong>VULN-017</strong></td>
<td style="text-align: left;">Use of Obsolete <code>System.Transactions</code></td>
<td style="text-align: left;">Vulnerable Components</td>
<td style="text-align: left;">Limitation</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;">Outdated Technology</td>
<td style="text-align: left;"><code>CIServRemessaTestes.cs</code></td>
<td style="text-align: left;">While not a direct vulnerability, it's an outdated pattern. Modern transaction management is better handled by ORMs or other units of work.</td>
<td style="text-align: left;">N/A</td>
</tr>
<tr>
<td style="text-align: left;"><strong>VULN-018</strong></td>
<td style="text-align: left;">No Certificate Pinning for Web Service</td>
<td style="text-align: left;">Cryptographic Failures</td>
<td style="text-align: left;">Limitation</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;">Missing Security Control</td>
<td style="text-align: left;"><code>MDIWebTransmCI.vbproj</code></td>
<td style="text-align: left;">If the SOAP service were over HTTPS, the client should validate the server's certificate to prevent MITM attacks.</td>
<td style="text-align: left;"><a href="https://owasp.org/www-community/controls/Certificate<em>and</em>Public<em>Key</em>Pinning">OWASP Certificate Pinning</a></td>
</tr>
<tr>
<td style="text-align: left;"><strong>VULN-019</strong></td>
<td style="text-align: left;">Information Exposure Through Comments</td>
<td style="text-align: left;">Identification Failures</td>
<td style="text-align: left;">Limitation</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;">Leaked Information</td>
<td style="text-align: left;"><code>AssemblyInfo.cs</code></td>
<td style="text-align: left;">Comments like <code>// You can specify all the values...</code> can provide attackers with information about the build process.</td>
<td style="text-align: left;"><a href="https://cwe.mitre.org/data/definitions/200.html">CWE-200</a></td>
</tr>
<tr>
<td style="text-align: left;"><strong>VULN-020</strong></td>
<td style="text-align: left;">Use of Obsolete <code>installutil.exe</code></td>
<td style="text-align: left;">Software/Data Integrity</td>
<td style="text-align: left;">Misconfiguration</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;">Legacy Deployment</td>
<td style="text-align: left;"><code>Install.bat</code></td>
<td style="text-align: left;"><code>installutil</code> is an outdated and inflexible tool for service installation. Modern deployment should use MSI, ClickOnce, or CI/CD pipelines.</td>
<td style="text-align: left;">N/A</td>
</tr>
<tr>
<td style="text-align: left;"><strong>VULN-025</strong></td>
<td style="text-align: left;">Sensitive Data in Memory</td>
<td style="text-align: left;">Cryptographic Failures</td>
<td style="text-align: left;">Risk</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;">Unmanaged Memory</td>
<td style="text-align: left;">Inferred</td>
<td style="text-align: left;">Connection strings and other sensitive data are held in memory as strings, which could be dumped.</td>
<td style="text-align: left;"><a href="https://cwe.mitre.org/data/definitions/316.html">CWE-316</a></td>
</tr>
<tr>
<td style="text-align: left;"><strong>VULN-026</strong></td>
<td style="text-align: left;">Unprotected Event Log</td>
<td style="text-align: left;">Security Logging Failures</td>
<td style="text-align: left;">Misconfiguration</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;">Default Permissions</td>
<td style="text-align: left;"><code>CIServico.cs</code></td>
<td style="text-align: left;">The Windows Event Log may be readable by low-privilege users, potentially leaking error details.</td>
<td style="text-align: left;">N/A</td>
</tr>
<tr>
<td style="text-align: left;"><strong>VULN-028</strong></td>
<td style="text-align: left;">Lack of Output Encoding</td>
<td style="text-align: left;">Injection</td>
<td style="text-align: left;">Risk</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;">Inferred</td>
<td style="text-align: left;">Data displayed in the UI is not encoded, creating a risk of UI-based injection attacks if the data is compromised.</td>
<td style="text-align: left;"><a href="https://owasp.org/www-community/attacks/xss/">OWASP XSS</a></td>
</tr>
<tr>
<td style="text-align: left;"><strong>VULN-029</strong></td>
<td style="text-align: left;">Predictable Temporary File Names</td>
<td style="text-align: left;">Security Misconfiguration</td>
<td style="text-align: left;">Risk</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;">Insecure Temp Files</td>
<td style="text-align: left;"><code>CIGlobalParameters.cs</code></td>
<td style="text-align: left;"><code>GetTempFileName</code> uses the thread ID, which could be predictable, leading to temp file hijacking.</td>
<td style="text-align: left;"><a href="https://cwe.mitre.org/data/definitions/377.html">CWE-377</a></td>
</tr>
<tr>
<td style="text-align: left;"><strong>VULN-031</strong></td>
<td style="text-align: left;">Missing Security Headers</td>
<td style="text-align: left;">Security Misconfiguration</td>
<td style="text-align: left;">Limitation</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;">N/A for WinForms</td>
<td style="text-align: left;">(Applicable if web UI exists)</td>
<td style="text-align: left;">A web version would need HSTS, CSP, etc.</td>
<td style="text-align: left;"><a href="https://owasp.org/Top10/A05<em>2021-Security</em>Misconfiguration/">OWASP A05</a></td>
</tr>
<tr>
<td style="text-align: left;"><strong>VULN-034</strong></td>
<td style="text-align: left;">Unvalidated Redirects and Forwards</td>
<td style="text-align: left;">Injection</td>
<td style="text-align: left;">Risk</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;">N/A for WinForms</td>
<td style="text-align: left;">(Applicable if web UI exists)</td>
<td style="text-align: left;">A web version would need to validate all redirects.</td>
<td style="text-align: left;"><a href="https://owasp.org/www-community/attacks/Unvalidated<em>Redirects</em>and<em>Forwards</em>Cheat_Sheet">OWASP Unvalidated Redirects</a></td>
</tr>
<tr>
<td style="text-align: left;"><strong>VULN-040</strong></td>
<td style="text-align: left;">Mass Assignment Vulnerability</td>
<td style="text-align: left;">Injection</td>
<td style="text-align: left;">Risk</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;">Inferred</td>
<td style="text-align: left;">If data models are populated directly from user input without whitelisting fields, an attacker could set internal properties.</td>
<td style="text-align: left;"><a href="https://owasp.org/www-project-proactive-controls/v3/en/c8-protect-data">OWASP Mass Assignment</a></td>
</tr>
<tr>
<td style="text-align: left;"><strong>VULN-043</strong></td>
<td style="text-align: left;">Integer Overflow Potential</td>
<td style="text-align: left;">Numeric Errors</td>
<td style="text-align: left;">Risk</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;">Use of <code>Int16</code>, <code>Int32</code></td>
<td style="text-align: left;">Multiple classes use <code>Int16</code> and <code>Int32</code> for IDs and counters, which could overflow in a high-volume system.</td>
<td style="text-align: left;"><a href="https://cwe.mitre.org/data/definitions/190.html">CWE-190</a></td>
</tr>
<tr>
<td style="text-align: left;"><strong>VULN-044</strong></td>
<td style="text-align: left;">No Endpoint for API Versioning</td>
<td style="text-align: left;">Security Misconfiguration</td>
<td style="text-align: left;">Limitation</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;">Inferred</td>
<td style="text-align: left;">The SOAP service URL does not indicate a version, making future updates difficult to manage without breaking clients.</td>
<td style="text-align: left;"><a href="https://owasp.org/API-Security/a9-improper-inventory-management/">OWASP API A09</a></td>
</tr>
<tr>
<td style="text-align: left;"><strong>VULN-049</strong></td>
<td style="text-align: left;">Use of <code>m_iInterface</code> for UI Updates</td>
<td style="text-align: left;">Architecture</td>
<td style="text-align: left;">Defect</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;">Poor layering</td>
<td style="text-align: left;"><code>CIServicoThread.cs</code></td>
<td style="text-align: left;">The background thread holds a reference to a UI-related interface, tightly coupling the backend service to a specific UI implementation.</td>
<td style="text-align: left;">N/A</td>
</tr>
<tr>
<td style="text-align: left;"><strong>VULN-050</strong></td>
<td style="text-align: left;">Business Logic in Stored Procedures</td>
<td style="text-align: left;">Maintainability</td>
<td style="text-align: left;">Risk</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;">Inferred</td>
<td style="text-align: left;">The code calls stored procedures like <code>Update_ProcessaRemessaProc</code>, which may contain critical business logic, making it hard to version and test.</td>
<td style="text-align: left;">N/A</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="product-section">
<h2 id="12-supportability-and-maintainability">12. Supportability and maintainability</h2>
This section assesses the supportability of the application's technology stack.
<div class="table-container">
<table>
<colgroup>
<col style="width: 16%" />
<col style="width: 16%" />
<col style="width: 16%" />
<col style="width: 16%" />
<col style="width: 16%" />
<col style="width: 16%" />
</colgroup>
<thead>
<tr>
<th style="text-align: left;">Component</th>
<th style="text-align: left;">Current version</th>
<th style="text-align: left;">End of support date</th>
<th style="text-align: left;">Supportability</th>
<th style="text-align: left;">Latest stable version</th>
<th style="text-align: left;">Links</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>.NET Framework</strong></td>
<td style="text-align: left;">4.0</td>
<td style="text-align: left;">2016-01-12</td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> Not supported</td>
<td style="text-align: left;">.NET Framework 4.8.1</td>
<td style="text-align: left;"><a href="https://learn.microsoft.com/en-us/lifecycle/products/microsoft-net-framework">Microsoft Lifecycle</a></td>
</tr>
<tr>
<td style="text-align: left;"><strong>C#</strong></td>
<td style="text-align: left;">4.0 (inferred from .NET 4.0)</td>
<td style="text-align: left;">N/A (tied to framework)</td>
<td style="text-align: left;"><span class="icon icon-check" title="Yes/Used/Supported">check_circle</span> Supported (language)</td>
<td style="text-align: left;">C# 12</td>
<td style="text-align: left;"><a href="https://learn.microsoft.com/en-us/dotnet/csharp/whats-new/csharp-version-history">C# Language Versions</a></td>
</tr>
<tr>
<td style="text-align: left;"><strong>VB.NET</strong></td>
<td style="text-align: left;">10.0 (inferred from .NET 4.0)</td>
<td style="text-align: left;">N/A (tied to framework)</td>
<td style="text-align: left;"><span class="icon icon-check" title="Yes/Used/Supported">check_circle</span> Supported (language)</td>
<td style="text-align: left;">VB.NET 16.9</td>
<td style="text-align: left;"><a href="https://learn.microsoft.com/en-us/dotnet/visual-basic/whats-new/">VB.NET Language Versions</a></td>
</tr>
<tr>
<td style="text-align: left;"><strong>Windows Forms</strong></td>
<td style="text-align: left;">.NET Framework 4.0 version</td>
<td style="text-align: left;">2029-01-09</td>
<td style="text-align: left;"><span class="icon icon-check" title="Yes/Used/Supported">check_circle</span> Supported</td>
<td style="text-align: left;">.NET 8 version</td>
<td style="text-align: left;"><a href="https://learn.microsoft.com/en-us/lifecycle/products/microsoft-net-framework">Windows Forms Lifecycle</a></td>
</tr>
<tr>
<td style="text-align: left;"><strong>SQL Server (inferred)</strong></td>
<td style="text-align: left;">2008 R2</td>
<td style="text-align: left;">2019-07-09</td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> Not supported</td>
<td style="text-align: left;">SQL Server 2022</td>
<td style="text-align: left;"><a href="https://learn.microsoft.com/en-us/lifecycle/products/sql-server-2008-r2">Microsoft Lifecycle</a></td>
</tr>
<tr>
<td style="text-align: left;"><strong>Windows Server (inferred)</strong></td>
<td style="text-align: left;">2008 R2</td>
<td style="text-align: left;">2020-01-14</td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> Not supported</td>
<td style="text-align: left;">Windows Server 2022</td>
<td style="text-align: left;"><a href="https://learn.microsoft.com/en-us/lifecycle/products/windows-server-2008-r2">Microsoft Lifecycle</a></td>
</tr>
</tbody>
</table>
</div>
<h3 id="121-net-framework-lifecycle">12.1. .NET Framework lifecycle</h3>
This table provides a comprehensive overview of the .NET Framework lifecycle, highlighting the versions used by the application. The lifecycle for versions 4.6.2 and later is tied to the parent Windows OS lifecycle.
<div class="table-container">
<table>
<colgroup>
<col style="width: 20%" />
<col style="width: 20%" />
<col style="width: 20%" />
<col style="width: 20%" />
<col style="width: 20%" />
</colgroup>
<thead>
<tr>
<th style="text-align: left;">Version</th>
<th style="text-align: left;">Start date</th>
<th style="text-align: left;">End date</th>
<th style="text-align: left;">Supported</th>
<th style="text-align: left;">Used in the application</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>.NET Framework 4.8.1</strong></td>
<td style="text-align: left;">2022-08-09</td>
<td style="text-align: left;">2031-10-14</td>
<td style="text-align: left;"><span class="icon icon-check" title="Yes/Used/Supported">check_circle</span> Yes</td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> No</td>
</tr>
<tr>
<td style="text-align: left;"><strong>.NET Framework 4.8</strong></td>
<td style="text-align: left;">2019-04-18</td>
<td style="text-align: left;">2029-01-09</td>
<td style="text-align: left;"><span class="icon icon-check" title="Yes/Used/Supported">check_circle</span> Yes</td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> No</td>
</tr>
<tr>
<td style="text-align: left;"><strong>.NET Framework 4.7.2</strong></td>
<td style="text-align: left;">2018-04-30</td>
<td style="text-align: left;">2029-01-09</td>
<td style="text-align: left;"><span class="icon icon-check" title="Yes/Used/Supported">check_circle</span> Yes</td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> No</td>
</tr>
<tr>
<td style="text-align: left;"><strong>.NET Framework 4.7.1</strong></td>
<td style="text-align: left;">2017-10-17</td>
<td style="text-align: left;">2029-01-09</td>
<td style="text-align: left;"><span class="icon icon-check" title="Yes/Used/Supported">check_circle</span> Yes</td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> No</td>
</tr>
<tr>
<td style="text-align: left;"><strong>.NET Framework 4.7</strong></td>
<td style="text-align: left;">2017-04-05</td>
<td style="text-align: left;">2029-01-09</td>
<td style="text-align: left;"><span class="icon icon-check" title="Yes/Used/Supported">check_circle</span> Yes</td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> No</td>
</tr>
<tr>
<td style="text-align: left;"><strong>.NET Framework 4.6.2</strong></td>
<td style="text-align: left;">2016-08-02</td>
<td style="text-align: left;">2029-01-09</td>
<td style="text-align: left;"><span class="icon icon-check" title="Yes/Used/Supported">check_circle</span> Yes</td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> No</td>
</tr>
<tr>
<td style="text-align: left;"><strong>.NET Framework 4.6.1</strong></td>
<td style="text-align: left;">2015-11-30</td>
<td style="text-align: left;">2022-04-26</td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> No</td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> No</td>
</tr>
<tr>
<td style="text-align: left;"><strong>.NET Framework 4.6</strong></td>
<td style="text-align: left;">2015-07-20</td>
<td style="text-align: left;">2022-04-26</td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> No</td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> No</td>
</tr>
<tr>
<td style="text-align: left;"><strong>.NET Framework 4.5.2</strong></td>
<td style="text-align: left;">2014-05-05</td>
<td style="text-align: left;">2022-04-26</td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> No</td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> No</td>
</tr>
<tr>
<td style="text-align: left;"><strong>.NET Framework 4.5.1</strong></td>
<td style="text-align: left;">2013-10-17</td>
<td style="text-align: left;">2016-01-12</td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> No</td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> No</td>
</tr>
<tr>
<td style="text-align: left;"><strong>.NET Framework 4.5</strong></td>
<td style="text-align: left;">2012-08-15</td>
<td style="text-align: left;">2016-01-12</td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> No</td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> No</td>
</tr>
<tr>
<td style="text-align: left;"><strong>.NET Framework 4.0</strong></td>
<td style="text-align: left;">2010-04-12</td>
<td style="text-align: left;">2016-01-12</td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> No</td>
<td style="text-align: left;"><span class="icon icon-check" title="Yes/Used/Supported">check_circle</span> Yes</td>
</tr>
<tr>
<td style="text-align: left;"><strong>.NET Framework 3.5 SP1</strong></td>
<td style="text-align: left;">2007-11-19</td>
<td style="text-align: left;">2029-01-09</td>
<td style="text-align: left;"><span class="icon icon-check" title="Yes/Used/Supported">check_circle</span> Yes</td>
<td style="text-align: left;"><span class="icon icon-check" title="Yes/Used/Supported">check_circle</span> Yes</td>
</tr>
<tr>
<td style="text-align: left;"><strong>.NET Framework 3.0</strong></td>
<td style="text-align: left;">2006-11-06</td>
<td style="text-align: left;">2011-07-12</td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> No</td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> No</td>
</tr>
<tr>
<td style="text-align: left;"><strong>.NET Framework 2.0</strong></td>
<td style="text-align: left;">2005-10-27</td>
<td style="text-align: left;">2011-07-12</td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> No</td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> No</td>
</tr>
<tr>
<td style="text-align: left;"><strong>.NET Framework 1.1</strong></td>
<td style="text-align: left;">2003-06-27</td>
<td style="text-align: left;">2013-10-08</td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> No</td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> No</td>
</tr>
<tr>
<td style="text-align: left;"><strong>.NET Framework 1.0</strong></td>
<td style="text-align: left;">2002-02-13</td>
<td style="text-align: left;">2009-07-14</td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> No</td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> No</td>
</tr>
</tbody>
</table>
</div>
<h3 id="122-net-lifecycle">12.2. .NET lifecycle</h3>
This section outlines the support lifecycle for the modern, cross-platform .NET (formerly .NET Core). This application does not use these versions.
<div class="table-container">
<table>
<colgroup>
<col style="width: 20%" />
<col style="width: 20%" />
<col style="width: 20%" />
<col style="width: 20%" />
<col style="width: 20%" />
</colgroup>
<thead>
<tr>
<th style="text-align: left;">Version</th>
<th style="text-align: left;">Start date</th>
<th style="text-align: left;">End date</th>
<th style="text-align: left;">Supported</th>
<th style="text-align: left;">Used in the application</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>.NET 8</strong></td>
<td style="text-align: left;">2023-11-14</td>
<td style="text-align: left;">2026-11-10</td>
<td style="text-align: left;"><span class="icon icon-check" title="Yes/Used/Supported">check_circle</span> Yes</td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> No</td>
</tr>
<tr>
<td style="text-align: left;"><strong>.NET 7</strong></td>
<td style="text-align: left;">2022-11-08</td>
<td style="text-align: left;">2024-05-14</td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> No</td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> No</td>
</tr>
<tr>
<td style="text-align: left;"><strong>.NET 6</strong></td>
<td style="text-align: left;">2021-11-08</td>
<td style="text-align: left;">2024-11-12</td>
<td style="text-align: left;"><span class="icon icon-check" title="Yes/Used/Supported">check_circle</span> Yes</td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> No</td>
</tr>
<tr>
<td style="text-align: left;"><strong>.NET 5</strong></td>
<td style="text-align: left;">2020-11-10</td>
<td style="text-align: left;">2022-05-10</td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> No</td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> No</td>
</tr>
<tr>
<td style="text-align: left;"><strong>.NET Core 3.1</strong></td>
<td style="text-align: left;">2019-12-03</td>
<td style="text-align: left;">2022-12-13</td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> No</td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> No</td>
</tr>
<tr>
<td style="text-align: left;"><strong>.NET Core 2.1</strong></td>
<td style="text-align: left;">2018-05-30</td>
<td style="text-align: left;">2021-08-21</td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> No</td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> No</td>
</tr>
<tr>
<td style="text-align: left;"><strong>.NET Core 1.x</strong></td>
<td style="text-align: left;">2016-06-27</td>
<td style="text-align: left;">2019-06-27</td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> No</td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> No</td>
</tr>
</tbody>
</table>
</div>
<h3 id="123-windows-server-operating-systems-lifecycle">12.3. Windows Server Operating Systems lifecycle</h3>
The following table outlines the support lifecycle for Windows Server, the likely deployment target for the application.
<div class="table-container">
<table>
<colgroup>
<col style="width: 16%" />
<col style="width: 16%" />
<col style="width: 16%" />
<col style="width: 16%" />
<col style="width: 16%" />
<col style="width: 16%" />
</colgroup>
<thead>
<tr>
<th style="text-align: left;">Version</th>
<th style="text-align: left;">Start date</th>
<th style="text-align: left;">End date (mainstream)</th>
<th style="text-align: left;">End date (extended)</th>
<th style="text-align: left;">Supported</th>
<th style="text-align: left;">Used in the application</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>Windows Server 2022</strong></td>
<td style="text-align: left;">2021-08-18</td>
<td style="text-align: left;">2026-10-13</td>
<td style="text-align: left;">2031-10-14</td>
<td style="text-align: left;"><span class="icon icon-check" title="Yes/Used/Supported">check_circle</span> Yes</td>
<td style="text-align: left;"><span class="icon icon-question" title="Uncertain/Likely">help</span> Likely</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Windows Server 2019</strong></td>
<td style="text-align: left;">2018-11-13</td>
<td style="text-align: left;">2024-01-09</td>
<td style="text-align: left;">2029-01-09</td>
<td style="text-align: left;"><span class="icon icon-check" title="Yes/Used/Supported">check_circle</span> Yes</td>
<td style="text-align: left;"><span class="icon icon-question" title="Uncertain/Likely">help</span> Likely</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Windows Server 2016</strong></td>
<td style="text-align: left;">2016-10-15</td>
<td style="text-align: left;">2022-01-11</td>
<td style="text-align: left;">2027-01-12</td>
<td style="text-align: left;"><span class="icon icon-check" title="Yes/Used/Supported">check_circle</span> Yes</td>
<td style="text-align: left;"><span class="icon icon-question" title="Uncertain/Likely">help</span> Likely</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Windows Server 2012 R2</strong></td>
<td style="text-align: left;">2013-11-25</td>
<td style="text-align: left;">2018-10-09</td>
<td style="text-align: left;">2023-10-10</td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> No</td>
<td style="text-align: left;"><span class="icon icon-question" title="Uncertain/Likely">help</span> Likely</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Windows Server 2012</strong></td>
<td style="text-align: left;">2012-10-30</td>
<td style="text-align: left;">2018-10-09</td>
<td style="text-align: left;">2023-10-10</td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> No</td>
<td style="text-align: left;"><span class="icon icon-question" title="Uncertain/Likely">help</span> Likely</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Windows Server 2008 R2</strong></td>
<td style="text-align: left;">2009-10-22</td>
<td style="text-align: left;">2015-01-13</td>
<td style="text-align: left;">2020-01-14</td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> No</td>
<td style="text-align: left;"><span class="icon icon-question" title="Uncertain/Likely">help</span> Likely</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Windows Server 2008</strong></td>
<td style="text-align: left;">2008-05-06</td>
<td style="text-align: left;">2015-01-13</td>
<td style="text-align: left;">2020-01-14</td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> No</td>
<td style="text-align: left;"><span class="icon icon-question" title="Uncertain/Likely">help</span> Likely</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Windows Server 2003</strong></td>
<td style="text-align: left;">2003-04-24</td>
<td style="text-align: left;">2010-07-13</td>
<td style="text-align: left;">2015-07-14</td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> No</td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> No</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Windows Server 2000</strong></td>
<td style="text-align: left;">2000-02-17</td>
<td style="text-align: left;">2005-06-30</td>
<td style="text-align: left;">2010-07-13</td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> No</td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> No</td>
</tr>
</tbody>
</table>
</div>
<h3 id="124-microsoft-sql-server-lifecycle">12.4. Microsoft SQL Server lifecycle</h3>
The following table outlines the support lifecycle for Microsoft SQL Server. The application is inferred to be using an unsupported version.
<div class="table-container">
<table>
<colgroup>
<col style="width: 16%" />
<col style="width: 16%" />
<col style="width: 16%" />
<col style="width: 16%" />
<col style="width: 16%" />
<col style="width: 16%" />
</colgroup>
<thead>
<tr>
<th style="text-align: left;">Version</th>
<th style="text-align: left;">Start date</th>
<th style="text-align: left;">End date (mainstream)</th>
<th style="text-align: left;">End date (extended)</th>
<th style="text-align: left;">Supported</th>
<th style="text-align: left;">Used in the application</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>SQL Server 2022</strong></td>
<td style="text-align: left;">2022-11-16</td>
<td style="text-align: left;">2028-01-11</td>
<td style="text-align: left;">2033-01-11</td>
<td style="text-align: left;"><span class="icon icon-check" title="Yes/Used/Supported">check_circle</span> Yes</td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> No</td>
</tr>
<tr>
<td style="text-align: left;"><strong>SQL Server 2019</strong></td>
<td style="text-align: left;">2019-11-04</td>
<td style="text-align: left;">2025-02-28</td>
<td style="text-align: left;">2030-01-08</td>
<td style="text-align: left;"><span class="icon icon-check" title="Yes/Used/Supported">check_circle</span> Yes</td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> No</td>
</tr>
<tr>
<td style="text-align: left;"><strong>SQL Server 2017</strong></td>
<td style="text-align: left;">2017-10-02</td>
<td style="text-align: left;">2022-10-11</td>
<td style="text-align: left;">2027-10-12</td>
<td style="text-align: left;"><span class="icon icon-check" title="Yes/Used/Supported">check_circle</span> Yes</td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> No</td>
</tr>
<tr>
<td style="text-align: left;"><strong>SQL Server 2016</strong></td>
<td style="text-align: left;">2016-06-01</td>
<td style="text-align: left;">2021-07-13</td>
<td style="text-align: left;">2026-07-14</td>
<td style="text-align: left;"><span class="icon icon-check" title="Yes/Used/Supported">check_circle</span> Yes</td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> No</td>
</tr>
<tr>
<td style="text-align: left;"><strong>SQL Server 2014</strong></td>
<td style="text-align: left;">2014-06-05</td>
<td style="text-align: left;">2019-07-09</td>
<td style="text-align: left;">2024-07-09</td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> No</td>
<td style="text-align: left;"><span class="icon icon-question" title="Uncertain/Likely">help</span> Likely</td>
</tr>
<tr>
<td style="text-align: left;"><strong>SQL Server 2012</strong></td>
<td style="text-align: left;">2012-05-20</td>
<td style="text-align: left;">2017-07-11</td>
<td style="text-align: left;">2022-07-12</td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> No</td>
<td style="text-align: left;"><span class="icon icon-question" title="Uncertain/Likely">help</span> Likely</td>
</tr>
<tr>
<td style="text-align: left;"><strong>SQL Server 2008 R2</strong></td>
<td style="text-align: left;">2010-07-20</td>
<td style="text-align: left;">2014-07-08</td>
<td style="text-align: left;">2019-07-09</td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> No</td>
<td style="text-align: left;"><span class="icon icon-question" title="Uncertain/Likely">help</span> Likely</td>
</tr>
<tr>
<td style="text-align: left;"><strong>SQL Server 2008</strong></td>
<td style="text-align: left;">2008-11-06</td>
<td style="text-align: left;">2014-07-08</td>
<td style="text-align: left;">2019-07-09</td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> No</td>
<td style="text-align: left;"><span class="icon icon-question" title="Uncertain/Likely">help</span> Likely</td>
</tr>
<tr>
<td style="text-align: left;"><strong>SQL Server 2005</strong></td>
<td style="text-align: left;">2005-12-14</td>
<td style="text-align: left;">2011-04-12</td>
<td style="text-align: left;">2016-04-12</td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> No</td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> No</td>
</tr>
<tr>
<td style="text-align: left;"><strong>SQL Server 2000</strong></td>
<td style="text-align: left;">2000-11-30</td>
<td style="text-align: left;">2008-04-08</td>
<td style="text-align: left;">2013-04-09</td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> No</td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> No</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="product-section">
<h2 id="13-modernization-strategy">13. Modernization strategy</h2>
This section outlines and compares three potential modernization strategies for the SDCIM application, along with a final recommendation and implementation plan.
<h3 id="131-modernization-strategy-comparison">13.1. Modernization strategy comparison</h3>
The following table compares the three proposed modernization strategies across several key factors.
<div class="table-container">
<table>
<colgroup>
<col style="width: 7%" />
<col style="width: 7%" />
<col style="width: 7%" />
<col style="width: 7%" />
<col style="width: 7%" />
<col style="width: 7%" />
<col style="width: 7%" />
<col style="width: 7%" />
<col style="width: 7%" />
<col style="width: 7%" />
<col style="width: 7%" />
<col style="width: 7%" />
<col style="width: 7%" />
<col style="width: 7%" />
</colgroup>
<thead>
<tr>
<th style="text-align: left;">Strategy</th>
<th style="text-align: left;">Description</th>
<th style="text-align: left;">Complexity</th>
<th style="text-align: left;">Development time estimate</th>
<th style="text-align: left;">Functional testing time estimate</th>
<th style="text-align: left;">Infrastructure time estimate</th>
<th style="text-align: left;">Deployment time estimate</th>
<th style="text-align: left;">Total time estimate</th>
<th style="text-align: left;">Cost estimate</th>
<th style="text-align: left;">Risk</th>
<th style="text-align: left;">Long-term fit</th>
<th style="text-align: left;">Time-to-market</th>
<th style="text-align: left;">Pros</th>
<th style="text-align: left;">Cons</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>Lift and Shift (without rehosting)</strong></td>
<td style="text-align: left;">Upgrade the application to the latest supported .NET Framework (4.8.1) and update all third-party libraries. The application remains on-premises.</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;">3-5 weeks</td>
<td style="text-align: left;">2-3 weeks</td>
<td style="text-align: left;">1 week</td>
<td style="text-align: left;">1 week</td>
<td style="text-align: left;">7-10 weeks</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> Low</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Fast</td>
<td style="text-align: left;"><span class="icon icon-check" title="Yes/Used/Supported">check_circle</span> Lowest cost and risk.<br><span class="icon icon-check" title="Yes/Used/Supported">check_circle</span> No architectural changes needed.<br><span class="icon icon-check" title="Yes/Used/Supported">check_circle</span> Resolves immediate security risks from unsupported frameworks.</td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> Does not address architectural flaws.<br><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> Limited scalability and maintainability gains.<br><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> Remains a monolith on legacy infrastructure.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Lift and Shift (with rehosting)</strong></td>
<td style="text-align: left;">Re-platform the application to run on a modern cloud infrastructure (e.g., Azure). The Windows Service is containerized and run on Azure Container Apps. The Windows Forms UI is delivered via Azure Virtual Desktop. The database is migrated to Azure SQL. The codebase is upgraded to .NET 8.</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;">6-8 weeks</td>
<td style="text-align: left;">4-6 weeks</td>
<td style="text-align: left;">3-4 weeks</td>
<td style="text-align: left;">2-3 weeks</td>
<td style="text-align: left;">15-21 weeks</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-check" title="Yes/Used/Supported">check_circle</span> Moves to a modern, scalable cloud platform.<br><span class="icon icon-check" title="Yes/Used/Supported">check_circle</span> Adopts a modern .NET runtime.<br><span class="icon icon-check" title="Yes/Used/Supported">check_circle</span> Improves security and manageability via cloud services.</td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> Higher cost and complexity than a simple upgrade.<br><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> Does not fully break down the monolith.<br><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> Requires new skills in cloud infrastructure and containerization.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Complete Refactor (Re-architect)</strong></td>
<td style="text-align: left;">Re-architect the application to a cloud-native, microservices-based architecture. The remittance processing logic becomes a set of Azure Functions or microservices. The UI is rewritten as a modern web application (e.g., Blazor).</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> Very High</td>
<td style="text-align: left;">12+ weeks</td>
<td style="text-align: left;">8-10 weeks</td>
<td style="text-align: left;">4-6 weeks</td>
<td style="text-align: left;">3-4 weeks</td>
<td style="text-align: left;">27+ weeks</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> High</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> Slow</td>
<td style="text-align: left;"><span class="icon icon-check" title="Yes/Used/Supported">check_circle</span> Achieves maximum scalability, maintainability, and agility.<br><span class="icon icon-check" title="Yes/Used/Supported">check_circle</span> Fully addresses all architectural and technical debt.<br><span class="icon icon-check" title="Yes/Used/Supported">check_circle</span> Aligns with modern development best practices.</td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> Highest cost, risk, and time commitment.<br><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> Requires a complete rewrite of the application.<br><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> Significant testing effort is required.</td>
</tr>
</tbody>
</table>
</div>
<h3 id="132-recommendation">13.2. Recommendation</h3>
This section details the recommended modernization strategy and a plan to implement it.
<p>The recommended strategy is <strong>Lift and Shift (with rehosting)</strong>. This approach provides the best balance of modernization benefits versus cost and risk. It addresses the most critical issue—the unsupported .NET Framework—while moving the application to a modern, scalable, and secure cloud platform. It avoids the high cost and risk of a full rewrite, delivering significant value in a moderate timeframe.</p>
<h4 id="1321-step-by-step-plan">13.2.1. Step-by-step plan</h4>
The following is a detailed, step-by-step plan for implementing the recommended "Lift and Shift (with rehosting)" strategy.
<div class="table-container">
<table>
<colgroup>
<col style="width: 20%" />
<col style="width: 20%" />
<col style="width: 20%" />
<col style="width: 20%" />
<col style="width: 20%" />
</colgroup>
<thead>
<tr>
<th style="text-align: left;">Phase</th>
<th style="text-align: left;">Step</th>
<th style="text-align: left;">Task Description</th>
<th style="text-align: left;">Technologies / Tools</th>
<th style="text-align: left;">Estimated Time</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>1. Assessment & Planning</strong></td>
<td style="text-align: left;">1.1</td>
<td style="text-align: left;">Analyze codebase with .NET Upgrade Assistant to identify breaking changes.</td>
<td style="text-align: left;">.NET Upgrade Assistant</td>
<td style="text-align: left;">1 week</td>
</tr>
<tr>
<td style="text-align: left;">1.2</td>
<td style="text-align: left;">Create a full inventory of all database objects, dependencies, and configuration settings.</td>
<td style="text-align: left;">SQL Server Management Studio</td>
<td style="text-align: left;">1 week</td>
</tr>
<tr>
<td style="text-align: left;">1.3</td>
<td style="text-align: left;">Design the target Azure architecture (VNet, Azure SQL, Azure Container Apps, Azure Virtual Desktop).</td>
<td style="text-align: left;">Azure Portal, Visio</td>
<td style="text-align: left;">1 week</td>
</tr>
<tr>
<td style="text-align: left;"><strong>2. Database Migration</strong></td>
<td style="text-align: left;">2.1</td>
<td style="text-align: left;">Use Azure Data Migration Assistant (DMA) to assess compatibility and migrate the schema to Azure SQL.</td>
<td style="text-align: left;">Azure DMA</td>
<td style="text-align: left;">1 week</td>
</tr>
<tr>
<td style="text-align: left;">2.2</td>
<td style="text-align: left;">Script and execute data migration from the on-premises SQL Server to Azure SQL.</td>
<td style="text-align: left;">Azure Data Factory, SSIS</td>
<td style="text-align: left;">2 weeks</td>
</tr>
<tr>
<td style="text-align: left;">2.3</td>
<td style="text-align: left;">Update all connection strings in the application configuration to point to Azure SQL.</td>
<td style="text-align: left;">Visual Studio</td>
<td style="text-align: left;">2 days</td>
</tr>
<tr>
<td style="text-align: left;"><strong>3. Application Upgrade</strong></td>
<td style="text-align: left;">3.1</td>
<td style="text-align: left;">Upgrade all projects in the solution to target .NET 8.</td>
<td style="text-align: left;">Visual Studio, .NET Upgrade Assistant</td>
<td style="text-align: left;">2-3 weeks</td>
</tr>
<tr>
<td style="text-align: left;">3.2</td>
<td style="text-align: left;">Replace outdated libraries (e.g., Crystal Reports) with modern equivalents (e.g., Power BI Embedded, SSRS).</td>
<td style="text-align: left;">Visual Studio</td>
<td style="text-align: left;">2-3 weeks</td>
</tr>
<tr>
<td style="text-align: left;">3.3</td>
<td style="text-align: left;">Refactor all direct SQL calls to use parameterized queries to eliminate SQL injection vulnerabilities.</td>
<td style="text-align: left;">Visual Studio</td>
<td style="text-align: left;">1-2 weeks</td>
</tr>
<tr>
<td style="text-align: left;"><strong>4. Containerization & Deployment</strong></td>
<td style="text-align: left;">4.1</td>
<td style="text-align: left;">Create a Dockerfile for the <code>CIServico</code> Windows Service.</td>
<td style="text-align: left;">Docker</td>
<td style="text-align: left;">1 week</td>
</tr>
<tr>
<td style="text-align: left;">4.2</td>
<td style="text-align: left;">Set up an Azure Container Registry (ACR) to store the container image.</td>
<td style="text-align: left;">Azure CLI</td>
<td style="text-align: left;">1 day</td>
</tr>
<tr>
<td style="text-align: left;">4.3</td>
<td style="text-align: left;">Create an Azure Container App environment to host the service container.</td>
<td style="text-align: left;">Azure Portal</td>
<td style="text-align: left;">2 days</td>
</tr>
<tr>
<td style="text-align: left;">4.4</td>
<td style="text-align: left;">Package the <code>CIControlo</code> Windows Forms application for deployment via Azure Virtual Desktop.</td>
<td style="text-align: left;">MSIX Packaging Tool</td>
<td style="text-align: left;">1 week</td>
</tr>
<tr>
<td style="text-align: left;"><strong>5. Testing & Validation</strong></td>
<td style="text-align: left;">5.1</td>
<td style="text-align: left;">Conduct full functional testing of the re-platformed application against the Azure SQL database.</td>
<td style="text-align: left;">Manual Testing, MSTest</td>
<td style="text-align: left;">4-6 weeks</td>
</tr>
<tr>
<td style="text-align: left;">5.2</td>
<td style="text-align: left;">Perform performance and security testing on the new Azure infrastructure.</td>
<td style="text-align: left;">Azure Load Testing, Azure Security Center</td>
<td style="text-align: left;">2 weeks</td>
</tr>
<tr>
<td style="text-align: left;"><strong>6. Go-Live</strong></td>
<td style="text-align: left;">6.1</td>
<td style="text-align: left;">Plan and execute the final data synchronization and cutover from the on-premises system to Azure.</td>
<td style="text-align: left;">Azure Data Factory</td>
<td style="text-align: left;">1 week</td>
</tr>
<tr>
<td style="text-align: left;">6.2</td>
<td style="text-align: left;">Decommission the old on-premises servers.</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">1 week</td>
</tr>
</tbody>
</table>
</div>
<h4 id="1322-gantt-chart">13.2.2. Gantt chart</h4>
A Gantt chart to visualize the step-by-step plan, showing the timeline and dependencies of each step.
<pre class="mermaid"><code>gantt
    title Modernization Plan: Lift and Shift (with rehosting)
    dateFormat  YYYY-MM-DD
    axisFormat %b %Y
    
    section Assessment & Planning
    Analyze Codebase           :done,    p1, 2025-09-01, 1w
    Inventory & Architecture   :         p2, after p1, 2w

    section Database Migration
    Assess & Migrate Schema    :         db1, after p2, 1w
    Migrate Data               :         db2, after db1, 2w
    Update Connection Strings  :         db3, after db2, 2d

    section Application Upgrade
    Upgrade to .NET 8          :         app1, after p2, 3w
    Replace Libraries          :         app2, after app1, 3w
    Fix SQL Injection          :         app3, after app2, 2w

    section Containerization & Deployment
    Containerize Service       :         dep1, after app3, 1w
    Setup Azure Infrastructure :         dep2, after dep1, 1w
    Package UI for AVD         :         dep3, after dep1, 1w

    section Testing & Validation
    Functional Testing         :         t1, after dep2, 6w
    Performance & Security     :         t2, after t1, 2w

    section Go-Live
    Final Cutover & Decommission :       gl, after t2, 2w
</code></pre>
<center>Figure 15 - Gantt chart for the recommended modernization plan.</center>
</div>
<div class="product-section">
<h2 id="14-application-porfolio-management">14. Application porfolio management</h2>
This section provides an analysis of the application's components for portfolio management purposes, mapping them to standard IT component types.
<h3 id="141-it-component-types-and-attributes">14.1. IT Component types and attributes</h3>
The following table maps the application's components to the LeanIX IT Component model.
<div class="table-container">
<table>
<colgroup>
<col style="width: 11%" />
<col style="width: 11%" />
<col style="width: 11%" />
<col style="width: 11%" />
<col style="width: 11%" />
<col style="width: 11%" />
<col style="width: 11%" />
<col style="width: 11%" />
<col style="width: 11%" />
</colgroup>
<thead>
<tr>
<th style="text-align: left;">IT Component Type</th>
<th style="text-align: left;">Name</th>
<th style="text-align: left;">Type</th>
<th style="text-align: left;">Version(s)</th>
<th style="text-align: left;">Provider(s)</th>
<th style="text-align: left;">Support start date</th>
<th style="text-align: left;">Support end date</th>
<th style="text-align: left;">Support end date (extended)</th>
<th style="text-align: left;">Support status</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>Programming Language</strong></td>
<td style="text-align: left;">C#</td>
<td style="text-align: left;">Programming Language</td>
<td style="text-align: left;">4.0</td>
<td style="text-align: left;">Microsoft</td>
<td style="text-align: left;">2010-04-12</td>
<td style="text-align: left;">2016-01-12</td>
<td style="text-align: left;">N/A</td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> Unsupported</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Programming Language</strong></td>
<td style="text-align: left;">VB.NET</td>
<td style="text-align: left;">Programming Language</td>
<td style="text-align: left;">10.0</td>
<td style="text-align: left;">Microsoft</td>
<td style="text-align: left;">2010-04-12</td>
<td style="text-align: left;">2016-01-12</td>
<td style="text-align: left;">N/A</td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> Unsupported</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Web Framework</strong></td>
<td style="text-align: left;">.NET Framework</td>
<td style="text-align: left;">Web Framework</td>
<td style="text-align: left;">4.0</td>
<td style="text-align: left;">Microsoft</td>
<td style="text-align: left;">2010-04-12</td>
<td style="text-align: left;">2016-01-12</td>
<td style="text-align: left;">N/A</td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> Unsupported</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Web Framework</strong></td>
<td style="text-align: left;">Windows Forms</td>
<td style="text-align: left;">Web Framework</td>
<td style="text-align: left;">4.0</td>
<td style="text-align: left;">Microsoft</td>
<td style="text-align: left;">2010-04-12</td>
<td style="text-align: left;">2029-01-09</td>
<td style="text-align: left;">N/A</td>
<td style="text-align: left;"><span class="icon icon-check" title="Yes/Used/Supported">check_circle</span> Supported</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Database</strong></td>
<td style="text-align: left;">Microsoft SQL Server</td>
<td style="text-align: left;">Database</td>
<td style="text-align: left;">2008 R2 (inferred)</td>
<td style="text-align: left;">Microsoft</td>
<td style="text-align: left;">2010-07-20</td>
<td style="text-align: left;">2014-07-08</td>
<td style="text-align: left;">2019-07-09</td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> Unsupported</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Operating System</strong></td>
<td style="text-align: left;">Windows Server</td>
<td style="text-align: left;">Operating System</td>
<td style="text-align: left;">2008 R2 (inferred)</td>
<td style="text-align: left;">Microsoft</td>
<td style="text-align: left;">2009-10-22</td>
<td style="text-align: left;">2015-01-13</td>
<td style="text-align: left;">2020-01-14</td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> Unsupported</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Development Tool</strong></td>
<td style="text-align: left;">Visual Studio</td>
<td style="text-align: left;">Development Tool</td>
<td style="text-align: left;">2010</td>
<td style="text-align: left;">Microsoft</td>
<td style="text-align: left;">2010-04-12</td>
<td style="text-align: left;">2015-07-20</td>
<td style="text-align: left;">2020-07-14</td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> Unsupported</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Integration Platform</strong></td>
<td style="text-align: left;">SOAP Web Service</td>
<td style="text-align: left;">Integration Platform</td>
<td style="text-align: left;">1.0 (inferred)</td>
<td style="text-align: left;">Internal</td>
<td style="text-align: left;">N/A</td>
<td style="text-align: left;">N/A</td>
<td style="text-align: left;">N/A</td>
<td style="text-align: left;"><span class="icon icon-check" title="Yes/Used/Supported">check_circle</span> Supported</td>
</tr>
</tbody>
</table>
</div>
<h3 id="142-portfolio-strategy">14.2. Portfolio strategy</h3>
This section evaluates the application's position in the IT portfolio using standard classification models.
<div class="table-container">
<table>
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr>
<th style="text-align: left;">Classification</th>
<th style="text-align: left;">Evaluation</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>TIME Classification</strong></td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> <strong>Tolerate/Invest</strong><br><br>The application performs a critical business function (remittance processing) and appears to be stable. However, its underlying technology is obsolete and carries significant security and maintenance risks. It should be tolerated in its current state only for a short period while an investment is made to modernize it. The business value is high, but the technical quality is low.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>6R Classification</strong></td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> <strong>Replatform / Re-architect</strong><br><br>- <strong>Rehost (Lift and Shift)</strong>: Not recommended as a final state, as it does not address the underlying technical debt.<br>- <strong>Replatform</strong>: The recommended strategy. This involves moving the application to a modern platform (e.g., .NET 8 on Azure) with minimal architectural changes, providing a good balance of cost and benefit.<br>- <strong>Re-architect</strong>: The ideal long-term goal. Breaking the monolith into microservices would provide the most agility and scalability but comes with the highest cost and risk. This should be considered as a phase 2 after a successful replatforming.</td>
</tr>
</tbody>
</table>
</div>
---
</div>

</main>
      <p class="ai-disclaimer">This application analysis was performed using Artificial Intelligence (AI). While AI enhances the process, it may still produce inaccuracies, and all results should be carefully reviewed.</p>
      <footer class="footer">
         <div class="footer-container">
            <div class="footer-brand">
               <img src="https://www.cgd.pt/PublishingImages/WSImages/Novo-CGD/logo-ap_Blue.png" alt="CGD Logo" class="footer-logo">
               <span class="footer-wordmark">Caixa. Para todos e para cada um.</span>
            </div>
            <div class="footer-copyright">
               © 2025 Caixa Geral de Depósitos, SA. All rights reserved.
            </div>
            <div class="footer-socials">
               <a href="https://www.cgd.pt/" target="_blank" title="Website">
                  <svg viewBox="0 0 24 24">
                     <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-1 17.93c-3.95-.49-7-3.85-7-7.93 0-.62.08-1.21.21-1.79L9 15v1c0 1.1.9 2 2 2v1.93zm6.9-2.54c-.26-.81-1-1.39-1.9-1.39h-1v-3c0-.55-.45-1-1-1h-2v-2h2c.55 0 1-.45 1-1V7h2c1.1 0 2-.9 2-2v-.41c2.93 1.19 5 4.06 5 7.41 0 2.08-.8 3.97-2.1 5.39z"/>
                  </svg>
               </a>
               <a href="https://www.facebook.com/caixageraldedepositos" target="_blank" title="Facebook">
                  <svg viewBox="0 0 24 24">
                     <path d="M22 12c0-5.52-4.48-10-10-10S2 6.48 2 12c0 4.84 3.44 8.87 8 9.8V15H8v-3h2V9.5C10 7.57 11.57 6 13.5 6H16v3h-1.5c-1.1 0-1.5.9-1.5 1.5V12h3l-.5 3h-2.5v6.8A10.02 10.02 0 0022 12z"/>
                  </svg>
               </a>
               <a href="https://www.youtube.com/user/mediacgd" target="_blank" title="YouTube">
                  <svg viewBox="0 0 24 24">
                     <path d="M21.58 7.19c-.23-.86-.9-1.52-1.76-1.75C18.25 5 12 5 12 5s-6.25 0-7.82.44c-.86.23-1.52.89-1.76 1.75C2 8.75 2 12 2 12s0 3.25.42 4.81c.23.86.9 1.52 1.76 1.75C5.75 19 12 19 12 19s6.25 0 7.82-.44c.86-.23 1.52-.89 1.76-1.75C22 15.25 22 12 22 12s0-3.25-.42-4.81zM10 15V9l5.2 3-5.2 3z"/>
                  </svg>
               </a>
               <a href="https://www.linkedin.com/company/caixageraldedepositos" target="_blank" title="LinkedIn">
                  <svg viewBox="0 0 24 24">
                     <path d="M19 3a2 2 0 012 2v14a2 2 0 01-2 2H5a2 2 0 01-2-2V5a2 2 0 012-2h14zm-7 5H8v8h4v-8zm-2-2h4v-2H8v2zm8 4h-4v4h4v-4zm0-2h-4v-2h4v2z" clip-rule="evenodd" fill-rule="evenodd"/>
                  </svg>
               </a>
               <a href="https://www.instagram.com/caixageraldedepositos" target="_blank" title="Instagram">
                  <svg viewBox="0 0 24 24">
                     <path d="M7.8 2h8.4C19.4 2 22 4.6 22 7.8v8.4a5.8 5.8 0 01-5.8 5.8H7.8C4.6 22 2 19.4 2 16.2V7.8A5.8 5.8 0 017.8 2zm-.2 2A3.6 3.6 0 004 7.6v8.8C4 18.39 5.61 20 7.6 20h8.8c1.99 0 3.6-1.61 3.6-3.6V7.6C20 5.61 18.39 4 16.4 4H7.6zm9.65 1.5a1.25 1.25 0 100 2.5 1.25 1.25 0 000-2.5zM12 7a5 5 0 100 10 5 5 0 000-10zm0 2a3 3 0 110 6 3 3 0 010-6z"/>
                  </svg>
               </a>
            </div>
         </div>
      </footer>
      <button id="back-to-top" title="Back to Top">
      <span class="icon">arrow_upward</span>
      </button>
      
      <!-- Floating Table of Contents -->
      <div id="floating-toc-toggle" class="floating-toc-toggle" title="Table of Contents">
         <span class="icon">toc</span>
      </div>
      
      <div id="floating-toc" class="floating-toc">
         <div class="floating-toc-header">
            <div class="floating-toc-title">
               <span class="icon">toc</span>
               Table of Contents
            </div>
            <button id="floating-toc-close" class="floating-toc-close" title="Close TOC">
               <span class="icon">close</span>
            </button>
         </div>
         <ul id="floating-toc-list" class="floating-toc-list">
            <!-- TOC items will be dynamically generated -->
         </ul>
      </div>

      <!-- Fullscreen Reading Mode -->
      <div id="fullscreen-reading-mode" class="fullscreen-reading-mode">
         <div class="fullscreen-font-controls">
            <button id="font-decrease" class="fullscreen-font-control" title="Decrease font size">
               <span class="icon">text_decrease</span>
            </button>
            <button id="font-increase" class="fullscreen-font-control" title="Increase font size">
               <span class="icon">text_increase</span>
            </button>
         </div>
         
         <div class="fullscreen-reading-controls">
            <button id="fullscreen-tts-btn" class="fullscreen-reading-control" title="Listen to content">
               <span class="icon">play_arrow</span>
            </button>
            <button id="fullscreen-dark-mode-btn" class="fullscreen-reading-control" title="Toggle dark mode">
               <span class="icon">light_mode</span>
            </button>
            <button id="fullscreen-exit-btn" class="fullscreen-reading-control fullscreen-reading-exit" title="Exit fullscreen reading">
               <span class="icon">fullscreen_exit</span>
            </button>
         </div>
         
         <div id="fullscreen-reading-content" class="fullscreen-reading-content">
            <!-- Content will be dynamically populated -->
         </div>
         
         <div id="fullscreen-reading-progress" class="fullscreen-reading-progress">
            Reading progress: 0%
         </div>
      </div>

      <script>
         document.addEventListener('DOMContentLoaded', function() {
             
             // --- INITIALIZATION ---
             function init() {
                 console.log('Starting initialization...');
                 replaceEmojisWithIcons();
                 removeHeadingNumbers();
                 setupTabs(); // This now also calculates and displays read times
                 console.log('About to initialize dark mode...');
                 initDarkMode();
                 console.log('Dark mode initialization complete');
                 initTTS();
                 initBackToTop();
                 initFloatingTOC();
                 initReadingProgress();
                 initFullscreenReading();
                 initBreadcrumbNavigation();
                 
                 // Initialize and render Mermaid diagrams
                 function checkMermaidAvailability() {
                     if (typeof mermaid === 'undefined') {
                         console.error('Mermaid library not loaded. Diagrams will not be rendered.');
                         return false;
                     }
                     console.log('Mermaid version:', mermaid.version || 'Unknown');
                     return true;
                 }
                 
                 if (checkMermaidAvailability()) {
                     try {
                         initializeMermaidRendering();
                         setTimeout(renderMermaidDiagrams, 500);
                     } catch (error) {
                         console.error('Error initializing Mermaid diagrams:', error);
                     }
                 }
             }
             
             // --- FEATURE: DARK MODE ---
             function initDarkMode() {
                 console.log('Initializing dark mode...');
                 const toggleBtn = document.getElementById('dark-mode-toggle');
                 console.log('Toggle button found:', toggleBtn);
                 
                 // Check if the toggle button exists
                 if (!toggleBtn) {
                     console.warn('Dark mode toggle button not found');
                     return;
                 }
                 
                 // Check if the icon element exists inside the button
                 const iconElement = toggleBtn.querySelector('.icon');
                 console.log('Icon element found:', iconElement);
                 if (!iconElement) {
                     console.warn('Dark mode toggle icon not found');
                     return;
                 }
                 
                 const sunIcon = 'light_mode';
                 const moonIcon = 'dark_mode';
         
                 // Check for saved preference and update UI accordingly
                 if (localStorage.getItem('theme') === 'dark') {
                     console.log('Setting dark mode from localStorage');
                     document.documentElement.classList.add('dark-mode');
                     iconElement.textContent = sunIcon;
                     toggleBtn.title = 'Switch to light mode';
                 } else {
                     console.log('Setting light mode');
                     iconElement.textContent = moonIcon;
                     toggleBtn.title = 'Switch to dark mode';
                 }
         
                 console.log('Adding click event listener to dark mode toggle');
                 toggleBtn.addEventListener('click', () => {
                     console.log('Dark mode toggle clicked!');
                     
                     const isDarkMode = document.documentElement.classList.toggle('dark-mode');
                     console.log('Dark mode toggled:', isDarkMode);
                     console.log('Current document classes:', document.documentElement.className);
                     
                     // Update icon and tooltip based on current mode
                     if (isDarkMode) {
                         console.log('Setting sun icon for dark mode');
                         iconElement.textContent = sunIcon;
                         toggleBtn.title = 'Switch to light mode';
                     } else {
                         console.log('Setting moon icon for light mode');
                         iconElement.textContent = moonIcon;
                         toggleBtn.title = 'Switch to dark mode';
                     }
                     
                     localStorage.setItem('theme', isDarkMode ? 'dark' : 'light');
                     console.log('Theme saved to localStorage:', isDarkMode ? 'dark' : 'light');
                     
                     // Update Mermaid theme if the function exists
                     if (typeof updateMermaidTheme === 'function') {
                         updateMermaidTheme();
                     }
                 });
                 
                 console.log('Dark mode initialization completed successfully');
             }
         
             // --- FEATURE: TEXT-TO-SPEECH (TTS) ---
             function initTTS() {
                 const ttsControls = document.getElementById('tts-controls');
                 const playPauseBtn = document.getElementById('tts-play-pause-btn');
                 const stopBtn = document.getElementById('tts-stop-btn');
                 
                 // Check if TTS elements exist
                 if (!ttsControls || !playPauseBtn || !stopBtn) {
                     console.warn('TTS controls not found');
                     return;
                 }
                 
                 const synth = window.speechSynthesis;
         
                 // Always show TTS controls
                 ttsControls.style.display = 'flex';
                 
                 if (!synth) {
                     console.warn("Browser does not support Speech Synthesis.");
                     // Show controls but disable them
                     playPauseBtn.disabled = true;
                     stopBtn.disabled = true;
                     playPauseBtn.title = "Speech synthesis not supported in this browser";
                     stopBtn.title = "Speech synthesis not supported in this browser";
                     return;
                 }
         
                 let utterance = null;
                 
                 console.log("TTS initialized successfully");
         
                 function play() {
                     console.log("TTS play function called");
                     const activePane = document.querySelector('.tab-pane.active');
                     if (!activePane) {
                         console.warn("No active tab pane found");
                         return;
                     }
                     
                     if (synth.speaking) {
                         console.log("Speech synthesis already speaking");
                         return;
                     }
         
                     // Clone to avoid modifying the live DOM, then clean text
                     const contentClone = activePane.cloneNode(true);
                     contentClone.querySelectorAll('h2, h3, h4').forEach(h => h.textContent = h.textContent + '. '); // Add pauses after headings
                     const textToSpeak = contentClone.innerText;
                     
                     console.log("Text to speak length:", textToSpeak.length);
         
                     utterance = new SpeechSynthesisUtterance(textToSpeak);
                     utterance.lang = document.documentElement.lang || 'en-US';
                     utterance.rate = 0.9; // Slightly slower for better comprehension
                     utterance.pitch = 1.0;
                     utterance.volume = 0.8;
         
                     utterance.onstart = () => {
                         console.log("Speech started");
                         playPauseBtn.querySelector('.icon').textContent = 'pause';
                         playPauseBtn.title = 'Pause listening';
                     };
                     utterance.onpause = () => {
                         console.log("Speech paused");
                         playPauseBtn.querySelector('.icon').textContent = 'play_arrow';
                         playPauseBtn.title = 'Resume listening';
                     };
                     utterance.onresume = () => {
                         console.log("Speech resumed");
                         playPauseBtn.querySelector('.icon').textContent = 'pause';
                         playPauseBtn.title = 'Pause listening';
                     };
                     utterance.onend = () => {
                         console.log("Speech ended");
                         playPauseBtn.querySelector('.icon').textContent = 'play_arrow';
                         playPauseBtn.title = 'Listen to this section';
                         utterance = null;
                     };
                     utterance.onerror = (event) => {
                         console.error("Speech synthesis error:", event);
                         playPauseBtn.querySelector('.icon').textContent = 'play_arrow';
                         playPauseBtn.title = 'Listen to this section';
                         utterance = null;
                     };
                     
                     synth.speak(utterance);
                 }
         
                 function togglePlayPause() {
                     console.log("TTS toggle play/pause clicked");
                     console.log("Current state - speaking:", synth.speaking, "paused:", synth.paused);
                     
                     if (synth.speaking && !synth.paused) {
                         console.log("Pausing speech");
                         synth.pause();
                     } else if (synth.paused) {
                         console.log("Resuming speech");
                         synth.resume();
                     } else {
                         console.log("Starting new speech");
                         play();
                     }
                 }
         
                 function stop() {
                     console.log("TTS stop clicked");
                     synth.cancel(); // Also triggers 'onend'
                 }
         
                 playPauseBtn.addEventListener('click', togglePlayPause);
                 stopBtn.addEventListener('click', stop);
                 
                 // Stop speech when user changes tabs
                 document.querySelector('.tab-navigation')?.addEventListener('click', stop);
             }
             
             // --- FEATURE: BACK TO TOP BUTTON ---
             function initBackToTop() {
                 const backToTopButton = document.getElementById('back-to-top');
                 
                 if (!backToTopButton) {
                     console.warn('Back to top button not found');
                     return;
                 }
                 
                 window.addEventListener('scroll', () => {
                     if (window.scrollY > 300) {
                         backToTopButton.classList.add('show');
                     } else {
                         backToTopButton.classList.remove('show');
                     }
                 });
                 backToTopButton.addEventListener('click', () => {
                     window.scrollTo({ top: 0, behavior: 'smooth' });
                 });
             }

             // --- FEATURE: FLOATING TABLE OF CONTENTS ---
             function initFloatingTOC() {
                 const tocToggle = document.getElementById('floating-toc-toggle');
                 const tocContainer = document.getElementById('floating-toc');
                 const tocClose = document.getElementById('floating-toc-close');
                 const tocList = document.getElementById('floating-toc-list');
                 
                 let isInitialized = false;
                 let tocItems = [];
                 let sectionElements = [];
                 
                 function buildTOC() {
                     if (isInitialized) return;
                     
                     // Get all h2 elements from tab panes
                     const tabPanes = document.querySelectorAll('.tab-pane');
                     tocList.innerHTML = '';
                     tocItems = [];
                     sectionElements = [];
                     
                     tabPanes.forEach((pane, index) => {
                         const h2Element = pane.querySelector('h2');
                         if (!h2Element) return;
                         
                         const tocItem = document.createElement('li');
                         tocItem.className = 'floating-toc-item';
                         
                         const tocLink = document.createElement('a');
                         tocLink.className = 'floating-toc-link';
                         tocLink.href = '#';
                         tocLink.textContent = h2Element.textContent.trim();
                         tocLink.dataset.target = h2Element.id || `section-${index}`;
                         
                         const progressIndicator = document.createElement('div');
                         progressIndicator.className = 'floating-toc-progress';
                         const progressFill = document.createElement('div');
                         progressFill.className = 'floating-toc-progress-fill';
                         progressIndicator.appendChild(progressFill);
                         tocLink.appendChild(progressIndicator);
                         
                         tocItem.appendChild(tocLink);
                         tocList.appendChild(tocItem);
                         
                         tocItems.push({
                             link: tocLink,
                             pane: pane,
                             h2: h2Element
                         });
                         
                         sectionElements.push({
                             element: pane,
                             link: tocLink,
                             id: h2Element.id || `section-${index}`
                         });
                         
                         // Add click handler for smooth scrolling to tab
                         tocLink.addEventListener('click', (e) => {
                             e.preventDefault();
                             
                             // Find and activate the corresponding tab
                             const tabButton = document.querySelector(`[data-tab="${pane.id}"]`);
                             if (tabButton) {
                                 tabButton.click();
                                 
                                 // Small delay to ensure tab is active, then scroll to h2
                                 setTimeout(() => {
                                     h2Element.scrollIntoView({
                                         behavior: 'smooth',
                                         block: 'start'
                                     });
                                 }, 100);
                             }
                         });
                     });
                     
                     isInitialized = true;
                 }
                 
                 function updateProgress() {
                     if (!isInitialized || tocItems.length === 0) return;
                     
                     const activeTabPane = document.querySelector('.tab-pane.active');
                     if (!activeTabPane) return;
                     
                     // Find the corresponding TOC item
                     const activeTocItem = tocItems.find(item => item.pane === activeTabPane);
                     
                     // Clear all active states
                     tocItems.forEach(item => {
                         item.link.classList.remove('active', 'reading');
                     });
                     
                     if (activeTocItem) {
                         activeTocItem.link.classList.add('active');
                         
                         // Calculate reading progress for the active section
                         const paneRect = activeTabPane.getBoundingClientRect();
                         const viewportHeight = window.innerHeight;
                         
                         // Consider a section as "reading" if it's visible in viewport
                         if (paneRect.top < viewportHeight && paneRect.bottom > 0) {
                             activeTocItem.link.classList.add('reading');
                         }
                     }
                 }
                 
                 function showTOC() {
                     buildTOC();
                     tocContainer.classList.add('show');
                     tocToggle.classList.remove('show');
                     updateProgress();
                 }
                 
                 function hideTOC() {
                     tocContainer.classList.remove('show');
                     tocToggle.classList.add('show');
                 }
                 
                 // Event listeners
                 tocToggle.addEventListener('click', showTOC);
                 tocClose.addEventListener('click', hideTOC);
                 
                 // Close TOC when clicking outside
                 document.addEventListener('click', (e) => {
                     if (!tocContainer.contains(e.target) && !tocToggle.contains(e.target)) {
                         if (tocContainer.classList.contains('show')) {
                             hideTOC();
                         }
                     }
                 });
                 
                 // Show/hide toggle button on scroll
                 window.addEventListener('scroll', () => {
                     if (window.scrollY > 500) {
                         if (!tocContainer.classList.contains('show')) {
                             tocToggle.classList.add('show');
                         }
                     } else {
                         tocToggle.classList.remove('show');
                         tocContainer.classList.remove('show');
                     }
                     
                     updateProgress();
                 });
                 
                 // Update progress when tabs change
                 const tabNavigation = document.querySelector('.tab-navigation');
                 if (tabNavigation) {
                     tabNavigation.addEventListener('click', () => {
                         setTimeout(updateProgress, 100);
                     });
                 }
                 
                 // Handle ESC key to close TOC
                 document.addEventListener('keydown', (e) => {
                     if (e.key === 'Escape' && tocContainer.classList.contains('show')) {
                         hideTOC();
                     }                 });
             }

             // --- FEATURE: READING PROGRESS INDICATOR ---
             function initReadingProgress() {
                 const progressBar = document.getElementById('reading-progress');
                 const progressFill = document.getElementById('reading-progress-fill');
                 const progressText = document.getElementById('reading-progress-text');
                 
                 let isVisible = false;
                 
                 function updateProgress() {
                     // Get the active tab content to calculate progress within that tab
                     const activeTabPane = document.querySelector('.tab-pane.active');
                     if (!activeTabPane) return;
                     
                     const rect = activeTabPane.getBoundingClientRect();
                     const tabTop = activeTabPane.offsetTop;
                     const tabHeight = activeTabPane.offsetHeight;
                     const headerHeight = document.querySelector('.header').offsetHeight + 
                                         document.querySelector('.tab-navigation-container').offsetHeight;
                     
                     // Calculate scroll position relative to the active tab
                     const scrollTop = window.pageYOffset;
                     const tabStart = tabTop - headerHeight;
                     const tabEnd = tabTop + tabHeight - window.innerHeight;
                     
                     // Calculate progress percentage for the current tab
                     let progress = 0;
                     if (scrollTop <= tabStart) {
                         progress = 0;
                     } else if (scrollTop >= tabEnd) {
                         progress = 100;
                     } else {
                         const scrollableHeight = tabEnd - tabStart;
                         const scrolledHeight = scrollTop - tabStart;
                         progress = Math.min(100, Math.max(0, (scrolledHeight / scrollableHeight) * 100));
                     }
                     
                     // Show progress bar after scrolling starts
                     const shouldShow = scrollTop > 100;
                     
                     if (shouldShow && !isVisible) {
                         progressBar.classList.add('show');
                         progressText.classList.add('show');
                         isVisible = true;
                     } else if (!shouldShow && isVisible) {
                         progressBar.classList.remove('show');
                         progressText.classList.remove('show');
                         isVisible = false;
                     }
                     
                     // Update progress bar and text
                     if (isVisible) {
                         progressFill.style.width = `${progress}%`;
                         progressText.textContent = `${Math.round(progress)}% read`;
                         
                         // Add current section info
                         const activeH2 = activeTabPane.querySelector('h2');
                         if (activeH2) {
                             const sectionTitle = activeH2.textContent.trim();
                             const shortTitle = sectionTitle.length > 25 ? 
                                               sectionTitle.substring(0, 25) + '...' : 
                                               sectionTitle;
                             progressText.textContent = `${Math.round(progress)}% • ${shortTitle}`;
                         }
                     }
                 }
                 
                 // Throttled scroll handler for better performance
                 let ticking = false;
                 function handleScroll() {
                     if (!ticking) {
                         requestAnimationFrame(() => {
                             updateProgress();
                             ticking = false;
                         });
                         ticking = true;
                     }
                 }
                 
                 // Event listeners
                 window.addEventListener('scroll', handleScroll);
                 window.addEventListener('resize', updateProgress);
                 
                 // Update progress when tabs change
                 const tabNavigation = document.querySelector('.tab-navigation');
                 if (tabNavigation) {
                     tabNavigation.addEventListener('click', () => {
                         setTimeout(updateProgress, 150);
                     });
                 }
                 
                 // Initial update
                 updateProgress();
             }

             // --- FEATURE: FULLSCREEN READING MODE ---
             function initFullscreenReading() {
                 const fullscreenBtn = document.getElementById('fullscreen-reading-btn');
                 const fullscreenMode = document.getElementById('fullscreen-reading-mode');
                 const fullscreenContent = document.getElementById('fullscreen-reading-content');
                 const fullscreenProgress = document.getElementById('fullscreen-reading-progress');
                 const exitBtn = document.getElementById('fullscreen-exit-btn');
                 const fontIncreaseBtn = document.getElementById('font-increase');
                 const fontDecreaseBtn = document.getElementById('font-decrease');
                 const fullscreenTtsBtn = document.getElementById('fullscreen-tts-btn');
                 const fullscreenDarkModeBtn = document.getElementById('fullscreen-dark-mode-btn');
                 
                 let currentFontSize = 1.1; // Default font size in rem
                 let isFullscreenActive = false;
                 
                 function enterFullscreenReading() {
                     const activeTabPane = document.querySelector('.tab-pane.active');
                     if (!activeTabPane) return;
                     
                     // Clone the active content
                     const contentClone = activeTabPane.cloneNode(true);
                     
                     // Clean up the cloned content for better reading
                     contentClone.querySelectorAll('.section-read-time').forEach(el => el.remove());
                     contentClone.querySelectorAll('script').forEach(el => el.remove());
                     
                     // Set the content
                     fullscreenContent.innerHTML = contentClone.innerHTML;
                     
                     // Activate fullscreen mode
                     document.body.classList.add('fullscreen-reading');
                     fullscreenMode.classList.add('active');
                     isFullscreenActive = true;
                     
                     // Update dark mode button state
                     const isDarkMode = document.documentElement.classList.contains('dark-mode');
                     fullscreenDarkModeBtn.querySelector('.icon').textContent = isDarkMode ? 'light_mode' : 'dark_mode';
                     fullscreenDarkModeBtn.title = isDarkMode ? 'Switch to light mode' : 'Switch to dark mode';
                     
                     // Initialize progress tracking
                     updateFullscreenProgress();
                     
                     // Prevent body scroll
                     document.body.style.overflow = 'hidden';
                 }
                 
                 function exitFullscreenReading() {
                     document.body.classList.remove('fullscreen-reading');
                     fullscreenMode.classList.remove('active');
                     isFullscreenActive = false;
                     
                     // Restore body scroll
                     document.body.style.overflow = '';
                     
                     // Stop any TTS playback
                     if (window.speechSynthesis) {
                         window.speechSynthesis.cancel();
                     }
                 }
                 
                 function adjustFontSize(increase) {
                     if (increase) {
                         currentFontSize = Math.min(2.0, currentFontSize + 0.1);
                     } else {
                         currentFontSize = Math.max(0.8, currentFontSize - 0.1);
                     }
                     fullscreenContent.style.fontSize = `${currentFontSize}rem`;
                 }
                 
                 function updateFullscreenProgress() {
                     if (!isFullscreenActive) return;
                     
                     const scrollTop = fullscreenMode.scrollTop;
                     const scrollHeight = fullscreenMode.scrollHeight - fullscreenMode.clientHeight;
                     const progress = scrollHeight > 0 ? Math.round((scrollTop / scrollHeight) * 100) : 0;
                     
                     fullscreenProgress.textContent = `Reading progress: ${progress}%`;
                 }
                 
                 function toggleFullscreenTTS() {
                     const synth = window.speechSynthesis;
                     if (!synth) return;
                     
                     if (synth.speaking && !synth.paused) {
                         synth.pause();
                         fullscreenTtsBtn.querySelector('.icon').textContent = 'play_arrow';
                         fullscreenTtsBtn.title = 'Resume listening';
                     } else if (synth.paused) {
                         synth.resume();
                         fullscreenTtsBtn.querySelector('.icon').textContent = 'pause';
                         fullscreenTtsBtn.title = 'Pause listening';
                     } else {
                         // Start new speech
                         const textToSpeak = fullscreenContent.innerText;
                         const utterance = new SpeechSynthesisUtterance(textToSpeak);
                         utterance.lang = document.documentElement.lang || 'en-US';
                         utterance.rate = 0.9;
                         utterance.pitch = 1.0;
                         utterance.volume = 0.8;
                         
                         utterance.onstart = () => {
                             fullscreenTtsBtn.querySelector('.icon').textContent = 'pause';
                             fullscreenTtsBtn.title = 'Pause listening';
                         };
                         
                         utterance.onend = () => {
                             fullscreenTtsBtn.querySelector('.icon').textContent = 'play_arrow';
                             fullscreenTtsBtn.title = 'Listen to content';
                         };
                         
                         utterance.onerror = () => {
                             fullscreenTtsBtn.querySelector('.icon').textContent = 'play_arrow';
                             fullscreenTtsBtn.title = 'Listen to content';
                         };
                         
                         synth.speak(utterance);
                     }
                 }
                 
                 function toggleFullscreenDarkMode() {
                     const isDarkMode = document.documentElement.classList.toggle('dark-mode');
                     fullscreenDarkModeBtn.querySelector('.icon').textContent = isDarkMode ? 'light_mode' : 'dark_mode';
                     fullscreenDarkModeBtn.title = isDarkMode ? 'Switch to light mode' : 'Switch to dark mode';
                     localStorage.setItem('theme', isDarkMode ? 'dark' : 'light');
                 }
                 
                 // Event listeners
                 fullscreenBtn.addEventListener('click', enterFullscreenReading);
                 exitBtn.addEventListener('click', exitFullscreenReading);
                 fontIncreaseBtn.addEventListener('click', () => adjustFontSize(true));
                 fontDecreaseBtn.addEventListener('click', () => adjustFontSize(false));
                 fullscreenTtsBtn.addEventListener('click', toggleFullscreenTTS);
                 fullscreenDarkModeBtn.addEventListener('click', toggleFullscreenDarkMode);
                 
                 // Scroll progress tracking
                 fullscreenMode.addEventListener('scroll', () => {
                     if (isFullscreenActive) {
                         updateFullscreenProgress();
                     }
                 });
                 
                 // Keyboard shortcuts
                 document.addEventListener('keydown', (e) => {
                     if (!isFullscreenActive) return;
                     
                     switch(e.key) {
                         case 'Escape':
                             exitFullscreenReading();
                             break;
                         case 'F':
                         case 'f':
                             if (e.ctrlKey) {
                                 e.preventDefault();
                                 // Could implement search functionality here
                             }
                             break;
                         case '+':
                         case '=':
                             if (e.ctrlKey) {
                                 e.preventDefault();
                                 adjustFontSize(true);
                             }
                             break;
                         case '-':
                             if (e.ctrlKey) {
                                 e.preventDefault();
                                 adjustFontSize(false);
                             }
                             break;
                         case ' ':
                             if (e.ctrlKey) {
                                 e.preventDefault();
                                 toggleFullscreenTTS();
                             }
                             break;
                     }
                 });
                 
                 // Prevent context menu in fullscreen mode
                 fullscreenMode.addEventListener('contextmenu', (e) => {
                     if (isFullscreenActive) {
                         e.preventDefault();
                     }
                 });
             }

             // --- FEATURE: BREADCRUMB NAVIGATION ---
             function initBreadcrumbNavigation() {
                 const breadcrumbContainer = document.getElementById('breadcrumb-container');
                 const breadcrumbHome = document.getElementById('breadcrumb-home');
                 const breadcrumbCurrent = document.getElementById('breadcrumb-current');
                 const breadcrumbProgressFill = document.getElementById('breadcrumb-progress-fill');
                 const breadcrumbProgressText = document.getElementById('breadcrumb-progress-text');
                 const breadcrumbSectionCount = document.getElementById('breadcrumb-section-count');
                 
                 let sections = [];
                 let currentSectionIndex = 0;
                 let isVisible = false;
                 
                 function initializeSections() {
                     const tabPanes = document.querySelectorAll('.tab-pane');
                     sections = Array.from(tabPanes).map((pane, index) => {
                         const h2Element = pane.querySelector('h2');
                         return {
                             id: pane.id,
                             title: h2Element ? h2Element.textContent.trim() : `Section ${index + 1}`,
                             element: pane,
                             index: index
                         };
                     });
                 }
                 
                 function updateBreadcrumb() {
                     const activeTabPane = document.querySelector('.tab-pane.active');
                     if (!activeTabPane || sections.length === 0) return;
                     
                     // Find current section
                     currentSectionIndex = sections.findIndex(section => section.element === activeTabPane);
                     const currentSection = sections[currentSectionIndex];
                     
                     if (!currentSection) return;
                     
                     // Update breadcrumb current section
                     const maxTitleLength = window.innerWidth < 768 ? 25 : 40;
                     const displayTitle = currentSection.title.length > maxTitleLength ? 
                                         currentSection.title.substring(0, maxTitleLength) + '...' : 
                                         currentSection.title;
                     
                     breadcrumbCurrent.innerHTML = `
                         <span class="breadcrumb-link active" title="${currentSection.title}">
                             ${displayTitle}
                         </span>
                     `;
                     
                     // Update section count
                     breadcrumbSectionCount.textContent = `Section ${currentSectionIndex + 1} of ${sections.length}`;
                     
                     // Update progress
                     const progress = Math.round(((currentSectionIndex + 1) / sections.length) * 100);
                     breadcrumbProgressFill.style.width = `${progress}%`;
                     breadcrumbProgressText.textContent = `${progress}%`;
                     
                     // Show/hide breadcrumb based on scroll position
                     const shouldShow = window.scrollY > 200;
                     if (shouldShow && !isVisible) {
                         breadcrumbContainer.classList.add('show');
                         isVisible = true;
                     } else if (!shouldShow && isVisible) {
                         breadcrumbContainer.classList.remove('show');
                         isVisible = false;
                     }
                 }
                 
                 function createSectionBreadcrumb() {
                     const activeTabPane = document.querySelector('.tab-pane.active');
                     if (!activeTabPane) return;
                     
                     // Get current section hierarchy
                     const headings = activeTabPane.querySelectorAll('h2, h3, h4');
                     const currentScroll = window.scrollY + window.innerHeight / 2;
                     let activeHeading = null;
                     
                     // Find the currently visible heading
                     for (let i = headings.length - 1; i >= 0; i--) {
                         const heading = headings[i];
                         const rect = heading.getBoundingClientRect();
                         const absoluteTop = window.scrollY + rect.top;
                         
                         if (absoluteTop <= currentScroll) {
                             activeHeading = heading;
                             break;
                         }
                     }
                     
                     // Build breadcrumb path
                     let breadcrumbPath = '';
                     if (activeHeading && activeHeading.tagName !== 'H2') {
                         const h2 = activeTabPane.querySelector('h2');
                         const headingText = activeHeading.textContent.trim();
                         const maxLength = window.innerWidth < 768 ? 20 : 30;
                         const shortText = headingText.length > maxLength ? 
                                          headingText.substring(0, maxLength) + '...' : 
                                          headingText;
                         
                         breadcrumbPath = `
                             <span class="breadcrumb-separator">›</span>
                             <div class="breadcrumb-item">
                                 <span class="breadcrumb-link" title="${headingText}">
                                     ${shortText}
                                 </span>
                             </div>
                         `;
                     }
                     
                     // Update the breadcrumb current section with subsection info
                     const currentSection = sections[currentSectionIndex];
                     if (currentSection) {
                         const maxTitleLength = window.innerWidth < 768 ? 20 : 30;
                         const displayTitle = currentSection.title.length > maxTitleLength ? 
                                             currentSection.title.substring(0, maxTitleLength) + '...' : 
                                             currentSection.title;
                         
                         breadcrumbCurrent.innerHTML = `
                             <span class="breadcrumb-link active" title="${currentSection.title}">
                                 ${displayTitle}
                             </span>
                             ${breadcrumbPath}
                         `;
                     }
                 }
                 
                 function navigateToSection(sectionIndex) {
                     if (sectionIndex < 0 || sectionIndex >= sections.length) return;
                     
                     const section = sections[sectionIndex];
                     const tabButton = document.querySelector(`[data-tab="${section.id}"]`);
                     
                     if (tabButton) {
                         tabButton.click();
                         setTimeout(() => {
                             section.element.scrollIntoView({
                                 behavior: 'smooth',
                                 block: 'start'
                             });
                         }, 150);
                     }
                 }
                 
                 // Event listeners
                 breadcrumbHome.addEventListener('click', (e) => {
                     e.preventDefault();
                     navigateToSection(0);
                 });
                 
                 // Throttled scroll handler
                 let scrollTicking = false;
                 function handleScroll() {
                     if (!scrollTicking) {
                         requestAnimationFrame(() => {
                             updateBreadcrumb();
                             createSectionBreadcrumb();
                             scrollTicking = false;
                         });
                         scrollTicking = true;
                     }
                 }
                 
                 // Event listeners
                 window.addEventListener('scroll', handleScroll);
                 window.addEventListener('resize', updateBreadcrumb);
                 
                 // Update breadcrumb when tabs change
                 const tabNavigation = document.querySelector('.tab-navigation');
                 if (tabNavigation) {
                     tabNavigation.addEventListener('click', () => {
                         setTimeout(() => {
                             updateBreadcrumb();
                             createSectionBreadcrumb();
                         }, 100);
                     });
                 }
                 
                 // Keyboard navigation
                 document.addEventListener('keydown', (e) => {
                     if (e.altKey) {
                         switch(e.key) {
                             case 'ArrowLeft':
                                 e.preventDefault();
                                 if (currentSectionIndex > 0) {
                                     navigateToSection(currentSectionIndex - 1);
                                 }
                                 break;
                             case 'ArrowRight':
                                 e.preventDefault();
                                 if (currentSectionIndex < sections.length - 1) {
                                     navigateToSection(currentSectionIndex + 1);
                                 }
                                 break;
                             case 'Home':
                                 e.preventDefault();
                                 navigateToSection(0);
                                 break;
                             case 'End':
                                 e.preventDefault();
                                 navigateToSection(sections.length - 1);
                                 break;
                         }
                     }
                 });
                 
                 // Initialize after tabs are set up
                 setTimeout(() => {
                     initializeSections();
                     updateBreadcrumb();
                     createSectionBreadcrumb();
                 }, 200);
             }

             // --- FEATURE: READ TIME CALCULATION ---
             function calculateAndDisplayReadTime() {
                 const wordsPerMinute = 225;
                 
                 function calculate(element) {
                     if (!element) return 0;
                     const text = element.innerText || '';
                     const wordCount = text.trim().split(/\s+/).length;
                     const minutes = Math.ceil(wordCount / wordsPerMinute);
                     return minutes;
                 }
                 
                 // Calculate reading time for each section and sum them up
                 let totalMinutes = 0;
         
                 // Calculate for each section and add after the description paragraph
                 document.querySelectorAll('.tab-pane').forEach(pane => {
                     const sectionMinutes = calculate(pane);
                     
                     // Add this section's reading time to the total
                     totalMinutes += sectionMinutes;
                     
                     const h2Element = pane.querySelector('h2');
                     
                     if (h2Element && sectionMinutes > 0) {
                         // Remove any existing read time elements
                         const existingReadTime = pane.querySelector('.section-read-time');
                         if (existingReadTime) {
                             existingReadTime.remove();
                         }
                         
                         // Find the first paragraph after the h2 (section description)
                         let insertionPoint = h2Element.nextSibling;
                         let firstParagraph = null;
                         
                         // Walk through siblings to find the first paragraph
                         while (insertionPoint) {
                             if (insertionPoint.nodeType === 1 && insertionPoint.tagName === 'P') {
                                 firstParagraph = insertionPoint;
                                 break;
                             }
                             insertionPoint = insertionPoint.nextSibling;
                         }
                         
                         // Create new read time element
                         const readTimeDiv = document.createElement('div');
                         readTimeDiv.className = 'section-read-time';
                         readTimeDiv.style.cssText = 'margin: 0.5rem 0 1rem 0; color: var(--text-secondary); font-size: 0.875rem; display: flex; align-items: center; gap: 0.25rem;';
                         
                         const clockIcon = document.createElement('span');
                         clockIcon.className = 'icon';
                         clockIcon.textContent = 'schedule';
                         clockIcon.style.fontSize = '18px';
                         
                         const readTimeText = document.createElement('span');
                         readTimeText.textContent = `${sectionMinutes} min read`;
                         
                         readTimeDiv.appendChild(clockIcon);
                         readTimeDiv.appendChild(readTimeText);
                         
                         // Insert after the first paragraph if found, otherwise after h2
                         if (firstParagraph) {
                             firstParagraph.parentNode.insertBefore(readTimeDiv, firstParagraph.nextSibling);
                         } else {
                             h2Element.parentNode.insertBefore(readTimeDiv, h2Element.nextSibling);
                         }
                     }
                 });
                 
                 // Update the total reading time in the product header
                 const totalReadTimeEl = document.getElementById('total-read-time').querySelector('span:last-child');
                 totalReadTimeEl.textContent = `${totalMinutes} min read`;
             }
         
             // --- UTILITY: EMOJI REPLACEMENT ---
             function replaceEmojisWithIcons() {
                 const emojiToIconMap = {
                     '🔴': '<span class="icon icon-high" title="High/Critical">dangerous</span>',
                     '🟠': '<span class="icon icon-medium" title="Medium/Warning">warning</span>',
                     '🟢': '<span class="icon icon-low" title="Low/Info">recommend</span>',
                     '✅': '<span class="icon icon-check" title="Yes/Used/Supported">check_circle</span>',
                     '❌': '<span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span>',
                     '🔴': '<span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span>',
                     '❔': '<span class="icon icon-question" title="Uncertain/Likely">help</span>'
                 };
                 const emojiRegex = new RegExp(Object.keys(emojiToIconMap).join('|'), 'g');
                 function walkDOM(node) {
                     if (node.nodeType === 3) {
                         if (emojiRegex.test(node.nodeValue)) {
                             const tempWrapper = document.createElement('span');
                             tempWrapper.innerHTML = node.nodeValue.replace(emojiRegex, match => emojiToIconMap[match]);
                             node.parentNode.replaceChild(tempWrapper, node);
                         }
                     } else if (node.nodeType === 1 && node.nodeName !== 'SCRIPT' && node.nodeName !== 'STYLE') {
                         for (let i = 0; i < node.childNodes.length; i++) {
                             walkDOM(node.childNodes[i]);
                         }
                     }
                 }
                 walkDOM(document.getElementById('main-content-area'));
             }
         
             // --- UTILITY: HEADING CLEANUP ---
             function removeHeadingNumbers() {
                 const headings = document.querySelectorAll('h2, h3, h4, h5, h6');
                 const numberPrefixRegex = /^\d+\.[\d\.]*\s*/;
                 headings.forEach(heading => {
                     const firstChild = heading.childNodes[0];
                     if (firstChild && firstChild.nodeType === 3) {
                         firstChild.nodeValue = firstChild.nodeValue.replace(numberPrefixRegex, '').trim();
                     }
                 });
             }
         
             // --- CORE SETUP: TABS ---
             function setupTabs() {
                 const mainContent = document.getElementById('main-content-area');
                 const tabPlaceholder = document.getElementById('tab-container-placeholder');
                 const sections = Array.from(mainContent.querySelectorAll('.product-section'));
                 
                 if (sections.length > 0) {
                     const tabContainer = document.createElement('div');
                     tabContainer.className = 'tab-navigation-container';
                     const tabNavScroller = document.createElement('div');
                     tabNavScroller.className = 'tab-nav-scroller';
                     const tabNav = document.createElement('nav');
                     tabNav.className = 'tab-navigation';
                     const tabContent = document.createElement('div');
                     tabContent.className = 'tab-content';
         
                     let tabCounter = 0; // Separate counter for actual tabs created
         
                     sections.forEach((section, index) => {
                         const headingElement = section.querySelector('h2');
                         if (!headingElement) return;
                         
                         tabCounter++; // Increment only when a tab is actually created
                         const tabPaneId = `pane-${tabCounter}`;
                         const tabButton = document.createElement('button');
                         tabButton.className = 'tab-link';
                         const tabText = document.createElement('span');
                         tabText.textContent = headingElement.textContent.trim();
                         tabButton.appendChild(tabText);
                         tabButton.setAttribute('data-tab', tabPaneId);
                         tabNav.appendChild(tabButton);
                         
                         const tabPane = document.createElement('div');
                         tabPane.id = tabPaneId;
                         tabPane.className = 'tab-pane';
                         tabPane.appendChild(section);
                         tabContent.appendChild(tabPane);
         
                         if (tabCounter === 1) { // First actual tab created
                             tabButton.classList.add('active');
                             tabPane.classList.add('active');
                         }
                     });
         
                     tabNavScroller.appendChild(tabNav);
                     tabContainer.appendChild(tabNavScroller);
                     tabPlaceholder.appendChild(tabContainer);
                     mainContent.appendChild(tabContent);
         
                     tabNav.addEventListener('click', (e) => {
                         const clickedTab = e.target.closest('.tab-link');
                         if (!clickedTab) return;
                         tabNav.querySelectorAll('.tab-link').forEach(tab => tab.classList.remove('active'));
                         tabContent.querySelectorAll('.tab-pane').forEach(pane => pane.classList.remove('active'));
                         clickedTab.classList.add('active');
                         document.getElementById(clickedTab.dataset.tab)?.classList.add('active');
                     });
         
                     // After tabs are in the DOM, calculate read times
                     calculateAndDisplayReadTime();
                 }
             }
         
             function detectDiagramType(code) {
                 const trimmedCode = code.trim().toLowerCase();
                 
                 if (trimmedCode.startsWith('graph') || trimmedCode.startsWith('flowchart')) return 'flowchart';
                 if (trimmedCode.startsWith('sequencediagram')) return 'sequence';
                 if (trimmedCode.startsWith('classdiagram')) return 'class';
                 if (trimmedCode.startsWith('statediagram')) return 'state';
                 if (trimmedCode.startsWith('erdiagram')) return 'er';
                 if (trimmedCode.startsWith('gantt')) return 'gantt';
                 if (trimmedCode.startsWith('journey')) return 'user-journey';
                 if (trimmedCode.startsWith('gitgraph')) return 'git';
                 if (trimmedCode.startsWith('pie')) return 'pie';
                 if (trimmedCode.startsWith('mindmap')) return 'mindmap';
                 if (trimmedCode.startsWith('timeline')) return 'timeline';
                 if (trimmedCode.startsWith('zenuml')) return 'zenuml';
                 if (trimmedCode.startsWith('quadrantchart')) return 'quadrant';
                 if (trimmedCode.startsWith('xychart')) return 'xy-chart';
                 if (trimmedCode.startsWith('block')) return 'block';
                 if (trimmedCode.startsWith('packet')) return 'packet';
                 if (trimmedCode.startsWith('treemap')) return 'treemap';
                 
                 return 'unknown';
             }
             
             function validateAndFixMermaidSyntax(code) {
                 let fixedCode = code.trim();
                 
                 // First, decode HTML entities that might cause parsing issues
                 fixedCode = fixedCode
                     .replace(/&amp;/g, '&')
                     .replace(/&lt;br&gt;/g, '<br>') // Handle HTML line breaks first
                     .replace(/&lt;/g, '<')
                     .replace(/&gt;/g, '>')
                     .replace(/&#39;/g, "'")
                     .replace(/&quot;/g, '"')
                     .replace(/&nbsp;/g, ' ')
                     .replace(/&apos;/g, "'");
                 
                 // Detect diagram type
                 const diagramType = detectDiagramType(fixedCode);
                 
                 // Handle unknown diagram types by converting to flowchart if possible
                 if (diagramType === 'unknown') {
                     console.warn('Unknown diagram type, attempting to render as-is');
                 }
                 
                 // Fix common syntax issues based on diagram type
                 switch (diagramType) {
                     case 'flowchart':
                         // Ensure flowchart has proper direction
                         if (!fixedCode.match(/(TD|TB|BT|RL|LR)/)) {
                             fixedCode = fixedCode.replace(/^(flowchart|graph)/, '$1 TD');
                         }
                         
                         // Fix specific pattern: node labels with <br> and file paths
                         // This pattern is causing the parser error: [Label<br>/path/file.xhtml]
                         fixedCode = fixedCode.replace(/\[([^\[\]]*)<br>([^\[\]]*)\]/g, (match, label, path) => {
                             // Clean the label and path, replace problematic characters
                             const cleanLabel = label.trim();
                             const cleanPath = path.trim()
                                 .replace(/\//g, '∕') // Replace forward slashes with math division symbol
                                 .replace(/\./g, '·'); // Replace dots with middle dot
                             return `["${cleanLabel}\\n${cleanPath}"]`; // Use quoted strings for safety
                         });
                         
                         // Handle similar pattern in parentheses
                         fixedCode = fixedCode.replace(/\(([^\(\)]*)<br>([^\(\)]*)\)/g, (match, label, path) => {
                             const cleanLabel = label.trim();
                             const cleanPath = path.trim()
                                 .replace(/\//g, '∕')
                                 .replace(/\./g, '·');
                             return `("${cleanLabel}\\n${cleanPath}")`;
                         });
                         
                         // Fix node labels with parentheses that can cause parsing issues
                         // Pattern: A[Label (with parentheses)] --> B
                         fixedCode = fixedCode.replace(/(\w+)\[([^\[\]]*\([^\[\]]*\)[^\[\]]*)\]/g, (match, nodeId, label) => {
                             // Wrap labels containing parentheses in quotes
                             const cleanLabel = label.replace(/"/g, '\\"'); // Escape existing quotes
                             return `${nodeId}["${cleanLabel}"]`;
                         });
                         
                         // Fix incomplete arrow syntax - ensure arrows have proper targets
                         // Pattern: A[Label] - (incomplete arrow at end of line)
                         fixedCode = fixedCode.replace(/(\w+\[[^\]]+\]|\w+\([^)]+\)|\w+)\s+--?\s*$/gm, (match, source) => {
                             // If we find an incomplete arrow at end of line, remove it entirely
                             console.warn('Removing incomplete arrow syntax:', match.trim());
                             return source.trim();
                         });
                         
                         // Fix common arrow syntax issues
                         fixedCode = fixedCode
                             .replace(/--&gt;/g, '-->')  // Fix any remaining HTML entities in arrows
                             .replace(/-->/g, ' --> ') // Ensure proper spacing around arrows
                             .replace(/\s+-->\s+/g, ' --> ') // Clean up multiple spaces
                             .replace(/\[\s+/g, '[') // Remove extra spaces after opening brackets
                             .replace(/\s+\]/g, ']') // Remove extra spaces before closing brackets
                             .replace(/\(\s+/g, '(') // Remove extra spaces after opening parentheses
                             .replace(/\s+\)/g, ')') // Remove extra spaces before closing parentheses
                             .replace(/\{\s+/g, '{') // Remove extra spaces after opening braces
                             .replace(/\s+\}/g, '}'); // Remove extra spaces before closing braces
                         
                         // Handle any remaining line breaks in node labels
                         fixedCode = fixedCode.replace(/<br>/gi, '\\n'); // Convert HTML breaks to Mermaid line breaks
                         
                         break;
                         
                     case 'mindmap':
                         // Ensure mindmap has proper structure
                         if (!fixedCode.includes('root(')) {
                             // If incomplete mindmap, add basic structure
                             const lines = fixedCode.split('\n');
                             if (lines.length > 1 && lines[0].trim() === 'mindmap') {
                                 // Wrap content in root node
                                 const content = lines.slice(1).join('\n').trim();
                                 if (content) {
                                     fixedCode = `mindmap\n  root((${content.split('\n')[0] || 'Root'}))\n${content}`;
                                 }
                             }
                         }
                         // Remove or fix invalid icon syntax for older versions
                         fixedCode = fixedCode.replace(/::icon\([^)]+\)/g, '');
                         break;
                         
                     case 'user-journey':
                         // Ensure journey diagram has proper structure
                         if (!fixedCode.includes('title')) {
                             const lines = fixedCode.split('\n');
                             if (lines.length > 1 && lines[0].trim() === 'journey') {
                                 lines.splice(1, 0, '    title User Journey');
                                 fixedCode = lines.join('\n');
                             }
                         }
                         break;
                         
                     case 'timeline':
                         // Timeline diagrams should have proper structure
                         if (!fixedCode.includes('title')) {
                             const lines = fixedCode.split('\n');
                             if (lines.length > 1 && lines[0].trim() === 'timeline') {
                                 lines.splice(1, 0, '  title Timeline');
                                 fixedCode = lines.join('\n');
                             }
                         }
                         break;
                 }
                 
                 // Final cleanup - remove any remaining problematic characters
                 fixedCode = fixedCode
                     .replace(/\r\n/g, '\n') // Normalize line endings
                     .replace(/\r/g, '\n')   // Convert old Mac line endings
                     .split('\n')
                     .map(line => line.trimRight()) // Remove trailing whitespace from each line
                     .join('\n')
                     .replace(/\n\s*\n\s*\n/g, '\n\n'); // Remove excessive blank lines
                 
                 return fixedCode;
             }
             
             // Function to re-render diagrams when theme changes
             function updateMermaidTheme() {
                 const isDarkMode = document.documentElement.classList.contains('dark-mode') || 
                                   document.documentElement.getAttribute('data-theme') === 'dark' ||
                                   window.matchMedia('(prefers-color-scheme: dark)').matches;
                 
                 try {
                     console.log(`Updating Mermaid theme to ${isDarkMode ? 'dark' : 'light'} mode`);
                     
                     // Step 1: Clear all existing rendered containers and reset processed state
                     const containers = document.querySelectorAll('.mermaid-container');
                     const preBlocks = document.querySelectorAll('pre.mermaid');
                     
                     containers.forEach(container => {
                         container.remove();
                     });
                     
                     preBlocks.forEach(preBlock => {
                         preBlock.classList.remove('mermaid-processed');
                         preBlock.style.display = 'block'; // Show original blocks temporarily
                     });
                     
                     // Step 2: Re-initialize Mermaid with new theme configuration
                     initializeMermaidRendering(); // Use the same initialization function as initial load
                     
                     // Step 3: Re-render all diagrams using the complete rendering process
                     setTimeout(() => {
                         renderMermaidDiagrams(); // Use the same rendering function as initial load
                         console.log(`Mermaid theme successfully updated to ${isDarkMode ? 'dark' : 'light'} mode`);
                     }, 100); // Small delay to ensure initialization is complete
                     
                 } catch (error) {
                     console.error('Error updating Mermaid theme:', error);
                 }
             }
         
             // --- RUN EVERYTHING ---
             // Add a small delay to ensure DOM is fully loaded
             setTimeout(() => {
                 init();
             }, 10);
         
         });
      </script>

   </body>
</html>

<!DOCTYPE html>
<html lang="en">
   <head>
      <meta charset="UTF-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <title>Application Technical Profile</title>
      <!-- Google Fonts: Roboto and Material Symbols -->
      <link rel="preconnect" href="https://fonts.googleapis.com">
      <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
      <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
      <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" rel="stylesheet" />
      <!-- Mermaid.js for diagram rendering -->
      <script src="https://cdn.jsdelivr.net/npm/mermaid@11.8.1/dist/mermaid.min.js"></script>
      <script>
         // Simple immediate check for Mermaid availability
         window.addEventListener('load', function() {
            if (typeof mermaid === 'undefined') {
               console.error('Mermaid library failed to load');
            } else {
               console.log('Mermaid library loaded successfully', mermaid.version || 'version unknown');
            }
         });
      </script>
      
      <!-- Critical stylesheet for Material Icons -->
      <style id="material-icons-critical">
         /* Ensure proper icon rendering and prevent emoji conversion */
         .material-symbols-outlined,
         .icon,
         [class*="icon"] {
            font-family: 'Material Symbols Outlined', sans-serif !important;
            font-weight: normal !important;
            font-style: normal !important;
            line-height: 1 !important;
            text-transform: none !important;
            letter-spacing: normal !important;
            word-wrap: normal !important;
            white-space: nowrap !important;
            direction: ltr !important;
            font-feature-settings: 'liga' !important;
            -webkit-font-feature-settings: 'liga' !important;
            -webkit-font-smoothing: antialiased !important;
            font-variant-emoji: text !important;
            text-rendering: optimizeLegibility !important;
            font-size: 20px !important;
            display: inline-flex !important;
            align-items: center !important;
            justify-content: center !important;
         }
         
         /* Specifically target table content icons that might get corrupted during pagination */
         tbody .material-symbols-outlined,
         tbody .icon,
         tbody td .material-symbols-outlined,
         tbody td .icon {
            font-family: 'Material Symbols Outlined', sans-serif !important;
            font-variant-emoji: text !important;
            text-rendering: optimizeLegibility !important;
         }
         
         /* Specifically target pagination icons */
         .pagination-button .material-symbols-outlined,
         .pagination-button .icon {
            font-family: 'Material Symbols Outlined', sans-serif !important;
            font-variant-emoji: text !important;
            font-size: 20px !important;
         }
      </style>
      
      <!-- Table styling and pagination styles -->
      <style>
         /* Common styles */
         * {
            box-sizing: border-box;
         }
         
         body {
            font-family: 'Roboto', sans-serif;
            line-height: 1.5;
            color: #333;
            margin: 0;
            padding: 0;
         }
         
         /* Table container */
         .table-container {
            width: 100%;
            overflow-x: auto;
            margin-bottom: 2rem;
         }
         
         /* Table pagination styles */
         .table-pagination {
            margin-top: 12px;
         }
         
         .pagination-top-controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
         }
         
         .page-size-selector {
            display: flex;
            align-items: center;
         }
         
         .page-size-label {
            margin-right: 8px;
            font-size: 14px;
            color: #555;
            padding-left: 4px;
         }
         
         .page-size-select {
            padding: 4px 8px;
            border-radius: 4px;
            border: 1px solid #ccc;
            min-width: 60px;
         }
         
         .pagination-info {
            font-size: 14px;
            color: #555;
            padding: 4px 0;
            padding-right: 4px;
            text-align: right;
         }
         
         .pagination-nav {
            display: flex;
            justify-content: center;
            align-items: center;
            margin-top: 8px;
         }
         
         .pagination-nav-buttons,
         .pagination-next-buttons {
            display: flex;
            align-items: center;
            justify-content: center;
         }
         
         .pagination-page-numbers {
            display: flex;
            align-items: center;
            margin: 0 10px;
         }
         
         /* Pagination buttons */
         .pagination-button {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            min-width: 36px;
            height: 36px;
            padding: 4px 8px;
            margin: 0 3px;
            border: none;
            border-radius: 50%;
            background: transparent;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.15s ease;
            box-shadow: none;
            color: #5f6368;
            user-select: none;
            outline: none;
         }
         
         .pagination-button:hover:not(:disabled) {
            background-color: rgba(0, 0, 0, 0.04);
         }
         
         .pagination-button:disabled {
            opacity: 0.5;
            cursor: default;
            color: #bdc1c6;
            background: transparent;
         }
         
         .pagination-button.active {
            background-color: #0071ce;
            color: white;
            font-weight: 500;
         }
         
         .pagination-button.ellipsis {
            color: #5f6368;
            pointer-events: none;
         }
         
         /* Table grouping styles */
         .table-group-controls {
            margin-bottom: 16px;
            display: flex;
            flex-wrap: wrap;
            align-items: center;
            padding: 8px 12px;
            background-color: #f8f9fa;
            border-radius: 4px;
            border: 1px solid #e0e0e0;
            transition: background-color 0.2s ease, border-color 0.2s ease;
         }
         
         .group-title {
            margin-right: 16px;
            font-weight: 500;
            display: flex;
            align-items: center;
            color: #333;
            transition: color 0.2s ease;
         }
         
         .group-options {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
         }
         
         .group-option {
            padding: 6px 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            background-color: #fff;
            color: #333;
            cursor: pointer;
            transition: all 0.2s ease;
         }
         
         .group-option:hover:not(.active) {
            background-color: #f0f0f0;
         }
         
         .group-option.active {
            background-color: #0071ce;
            color: #fff;
            border: 1px solid #0071ce;
            font-weight: 500;
         }
         
         .group-header {
            background-color: #f5f7f9;
            transition: background-color 0.2s ease;
         }
         
         .group-header td {
            padding: 0 !important;
         }
         
         .group-header-content {
            display: flex;
            align-items: center;
            padding: 10px;
            background-color: #f5f7f9;
            border-radius: 4px;
            transition: background-color 0.2s ease;
         }
         
         .group-toggle {
            margin-right: 8px;
            color: #0071ce;
            transition: color 0.2s ease;
         }
         
         .group-header-title {
            font-weight: 500;
            color: #333;
            transition: color 0.2s ease;
         }
         
         .group-count {
            margin-left: 12px;
            font-size: 0.85em;
            color: #666;
            background-color: rgba(0, 113, 206, 0.1);
            padding: 2px 8px;
            border-radius: 12px;
            transition: all 0.2s ease;
         }
         
         .collapsed-row {
            display: none !important;
         }
         
         tr.first-in-group td {
            border-top: 1px solid #e0e0e0;
            transition: border-color 0.2s ease;
         }
         
         .group-header:hover {
            background-color: #eef1f5;
         }
         
         .group-tooltip {
            font-size: 0.75em;
            color: #666;
            margin-left: 8px;
            padding: 2px 6px;
            background: rgba(0, 113, 206, 0.08);
            border-radius: 4px;
            transition: all 0.2s ease;
         }

         /* Dark mode styles for table grouping */
         @media (prefers-color-scheme: dark) {
            body {
               background-color: #1a202c !important;
               color: #e2e8f0 !important;
            }
            
            .table-group-controls {
               background-color: #2d3748 !important;
               border: 1px solid #4a5568 !important;
               box-shadow: none !important;
            }
            
            .group-title {
               color: #cbd5e0 !important;
            }
            
            .group-option {
               background-color: #4a5568 !important;
               border: 1px solid #718096 !important;
               color: #e2e8f0 !important;
               box-shadow: none !important;
            }
            
            .group-option:hover:not(.active) {
               background-color: #718096 !important;
               border-color: #a0aec0 !important;
            }
            
            .group-option.active {
               background-color: #3182ce !important;
               color: #ffffff !important;
               border: 1px solid #3182ce !important;
               box-shadow: none !important;
            }
            
            .group-header {
               background-color: #2d3748 !important;
            }
            
            .group-header-content {
               background-color: #2d3748 !important;
            }
            
            .group-toggle {
               color: #4299e1 !important;
            }
            
            .group-header-title {
               color: #e2e8f0 !important;
            }
            
            .group-count {
               color: #cbd5e0 !important;
               background-color: rgba(66, 153, 225, 0.2) !important;
               border: none !important;
            }
            
            tr.first-in-group td {
               border-top: 1px solid #4a5568 !important;
            }
            
            .group-header:hover {
               background-color: #4a5568 !important;
            }
            
            .group-header:hover .group-header-content {
               background-color: #4a5568 !important;
            }
            
            .group-tooltip {
               color: #cbd5e0 !important;
               background: rgba(66, 153, 225, 0.15) !important;
               border: none !important;
            }
         }

         /* Force dark mode styles - Alternative approach */
         .dark-mode body,
         [data-theme="dark"] body {
            background-color: var(--background-main) !important;
            color: var(--text-primary) !important;
         }

         .dark-mode .footer-wordmark{
            color: var(--text-primary) !important;
         }

         .dark-mode .tab-link
         {
            color: var(--text-primary) !important;
            text-decoration: none !important;
            font-weight: 500 !important;
            transition: color 0.2s ease;
         }
         
         .dark-mode .table-group-controls,
         [data-theme="dark"] .table-group-controls {
            background-color: var(--background-main) !important;
            border: 1px solid var(--border-color) !important;
            box-shadow: none !important;
         }
         
         .dark-mode .group-title,
         [data-theme="dark"] .group-title {
            color: var(--text-primary) !important;
         }
         
         .dark-mode .group-option,
         [data-theme="dark"] .group-option {
            background-color: var(--border-color) !important;
            border: none !important;
            color: var(--text-primary) !important;
            box-shadow: none !important;
         }
         
         .dark-mode .group-option:hover:not(.active),
         [data-theme="dark"] .group-option:hover:not(.active) {
            background-color: var(--background-button) !important;
            border-color: none !important;
         }
         
         .dark-mode .group-option.active,
         [data-theme="dark"] .group-option.active {
            background-color: var(--product-accent) !important;
            color: var(--text-primary) !important;
            border: none !important;
            box-shadow: none !important;
         }

         .dark-mode .group-header-content{
            background-color: var(--background-main) !important;
         }

         .dark-mode .group-header-title
         {
            color: var(--text-primary) !important;
         }

         .dark-mode .group-tooltip{
            color: var(--text-primary) !important;
            background-color: var(--border-color) !important;
            border: none !important;
         }

         .dark-mode .group-count{
            background-color: rgba(0, 113, 206, 0.1) !important;
            border: none !important;
            color: rgb(0, 113, 206) !important;
         }

         .dark-mode .floating-toc-link:hover{
            background-color: var(--product-accent) !important;
         }


         .dark-mode .pagination-nav{
            background-color: var(--background-main) !important;          
            border: 1px solid var(--border-color) !important;
            box-shadow: none !important;
         }

         .dark-mode .pagination-button.page-number {
            color: var(--text-primary) !important;
         }

         .dark-mode .pagination-button.page-number.active {
            background-color: var(--product-accent) !important;
            color: var(--text-primary) !important;
            border: none !important;
            box-shadow: none !important;
         }

         .dark-mode .pagination-button.page-number:hover:not(.active) {
            background-color: var(--product-accent) !important;
            border-color: none !important;
            color: var(--text-primary) !important;
         }

         .dark-mode .pagination-button.next, .dark-mode .pagination-button.prev, .dark-mode .pagination-button.first, .dark-mode .pagination-button.last {
            background-color: var(--background-main) !important;
            border-color: none !important;
            color: var(--text-primary) !important;
         }

         /* Enhanced light mode styles for better contrast */
         @media (prefers-color-scheme: light) {
            .table-group-controls {
               background-color: #ffffff;
               border: 1px solid #e2e8f0;
               box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            }
            
            .group-option {
               background-color: #f8f9fa;
               border: 1px solid #d1d5db;
               color: #374151;
               box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05);
            }
            
            .group-option:hover:not(.active) {
               background-color: #e5e7eb;
               border-color: #9ca3af;
            }
            
            .group-option.active {
               background-color: #0071ce;
               color: #ffffff;
               border: 1px solid #0071ce;
               box-shadow: 0 2px 4px rgba(0, 113, 206, 0.2);
            }
            
            .group-count {
               background-color: rgba(0, 113, 206, 0.1);
               border: 1px solid rgba(0, 113, 206, 0.2);
            }
            
            .group-tooltip {
               background: rgba(0, 113, 206, 0.08);
               border: 1px solid rgba(0, 113, 206, 0.15);
            }
         }

         /* MERMAID DIAGRAM THEMING */
         .mermaid-container {
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
            overflow-x: auto;
            text-align: center;
            transition: background-color 0.3s ease, border-color 0.3s ease;
            
            /* Use CSS variables for consistent theming */
            background-color: var(--background-main);
            border: 1px solid var(--border-color);
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
         }

         .mermaid-container svg {
            max-width: 100%;
            height: auto;
            background-color: transparent !important;
         }

         /* Global font styling for all Mermaid diagrams */
         .mermaid-container svg text,
         .mermaid-container svg tspan,
         .mermaid-container svg .nodeLabel,
         .mermaid-container svg .edgeLabel,
         .mermaid-container svg .label,
         .mermaid-container svg .titleText {
            font-family: 'Roboto', 'Segoe UI', Arial, sans-serif !important;
            font-size: 14px !important;
         }

         /* Ensure text visibility in dark mode Mermaid diagrams */
         .dark-mode .mermaid-container svg text,
         [data-theme="dark"] .mermaid-container svg text {
            fill: var(--text-primary) !important;
         }

         .dark-mode .mermaid-container svg .node rect,
         [data-theme="dark"] .mermaid-container svg .node rect {
            stroke: var(--border-color) !important;
         }

         .dark-mode .mermaid-container svg .edgePath path,
         [data-theme="dark"] .mermaid-container svg .edgePath path {
            stroke: var(--border-color) !important;
         }

         /* Light mode Mermaid container */
         @media (prefers-color-scheme: light) {
            .mermaid-container {
               box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            }
         }

         /* Dark mode Mermaid container */
         @media (prefers-color-scheme: dark) {
            .mermaid-container {
               box-shadow: 0 2px 8px rgba(0, 0, 0, 0.5);
            }
         }

         /* Force dark mode Mermaid styling */
         .dark-mode .mermaid-container,
         [data-theme="dark"] .mermaid-container {
            background-color: var(--background-main) !important;
            border: 1px solid var(--border-color) !important;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.5) !important;
         }

         /* Force light mode Mermaid styling */
         .light-mode .mermaid-container,
         [data-theme="light"] .mermaid-container {
            background-color: var(--background-main) !important;
            border: 1px solid var(--border-color) !important;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1) !important;
         }

         /* GOOGLE-LIKE LOADING INDICATOR */
         .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(2px);
            z-index: 9999;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease, visibility 0.3s ease;
         }

         .loading-overlay.show {
            opacity: 1;
            visibility: visible;
         }

         .loading-dots {
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 16px;
         }

         .loading-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background-color: var(--background-button);
            margin: 0 3px;
            animation: pulse 1.5s ease-in-out infinite;
         }

         .loading-dot:nth-child(1) { animation-delay: 0s; }
         .loading-dot:nth-child(2) { animation-delay: 0.2s; }
         .loading-dot:nth-child(3) { animation-delay: 0.4s; }
         .loading-dot:nth-child(4) { animation-delay: 0.6s; }

         .loading-text {
            font-family: 'Roboto', sans-serif;
            font-size: 14px;
            color: var(--text-primary);
            margin-bottom: 8px;
            text-align: center;
         }

         .loading-progress {
            width: 200px;
            height: 4px;
            background-color: #e8eaed;
            border-radius: 2px;
            overflow: hidden;
            position: relative;
         }

         .loading-progress-bar {
            height: 100%;
            background-color:var(--background-button);
            border-radius: 2px;
            position: absolute;
            left: -100%;
            animation: progress 2s ease-in-out infinite;
         }

         /* Dark mode loading overlay */
         .dark-mode .loading-overlay,
         [data-theme="dark"] .loading-overlay {
            background-color: var(--background-main);
         }

         .dark-mode .loading-dot,
         [data-theme="dark"] .loading-dot {
            background-color: var(--background-button);
         }

         .dark-mode .loading-text,
         [data-theme="dark"] .loading-text {
            color: var(--text-primary);
         }

         .dark-mode .loading-progress,
         [data-theme="dark"] .loading-progress {
            background-color: var(--background-main);
         }

         .dark-mode .loading-progress-bar,
         [data-theme="dark"] .loading-progress-bar {
            background-color: var(--background-button);
         }

         /* Animations */
         @keyframes pulse {
            0%, 20% { 
               transform: scale(1); 
               opacity: 1; 
            }
            50% { 
               transform: scale(1.3); 
               opacity: 0.7; 
            }
            80%, 100% { 
               transform: scale(1); 
               opacity: 1; 
            }
         }

         @keyframes progress {
            0% {
               left: -100%;
               width: 0%;
            }
            50% {
               left: 0%;
               width: 100%;
            }
            100% {
               left: 100%;
               width: 0%;
            }
         }

         /* Loading indicator for specific sections */
         .section-loading {
            position: relative;
         }

         .section-loading::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(1px);
            z-index: 100;
            display: flex;
            justify-content: center;
            align-items: center;
         }

         .dark-mode .section-loading::after,
         [data-theme="dark"] .section-loading::after {
            background-color: rgba(26, 32, 44, 0.8);
         }
      </style>
     
      <!-- Table sorting and grouping functionality -->
      <script>
         // --- MERMAID DIAGRAM RENDERING ---
         
         // Loading indicator management
         let loadingTasks = new Set();
         
         function showLoading(message = 'Loading...', taskId = 'default') {
             const overlay = document.getElementById('loadingOverlay');
             const loadingText = document.getElementById('loadingText');
             
             if (overlay && loadingText) {
                 loadingTasks.add(taskId);
                 loadingText.textContent = message;
                 overlay.classList.add('show');
                 console.log(`Loading started: ${message} (task: ${taskId})`);
             }
         }
         
         function hideLoading(taskId = 'default') {
             loadingTasks.delete(taskId);
             console.log(`Loading task completed: ${taskId}, ${loadingTasks.size} tasks remaining`);
             
             // Only hide if no other tasks are running
             if (loadingTasks.size === 0) {
                 const overlay = document.getElementById('loadingOverlay');
                 if (overlay) {
                     // Add a small delay to prevent flicker for quick operations
                     setTimeout(() => {
                         // Double-check that no new tasks were added during the delay
                         if (loadingTasks.size === 0) {
                             overlay.classList.remove('show');
                             console.log(`All loading tasks completed - hiding overlay`);
                         }
                     }, 100); // Reduced delay from 300ms to 100ms
                 }
             }
         }
         
         function updateLoadingMessage(message, taskId = 'default') {
             if (loadingTasks.has(taskId)) {
                 const loadingText = document.getElementById('loadingText');
                 if (loadingText) {
                     loadingText.textContent = message;
                 }
             }
         }

         function initializeMermaidRendering() {
             showLoading('Initializing diagram renderer...', 'mermaid-init');
             
             try {
                 // Detect current theme
                 const isDarkMode = document.documentElement.classList.contains('dark-mode') || 
                                   document.documentElement.getAttribute('data-theme') === 'dark' ||
                                   window.matchMedia('(prefers-color-scheme: dark)').matches;
                 
                 // Get theme-specific configuration
                 const themeConfig = getMermaidThemeConfig(isDarkMode);
                 
                 updateLoadingMessage('Configuring diagram themes...', 'mermaid-init');
                 
                 // Configure Mermaid with comprehensive theme settings
                 mermaid.initialize({
                     startOnLoad: false, // Important! We manually control the rendering
                     securityLevel: 'loose', // Allow all diagram features
                     htmlLabels: true, // Enable HTML labels for better text rendering
                     theme: themeConfig.theme,
                     themeVariables: themeConfig.themeVariables,
                     flowchart: {
                         useMaxWidth: true,
                         htmlLabels: true,
                         curve: 'basis'
                     },
                     sequence: {
                         useMaxWidth: true,
                         wrap: true
                     },
                     class: {
                         useMaxWidth: true
                     },
                     state: {
                         useMaxWidth: true
                     },
                     er: {
                         useMaxWidth: true
                     },
                     journey: {
                         useMaxWidth: true
                     },
                     gantt: {
                         useMaxWidth: true
                     },
                     pie: {
                         useMaxWidth: true
                     },
                     // Simplified configuration - remove complex settings that might cause issues
                     logLevel: 'error',
                     suppressErrorRendering: false
                 });
                 console.log(`Mermaid initialized successfully with ${isDarkMode ? 'dark' : 'light'} theme`);
                 hideLoading('mermaid-init');
             } catch (error) {
                 console.error('Error initializing Mermaid:', error);
                 hideLoading('mermaid-init');
             }
         }

         // Get comprehensive theme configuration for Mermaid
         function getMermaidThemeConfig(isDarkMode) {
             // Get CSS variables from the document
             const rootStyles = getComputedStyle(document.documentElement);
             const backgroundMain = rootStyles.getPropertyValue('--background-main').trim();
             const textPrimary = rootStyles.getPropertyValue('--text-primary').trim();
             const textSecondary = rootStyles.getPropertyValue('--text-secondary').trim();
             const borderColor = rootStyles.getPropertyValue('--border-color').trim();
             const backgroundCard = rootStyles.getPropertyValue('--background-card').trim();
             const backgroundHover = rootStyles.getPropertyValue('--background-hover').trim();
             const productAccent = rootStyles.getPropertyValue('--product-accent').trim();
             
             if (isDarkMode) {
                 return {
                     theme: 'dark',
                     themeVariables: {
                         // Core theme colors using CSS variables
                         darkMode: true,
                         background: backgroundMain,
                         primaryColor: productAccent, // Use the accent color for primary elements
                         primaryTextColor: textPrimary,
                         primaryBorderColor: borderColor,
                         lineColor: borderColor,
                         
                         // Font configuration
                         fontFamily: "'Roboto', 'Segoe UI', Arial, sans-serif",
                         fontSize: '14px',
                         
                         // Secondary colors
                         secondaryColor: backgroundCard,
                         tertiaryColor: backgroundHover,
                         
                         // Text colors - all using CSS variables
                         textColor: textPrimary,
                         darkTextColor: textPrimary,
                         mainBkg: backgroundCard,
                         secondBkg: backgroundHover,
                         tertiaryBkg: backgroundMain,
                         
                         // Node and connector styling
                         nodeBkg: backgroundCard,
                         nodeBorder: borderColor,
                         clusterBkg: backgroundMain,
                         clusterBorder: borderColor,
                         defaultLinkColor: productAccent,
                         titleColor: textPrimary,
                         edgeLabelBackground: backgroundMain,
                         
                         // Specific diagram type colors
                         actorBorder: borderColor,
                         actorBkg: backgroundCard,
                         actorTextColor: textPrimary,
                         actorLineColor: borderColor,
                         signalColor: textPrimary,
                         signalTextColor: textPrimary,
                         
                         // Flowchart colors - readable and distinguishable
                         fillType0: '#4285f4', // Blue - good contrast in dark mode
                         fillType1: '#81c995', // Light green
                         fillType2: '#fdd663', // Yellow
                         fillType3: '#f28b82', // Light red
                         fillType4: '#ce93d8', // Light purple
                         fillType5: '#ffab91', // Light orange
                         fillType6: '#80deea', // Light cyan
                         fillType7: '#a5d6a7', // Another green shade
                         
                         // Class diagram colors
                         classText: textPrimary,
                         
                         // State diagram colors
                         labelColor: textPrimary,
                         altBackground: backgroundCard,
                         
                         // ER diagram colors
                         entityBkg: backgroundCard,
                         entityTextColor: textPrimary,
                         relationLabelColor: textPrimary,
                         
                         // Journey diagram colors
                         taskBkgColor: backgroundCard,
                         taskTextColor: textPrimary,
                         activeTaskBkgColor: productAccent,
                         activeTaskBorderColor: borderColor,
                         gridColor: borderColor,
                         section0: '#4285f4',
                         section1: '#81c995',
                         section2: '#fdd663',
                         section3: '#f28b82'
                     }
                 };
             } else {
                 return {
                     theme: 'default',
                     themeVariables: {
                         // Core theme colors using CSS variables
                         background: backgroundMain,
                         primaryColor: productAccent,
                         primaryTextColor: textPrimary,
                         primaryBorderColor: borderColor,
                         lineColor: borderColor,
                         
                         // Font configuration
                         fontFamily: "'Roboto', 'Segoe UI', Arial, sans-serif",
                         fontSize: '14px',
                         
                         // Secondary colors
                         secondaryColor: backgroundCard,
                         tertiaryColor: backgroundHover,
                         
                         // Text colors - all using CSS variables
                         textColor: textPrimary,
                         darkTextColor: textPrimary,
                         mainBkg: backgroundCard,
                         secondBkg: backgroundHover,
                         tertiaryBkg: backgroundMain,
                         
                         // Node and connector styling
                         nodeBkg: backgroundCard,
                         nodeBorder: borderColor,
                         clusterBkg: backgroundMain,
                         clusterBorder: borderColor,
                         defaultLinkColor: productAccent,
                         titleColor: textPrimary,
                         edgeLabelBackground: backgroundMain,
                         
                         // Specific diagram type colors
                         actorBorder: borderColor,
                         actorBkg: backgroundCard,
                         actorTextColor: textPrimary,
                         actorLineColor: borderColor,
                         signalColor: textPrimary,
                         signalTextColor: textPrimary,
                         
                         // Flowchart colors - readable in light mode
                         fillType0: '#0071ce', // Primary blue
                         fillType1: '#1e8e3e', // Green
                         fillType2: '#f9ab00', // Amber/Yellow
                         fillType3: '#d93025', // Red
                         fillType4: '#9c27b0', // Purple
                         fillType5: '#ff5722', // Deep orange
                         fillType6: '#00acc1', // Cyan
                         fillType7: '#689f38', // Light green
                         
                         // Class diagram colors
                         classText: textPrimary,
                         
                         // State diagram colors
                         labelColor: textPrimary,
                         altBackground: backgroundCard,
                         
                         // ER diagram colors
                         entityBkg: backgroundCard,
                         entityTextColor: textPrimary,
                         relationLabelColor: textPrimary,
                         
                         // Journey diagram colors
                         taskBkgColor: backgroundCard,
                         taskTextColor: textPrimary,
                         activeTaskBkgColor: productAccent,
                         activeTaskBorderColor: borderColor,
                         gridColor: borderColor,
                         section0: '#0071ce',
                         section1: '#1e8e3e',
                         section2: '#f9ab00',
                         section3: '#d93025'
                     }
                 };
             }
         }

         function renderMermaidDiagrams() {
             // Find all mermaid code blocks - be more specific in the selector
             const mermaidBlocks = document.querySelectorAll('pre.mermaid');
             
             if (mermaidBlocks.length === 0) {
                 console.log('No Mermaid diagrams found to render');
                 return;
             }
             
             showLoading(`Preparing ${mermaidBlocks.length} diagram${mermaidBlocks.length > 1 ? 's' : ''}...`, 'mermaid-render');
             console.log(`Found ${mermaidBlocks.length} Mermaid diagrams to render`);
             
             let processedCount = 0;
             let successCount = 0;
             let errorCount = 0;
             
             const updateProgress = () => {
                 processedCount++;
                 updateLoadingMessage(
                     `Rendering diagrams... ${processedCount}/${mermaidBlocks.length} (${successCount} successful, ${errorCount} errors)`,
                     'mermaid-render'
                 );
                 
                 // Hide loading when all diagrams are processed
                 if (processedCount >= mermaidBlocks.length) {
                     clearTimeout(maxTimeout); // Clear the fallback timeout
                     setTimeout(() => {
                         hideLoading('mermaid-render');
                     }, 200); // Small delay to show completion message
                 }
             };
             
             // Set a maximum timeout to ensure loading doesn't hang indefinitely
             const maxTimeout = setTimeout(() => {
                 console.warn('Forcing loading to complete after maximum timeout');
                 hideLoading('mermaid-render');
             }, 30000); // 30 second maximum timeout
             
             mermaidBlocks.forEach((preBlock, index) => {
                 try {
                     // Skip if already processed
                     if (preBlock.classList.contains('mermaid-processed')) {
                         console.log(`Skipping diagram ${index + 1} - already processed`);
                         updateProgress(); // Still count this as processed
                         return;
                     }
                     
                     // Check if there's already a rendered container
                     const existingContainer = preBlock.nextElementSibling?.classList.contains('mermaid-container') ||
                                             preBlock.previousElementSibling?.classList.contains('mermaid-container');
                     if (existingContainer) {
                         console.log(`Skipping diagram ${index + 1} - container already exists`);
                         updateProgress(); // Still count this as processed
                         return;
                     }
                     
                     // Get the code element inside the pre block
                     const codeElement = preBlock.querySelector('code');
                     if (!codeElement) {
                         console.warn(`No code element found in mermaid block ${index + 1}`);
                         errorCount++;
                         updateProgress();
                         return;
                     }
                     
                     // Get the mermaid code content from the code element
                     let mermaidCode = codeElement.textContent || codeElement.innerText;
                     
                     // Skip if empty
                     if (!mermaidCode.trim()) {
                         console.warn(`Empty mermaid code in block ${index + 1}`);
                         errorCount++;
                         updateProgress();
                         return;
                     }
                     
                     // Clean up the code
                     mermaidCode = mermaidCode.trim();
                     
                     // Debug: Log the first few lines of the code to verify content
                     const firstLines = mermaidCode.split('\n').slice(0, 3).join('\n');
                     console.log(`Diagram ${index + 1} content preview:`, firstLines);
                     
                     // Validate this is actually Mermaid syntax, not CSS or other content
                     if (mermaidCode.includes('font-family:') || mermaidCode.includes('keyframes') || mermaidCode.includes('.mermaid-')) {
                         console.error(`Block ${index + 1} contains CSS instead of Mermaid syntax, skipping`);
                         errorCount++;
                         updateProgress();
                         return;
                     }
                     
                     // Validate and fix common syntax issues
                     mermaidCode = validateAndFixMermaidSyntax(mermaidCode);
                     
                     // Detect diagram type for specific handling
                     const diagramType = detectDiagramType(mermaidCode);
                     console.log(`Rendering ${diagramType} diagram ${index + 1}`);
                     
                     // Create a unique ID for this diagram
                     const diagramId = `mermaid-diagram-${index}-${Date.now()}`;
                     
                     // Create container for the rendered diagram with enhanced styling
                     const container = document.createElement('div');
                     container.id = diagramId;
                     container.className = 'mermaid-container';
                     
                     // Apply CSS variable-based styling that adapts to theme
                     const isDarkMode = document.documentElement.classList.contains('dark-mode') || 
                                       document.documentElement.getAttribute('data-theme') === 'dark' ||
                                       window.matchMedia('(prefers-color-scheme: dark)').matches;
                     
                     // Use CSS variables for consistent theming
                     container.style.cssText = `
                         text-align: center;
                         margin: 20px 0;
                         padding: 20px;
                         border: 1px solid var(--border-color);
                         border-radius: 8px;
                         background-color: var(--background-main);
                         box-shadow: ${isDarkMode ? '0 2px 8px rgba(0, 0, 0, 0.5)' : '0 2px 4px rgba(0, 0, 0, 0.1)'};
                         overflow-x: auto;
                         transition: background-color 0.3s ease, border-color 0.3s ease;
                     `;
                     
                     // Insert the container after the pre block
                     preBlock.parentNode.insertBefore(container, preBlock.nextSibling);
                     preBlock.style.display = 'none'; // Hide original but keep for reference
                     
                     // Add timeout to prevent hanging
                     const renderTimeout = setTimeout(() => {
                         console.error(`Rendering timeout for ${diagramType} diagram ${index + 1}`);
                         container.innerHTML = `
                             <div style="color: #ff6b35; padding: 20px; text-align: center;">
                                 <strong>Rendering timeout for ${diagramType} diagram</strong><br>
                                 <small>The diagram took too long to render</small>
                             </div>
                         `;
                         errorCount++;
                         updateProgress();
                     }, 10000); // 10 second timeout
                     
                     // Render the diagram
                     mermaid.render(diagramId + '-svg', mermaidCode)
                         .then(({ svg, bindFunctions }) => {
                             clearTimeout(renderTimeout);
                             container.innerHTML = svg;
                             
                             // Apply bind functions if they exist (for interactive elements)
                             if (bindFunctions) {
                                 try {
                                     bindFunctions(container);
                                 } catch (bindError) {
                                     console.warn('Error applying bind functions:', bindError);
                                 }
                             }
                             
                             // Mark as processed
                             preBlock.classList.add('mermaid-processed');
                             
                             // Add diagram type as data attribute
                             container.setAttribute('data-diagram-type', diagramType);
                             
                             console.log(`Successfully rendered ${diagramType} diagram ${index + 1}`);
                             successCount++;
                             updateProgress();
                         })
                         .catch(error => {
                             clearTimeout(renderTimeout);
                             console.error(`Error rendering ${diagramType} diagram ${index + 1}:`, error);
                             
                             // Show detailed error information
                             const errorDetails = error.message || 'Unknown error occurred';
                             const codePreview = mermaidCode.length > 200 ? 
                                 mermaidCode.substring(0, 200) + '...' : 
                                 mermaidCode;
                             
                             container.innerHTML = `
                                 <div style="color: #d32f2f; padding: 20px; text-align: center; border: 1px solid #d32f2f; border-radius: 4px; background-color: #ffebee;">
                                     <strong>Error rendering ${diagramType} diagram:</strong><br>
                                     <small>${errorDetails}</small><br>
                                     <details style="margin-top: 10px;">
                                         <summary>Show diagram code</summary>
                                         <pre style="text-align: left; background: #f5f5f5; padding: 10px; margin-top: 10px; border-radius: 4px; white-space: pre-wrap; word-wrap: break-word;">${codePreview}</pre>
                                     </details>
                                 </div>
                             `;
                             errorCount++;
                             updateProgress();
                         });
                         
                 } catch (error) {
                     console.error(`Error processing Mermaid block ${index + 1}:`, error);
                     errorCount++;
                     updateProgress();
                 }
             });
             
             // Fallback: if no diagrams were found or processed, hide loading immediately
             if (mermaidBlocks.length === 0) {
                 console.log('No Mermaid diagrams found');
                 clearTimeout(maxTimeout);
                 hideLoading('mermaid-render');
             }
         }

         function detectDiagramType(code) {
             const trimmedCode = code.trim().toLowerCase();
             
             if (trimmedCode.startsWith('graph') || trimmedCode.startsWith('flowchart')) return 'flowchart';
             if (trimmedCode.startsWith('sequencediagram')) return 'sequence';
             if (trimmedCode.startsWith('classdiagram')) return 'class';
             if (trimmedCode.startsWith('statediagram')) return 'state';
             if (trimmedCode.startsWith('erdiagram')) return 'er';
             if (trimmedCode.startsWith('journey')) return 'user-journey';
             if (trimmedCode.startsWith('gantt')) return 'gantt';
             if (trimmedCode.startsWith('pie')) return 'pie';
             if (trimmedCode.startsWith('gitgraph')) return 'gitgraph';
             if (trimmedCode.startsWith('mindmap')) return 'mindmap';
             if (trimmedCode.startsWith('timeline')) return 'timeline';
             if (trimmedCode.startsWith('quadrantchart')) return 'quadrant';
             if (trimmedCode.startsWith('xychart')) return 'xy';
             if (trimmedCode.startsWith('block')) return 'block';
             if (trimmedCode.startsWith('packet')) return 'packet';
             if (trimmedCode.startsWith('tree')) return 'tree';
             
             return 'unknown';
         }

         function validateAndFixMermaidSyntax(code) {
             let fixedCode = code.trim();
             
             // Remove any HTML entities that might cause issues
             fixedCode = fixedCode
                 .replace(/&amp;/g, '&')
                 .replace(/&lt;/g, '<')
                 .replace(/&gt;/g, '>')
                 .replace(/&#39;/g, "'")
                 .replace(/&quot;/g, '"');
             
             return fixedCode;
         }

         // Update Mermaid theme (used for theme switching)
         function updateMermaidTheme() {
             showLoading('Updating diagram themes...', 'theme-update');
             
             try {
                 // Re-initialize Mermaid with new theme
                 initializeMermaidRendering();
                 
                 // Re-render all diagrams
                 const processedDiagrams = document.querySelectorAll('.mermaid-processed');
                 if (processedDiagrams.length > 0) {
                     updateLoadingMessage('Re-rendering diagrams with new theme...', 'theme-update');
                     
                     // Reset processed state
                     processedDiagrams.forEach(diagram => {
                         diagram.classList.remove('mermaid-processed');
                     });
                     
                     // Remove existing rendered containers
                     const containers = document.querySelectorAll('.mermaid-container');
                     containers.forEach(container => container.remove());
                     
                     // Show original code blocks
                     const hiddenBlocks = document.querySelectorAll('pre.mermaid[style*="display: none"]');
                     hiddenBlocks.forEach(block => {
                         block.style.display = '';
                     });
                     
                     // Re-render
                     renderMermaidDiagrams();
                 }
                 
                 hideLoading('theme-update');
             } catch (error) {
                 console.error('Error updating Mermaid theme:', error);
                 hideLoading('theme-update');
             }
         }
      </script>
   </head>
   <body>
      <!-- Google-like Loading Overlay -->
      <div id="loadingOverlay" class="loading-overlay">
         <div class="loading-dots">
            <div class="loading-dot"></div>
            <div class="loading-dot"></div>
            <div class="loading-dot"></div>
            <div class="loading-dot"></div>
         </div>
         <div class="loading-text" id="loadingText">Loading...</div>
         <div class="loading-progress">
            <div class="loading-progress-bar"></div>
         </div>
      </div>

      <script>
         document.addEventListener('DOMContentLoaded', function() {
            showLoading('Initializing application...', 'app-init');
            
            // Apply dark mode detection and styling
            updateLoadingMessage('Applying theme settings...', 'app-init');
            applyThemeDetection();
            
            // Initialize Mermaid diagrams
            if (typeof mermaid !== 'undefined') {
               updateLoadingMessage('Setting up diagram renderer...', 'app-init');
               console.log('Initializing Mermaid diagrams...');
               initializeMermaidRendering();
               renderMermaidDiagrams();
            } else {
               console.warn('Mermaid library not loaded');
            }
            
            // Add sorting capability to all tables
            updateLoadingMessage('Preparing interactive tables...', 'app-init');
            makeTablesSortable();
            
            // Add grouping capability to tables with specific columns
            makeTablesGroupable();
            
            // Add pagination to all tables
            makeTablesPaginated();
            
            hideLoading('app-init');
         });
         
         function applyThemeDetection() {
            // Function to apply dark mode
            function applyDarkMode() {
               document.body.classList.add('dark-mode');
               document.documentElement.setAttribute('data-theme', 'dark');
               console.log('Dark mode applied');
               
               // Update Mermaid diagrams theme
               if (typeof updateMermaidTheme === 'function') {
                  setTimeout(updateMermaidTheme, 100);
               }
            }
            
            // Function to apply light mode
            function applyLightMode() {
               document.body.classList.remove('dark-mode');
               document.documentElement.setAttribute('data-theme', 'light');
               console.log('Light mode applied');
               
               // Update Mermaid diagrams theme
               if (typeof updateMermaidTheme === 'function') {
                  setTimeout(updateMermaidTheme, 100);
               }
            }
            
            // Check for dark mode preference
            if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
               applyDarkMode();
            } else {
               applyLightMode();
            }
            
            // Listen for changes in color scheme preference
            if (window.matchMedia) {
               const mediaQuery = window.matchMedia('(prefers-color-scheme: dark)');
               mediaQuery.addEventListener('change', function(e) {
                  showLoading('Switching theme...', 'theme-switch');
                  
                  if (e.matches) {
                     updateLoadingMessage('Applying dark theme...', 'theme-switch');
                     applyDarkMode();
                  } else {
                     updateLoadingMessage('Applying light theme...', 'theme-switch');
                     applyLightMode();
                  }
                  
                  // Update Mermaid diagrams with new theme
                  if (typeof updateMermaidTheme === 'function') {
                     updateMermaidTheme();
                  }
                  
                  hideLoading('theme-switch');
               });
            }
         }
         
         function makeTablesPaginated() {
            const tables = document.querySelectorAll('.table-container table');
            const defaultPageSize = 20;
            
            tables.forEach((table) => {
                // Skip tables that shouldn't be paginated
                if (table.classList.contains('no-pagination')) {
                    return;
                }
                
                // Mark table as paginated
                table.setAttribute('data-paginated', 'true');
                table.setAttribute('data-page-size', String(defaultPageSize));
                table.setAttribute('data-current-page', '1');
                
                // Ensure the table has necessary DOM structure
                let tbody = table.querySelector('tbody');
                if (!tbody) {
                    tbody = document.createElement('tbody');
                    
                    // Move all rows that aren't in thead to tbody
                    const rows = Array.from(table.querySelectorAll('tr'));
                    const theadRows = Array.from(table.querySelectorAll('thead tr'));
                    
                    rows.forEach(row => {
                        if (!theadRows.includes(row)) {
                            tbody.appendChild(row);
                        }
                    });
                    
                    table.appendChild(tbody);
                }
                
                // Store the original table data for pagination
                storeTableData(table);
                
                // Add pagination controls
                addPaginationControls(table);
                
                // Initial pagination
                paginateTable(table);
            });
         }
         
         function storeTableData(table) {
            // Store original rows for pagination
            const tbody = table.querySelector('tbody');
            if (!tbody) {
                return;
            }
            
            // Get all rows, including potential group headers
            const rows = Array.from(tbody.querySelectorAll('tr'));
            
            // Function to preserve icon data before storing
            const preserveIconData = (element) => {
                if (!element) return;
                
                const icons = element.querySelectorAll('.icon, .material-symbols-outlined, [class*="icon"]');
                icons.forEach((icon, index) => {
                    // Store the original icon text as a data attribute
                    const iconText = icon.textContent.trim();
                    if (iconText) {
                        icon.setAttribute('data-original-icon-text', iconText);
                        icon.setAttribute('data-icon-index', String(index));
                    }
                    
                    // Ensure proper classes and styling
                    if (!icon.classList.contains('material-symbols-outlined')) {
                        icon.classList.add('material-symbols-outlined');
                    }
                });
            };
            
            // Check if we're dealing with grouped data
            const hasGroups = rows.some(row => row.classList.contains('group-header'));
            
            // Clear previous pagination data to prevent stale data issues
            if (table._paginationGroupData) delete table._paginationGroupData;
            if (table._paginationData) delete table._paginationData;
            
            if (hasGroups) {
                // For grouped tables, we store the data differently
                const groupData = [];
                let currentGroup = null;
                let currentRows = [];
                
                rows.forEach(row => {
                    if (row.classList.contains('group-header')) {
                        // If we have a previous group, store it
                        if (currentGroup) {
                            groupData.push({
                                header: currentGroup,
                                rows: currentRows
                            });
                        }
                        // Start a new group
                        currentGroup = row;
                        currentRows = [];
                    } else {
                        // Add row to current group
                        currentRows.push(row);
                    }
                });
                
                // Don't forget to add the last group
                if (currentGroup) {
                    groupData.push({
                        header: currentGroup,
                        rows: currentRows
                    });
                }
                
                // Preserve icon data for all grouped elements
                groupData.forEach(group => {
                    preserveIconData(group.header);
                    group.rows.forEach(row => {
                        preserveIconData(row);
                    });
                });
                
                // Store the grouped data
                table._paginationGroupData = groupData;
            } else {
                // For regular tables, filter out any potential group headers just to be safe
                const dataRows = rows.filter(row => !row.classList.contains('group-header'));
                
                // Preserve icon data for all rows
                dataRows.forEach(row => {
                    preserveIconData(row);
                });
                
                table._paginationData = dataRows;
            }
         }
         
         function addPaginationControls(table) {
            const tableContainer = table.closest('.table-container');
            if (!tableContainer) return;
            
            // Create pagination container
            const paginationContainer = document.createElement('div');
            paginationContainer.className = 'table-pagination';
            
            // Top controls with page size selector
            const topControls = document.createElement('div');
            topControls.className = 'pagination-top-controls';
            
            const pageSizeSelector = document.createElement('div');
            pageSizeSelector.className = 'page-size-selector';
            
            // Get current page size from table attribute
            const currentPageSize = parseInt(table.getAttribute('data-page-size') || '20', 10);
            
            // Create the page size selector with the current value selected
            pageSizeSelector.innerHTML = `
                <span class="page-size-label">Items per page</span>
                <select class="page-size-select">
                    <option value="5" ${currentPageSize === 5 ? 'selected' : ''}>5</option>
                    <option value="10" ${currentPageSize === 10 ? 'selected' : ''}>10</option>
                    <option value="20" ${currentPageSize === 20 ? 'selected' : ''}>20</option>
                    <option value="50" ${currentPageSize === 50 ? 'selected' : ''}>50</option>
                    <option value="100" ${currentPageSize === 100 ? 'selected' : ''}>100</option>
                </select>
            `;
            
            // Add event listener for page size change
            const pageSizeSelect = pageSizeSelector.querySelector('.page-size-select');
            pageSizeSelect.addEventListener('change', function() {
                const newPageSize = parseInt(this.value);
                
                console.log(`Page size change requested: ${newPageSize} (from ${table.getAttribute('data-page-size')})`);
                
                // DEBUG: Let's see what's currently visible before making changes
                const currentlyVisibleRows = table.querySelectorAll('tbody tr');
                console.log(`Currently visible rows: ${currentlyVisibleRows.length}`);
                currentlyVisibleRows.forEach((row, index) => {
                    const firstCell = row.querySelector('td');
                    if (firstCell) {
                        console.log(`Row ${index + 1}: ${firstCell.textContent.trim()}`);
                    }
                });
                
                // Calculate pagination values  
                const oldPageSize = parseInt(table.getAttribute('data-page-size')) || 20;
                const oldCurrentPage = parseInt(table.getAttribute('data-current-page')) || 1;
                
                // Get total rows first
                let totalRows = 0;
                if (table._paginationGroupData) {
                    table._paginationGroupData.forEach(group => totalRows += group.rows.length);
                } else if (table._paginationData) {
                    totalRows = table._paginationData.length;
                }
                
                console.log(`Total rows in data: ${totalRows}`);
                
                // Calculate which item we're currently starting with
                const currentFirstItem = (oldCurrentPage - 1) * oldPageSize + 1;
                const currentLastItem = Math.min(currentFirstItem + oldPageSize - 1, totalRows);
                console.log(`Current view: items ${currentFirstItem} to ${currentLastItem}`);
                
                // For page size changes, we want to show the same starting item
                // but limit to the new page size
                let newCurrentPage = Math.ceil(currentFirstItem / newPageSize);
                const newTotalPages = Math.max(1, Math.ceil(totalRows / newPageSize));
                newCurrentPage = Math.max(1, Math.min(newCurrentPage, newTotalPages));
                
                // Calculate how many items we should actually show
                const newFirstItem = (newCurrentPage - 1) * newPageSize + 1;
                const newLastItem = Math.min(newFirstItem + newPageSize - 1, totalRows);
                
                console.log(`Page size change: totalRows=${totalRows}, oldPage=${oldCurrentPage}/${Math.ceil(totalRows / oldPageSize)}, newPage=${newCurrentPage}/${newTotalPages}`);
                console.log(`New view should show: items ${newFirstItem} to ${newLastItem} (max ${newPageSize} items)`);
                
                // IMPORTANT: If we're changing to a smaller page size, we might need to show fewer items
                // to maintain the same starting point
                const visibleItemsCount = currentLastItem - currentFirstItem + 1;
                const expectedNewItemsCount = Math.min(newPageSize, visibleItemsCount);
                console.log(`Currently showing ${visibleItemsCount} items, new page size allows ${newPageSize}, should show ${expectedNewItemsCount}`);
                
                // If the current view has fewer items than the new page size,
                // we might need to adjust to show the same number of items
                if (visibleItemsCount < newPageSize) {
                    console.log(`Adjusting to show same number of items (${visibleItemsCount}) instead of full page size (${newPageSize})`);
                }
                
                // Set new values
                table.setAttribute('data-page-size', newPageSize);
                table.setAttribute('data-current-page', newCurrentPage);
                
                // Execute pagination immediately to see the result
                setTimeout(() => {
                    console.log('Executing pagination with new settings');
                    
                    paginateTable(table);
                    
                    // NOTE: Removed emoji replacement - let's preserve original content exactly
                    const newVisibleRows = table.querySelectorAll('tbody tr');
                    console.log(`After pagination - visible rows: ${newVisibleRows.length}`);
                    newVisibleRows.forEach((row, index) => {
                        const firstCell = row.querySelector('td');
                        if (firstCell) {
                            console.log(`New Row ${index + 1}: ${firstCell.textContent.trim()}`);
                        }
                    });
                }, 0);
            });
            
            // Pagination info (showing X-Y of Z)
            const paginationInfo = document.createElement('div');
            paginationInfo.className = 'pagination-info';
            
            topControls.appendChild(pageSizeSelector);
            topControls.appendChild(paginationInfo);
            
            // Pagination navigation
            const paginationNav = document.createElement('div');
            paginationNav.className = 'pagination-nav';
            
            // We'll populate the navigation in the updatePaginationControls function
            
            // Add all elements to the container
            paginationContainer.appendChild(topControls);
            paginationContainer.appendChild(paginationNav);
            
            // Add to the DOM after the table
            tableContainer.appendChild(paginationContainer);
            
            // Initial update of pagination controls
            updatePaginationControls(table);
         }
         
         function paginateTable(table) {
            // Make sure we have valid numeric values for page size and current page
            const pageSize = Math.max(1, parseInt(table.getAttribute('data-page-size') || '20', 10));
            let currentPage = Math.max(1, parseInt(table.getAttribute('data-current-page') || '1', 10));
            const tbody = table.querySelector('tbody');
            
            if (!tbody) {
                return;
            }
            
            // Calculate total rows and total pages to make sure current page is valid
            let totalRows = 0;
            
            // Check if we have pagination data at all
            if (!table._paginationGroupData && !table._paginationData) {
                try {
                    storeTableData(table);
                } catch (error) {
                    console.error('Error storing table data:', error);
                    return;
                }
            }
            
            // Ensure we're not dealing with stale grouped data when we should be in ungrouped mode
            // Check if the table has actual group headers in the DOM
            const hasRealGroupHeaders = tbody.querySelector('.group-header') !== null;
            
            // If we have grouped data in memory but no actual group headers in the DOM, 
            // we need to rebuild the pagination data for the ungrouped state
            if (table._paginationGroupData && !hasRealGroupHeaders) {
                delete table._paginationGroupData;
                storeTableData(table);
            }
            
            // Calculate total rows from whichever data structure we have
            if (table._paginationGroupData) {
                table._paginationGroupData.forEach(group => totalRows += group.rows.length);
            } else if (table._paginationData) {
                totalRows = table._paginationData.length;
            } else {
                // Emergency fallback - get what's in the DOM right now
                const visibleRows = tbody.querySelectorAll('tr:not(.group-header)').length;
                totalRows = visibleRows;
                if (totalRows === 0) return; // Nothing to do if no rows
            }
            
            // Ensure we have at least one page
            const totalPages = Math.max(1, Math.ceil(totalRows / pageSize));
            
            // Ensure current page is valid (between 1 and totalPages)
            currentPage = Math.max(1, Math.min(currentPage, totalPages));
            
            // Update the current page attribute if it was adjusted
            if (currentPage !== parseInt(table.getAttribute('data-current-page') || '1', 10)) {
                table.setAttribute('data-current-page', String(currentPage));
            }
            
            // Clear the table body first
            tbody.innerHTML = '';
            
            // SIMPLIFIED APPROACH: Use direct cloning and restore proper Material Icons
            const simpleCloneRow = (originalRow) => {
                if (!originalRow) return null;
                
                // Clone the row
                const cloned = originalRow.cloneNode(true);
                
                // Convert any emojis back to proper Material Icons
                const emojiToIconMap = {
                    '🔴': { iconName: 'cancel', classes: 'icon icon-high', title: 'High/Critical' },
                    '🟠': { iconName: 'warning', classes: 'icon icon-medium', title: 'Medium/Warning' },
                    '🟢': { iconName: 'recommend', classes: 'icon icon-low', title: 'Low/Info' },
                    '✅': { iconName: 'check_circle', classes: 'icon icon-check', title: 'Yes/Used/Supported' },
                    '❌': { iconName: 'cancel', classes: 'icon icon-cross', title: 'No/Not Used/Unsupported' },
                    '❔': { iconName: 'help', classes: 'icon icon-question', title: 'Uncertain/Likely' },
                    '🟡': { iconName: 'warning', classes: 'icon icon-medium', title: 'Medium/Warning' },
                    '⚠️': { iconName: 'warning', classes: 'icon icon-medium', title: 'Medium/Warning' },
                    '⚠': { iconName: 'warning', classes: 'icon icon-medium', title: 'Medium/Warning' },
                    '✓': { iconName: 'check_circle', classes: 'icon icon-check', title: 'Yes/Used/Supported' },
                    '✗': { iconName: 'cancel', classes: 'icon icon-cross', title: 'No/Not Used/Unsupported' },
                    '❓': { iconName: 'help', classes: 'icon icon-question', title: 'Uncertain/Likely' },
                    '🔥': { iconName: 'cancel', classes: 'icon icon-high', title: 'High/Critical' },
                    '⭕': { iconName: 'cancel', classes: 'icon icon-cross', title: 'No/Not Used/Unsupported' },
                    '🛑': { iconName: 'cancel', classes: 'icon icon-high', title: 'High/Critical' }
                };
                
                // Find all text nodes and spans that might contain emojis
                const walker = document.createTreeWalker(
                    cloned,
                    NodeFilter.SHOW_TEXT | NodeFilter.SHOW_ELEMENT,
                    null,
                    false
                );
                
                const nodesToReplace = [];
                let node;
                
                while (node = walker.nextNode()) {
                    if (node.nodeType === Node.TEXT_NODE) {
                        const text = node.textContent;
                        for (const emoji in emojiToIconMap) {
                            if (text.includes(emoji)) {
                                nodesToReplace.push({
                                    node: node,
                                    emoji: emoji,
                                    iconData: emojiToIconMap[emoji],
                                    text: text
                                });
                                break;
                            }
                        }
                    } else if (node.nodeType === Node.ELEMENT_NODE && node.tagName === 'SPAN') {
                        const text = node.textContent.trim();
                        if (emojiToIconMap[text]) {
                            nodesToReplace.push({
                                node: node,
                                emoji: text,
                                iconData: emojiToIconMap[text],
                                isSpan: true
                            });
                        }
                    }
                }
                
                // Replace emojis with proper Material Icons
                nodesToReplace.forEach(replacement => {
                    if (replacement.isSpan) {
                        // Update span content to proper Material Icon name, use correct semantic classes
                        replacement.node.textContent = replacement.iconData.iconName;
                        replacement.node.className = replacement.iconData.classes + ' material-symbols-outlined';
                        replacement.node.title = replacement.iconData.title;
                        
                        // Apply proper Material Icons styling
                        replacement.node.style.fontFamily = "'Material Symbols Outlined', sans-serif";
                        replacement.node.style.fontVariantEmoji = "text";
                    } else {
                        // For text nodes, create new icon span with correct semantic classes
                        const iconSpan = document.createElement('span');
                        iconSpan.className = replacement.iconData.classes + ' material-symbols-outlined';
                        iconSpan.textContent = replacement.iconData.iconName;
                        iconSpan.title = replacement.iconData.title;
                        iconSpan.style.fontFamily = "'Material Symbols Outlined', sans-serif";
                        iconSpan.style.fontVariantEmoji = "text";
                        
                        // Replace the emoji in the text
                        const newText = replacement.text.replace(replacement.emoji, '');
                        if (newText.trim()) {
                            const textNode = document.createTextNode(newText);
                            replacement.node.parentNode.insertBefore(iconSpan, replacement.node);
                            replacement.node.parentNode.insertBefore(textNode, replacement.node);
                        } else {
                            replacement.node.parentNode.insertBefore(iconSpan, replacement.node);
                        }
                        replacement.node.parentNode.removeChild(replacement.node);
                    }
                });
                
                return cloned;
            };
            
            // Check if we're dealing with grouped data
            if (table._paginationGroupData) {
                // For grouped tables, pagination works differently
                const groupData = table._paginationGroupData;
                let totalRows = 0;
                groupData.forEach(group => totalRows += group.rows.length);
                
                // Calculate pagination
                const totalPages = Math.ceil(totalRows / pageSize);
                const startIdx = (currentPage - 1) * pageSize;
                const endIdx = Math.min(startIdx + pageSize, totalRows);
                
                let rowCount = 0;
                let addedRows = 0;
                
                // Add groups and their visible rows
                groupData.forEach(group => {
                    // Check if any rows from this group should be visible
                    const groupStartRow = rowCount;
                    const groupEndRow = rowCount + group.rows.length;
                    
                    // If any rows in this group are visible in the current page
                    if (groupEndRow > startIdx && groupStartRow < endIdx) {
                        // Add the group header
                        const clonedHeader = simpleCloneRow(group.header);
                        tbody.appendChild(clonedHeader);
                        
                        // Add visible rows from this group
                        for (let i = 0; i < group.rows.length; i++) {
                            if (rowCount >= startIdx && rowCount < endIdx) {
                                const clonedRow = simpleCloneRow(group.rows[i]);
                                tbody.appendChild(clonedRow);
                                addedRows++;
                            }
                            rowCount++;
                        }
                    } else {
                        rowCount += group.rows.length;
                    }
                });
                
                // Restore event listeners for group headers
                const groupHeaders = tbody.querySelectorAll('.group-header');
                groupHeaders.forEach(header => {
                    header.addEventListener('click', function() {
                        this.classList.toggle('collapsed');
                        const isCollapsed = this.classList.contains('collapsed');
                        const groupValue = this.getAttribute('data-group');
                        const groupRows = tbody.querySelectorAll(`tr[data-group="${groupValue}"]:not(.group-header)`);
                        
                        groupRows.forEach(row => {
                            if (isCollapsed) {
                                row.classList.add('collapsed-row');
                            } else {
                                row.classList.remove('collapsed-row');
                            }
                        });
                        
                        const icon = this.querySelector('.group-toggle');
                        if (icon) {
                            icon.textContent = isCollapsed ? 'chevron_right' : 'expand_more';
                            icon.className = 'material-symbols-outlined icon group-toggle';
                        }
                    });
                });
            } else {
                // Regular table pagination
                const rows = table._paginationData;
                if (!rows) return;
                
                // Calculate pagination
                const totalPages = Math.ceil(rows.length / pageSize);
                const startIdx = (currentPage - 1) * pageSize;
                const endIdx = Math.min(startIdx + pageSize, rows.length);
                
                // Add visible rows
                for (let i = startIdx; i < endIdx; i++) {
                    const clonedRow = simpleCloneRow(rows[i]);
                    tbody.appendChild(clonedRow);
                }
            }
            
            // Always update pagination controls at the end
            console.log('Calling updatePaginationControls...');
            // Force this to run after the current execution context
            // This ensures the table is fully updated before pagination controls are created
            setTimeout(() => {
                updatePaginationControls(table);
                
                // NOTE: Removed emoji replacement to preserve original content structure
            }, 0);
            console.log('=== Finished paginateTable ===');
         }
         
         function updatePaginationControls(table) {
            console.log('=== Starting updatePaginationControls ===');
            
            const pageSize = parseInt(table.getAttribute('data-page-size')) || 20;
            const currentPage = parseInt(table.getAttribute('data-current-page')) || 1;
            const tableContainer = table.closest('.table-container');
            const paginationContainer = tableContainer.querySelector('.table-pagination');
            
            console.log(`updatePaginationControls: pageSize=${pageSize}, currentPage=${currentPage}`);
            
            if (!paginationContainer) {
                console.error('No pagination container found');
                return;
            }
            
            // Find pagination elements
            const paginationInfo = paginationContainer.querySelector('.pagination-info');
            const paginationNav = paginationContainer.querySelector('.pagination-nav');
            
            // Calculate total rows
            let totalRows = 0;
            if (table._paginationGroupData) {
                table._paginationGroupData.forEach(group => totalRows += group.rows.length);
            } else if (table._paginationData) {
                totalRows = table._paginationData.length;
            }
            
            // Calculate pagination values
            const totalPages = Math.max(1, Math.ceil(totalRows / pageSize));
            const startItem = totalRows === 0 ? 0 : (currentPage - 1) * pageSize + 1;
            const endItem = Math.min(startItem + pageSize - 1, totalRows);
            
            // Update info text
            if (paginationInfo) {
                paginationInfo.textContent = `Showing ${startItem}-${endItem} of ${totalRows}`;
            }
            
            // Clear existing navigation
            if (paginationNav) {
                paginationNav.innerHTML = '';
            }
            
            console.log(`Final pagination state: totalRows=${totalRows}, pageSize=${pageSize}, totalPages=${totalPages}, currentPage=${currentPage}`);
            
            // Always show pagination nav div, but only add buttons if multiple pages
            if (paginationNav) {                
                console.log(`Pagination nav found, totalPages=${totalPages}`);
                
                // Create page buttons regardless of total pages
                // This ensures pagination controls are always visible after page size change
                console.log('Creating page buttons...');
                createPageButtons(paginationNav, currentPage, totalPages, table);
                
                // Make sure the page size selector shows the correct value
                const pageSizeSelect = paginationContainer.querySelector('.page-size-select');
                if (pageSizeSelect && pageSizeSelect.value != pageSize) {
                    console.log(`Updating page size selector from ${pageSizeSelect.value} to ${pageSize}`);
                    pageSizeSelect.value = pageSize;
                } else {
                    console.log(`Page size selector already shows correct value: ${pageSize}`);
                }
            } else {
                console.error('Pagination nav not found!');
            }
            
            console.log('=== Finished updatePaginationControls ===');
         }
         
         function createPageButtons(container, currentPage, totalPages, table) {
            // Validate inputs
            currentPage = Math.max(1, currentPage);
            totalPages = Math.max(1, totalPages);
            
            // Define button styles
            const buttonStyles = `
                border: none;
                background: transparent;
                color: #5f6368;
                padding: 8px 12px;
                margin: 0 2px;
                border-radius: 4px;
                cursor: pointer;
                font-size: 14px;
                font-weight: 500;
                transition: all 0.2s ease;
                display: inline-flex;
                align-items: center;
                justify-content: center;
                min-width: 32px;
                min-height: 32px;
            `;
            
            const disabledButtonStyles = `
                opacity: 0.38;
                cursor: not-allowed;
                pointer-events: none;
            `;
            
            // Ensure we have at least one page
            totalPages = Math.max(1, totalPages);
            
            // Create a div to hold the navigation buttons
            const navButtonsContainer = document.createElement('div');
            navButtonsContainer.className = 'pagination-nav-buttons';
            
            // First page button
            const firstBtn = document.createElement('button');
            firstBtn.className = 'pagination-button first';
            firstBtn.innerHTML = '<span class="material-symbols-outlined icon">first_page</span>';
            firstBtn.title = 'First Page';
            firstBtn.disabled = currentPage === 1;
            firstBtn.style.cssText = buttonStyles + (currentPage === 1 ? disabledButtonStyles : '');
            
            // Immediately fix the icon in this button
            const firstIcon = firstBtn.querySelector('span');
            if (firstIcon) {
                firstIcon.setAttribute('data-original-icon-text', 'first_page');
                firstIcon.style.fontFamily = "'Material Symbols Outlined', sans-serif";
                firstIcon.style.fontVariantEmoji = "text";
            }
            
            // Add hover effect - Updated Google style
            firstBtn.addEventListener('mouseover', function() {
                if (currentPage !== 1) {
                    this.style.backgroundColor = 'rgba(60, 64, 67, 0.08)';
                    this.style.color = '#202124';
                }
            });
            
            firstBtn.addEventListener('mouseout', function() {
                if (currentPage !== 1) {
                    this.style.backgroundColor = 'transparent';
                    this.style.color = '#5f6368';
                }
            });
            firstBtn.addEventListener('click', () => {
                table.setAttribute('data-current-page', '1');
                paginateTable(table);
            });
            navButtonsContainer.appendChild(firstBtn);
            
            // Previous button
            const prevBtn = document.createElement('button');
            prevBtn.className = 'pagination-button prev';
            prevBtn.innerHTML = '<span class="material-symbols-outlined icon">chevron_left</span>';
            prevBtn.title = 'Previous Page';
            prevBtn.disabled = currentPage === 1;
            prevBtn.style.cssText = buttonStyles + (currentPage === 1 ? disabledButtonStyles : '');
            
            // Immediately fix the icon in this button
            const prevIcon = prevBtn.querySelector('span');
            if (prevIcon) {
                prevIcon.setAttribute('data-original-icon-text', 'chevron_left');
                prevIcon.style.fontFamily = "'Material Symbols Outlined', sans-serif";
                prevIcon.style.fontVariantEmoji = "text";
            }
            
            // Add hover effect - Updated Google style
            prevBtn.addEventListener('mouseover', function() {
                if (currentPage !== 1) {
                    this.style.backgroundColor = 'rgba(60, 64, 67, 0.08)';
                    this.style.color = '#202124';
                }
            });
            
            prevBtn.addEventListener('mouseout', function() {
                if (currentPage !== 1) {
                    this.style.backgroundColor = 'transparent';
                    this.style.color = '#5f6368';
                }
            });
            prevBtn.addEventListener('click', () => {
                const newPage = Math.max(1, currentPage - 1);
                table.setAttribute('data-current-page', newPage);
                paginateTable(table);
            });
            navButtonsContainer.appendChild(prevBtn);
            
            // Add the nav buttons container to the main container
            container.appendChild(navButtonsContainer);
            
            // Create a div to hold the page number buttons
            const pageNumbersContainer = document.createElement('div');
            pageNumbersContainer.className = 'pagination-page-numbers';
            pageNumbersContainer.style.display = 'flex';
            pageNumbersContainer.style.alignItems = 'center';
            pageNumbersContainer.style.margin = '0 10px';
            
            // Google-style page numbers (always show current page and some context)
            let startPage = Math.max(1, currentPage - 2);
            let endPage = Math.min(totalPages, startPage + 4);
            
            // Adjust if we're near the end
            if (endPage === totalPages) {
                startPage = Math.max(1, endPage - 4);
            }
            
            // For single page, ensure we show at least that one page
            if (totalPages === 1) {
                startPage = 1;
                endPage = 1;
            }
            
            // Add ellipsis at start if needed
            if (startPage > 1) {
                const ellipsisStart = document.createElement('span');
                ellipsisStart.className = 'pagination-button ellipsis';
                ellipsisStart.style.cssText = `
                    display: inline-flex;
                    align-items: center;
                    justify-content: center;
                    min-width: 36px;
                    height: 36px;
                    margin: 0 4px;
                    font-size: 14px;
                    color: #5f6368;
                `;
                ellipsisStart.textContent = '...';
                pageNumbersContainer.appendChild(ellipsisStart);
            }
            
            // Add page buttons
            for (let i = startPage; i <= endPage; i++) {
                const pageBtn = document.createElement('button');
                pageBtn.className = 'pagination-button page-number';
                pageBtn.style.cssText = buttonStyles;
                
                // Add hover effect - Updated Google style
                pageBtn.addEventListener('mouseover', function() {
                    if (i !== currentPage) {
                        this.style.backgroundColor = 'rgba(60, 64, 67, 0.08)'; // Transparent gray hover effect
                        this.style.color = '#202124';
                    }
                });
                
                pageBtn.addEventListener('mouseout', function() {
                    if (i !== currentPage) {
                        this.style.backgroundColor = 'transparent';
                        this.style.color = '#5f6368';
                    }
                });
                
                if (i === currentPage) {
                    pageBtn.classList.add('active');
                    pageBtn.style.backgroundColor = 'var(--product-accent)'; // Google Blue
                    pageBtn.style.color = 'white';
                    pageBtn.style.fontWeight = '500';
                    pageBtn.style.border = 'none';
                }
                
                pageBtn.textContent = i;
                pageBtn.addEventListener('click', () => {
                    table.setAttribute('data-current-page', i);
                    paginateTable(table);
                });
                pageNumbersContainer.appendChild(pageBtn);
            }
            
            // Add ellipsis at end if needed
            if (endPage < totalPages) {
                const ellipsisEnd = document.createElement('span');
                ellipsisEnd.className = 'pagination-button ellipsis';
                ellipsisEnd.style.cssText = `
                    display: inline-flex;
                    align-items: center;
                    justify-content: center;
                    min-width: 36px;
                    height: 36px;
                    margin: 0 4px;
                    font-size: 14px;
                    color: #5f6368;
                `;
                ellipsisEnd.textContent = '...';
                pageNumbersContainer.appendChild(ellipsisEnd);
            }
            
            // Add the page numbers container to the main container
            container.appendChild(pageNumbersContainer);
            
            // Create a div for the next/last buttons
            const nextButtonsContainer = document.createElement('div');
            nextButtonsContainer.className = 'pagination-next-buttons';
            nextButtonsContainer.style.display = 'flex';
            nextButtonsContainer.style.alignItems = 'center';
            
            // Next button
            const nextBtn = document.createElement('button');
            nextBtn.className = 'pagination-button next';
            nextBtn.innerHTML = '<span class="material-symbols-outlined icon">chevron_right</span>';
            nextBtn.title = 'Next Page';
            nextBtn.disabled = currentPage === totalPages;
            nextBtn.style.cssText = buttonStyles + (currentPage === totalPages ? disabledButtonStyles : '');
            
            // Immediately fix the icon in this button
            const nextIcon = nextBtn.querySelector('span');
            if (nextIcon) {
                nextIcon.setAttribute('data-original-icon-text', 'chevron_right');
                nextIcon.style.fontFamily = "'Material Symbols Outlined', sans-serif";
                nextIcon.style.fontVariantEmoji = "text";
            }
            
            // Add hover effect - Updated Google style
            nextBtn.addEventListener('mouseover', function() {
                if (currentPage !== totalPages) {
                    this.style.backgroundColor = 'rgba(60, 64, 67, 0.08)';
                    this.style.color = '#202124';
                }
            });
            
            nextBtn.addEventListener('mouseout', function() {
                if (currentPage !== totalPages) {
                    this.style.backgroundColor = 'transparent';
                    this.style.color = '#5f6368';
                }
            });
            nextBtn.addEventListener('click', () => {
                const newPage = Math.min(totalPages, currentPage + 1);
                table.setAttribute('data-current-page', newPage);
                paginateTable(table);
            });
            nextButtonsContainer.appendChild(nextBtn);
            
            // Last page button
            const lastBtn = document.createElement('button');
            lastBtn.className = 'pagination-button last';
            lastBtn.innerHTML = '<span class="material-symbols-outlined icon">last_page</span>';
            lastBtn.title = 'Last Page';
            lastBtn.disabled = currentPage === totalPages;
            lastBtn.style.cssText = buttonStyles + (currentPage === totalPages ? disabledButtonStyles : '');
            
            // Immediately fix the icon in this button
            const lastIcon = lastBtn.querySelector('span');
            if (lastIcon) {
                lastIcon.setAttribute('data-original-icon-text', 'last_page');
                lastIcon.style.fontFamily = "'Material Symbols Outlined', sans-serif";
                lastIcon.style.fontVariantEmoji = "text";
            }
            
            // Add hover effect - Updated Google style
            lastBtn.addEventListener('mouseover', function() {
                if (currentPage !== totalPages) {
                    this.style.backgroundColor = 'rgba(60, 64, 67, 0.08)';
                    this.style.color = '#202124';
                }
            });
            
            lastBtn.addEventListener('mouseout', function() {
                if (currentPage !== totalPages) {
                    this.style.backgroundColor = 'transparent';
                    this.style.color = '#5f6368';
                }
            });
            lastBtn.addEventListener('click', () => {
                table.setAttribute('data-current-page', totalPages);
                paginateTable(table);
            });
            nextButtonsContainer.appendChild(lastBtn);
            
            // Add the next buttons container to the main container
            container.appendChild(nextButtonsContainer);
            
            // Fix all icons in the pagination controls
            setTimeout(() => {
                const paginationIcons = container.querySelectorAll('.icon, .material-symbols-outlined');
                paginationIcons.forEach(icon => {
                    if (!icon.classList.contains('material-symbols-outlined')) {
                        icon.classList.add('material-symbols-outlined');
                    }
                    
                    icon.style.fontFamily = "'Material Symbols Outlined', sans-serif";
                    icon.style.fontWeight = "normal";
                    icon.style.fontStyle = "normal";
                    icon.style.fontVariantEmoji = "text"; // Prevent emoji rendering
                    
                    const iconText = icon.textContent.trim();
                    if (iconText) {
                        icon.innerHTML = '';
                        icon.textContent = iconText;
                    }
                });
            }, 0);
         }
         
         function makeTablesSortable() {
            const tables = document.querySelectorAll('.table-container table');
            
            tables.forEach(table => {
               const headers = table.querySelectorAll('th');
               
               headers.forEach((header, index) => {
                  // Skip columns that shouldn't be sortable (you can add a 'no-sort' class to specific headers)
                  if (header.classList.contains('no-sort')) return;
                  
                  // Add sorting indicators and cursor pointer
                  header.style.cursor = 'pointer';
                  header.style.position = 'relative';
                  header.setAttribute('data-sort-direction', '');
                  
                  // Create sort indicator element
                  const sortIndicator = document.createElement('span');
                  sortIndicator.className = 'sort-indicator';
                  sortIndicator.innerHTML = '&nbsp;⇕';
                  sortIndicator.style.fontSize = '0.8em';
                  sortIndicator.style.opacity = '0.6';
                  sortIndicator.style.marginLeft = '5px';
                  sortIndicator.style.display = 'inline-block';
                  header.appendChild(sortIndicator);
                  
                  // Add click event
                  header.addEventListener('click', function() {
                     sortTable(table, index, header);
                  });
               });
            });
         }
         
         function makeTablesGroupable() {
            const tables = document.querySelectorAll('.table-container table');
            
            // For debugging - add a small indicator to help identify if function is running
            console.log('Looking for groupable tables...', tables.length);
            
            tables.forEach((table, tableIndex) => {
               // Make sure the table has a thead
               const thead = table.querySelector('thead');
               if (!thead) return;
               
               const headers = Array.from(thead.querySelectorAll('th'));
               let groupableColumnIndices = [];
               
               // Make all columns groupable
               headers.forEach((header, index) => {
                  // Skip columns that shouldn't be groupable (you can add a 'no-group' class to specific headers)
                  if (header.classList.contains('no-group')) return;
                  
                  const headerText = header.textContent.trim();
                  
                  // Skip empty headers
                  if (headerText !== '') {
                     groupableColumnIndices.push({index: index, name: headerText});
                  }
               });
               
               // If there are any columns to group by, add group controls
               if (groupableColumnIndices.length > 0) {
                  addGroupingControlsToTable(table, groupableColumnIndices);
                  console.log(`Added grouping controls to table ${tableIndex+1} with ${groupableColumnIndices.length} columns`);
               }
            });
         }
         
         function addGroupingControlsToTable(table, groupableColumns) {
            const tableContainer = table.closest('.table-container');
            
            // Remove any existing grouping controls to prevent duplicates
            const existingControls = tableContainer.querySelector('.table-group-controls');
            if (existingControls) {
               existingControls.remove();
            }
            
            // Create grouping control panel with improved styling
            const groupingControls = document.createElement('div');
            groupingControls.className = 'table-group-controls';
            groupingControls.style.display = 'flex';
            groupingControls.style.flexWrap = 'wrap';
            groupingControls.style.alignItems = 'center';
            groupingControls.style.padding = '10px 12px';
            groupingControls.style.backgroundColor = '#f8f9fa';
            groupingControls.style.borderRadius = '4px';
            groupingControls.style.border = '1px solid #e0e0e0';
            
            // Add title with icon
            const groupTitle = document.createElement('div');
            groupTitle.className = 'group-title';
            groupTitle.style.marginRight = '16px';
            groupTitle.style.fontWeight = '500';
            groupTitle.style.display = 'flex';
            groupTitle.style.alignItems = 'center';
            
            const icon = document.createElement('span');
            icon.className = 'material-symbols-outlined';
            icon.textContent = 'filter_list';
            icon.style.marginRight = '6px';
            icon.style.fontSize = '20px';
            icon.style.color = '#0071ce';
            
            const titleText = document.createElement('span');
            titleText.textContent = 'Group by:';
            
            groupTitle.appendChild(icon);
            groupTitle.appendChild(titleText);
            groupingControls.appendChild(groupTitle);
            
            // Add controls for each groupable column
            const groupOptions = document.createElement('div');
            groupOptions.className = 'group-options';
            groupOptions.style.display = 'flex';
            groupOptions.style.flexWrap = 'wrap';
            groupOptions.style.gap = '8px';
            
            // Add "None" option with improved styling
            const noneOption = document.createElement('button');
            noneOption.className = 'group-option active';
            noneOption.textContent = 'None';
            noneOption.style.padding = '6px 12px';
            noneOption.style.border = '1px solid #ddd';
            noneOption.style.borderRadius = '4px';
            noneOption.style.backgroundColor = '#fff';
            noneOption.style.cursor = 'pointer';
            noneOption.style.transition = 'all 0.2s ease';
            
            // Active style
            if (noneOption.classList.contains('active')) {
               noneOption.style.backgroundColor = '#0071ce';
               noneOption.style.color = '#fff';
               noneOption.style.border = '1px solid #0071ce';
            }
            
            noneOption.onclick = function(event) {
               // Prevent event propagation
               event.stopPropagation();
               event.preventDefault();
               
               console.log('None option clicked - Starting grouping reset');
               
               try {
                  // Set this option as active first to provide visual feedback
                  setActiveGroupOption(groupOptions, this);
                  
                  // Add a small delay to ensure UI feedback happens before potentially intensive operation
                  setTimeout(() => {
                     // Ensure we clean up all grouping
                     resetGrouping(table);
                     console.log('None option: grouping reset complete');
                  }, 10);
               } catch (error) {
                  console.error('Error handling None option click:', error);
               }
            };
            
            // Add hover effect
            noneOption.onmouseover = function() {
               if (!this.classList.contains('active')) {
                  this.style.backgroundColor = '#f0f0f0';
               }
            };
            noneOption.onmouseout = function() {
               if (!this.classList.contains('active')) {
                  this.style.backgroundColor = '#fff';
               }
            };
            
            groupOptions.appendChild(noneOption);
            
            // Add column options with the same styling
            groupableColumns.forEach(column => {
               const option = document.createElement('button');
               option.className = 'group-option';
               option.textContent = column.name;
               option.style.padding = '6px 12px';
               option.style.border = '1px solid #ddd';
               option.style.borderRadius = '4px';
               option.style.backgroundColor = '#fff';
               option.style.cursor = 'pointer';
               option.style.transition = 'all 0.2s ease';
               
               // Add hover effect
               option.onmouseover = function() {
                  if (!this.classList.contains('active')) {
                     this.style.backgroundColor = '#f0f0f0';
                  }
               };
               option.onmouseout = function() {
                  if (!this.classList.contains('active')) {
                     this.style.backgroundColor = '#fff';
                  }
               };
               
               option.onclick = (event) => {
                  // Prevent event propagation
                  event.stopPropagation();
                  event.preventDefault();
                  
                  console.log(`Group option clicked: ${column.name}`);
                  groupTableByColumn(table, column.index, column.name);
                  setActiveGroupOption(groupOptions, option);
               };
               groupOptions.appendChild(option);
            });
            
            groupingControls.appendChild(groupOptions);
            
            // Insert controls before the table
            tableContainer.insertBefore(groupingControls, table);
         }
         
         function setActiveGroupOption(container, activeButton) {
            console.log('Setting active group option:', activeButton.textContent);
            
            // Remove active class and reset styles from all buttons
            const buttons = container.querySelectorAll('.group-option');
            buttons.forEach(button => {
               button.classList.remove('active');
               button.style.backgroundColor = '#fff';
               button.style.color = '#333';
               button.style.border = '1px solid #ddd';
            });
            
            // Add active class to the selected button
            activeButton.classList.add('active');
            
            // Apply active styles
            activeButton.style.backgroundColor = '#0071ce';
            activeButton.style.color = '#fff';
            activeButton.style.border = '1px solid #0071ce';
            activeButton.style.fontWeight = '500';
         }
         
         function groupTableByColumn(table, columnIndex, columnName) {
            // Implementation for grouping table by column
            
            // Get all rows except header
            const tbody = table.querySelector('tbody');
            if (!tbody) {
               console.error('No tbody found in table during grouping');
               return;
            }
            
            // First, ensure all existing group headers are removed
            const allRows = Array.from(tbody.querySelectorAll('tr'));
            const dataRows = allRows.filter(row => !row.classList.contains('group-header'));
            const existingGroups = tbody.querySelectorAll('.group-header');
            
            console.log(`Found ${allRows.length} total rows, ${dataRows.length} data rows, ${existingGroups.length} existing group headers`);
            
            // Make sure to remove existing group headers properly
            existingGroups.forEach(group => {
               if (group.parentNode) {
                  group.parentNode.removeChild(group);
               }
            });
            
            // Reset all rows to their default state
            dataRows.forEach(row => {
               row.style.display = '';
               row.removeAttribute('data-group');
               row.classList.remove('first-in-group', 'collapsed-row');
            });
            
            // Group the data - use a new empty object for clean grouping
            const groupedData = {};
            
            dataRows.forEach(row => {
               // Ensure we have the right index
               if (columnIndex >= row.cells.length) {
                  console.warn(`Column index ${columnIndex} out of bounds for row`, row);
                  return;
               }
               
               // Extract only the text content and ignore icons
               const cell = row.cells[columnIndex];
               if (!cell) {
                  console.warn(`No cell found at index ${columnIndex} for row`, row);
                  return;
               }
               
               let cellValue = '';
               
               // Function to extract text nodes only (no icon text)
               function extractTextOnly(element) {
                  // Special case for cells with icons + text pattern like "dangerous High"
                  // Try to find any direct text node that is not within an icon element
                  let directTextContent = '';
                  let hasFoundDirectText = false;
                  
                  // First, check if this is a cell with the specific structure we're targeting
                  // This usually means it has both an icon with text and visible text afterward
                  const iconElements = element.querySelectorAll('.icon, .icon-high, .icon-medium, .icon-low');
                  if (iconElements.length > 0) {
                     // Try to find text nodes that are direct children but not part of icons
                     for (let childNode of element.childNodes) {
                        // Text node that's a direct child
                        if (childNode.nodeType === 3 && childNode.textContent.trim()) {
                           directTextContent += childNode.textContent.trim() + ' ';
                           hasFoundDirectText = true;
                        }
                        // If it's a span that doesn't have icon classes, it might contain our text
                        else if (childNode.nodeType === 1 && 
                                !childNode.classList?.contains('icon') && 
                                !childNode.classList?.contains('icon-high') && 
                                !childNode.classList?.contains('icon-medium') && 
                                !childNode.classList?.contains('icon-low')) {
                           // Only extract text if it doesn't contain icon children
                           if (!childNode.querySelector('.icon')) {
                              directTextContent += childNode.textContent.trim() + ' ';
                              hasFoundDirectText = true;
                           }
                        }
                     }
                  }
                  
                  // If we found direct text, use that (this helps with the specific case of "dangerous High")
                  if (hasFoundDirectText) {
                     return directTextContent.trim();
                  }
                  
                  // Otherwise, use the more generic approach
                  let text = '';
                  for (let node of element.childNodes) {
                     if (node.nodeType === 3) { // Text node
                        text += node.textContent.trim() + ' ';
                     } else if (node.nodeType === 1) { // Element node
                        // Skip icon elements, elements with icon class
                        const classList = node.classList ? Array.from(node.classList) : [];
                        const hasIconClass = classList.some(cls => cls === 'icon' || cls.startsWith('icon-'));
                        const isIcon = hasIconClass || 
                                      node.tagName.toLowerCase() === 'i';
                                    
                        if (!isIcon) {
                           text += extractTextOnly(node);
                        }
                     }
                  }
                  return text;
               }
               
               cellValue = extractTextOnly(cell).trim();
               
               // If we couldn't extract text properly, fallback to full text
               if (!cellValue) {
                  cellValue = cell.textContent.trim();
               }
               
               // Handle empty values specially
               const normalizedValue = cellValue || '(Empty)';
               
               // Create the group if it doesn't exist yet
               if (!groupedData[normalizedValue]) {
                  groupedData[normalizedValue] = [];
               }
               
               // Add the row to the group
               groupedData[normalizedValue].push(row);
            });
            
            // Clear the tbody completely to start fresh
            while (tbody.firstChild) {
               tbody.removeChild(tbody.firstChild);
            }
            
            // Create a sorted array of group values
            const groupValues = Object.keys(groupedData).sort();
            console.log(`Created ${groupValues.length} groups`);
            
            // Add rows back with group headers
            groupValues.forEach(groupValue => {
               const rowsInThisGroup = groupedData[groupValue];
               console.log(`Adding group: "${groupValue}" with ${rowsInThisGroup.length} rows`);
               
               // Create group header
               const groupHeader = document.createElement('tr');
               groupHeader.className = 'group-header';
               groupHeader.setAttribute('data-group', groupValue);
               
               const groupCell = document.createElement('td');
               // Get the correct column count from thead
               const headerRow = table.querySelector('thead tr');
               const colCount = headerRow ? headerRow.cells.length : 
                               (rowsInThisGroup.length > 0 ? rowsInThisGroup[0].cells.length : 1);
               groupCell.colSpan = colCount;
               
               const groupContent = document.createElement('div');
               groupContent.className = 'group-header-content';
               groupContent.style.display = 'flex';
               groupContent.style.alignItems = 'center';
               groupContent.style.padding = '8px';
               groupContent.style.backgroundColor = '#f5f7f9';
               groupContent.style.borderRadius = '4px';
               
               const groupIcon = document.createElement('span');
               groupIcon.className = 'material-symbols-outlined icon group-toggle';
               groupIcon.textContent = 'expand_more';
               groupIcon.style.marginRight = '8px';
               groupIcon.style.color = '#0071ce';
               groupIcon.style.fontFamily = "'Material Symbols Outlined', sans-serif";
               groupIcon.style.fontWeight = 'normal';
               groupIcon.style.fontSize = '20px';
               groupIcon.style.lineHeight = '1';
               groupIcon.style.display = 'flex';
               groupIcon.style.alignItems = 'center';
               groupIcon.style.justifyContent = 'center';
               
               const groupTitle = document.createElement('span');
               groupTitle.className = 'group-header-title';
               groupTitle.textContent = `${columnName}: ${groupValue}`;
               groupTitle.style.fontWeight = '500';
               groupTitle.style.color = '#333';
               
               const groupCount = document.createElement('span');
               groupCount.className = 'group-count';
               groupCount.textContent = `${rowsInThisGroup.length} items`;
               groupCount.style.marginLeft = '12px';
               groupCount.style.fontSize = '0.85em';
               groupCount.style.color = '#666';
               groupCount.style.backgroundColor = 'rgba(0, 113, 206, 0.1)';
               groupCount.style.padding = '2px 8px';
               groupCount.style.borderRadius = '12px';
               
               groupContent.appendChild(groupIcon);
               groupContent.appendChild(groupTitle);
               groupContent.appendChild(groupCount);
               groupCell.appendChild(groupContent);
               groupHeader.appendChild(groupCell);
               
               // Add toggle functionality and make it more obvious
               groupHeader.title = 'Click to expand/collapse group';
               groupHeader.style.cursor = 'pointer';
               
               /* Add tooltip text to make it clear this is collapsible
               const tooltipSpan = document.createElement('span');
               tooltipSpan.className = 'group-tooltip';
               tooltipSpan.textContent = 'Click to expand/collapse';
               tooltipSpan.style.fontSize = '0.75em';
               tooltipSpan.style.color = '#666';
               tooltipSpan.style.marginLeft = '8px';
               tooltipSpan.style.padding = '2px 6px';
               tooltipSpan.style.background = 'rgba(0, 113, 206, 0.08)';
               tooltipSpan.style.borderRadius = '4px';
               groupContent.appendChild(tooltipSpan);*/
               
               groupHeader.addEventListener('click', function(event) {
                  // Prevent event propagation
                  event.stopPropagation();
                  
                  this.classList.toggle('collapsed');
                  const isCollapsed = this.classList.contains('collapsed');
                  const groupValue = this.getAttribute('data-group');
                  
                  // Ensure we're getting the right rows by being more specific with our selector
                  // We need to escape special characters in the group value for the selector
                  const escapedGroupValue = groupValue.replace(/"/g, '\\"');
                  const groupRows = tbody.querySelectorAll(`tr[data-group="${escapedGroupValue}"]:not(.group-header)`);
                  
                  console.log(`Toggle group: "${groupValue}", Collapsed: ${isCollapsed}, Found rows: ${groupRows.length}`);
                  
                  // Toggle row visibility with CSS classes for better performance
                  groupRows.forEach(row => {
                     if (isCollapsed) {
                        row.classList.add('collapsed-row');
                        row.style.display = 'none';
                     } else {
                        row.classList.remove('collapsed-row');
                        row.style.display = '';
                     }
                  });
                  
                  // Update the icon with proper styling
                  const icon = this.querySelector('.group-toggle');
                  if (icon) {
                     icon.textContent = isCollapsed ? 'chevron_right' : 'expand_more';
                     
                     // Ensure consistent icon styling after text change
                     icon.style.fontFamily = "'Material Symbols Outlined', sans-serif";
                     icon.style.fontWeight = 'normal';
                     icon.style.fontSize = '20px';
                     icon.style.lineHeight = '1';
                     icon.style.display = 'flex';
                     icon.style.alignItems = 'center';
                     icon.style.justifyContent = 'center';
                  }
                  
                  /* Update tooltip text based on collapsed state
                  const tooltipElement = this.querySelector('.group-tooltip');
                  if (tooltipElement) {
                     tooltipElement.textContent = isCollapsed ? 'Click to expand' : 'Click to collapse';
                  }*/
                  
                  // Show a count of collapsed items when collapsed
                  const existingBadge = this.querySelector('.collapsed-count');
                  if (existingBadge) {
                     existingBadge.remove();
                  }
                  
                  if (isCollapsed) {
                     const count = groupRows.length;
                     const countBadge = document.createElement('span');
                     countBadge.className = 'collapsed-count';
                     countBadge.textContent = `(${count} items hidden)`;
                     countBadge.style.fontSize = '0.7em';
                     countBadge.style.padding = '2px 8px';
                     countBadge.style.backgroundColor = 'rgba(0, 113, 206, 0.15)';
                     countBadge.style.color = 'rgba(0, 113, 206, 0.9)';
                     countBadge.style.borderRadius = '10px';
                     countBadge.style.marginLeft = '10px';
                     countBadge.style.fontWeight = '500';
                     countBadge.style.border = '1px solid rgba(0, 113, 206, 0.3)';
                     
                     const headerContent = this.querySelector('.group-header-content');
                     if (headerContent) {
                        headerContent.appendChild(countBadge);
                     }
                  }
               });
               
               // Add the group header to the tbody
               tbody.appendChild(groupHeader);
               
               // Add the rows for this group with data-group attribute
               groupedData[groupValue].forEach((row, i) => {
                  // Set data-group attribute for proper identification
                  row.setAttribute('data-group', groupValue);
                  
                  // Style the first row in each group differently if needed
                  if (i === 0) {
                     row.classList.add('first-in-group');
                  }
                  
                  // Add the row to the tbody
                  tbody.appendChild(row);
               });
            });
            
            // Make sure we have consistent styles for grouped table
            const style = document.createElement('style');
            style.textContent = `
               .group-header { background-color: #f5f7f9; }
               .group-header td { padding: 0 !important; }
               .group-header-content { padding: 10px; }
               .collapsed-row { display: none; }
               tr.first-in-group td { border-top: 1px solid #e0e0e0; }
               .group-header:hover { background-color: #eef1f5; }
               
               /* Material Icons proper styling */
               .material-symbols-outlined.icon {
                  font-family: 'Material Symbols Outlined', sans-serif !important;
                  font-weight: normal !important;
                  font-style: normal !important;
                  font-size: 20px !important;
                  line-height: 1 !important;
                  display: inline-flex !important;
                  align-items: center !important;
                  justify-content: center !important;
                  text-transform: none !important;
                  letter-spacing: normal !important;
                  overflow-wrap: normal !important;
                  white-space: nowrap !important;
                  direction: ltr !important;
                  -webkit-font-smoothing: antialiased !important;
               }
            `;
            
            // Only add the style if it doesn't exist yet
            if (!document.querySelector('style[data-group-styles="true"]')) {
                style.setAttribute('data-group-styles', 'true');
                document.head.appendChild(style);
            }
            
            console.log('Group headers and rows added to table');
            
            // Re-apply pagination if it's enabled
            if (table.hasAttribute('data-paginated')) {
               console.log('Table is paginated, re-applying pagination after grouping');
               // Re-store table data since grouping has changed the structure
               storeTableData(table);
               // Reset to first page and update
               table.setAttribute('data-current-page', '1');
               paginateTable(table);
            }
         }
         
         function resetGrouping(table) {
            console.log('Resetting table grouping - START');
            const tbody = table.querySelector('tbody');
            if (!tbody) {
               console.error('No tbody found in table during resetGrouping');
               return;
            }
            
            try {
               // Backup of all non-header rows (important data rows)
               const allRows = Array.from(tbody.querySelectorAll('tr'));
               const dataRows = allRows.filter(row => !row.classList.contains('group-header'));
               
               console.log(`Found ${allRows.length} total rows, ${dataRows.length} data rows to restore`);
               
               // Make a clean copy of each data row to avoid any reference issues
               const cleanDataRows = dataRows.map(row => {
                  const clonedRow = row.cloneNode(true);
                  
                  // Reset any grouping-related attributes and styling
                  clonedRow.removeAttribute('data-group');
                  clonedRow.classList.remove('first-in-group', 'collapsed-row');
                  clonedRow.style.display = '';
                  
                  // Ensure any row that was hidden is now visible
                  if (row.style.display === 'none') {
                     clonedRow.style.display = '';
                  }
                  
                  return clonedRow;
               });
               
               console.log(`Created ${cleanDataRows.length} clean rows for regrouping`);
               
               // Clear the tbody completely to start fresh
               console.log('Clearing tbody to start fresh');
               while (tbody.firstChild) {
                  tbody.removeChild(tbody.firstChild);
               }
               
               // Re-add all data rows in their original order with clean state
               console.log('Re-adding clean data rows to table');
               cleanDataRows.forEach(row => tbody.appendChild(row));
               
               // Re-apply pagination if it's enabled
               if (table.hasAttribute('data-paginated')) {
                  console.log('Table is paginated, restoring pagination after group reset');
                  // Re-store table data since we've reset the grouping
                  storeTableData(table);
                  // Reset to first page and update
                  table.setAttribute('data-current-page', '1');
                  paginateTable(table);
               }
               
               console.log('Resetting table grouping - COMPLETE');
            } catch (error) {
               console.error('Error in resetGrouping:', error);
            }
         }
         
         function sortTable(table, columnIndex, header) {
            const sortDirection = header.getAttribute('data-sort-direction');
            const newDirection = sortDirection === 'asc' ? 'desc' : 'asc';
            
            // Reset all headers
            const headers = table.querySelectorAll('th');
            headers.forEach(h => {
               h.setAttribute('data-sort-direction', '');
               const indicator = h.querySelector('.sort-indicator');
               if (indicator) indicator.innerHTML = '&nbsp;⇕';
               indicator.style.opacity = '0.6';
            });
            
            // Set current header
            header.setAttribute('data-sort-direction', newDirection);
            const sortIndicator = header.querySelector('.sort-indicator');
            sortIndicator.innerHTML = newDirection === 'asc' ? '&nbsp;↑' : '&nbsp;↓';
            sortIndicator.style.opacity = '1';
            
            // Check if table is grouped
            const tbody = table.querySelector('tbody');
            const groupHeaders = tbody.querySelectorAll('.group-header');
            
            if (groupHeaders.length > 0) {
               // Table is grouped, sort within each group
               const groups = {};
               
               // Collect all groups
               groupHeaders.forEach(header => {
                  const groupValue = header.getAttribute('data-group');
                  groups[groupValue] = [];
                  
                  // Find all rows in this group
                  const groupRows = tbody.querySelectorAll(`tr[data-group="${groupValue}"]:not(.group-header)`);
                  groupRows.forEach(row => groups[groupValue].push(row));
                  
                  // Sort rows in this group
                  groups[groupValue].sort((rowA, rowB) => {
                     const cellA = rowA.cells[columnIndex].textContent.trim();
                     const cellB = rowB.cells[columnIndex].textContent.trim();
                     
                     // Check if values are numbers
                     const numA = parseFloat(cellA);
                     const numB = parseFloat(cellB);
                     
                     if (!isNaN(numA) && !isNaN(numB)) {
                        return newDirection === 'asc' ? numA - numB : numB - numA;
                     } else {
                        // String comparison
                        return newDirection === 'asc' 
                           ? cellA.localeCompare(cellB) 
                           : cellB.localeCompare(cellA);
                     }
                  });
                  
                  // Remove existing rows
                  groupRows.forEach(row => {
                     tbody.removeChild(row);
                  });
                  
                  // Insert sorted rows after their group header
                  let insertAfter = header;
                  const isGroupCollapsed = header.classList.contains('collapsed');
                  
                  groups[groupValue].forEach((row, idx) => {
                     // Preserve the collapsed state from the group header
                     if (isGroupCollapsed) {
                        row.classList.add('collapsed-row');
                     } else {
                        row.classList.remove('collapsed-row');
                     }
                     
                     // Add first-in-group class to the first row
                     if (idx === 0) {
                        row.classList.add('first-in-group');
                     } else {
                        row.classList.remove('first-in-group');
                     }
                     
                     if (insertAfter.nextSibling) {
                        tbody.insertBefore(row, insertAfter.nextSibling);
                     } else {
                        tbody.appendChild(row);
                     }
                     insertAfter = row;
                  });
               });
               
            } else {
               // Normal sorting (no groups)
               const rows = Array.from(tbody.querySelectorAll('tr'));
               
               // Sort rows
               rows.sort((rowA, rowB) => {
                  const cellA = rowA.cells[columnIndex].textContent.trim();
                  const cellB = rowB.cells[columnIndex].textContent.trim();
                  
                  // Check if values are numbers
                  const numA = parseFloat(cellA);
                  const numB = parseFloat(cellB);
                  
                  if (!isNaN(numA) && !isNaN(numB)) {
                     return newDirection === 'asc' ? numA - numB : numB - numA;
                  } else {
                     // String comparison
                     return newDirection === 'asc' 
                        ? cellA.localeCompare(cellB) 
                        : cellB.localeCompare(cellA);
                  }
               });
               
               // Remove existing rows
               rows.forEach(row => tbody.removeChild(row));
               
               // Add sorted rows
               rows.forEach(row => tbody.appendChild(row));
            }
            
            // Re-apply pagination if it's enabled
            if (table.hasAttribute('data-paginated')) {
               // Re-store table data since sorting has changed the structure
               storeTableData(table);
               paginateTable(table);
            }
            
            // Add a highlight effect on sorting
            tbody.style.transition = 'background-color 0.3s ease';
            tbody.style.backgroundColor = 'rgba(0, 113, 206, 0.05)';
            setTimeout(() => {
               tbody.style.backgroundColor = '';
            }, 500);
         }
      </script>

      <style>
         :root {
         /* Light Theme */
         --cgd-blue: #0071CE;
         --product-accent: #0071CE;
         --product-accent-hover: #00559A;
         --text-primary: #202124;
         --text-secondary: #5f6368;
         --border-color: #dadce0;
         --background-main: #f8f9fa;
         --background-card: #ffffff;
         --background-hover: #f1f3f4;
         --background-button: #0071CE;
         --background-button-text: #ffffff;
         /* Icon Colors */
         --color-red: #d93025;
         --color-amber: #f9ab00;
         --color-green: #1e8e3e;
         }
        html.dark-mode {
         /* Dark Theme - Improved for better visibility and contrast */
         --product-accent: #4285f4;
         --product-accent-hover: #5294ff;
         --text-primary: #ffffff;
         --text-secondary: #ffffff;
         --border-color: #5f6368;
         --background-main: #1a1a1a;
         --background-card: #2d2d2d;
         --background-hover: #404040;
         --background-button: #4285f4;
         --background-button-text: #ffffff;
         /* Improved Icon Colors for dark mode */
         --color-red: #f28b82;
         --color-amber: #fdd663;
         --color-green: #81c995;
         }
         html {
         color: var(--text-primary);
         background-color: var(--background-main);
         box-sizing: border-box;
         scroll-behavior: smooth;
         }
         *, *::before, *::after { box-sizing: inherit; }
         body {
         margin: 0; padding: 0; width: 100%;
         font-family: 'Roboto', 'Segoe UI', Arial, sans-serif;
         font-size: 14px; line-height: 1.6;
         text-rendering: optimizeLegibility;
         overflow-x: hidden;
         text-align: left;
         color: var(--text-primary);
         background-color: var(--background-main);
         transition: background-color 0.3s ease, color 0.3s ease;
         }
         /* --- HEADER --- */
         /* --- READING PROGRESS INDICATOR --- */
         .reading-progress {
         position: fixed;
         top: 0;
         left: 0;
         width: 100%;
         height: 3px;
         background-color: rgba(0, 113, 206, 0.1);
         z-index: 103;
         opacity: 0;
         transition: opacity 0.3s ease;
         }
         .reading-progress.show {
         opacity: 1;
         }
         .reading-progress-fill {
         height: 100%;
         background: linear-gradient(90deg, var(--product-accent) 0%, #00559A 100%);
         width: 0%;
         transition: width 0.1s ease-out;
         border-radius: 0 2px 2px 0;
         box-shadow: 0 0 10px rgba(0, 113, 206, 0.3);
         }
         .reading-progress-text {
         position: fixed;
         top: 8px;
         right: 20px;
         background-color: var(--background-card);
         color: var(--text-secondary);
         font-size: 0.75rem;
         font-weight: 500;
         padding: 0.25rem 0.5rem;
         border-radius: 12px;
         border: 1px solid var(--border-color);
         z-index: 104;
         opacity: 0;
         visibility: hidden;
         transition: all 0.3s ease;
         backdrop-filter: blur(8px);
         }
         .reading-progress-text.show {
         opacity: 1;
         visibility: visible;
         }
         .header {
         background-color: var(--background-card);
         box-shadow: 0 1px 2px rgba(0,0,0,0.1);
         position: sticky;
         top: 0;
         z-index: 102;
         width: 100%;
         border-bottom: 1px solid var(--border-color);
         transition: background-color 0.3s ease, border-color 0.3s ease;
         }
         .header-container {
         display: flex;
         align-items: center;
         justify-content: space-between;
         padding: 0.5rem 1.5rem; /* Reduced padding */
         max-width: 100%;
         margin: 0 auto;
         }
         .header-brand { display: flex; align-items: center; }
         .header-logo { height: 38px; margin-right: 1rem; }
         .header-title { font-size: 18px; font-weight: 600; color: var(--cgd-blue); padding: 0; }
         .header-controls { display: flex; align-items: center; gap: 0.5rem; }
         .support-button {
         background-color: var(--background-button);
         color: var(--background-button-text);
         border: 1px solid transparent;
         border-radius: 4px;
         padding: 8px 16px;
         font-size: 14px;
         font-weight: 500;
         text-decoration: none;
         cursor: pointer;
         transition: background-color 0.2s ease, box-shadow 0.2s ease;
         margin-left: 1rem;
         }
         .support-button:hover {
         background-color: var(--product-accent-hover);
         box-shadow: 0 1px 3px rgba(0,0,0,0.1);
         }
         .icon-button {
         background: none; border: none; cursor: pointer;
         padding: 8px; border-radius: 50%;
         display: inline-flex; align-items: center; justify-content: center;
         color: var(--text-secondary);
         transition: background-color 0.2s ease, color 0.2s ease;
         }
         .icon-button:hover { background-color: var(--background-hover); color: var(--text-primary); }
         .icon-button .icon { margin: 0; vertical-align: -6px; }
         /* --- MAIN CONTENT & TYPOGRAPHY --- */
         .content { max-width: 100%; padding: 0 1.5rem; margin: 0 auto; }
         .product-header {
         background-color: var(--background-card);
         padding: 2rem 1.5rem;
         margin-bottom: 0;
         border-bottom: 1px solid var(--border-color);
         transition: background-color 0.3s ease, border-color 0.3s ease;
         }
         .document-meta {
         display: flex;
         align-items: center;
         gap: 1rem;
         margin-top: 0.5rem;
         color: var(--text-secondary);
         font-size: 0.875rem;
         }
         .read-time { display: flex; align-items: center; gap: 0.25rem; }
         .read-time .icon { font-size: 18px; vertical-align: -4px; }
         h1, h2, h3, h4 { color: var(--text-primary); text-align: left; font-weight: 600; margin-bottom: 1rem; }
         h1 { margin-top: 0; font-size: 2.25rem; padding-bottom: 0.5rem; }
         h2 { font-size: 1.75rem; padding-bottom: 0.75rem; border-bottom: 1px solid var(--border-color); transition: border-color 0.3s ease; }
         h3 { font-size: 1.4rem; }
         h4 { font-size: 1.2rem; }
         p { margin: 1rem 0; color: var(--text-secondary); }
         /* --- ICON STYLES --- */
         .icon { font-family: 'Material Symbols Outlined', sans-serif; font-weight: normal; font-style: normal; font-size: 20px; line-height: 1; letter-spacing: normal; text-transform: none; display: inline-block; white-space: nowrap; word-wrap: normal; direction: ltr; -webkit-font-smoothing: antialiased; vertical-align: -5px; margin-right: 0.07em; }
         .icon-high { color: var(--color-red); }
         .icon-medium { color: var(--color-amber); }
         .icon-low { color: var(--color-green); }
         .icon-check { color: var(--color-green); }
         .icon-cross { color: var(--color-red); }
         .icon-question { color: var(--text-secondary); }
         /* --- BREADCRUMB NAVIGATION --- */
         .breadcrumb-container {
         background-color: var(--background-main);
         border-top: 1px solid var(--border-color);
         padding: 0.5rem 1.5rem;
         transition: all 0.3s ease;
         }
         .breadcrumb {
         display: flex;
         align-items: center;
         flex-wrap: wrap;
         gap: 0.5rem;
         font-size: 0.8rem;
         color: var(--text-secondary);
         max-width: 1200px;
         margin: 0 auto;
         }
         .breadcrumb-item {
         display: flex;
         align-items: center;
         gap: 0.25rem;
         }
         .breadcrumb-link {
         color: var(--text-secondary);
         text-decoration: none;
         padding: 0.25rem 0.5rem;
         border-radius: 4px;
         transition: all 0.2s ease;
         cursor: pointer;
         }
         .breadcrumb-link:hover {
         color: var(--product-accent);
         background-color: var(--background-hover);
         }
         .breadcrumb-link.active {
         color: var(--product-accent);
         font-weight: 500;
         background-color: rgba(0, 113, 206, 0.1);
         }
         .breadcrumb-separator {
         color: var(--border-color);
         font-size: 0.75rem;
         margin: 0 0.25rem;
         }
         .breadcrumb-home {
         display: flex;
         align-items: center;
         gap: 0.25rem;
         color: var(--text-secondary);
         text-decoration: none;
         padding: 0.25rem 0.5rem;
         border-radius: 4px;
         transition: all 0.2s ease;
         }
         .breadcrumb-home:hover {
         color: var(--product-accent);
         background-color: var(--background-hover);
         }
         .breadcrumb-home .icon {
         font-size: 16px;
         }
         .breadcrumb-section-info {
         margin-left: auto;
         display: flex;
         align-items: center;
         gap: 1rem;
         font-size: 0.8rem;
         color: var(--text-secondary);
         }
         .breadcrumb-progress {
         display: flex;
         align-items: center;
         gap: 0.25rem;
         }
         .breadcrumb-progress-bar {
         width: 60px;
         height: 4px;
         background-color: var(--border-color);
         border-radius: 2px;
         overflow: hidden;
         }
         .breadcrumb-progress-fill {
         height: 100%;
         background-color: var(--product-accent);
         width: 0%;
         transition: width 0.3s ease;
         }
         /* Mobile adjustments for breadcrumb */
         @media (max-width: 768px) {
         .breadcrumb-container {
         padding: 0.4rem 1rem;
         }
         .breadcrumb {
         font-size: 0.75rem;
         }
         .breadcrumb-section-info {
         display: none;
         }
         .breadcrumb-link {
         padding: 0.2rem 0.4rem;
         }
         }
         @media (max-width: 480px) {
         .breadcrumb-container {
         padding: 0.3rem 1rem;
         }
         .breadcrumb {
         font-size: 0.7rem;
         gap: 0.25rem;
         }
         .breadcrumb-link {
         padding: 0.15rem 0.3rem;
         max-width: 100px;
         overflow: hidden;
         text-overflow: ellipsis;
         white-space: nowrap;
         }
         }
         /* --- TAB STYLES --- */
         .tab-navigation-container {
         position: sticky; top: 62px; /* After header (which now includes breadcrumb) */
         background-color: var(--background-card);
         z-index: 101;
         border-bottom: 1px solid var(--border-color);
         width: 100vw; margin-left: calc(-50vw + 50%);
         transition: background-color 0.3s ease, border-color 0.3s ease;
         }
         .tab-nav-scroller { overflow-x: auto; scrollbar-width: thin; scrollbar-color: var(--border-color) transparent; padding: 0 1.5rem; }
         .tab-navigation { display: flex; flex-wrap: nowrap; white-space: nowrap; margin: 0; padding: 0; list-style: none; }
         .tab-link { padding: 0.75rem 0; margin: 0 1.25rem; cursor: pointer; background: none; border: none; border-bottom: 3px solid transparent; color: var(--text-secondary); font-size: 0.9rem; font-weight: 500; transition: color 0.2s ease, border-color 0.2s ease; margin-bottom: -1px; text-align: center; }
         
         
         .tab-link:hover { color: var(--product-accent); }
         .tab-link.active { color: var(--product-accent); border-bottom-color: var(--product-accent); }
         .tab-link:first-child { margin-left: 0; } .tab-link:last-child { margin-right: 0; }
         .tab-content { padding-top: 2rem; }
         .tab-pane { display: none; animation: fadeIn 0.5s ease; }
         .tab-pane.active { display: block; }
         .tab-link span {font-weight: 550; }
         @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
         .product-section { margin-bottom: 3rem; background: var(--background-card); border-radius: 8px; border: 1px solid var(--border-color); padding: 0 2rem; transition: background-color 0.3s ease, border-color 0.3s ease; }
         /* --- TABLES --- */
         .table-container { width: 100%; overflow-x: auto; margin: 1.5rem 0; border: 1px solid var(--border-color); border-radius: 8px; transition: border-color 0.3s ease; }
         table { width: 100%; border-collapse: collapse; min-width: 650px; }
         th, td { padding: 12px 16px; text-align: left; vertical-align: middle; font-size: 0.875rem; border-bottom: 1px solid var(--border-color); transition: border-color 0.3s ease;}
         th { background-color: var(--background-main); color: var(--text-primary); font-weight: 500; position: sticky; top: 0; z-index: 10; transition: background-color 0.3s ease, color 0.3s ease; }
         tr:last-child td { border-bottom: none; }
         tr:hover { background-color: var(--background-hover); }
         td strong { color: var(--text-primary); font-weight: 500; }
         td .icon { margin-left: -4px; }

         /* Sortable table styles */
         th[data-sort-direction="asc"],
         th[data-sort-direction="desc"] {
            background-color: rgba(0, 113, 206, 0.1);
         }
         th .sort-indicator {
            transition: transform 0.2s ease, opacity 0.2s ease;
         }
         th:hover .sort-indicator {
            opacity: 1 !important;
         }
         th:hover {
            background-color: rgba(0, 113, 206, 0.05);
         }
         tbody tr.sort-highlight {
            animation: highlightRow 1s ease;
         }
         @keyframes highlightRow {
            0% { background-color: rgba(0, 113, 206, 0.1); }
            100% { background-color: transparent; }
         }
         
         /* Table grouping styles */
         .table-group-controls {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 0px;
            padding: 8px 12px;
            background-color: var(--background-main);
            border-radius: 6px;
            border: 1px solid var(--border-color);
            transition: border-color 0.3s ease, background-color 0.3s ease;
         }
         
         .group-title {
            display: flex;
            align-items: center;
            gap: 6px;
            font-weight: 500;
            color: var(--text-primary);
            font-size: 0.9rem;
         }
         
         .group-options {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
         }
         
         .group-option {
            padding: 4px 10px;
            border-radius: 4px;
            border: 1px solid var(--border-color);
            background-color: var(--background-card);
            color: var(--text-secondary);
            cursor: pointer;
            font-size: 0.8rem;
            transition: all 0.2s ease;
         }
         
         .group-option:hover {
            background-color: var(--background-hover);
            color: var(--text-primary);
         }
         
         .group-option.active {
            background-color: var(--product-accent);
            color: white;
            border-color: var(--product-accent);
            font-weight: 500;
         }
         
         tr.group-header {
            background-color: rgba(0, 113, 206, 0.08);
            cursor: pointer;
            user-select: none;
            transition: all 0.2s ease;
            border-radius: 4px;
            border-left: 3px solid rgba(0, 113, 206, 0.6);
         }
         
         tr.group-header:hover {
            background-color: rgba(0, 113, 206, 0.15);
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
         }
         
         tr.group-header.collapsed {
            background-color: rgba(0, 113, 206, 0.12);
            border-left-color: rgba(0, 113, 206, 0.6);
            margin-bottom: 0;
            border-bottom: 2px solid rgba(0, 113, 206, 0.4);
            position: relative; /* For the ::after pseudo-element */
         }
         
         tr.group-header.collapsed:hover {
            background-color: rgba(0, 113, 206, 0.18);
         }
         
         /* Add visual indicator of collapsed rows below */
         tr.group-header.collapsed::after {
            content: "";
            height: 3px;
            background: linear-gradient(to right, rgba(0, 113, 206, 0.4), rgba(0, 113, 206, 0.1), transparent);
            display: block;
            position: relative;
            margin-top: 2px;
         }
         
         /* Add a more prominent indicator for collapsed content */
         tr.group-header.collapsed td:first-child {
            position: relative;
         }
         
         tr.group-header.collapsed td:first-child::before {
            content: "▾"; /* Down-pointing triangle */
            position: absolute;
            right: 10px;
            color: rgba(0, 113, 206, 0.6);
            font-size: 12px;
         }
         
         .group-header-content {
            display: flex;
            align-items: center;
            padding: 4px 0;
            flex-wrap: wrap;
         }
         
         .group-header-title {
            font-weight: 500;
            color: var(--text-primary);
            margin-right: 8px;
         }
         
         .group-count {
            font-size: 0.75rem;
            color: var(--text-secondary);
            background-color: var(--background-card);
            padding: 2px 8px;
            border-radius: 12px;
            border: 1px solid var(--border-color);
         }
         
         .group-toggle {
            margin-right: 10px;
            transition: all 0.3s ease;
            color: rgba(0, 113, 206, 0.8);
            font-weight: bold;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            background-color: rgba(0, 113, 206, 0.1);
            width: 26px;
            height: 26px;
            border-radius: 50%;
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
            font-size: 18px;
         }
         
         tr.group-header:hover .group-toggle {
            background-color: rgba(0, 113, 206, 0.2);
            transform: scale(1.1);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.15);
         }
         
         tr.group-header.collapsed .group-toggle {
            transform: rotate(-90deg);
            color: rgba(0, 113, 206, 0.6);
            background-color: rgba(0, 113, 206, 0.05);
         }
         
         /* Simplify the animation */
         tr.group-header.collapsed:hover .group-toggle {
            background-color: rgba(0, 113, 206, 0.15);
            transform: rotate(-90deg) scale(1.05);
         }
         
         /* Styles for grouped rows */
         tr[data-group] {
            transition: all 0.3s ease;
         }
         
         /* Collapsed rows - completely hidden */
         tbody tr.collapsed-row {
            display: none !important;
         }
         
         tr.first-in-group {
            border-top: 1px solid rgba(0, 113, 206, 0.1);
         }
         
         @media (max-width: 768px) {
            .table-group-controls {
               flex-direction: column;
               align-items: flex-start;
               gap: 8px;
            }
            
            .group-options {
               width: 100%;
            }
         }
         
         /* Table Pagination Styles */
         .table-pagination {
            margin-top: 1rem;
            border-top: 1px solid var(--border-color);
            padding-top: 0.75rem;
         }
         
         .pagination-top-controls {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 0.75rem;
            padding-left:12px;
            padding-right: 12px;
         }
         
         .page-size-selector {
            display: flex;
            align-items: center;
            gap: 0.5rem;
         }
         
         .page-size-label {
            font-size: 0.875rem;
            color: var(--text-secondary);
         }
         
         .page-size-select {
            padding: 0.25rem 0.5rem;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            background-color: var(--background-card);
            color: var(--text-primary);
            font-size: 0.875rem;
            cursor: pointer;
         }
         
         .page-size-select:focus {
            outline: none;
            border-color: var(--product-accent);
            box-shadow: 0 0 0 2px rgba(0, 113, 206, 0.1);
         }
         
         .pagination-info {
            font-size: 0.875rem;
            color: var(--text-secondary);
         }
         
         .pagination-nav {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.25rem;
            padding: 8px 0;
            background-color: #f8f9fa;
            border-radius: 8px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.05);
         }
         
         .pagination-button {
            min-width: 36px;
            height: 36px;
            padding: 0;
            border: none;
            border-radius: 4px;
            background-color: transparent;
            color: var(--product-accent);
            font-size: 0.875rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
            margin: 0 2px;
         }
         
         .pagination-button:hover:not(:disabled) {
            background-color: rgba(0, 113, 206, 0.08);
            color: var(--product-accent);
         }
         
         .pagination-button {
            background-color: var(--product-accent);
            color: white;
            font-weight: 500;
         }
         
         /* Navigation buttons styling */
         .pagination-button.prev,
         .pagination-button.next,
         .pagination-button.first,
         .pagination-button.last {
            background-color: transparent;
            border-radius: 50%;
         }
         
         /* Number buttons styling */
         .pagination-button.page-number {
            font-family: 'Roboto', Arial, sans-serif;
            font-weight: 500;
         }
         
         .pagination-button.ellipsis {
            cursor: default;
            min-width: 24px;
         }
         
         .pagination-button.ellipsis:hover {
            background-color: transparent;
         }
         
         .pagination-button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            color: var(--text-secondary);
         }
         
         .pagination-button.prev,
         .pagination-button.next,
         .pagination-button.first,
         .pagination-button.last {
            background-color: transparent;
            border: none;
         }
         
         .pagination-button.prev:hover:not(:disabled),
         .pagination-button.next:hover:not(:disabled),
         .pagination-button.first:hover:not(:disabled),
         .pagination-button.last:hover:not(:disabled) {
            background-color: rgba(0, 113, 206, 0.08);
            border: none;
         }
         
         .pagination-button .icon {
            font-size: 20px;
            margin: 0;
            font-family: 'Material Symbols Outlined', sans-serif !important;
            vertical-align: middle;
            font-style: normal;
         }
         
         .icon {
            font-family: 'Material Symbols Outlined', sans-serif !important;
            font-weight: normal;
            font-style: normal;
            line-height: 1;
            text-transform: none;
            letter-spacing: normal;
            word-wrap: normal;
            white-space: nowrap;
            direction: ltr;
            display: inline-block;
            text-rendering: auto;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
         }
         
         /* Ensure Material Symbols are properly applied */
         span.material-symbols-outlined,
         .material-symbols-outlined {
            font-family: 'Material Symbols Outlined', sans-serif !important;
            font-weight: normal;
            font-style: normal;
            font-size: 20px;
            line-height: 1;
            letter-spacing: normal;
            text-transform: none;
            display: inline-block;
            white-space: nowrap;
            word-wrap: normal;
            direction: ltr;
            font-feature-settings: 'liga';
            -webkit-font-feature-settings: 'liga';
            -webkit-font-smoothing: antialiased;
         }
         
         .pagination-button.ellipsis {
            cursor: default;
            color: var(--text-secondary);
         }
         
         .pagination-button.ellipsis:hover {
            background-color: transparent;
         }
         
         /* Mobile adjustments for pagination */
         @media (max-width: 768px) {
            .pagination-top-controls {
               flex-direction: column;
               align-items: flex-start;
               gap: 0.5rem;
            }
            
            .pagination-info {
               margin-top: 0.25rem;
            }
            
            .pagination-button {
               min-width: 32px;
               height: 32px;
            }
         }
         
         @media (max-width: 480px) {
            .pagination-button:not(.prev):not(.next):not(.active):not(.first):not(.last) {
               display: none;
            }
            
            .pagination-button.ellipsis:first-of-type,
            .pagination-button.ellipsis:last-of-type {
               display: flex;
            }
            
            .pagination-nav {
               width: 100%;
               justify-content: space-between;
            }
         }
         /* --- FLOATING TABLE OF CONTENTS --- */
         .floating-toc {
         position: fixed;
         top: 50%;
         right: 20px;
         transform: translateY(-50%);
         background-color: var(--background-card);
         border: 1px solid var(--border-color);
         border-radius: 12px;
         padding: 1rem;
         max-width: 280px;
         min-width: 240px;
         max-height: 70vh;
         overflow-y: auto;
         z-index: 1001;
         box-shadow: 0 8px 32px rgba(0,0,0,0.12);
         opacity: 0;
         visibility: hidden;
         transition: opacity 0.3s ease, visibility 0.3s ease, transform 0.3s ease;
         backdrop-filter: blur(8px);
         }
         .floating-toc.show {
         opacity: 1;
         visibility: visible;
         }
         .floating-toc-header {
         display: flex;
         align-items: center;
         justify-content: space-between;
         margin-bottom: 1rem;
         padding-bottom: 0.5rem;
         border-bottom: 1px solid var(--border-color);
         }
         .floating-toc-title {
         font-size: 0.875rem;
         font-weight: 600;
         color: var(--text-primary);
         display: flex;
         align-items: center;
         gap: 0.5rem;
         }
         .floating-toc-close {
         background: none;
         border: none;
         cursor: pointer;
         padding: 4px;
         border-radius: 4px;
         color: var(--text-secondary);
         transition: background-color 0.2s ease, color 0.2s ease;
         }
         .floating-toc-close:hover {
         background-color: var(--background-hover);
         color: var(--text-primary);
         }
         .floating-toc-list {
         list-style: none;
         padding: 0;
         margin: 0;
         }
         .floating-toc-item {
         margin-bottom: 0.5rem;
         }
         .floating-toc-link {
         display: block;
         padding: 0.5rem 0.75rem;
         text-decoration: none;
         color: var(--text-secondary);
         font-size: 0.8rem;
         line-height: 1.4;
         border-radius: 6px;
         transition: all 0.2s ease;
         cursor: pointer;
         position: relative;
         border-left: 3px solid transparent;
         }
         .floating-toc-link:hover {
         background-color: var(--background-hover);
         color: var(--text-primary);
         }
         .floating-toc-link.active {
         background-color: rgba(0, 113, 206, 0.1);
         color: var(--product-accent);
         border-left-color: var(--product-accent);
         font-weight: 500;
         }
         .floating-toc-progress {
         position: absolute;
         right: 0.5rem;
         top: 50%;
         transform: translateY(-50%);
         width: 20px;
         height: 20px;
         border-radius: 50%;
         background-color: var(--border-color);
         border: 2px solid var(--background-card);
         transition: all 0.2s ease;
         }
         .floating-toc-link.active .floating-toc-progress {
         background-color: var(--product-accent);
         }
         .floating-toc-progress-fill {
         position: absolute;
         top: 2px;
         left: 2px;
         right: 2px;
         bottom: 2px;
         border-radius: 50%;
         background-color: var(--product-accent);
         transform: scale(0);
         transition: transform 0.2s ease;
         }
         .floating-toc-link.reading .floating-toc-progress-fill {
         transform: scale(1);
         }
         .floating-toc-toggle {
         position: fixed;
         top: 50%;
         right: 20px;
         transform: translateY(-50%);
         background-color: var(--product-accent);
         color: var(--background-button-text);
         border: none;
         border-radius: 50%;
         width: 48px;
         height: 48px;
         display: flex;
         align-items: center;
         justify-content: center;
         cursor: pointer;
         z-index: 1002;
         box-shadow: 0 4px 16px rgba(0,0,0,0.15);
         opacity: 0;
         visibility: hidden;
         transition: all 0.3s ease;
         }
         .floating-toc-toggle.show {
         opacity: 1;
         visibility: visible;
         }
         .floating-toc-toggle:hover {
         background-color: var(--product-accent-hover);
         transform: translateY(-50%) scale(1.05);
         }
         /* --- FULL-SCREEN READING MODE --- */
         .fullscreen-reading-mode {
         position: fixed;
         top: 0;
         left: 0;
         right: 0;
         bottom: 0;
         background-color: var(--background-main);
         z-index: 2000;
         overflow-y: auto;
         padding: 2rem;
         opacity: 0;
         visibility: hidden;
         transition: opacity 0.3s ease, visibility 0.3s ease;
         }
         .fullscreen-reading-mode.active {
         opacity: 1;
         visibility: visible;
         }
         .fullscreen-reading-content {
         max-width: 800px;
         margin: 0 auto;
         line-height: 1.8;
         font-size: 1.1rem;
         color: var(--text-primary);
         }
         .fullscreen-reading-content h2 {
         font-size: 2rem;
         margin-bottom: 1.5rem;
         color: var(--text-primary);
         border-bottom: 2px solid var(--product-accent);
         padding-bottom: 0.5rem;
         }
         .fullscreen-reading-content h3 {
         font-size: 1.5rem;
         margin-top: 2rem;
         margin-bottom: 1rem;
         color: var(--text-primary);
         }
         .fullscreen-reading-content h4 {
         font-size: 1.25rem;
         margin-top: 1.5rem;
         margin-bottom: 0.75rem;
         color: var(--text-primary);
         }
         .fullscreen-reading-content p {
         margin-bottom: 1.5rem;
         text-align: justify;
         color: var(--text-secondary);
         }
         .fullscreen-reading-content table {
         margin: 2rem 0;
         font-size: 0.95rem;
         }
         .fullscreen-reading-controls {
         position: fixed;
         top: 20px;
         right: 20px;
         display: flex;
         gap: 0.5rem;
         z-index: 2001;
         }
         .fullscreen-reading-control {
         background-color: var(--background-card);
         border: 1px solid var(--border-color);
         border-radius: 8px;
         padding: 0.5rem;
         cursor: pointer;
         color: var(--text-secondary);
         transition: all 0.2s ease;
         backdrop-filter: blur(8px);
         }
         .fullscreen-reading-control:hover {
         background-color: var(--background-hover);
         color: var(--text-primary);
         }
         .fullscreen-reading-exit {
         background-color: var(--product-accent);
         color: var(--background-button-text);
         }
         .fullscreen-reading-exit:hover {
         background-color: var(--product-accent-hover);
         }
         .fullscreen-reading-progress {
         position: fixed;
         bottom: 20px;
         left: 50%;
         transform: translateX(-50%);
         background-color: var(--background-card);
         border: 1px solid var(--border-color);
         border-radius: 20px;
         padding: 0.5rem 1rem;
         font-size: 0.875rem;
         color: var(--text-secondary);
         backdrop-filter: blur(8px);
         z-index: 2001;
         }
         .fullscreen-font-controls {
         position: fixed;
         top: 20px;
         left: 20px;
         display: flex;
         gap: 0.5rem;
         z-index: 2001;
         }
         .fullscreen-font-control {
         background-color: var(--background-card);
         border: 1px solid var(--border-color);
         border-radius: 8px;
         padding: 0.5rem;
         cursor: pointer;
         color: var(--text-secondary);
         transition: all 0.2s ease;
         backdrop-filter: blur(8px);
         min-width: 40px;
         text-align: center;
         }
         .fullscreen-font-control:hover {
         background-color: var(--background-hover);
         color: var(--text-primary);
         }
         /* Hide UI elements when in fullscreen reading mode */
         body.fullscreen-reading .header,
         body.fullscreen-reading .product-header,
         body.fullscreen-reading .tab-navigation-container,
         body.fullscreen-reading .footer,
         body.fullscreen-reading .floating-toc,
         body.fullscreen-reading .floating-toc-toggle,
         body.fullscreen-reading #back-to-top,
         body.fullscreen-reading .reading-progress,
         body.fullscreen-reading .reading-progress-text {
         display: none !important;
         }
         /* Mobile adjustments for fullscreen reading */
         @media (max-width: 768px) {
         .fullscreen-reading-mode {
         padding: 1rem;
         }
         .fullscreen-reading-content {
         font-size: 1rem;
         line-height: 1.7;
         }
         .fullscreen-reading-controls {
         top: 10px;
         right: 10px;
         }
         .fullscreen-font-controls {
         top: 10px;
         left: 10px;
         }
         .fullscreen-reading-progress {
         bottom: 10px;
         padding: 0.4rem 0.8rem;
         font-size: 0.8rem;
         }
         }
         /* Hide TOC on smaller screens */
         @media (max-width: 1024px) {
         .floating-toc,
         .floating-toc-toggle {
         display: none !important;
         }
         }
         
         /* Mobile adjustments for reading progress */
         @media (max-width: 768px) {
         .reading-progress-text {
         right: 10px;
         top: 6px;
         font-size: 0.7rem;
         padding: 0.2rem 0.4rem;
         }
         }
         
         @media (max-width: 480px) {
         .reading-progress-text {
         right: 5px;
         top: 4px;
         font-size: 0.65rem;
         padding: 0.15rem 0.3rem;
         max-width: 120px;
         text-overflow: ellipsis;
         overflow: hidden;
         white-space: nowrap;
         }
         }
         /* --- MISC & FOOTER --- */
         .ai-disclaimer { text-align: center; font-style: italic; color: var(--text-secondary); font-size: 0.875rem; margin: -1rem auto -2rem; padding: 0 1rem; line-height: 1.5; }
         #back-to-top {
         position: fixed; bottom: 20px; left: 20px;
         background-color: var(--product-accent); color: var(--background-button-text);
         border: none; border-radius: 50%;
         width: 50px; height: 50px;
         display: none; align-items: center; justify-content: center;
         cursor: pointer; z-index: 1000;
         box-shadow: 0 4px 8px rgba(0,0,0,0.2);
         opacity: 0;
         transition: opacity 0.3s ease, transform 0.3s ease, background-color 0.3s ease;
         }
         #back-to-top.show { opacity: 1; display: flex; }
         #back-to-top:hover { background-color: var(--product-accent-hover); transform: translateY(-2px); }
         .footer { background-color: var(--background-card); color: var(--text-secondary); padding: 2rem 1.5rem; margin-top: 4rem; text-align: center; border-top: 1px solid var(--border-color); transition: background-color 0.3s ease, border-color 0.3s ease;}
         .footer-container { max-width: 1440px; margin: 0 auto; display: flex; flex-direction: column; align-items: center; gap: 1.5rem; }
         .footer-brand { display: flex; align-items: center; gap: 1rem; }
         .footer-logo { height: 32px; }
         .footer-wordmark { font-size: 1rem; font-weight: 500; color: var(--cgd-blue); }
         .footer-copyright { font-size: 0.8rem; }
         .footer-socials { display: flex; gap: 1rem; }
         .footer-socials a { color: var(--text-secondary); text-decoration: none; display: inline-block; transition: color 0.2s ease, transform 0.2s ease; }
         .footer-socials a:hover { color: var(--product-accent); transform: scale(1.1); }
         .footer-socials svg { width: 24px; height: 24px; fill: currentColor; }
         @media (max-width: 768px) {
         .content, .product-header { padding-left: 1rem; padding-right: 1rem; }
         .footer-container { flex-direction: column; text-align: center; gap: 1.5rem; }
         }
         @media print {
         /* Print styles remain largely the same */
         .header, .footer, .tab-navigation-container, .ai-disclaimer, #back-to-top, .header-controls { display: none !important; }
         }
      </style>
   </head>
   <body>
      <!-- Reading Progress Indicator -->
      <div id="reading-progress" class="reading-progress">
         <div id="reading-progress-fill" class="reading-progress-fill"></div>
      </div>
      <div id="reading-progress-text" class="reading-progress-text">
         0% read
      </div>
      
      <header class="header">
         <div class="header-container">
            <div class="header-brand">
               <img src="https://www.cgd.pt/PublishingImages/WSImages/Novo-CGD/logo-ap_Blue.png" alt="CGD Logo" class="header-logo">
            </div>
            <div class="header-controls">
               <div id="tts-controls" style="display: none;">
                  <button id="tts-play-pause-btn" class="icon-button" title="Listen to this section">
                  <span class="icon">play_arrow</span>
                  </button>
                  <button id="tts-stop-btn" class="icon-button" title="Stop listening">
                  <span class="icon">stop</span>
                  </button>
               </div>
               <button id="fullscreen-reading-btn" class="icon-button" title="Enter fullscreen reading mode">
               <span class="icon">fullscreen</span>
               </button>
               <button id="dark-mode-toggle" class="icon-button" title="Toggle dark/light mode">
               <span class="icon">light_mode</span>
               </button>
               <a href="mailto:david.alexandre.rosa@cgd.pt?subject=Support Request for Application Technical Profile&cc=dsi-arquitetura_empresarial@cgd.pt" target="_blank" class="support-button">Ask for Support</a>
            </div>
         </div>
         
         <!-- Breadcrumb Navigation integrated in header -->
         <div id="breadcrumb-container" class="breadcrumb-container">
            <nav class="breadcrumb" aria-label="Breadcrumb navigation">
               <a href="#" id="breadcrumb-home" class="breadcrumb-home" title="Go to overview">
                  <span class="icon">home</span>
                  <span>Overview</span>
               </a>
               <span class="breadcrumb-separator">›</span>
               <div id="breadcrumb-current" class="breadcrumb-item">
                  <span class="breadcrumb-link active">Current Section</span>
               </div>
               <div class="breadcrumb-section-info">
                  <div class="breadcrumb-progress">
                     <span class="icon">trending_up</span>
                     <div class="breadcrumb-progress-bar">
                        <div id="breadcrumb-progress-fill" class="breadcrumb-progress-fill"></div>
                     </div>
                     <span id="breadcrumb-progress-text">0%</span>
                  </div>
                  <div id="breadcrumb-section-count">
                     Section 1 of 13
                  </div>
               </div>
            </nav>
         </div>
      </header>
      
      <div class="product-header">
         <h1 id="application-technical-profile">Application Technical Profile</h1>
         <p style="font-size: 16px">A structured and in-depth technical overview of the application, capturing key architectural elements, technology stack, system components, and more. This profile serves as a foundational reference for modernization, migration, and governance initiatives.</p>
         <div class="document-meta">
            <div class="read-time" id="total-read-time">
               <span class="icon">schedule</span>
               <span>Calculating...</span>
            </div>
         </div>
      </div>
      <div id="tab-container-placeholder"></div>
      
      <main class="content" id="main-content-area">
<div class="product-section">
<h2 id="1-application-overview">1. Application overview</h2>
This section contains high-level, application-level information, providing a summary of its main characteristics and components.
<div class="table-container">
<table>
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr>
<th style="text-align: left;">Attribute</th>
<th style="text-align: left;">Value</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>Acronym</strong></td>
<td style="text-align: left;">SDCIM</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Application name</strong></td>
<td style="text-align: left;">Image Concentration System</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Primary business purpose</strong></td>
<td style="text-align: left;">A backend processing system for bank remittances (cheques, deposits). It handles the reception of remittance files, processes transactions in batches (tranches), manages alerts for different situations, and provides a Windows-based user interface for monitoring and manual intervention.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Business domain</strong></td>
<td style="text-align: left;">Banking, Financial Services, Remittance Processing</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Solution files</strong></td>
<td style="text-align: left;">2 solutions: <code>CIControloComSetup.sln</code>, <code>CIControloSemSetup.sln</code></td>
</tr>
<tr>
<td style="text-align: left;"><strong>Project files</strong></td>
<td style="text-align: left;">18 projects: <code>Alerta.csproj</code>, <code>CIActividades.csproj</code>, <code>CIConfigGlobalParameters.csproj</code>, <code>CIConfiguration.csproj</code>, <code>CIControlo.csproj</code>, <code>CIFicheiro.csproj</code>, <code>CIFicheirosControlo.csproj</code>, <code>CIReports.csproj</code>, <code>CIServAlertas.csproj</code>, <code>CIServRemessas.csproj</code>, <code>CIServico.csproj</code>, <code>CIServTester.csproj</code>, <code>CITestes.csproj</code>, <code>MDIsControlo.csproj</code>, <code>MDIWebTransmCI.vbproj</code>, <code>QueryForm.csproj</code>, <code>SetupCIControlo.vdproj</code>, <code>CIDepositoErro.csproj</code></td>
</tr>
<tr>
<td style="text-align: left;"><strong>Files</strong></td>
<td style="text-align: left;">- C# source code files (.cs): 55<br>- C# project files (.csproj): 17<br>- Visual Basic.NET project files (.vbproj): 1<br>- Visual Basic.NET source code files (.vb): 4<br>- Solution files (.sln): 2<br>- Application configuration files (.config): 7<br>- Resource files (.resx): 11<br>- SQL files (.sql): 5<br>- Crystal Reports files (.rpt): 5<br>- Batch files (.bat): 3<br>- Other (e.g., .settings, .map, .ps1): 7</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Main programming language(s)</strong></td>
<td style="text-align: left;">C#, VB.NET</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Target .NET Framework(s)</strong></td>
<td style="text-align: left;">.NET Framework 4.0</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Application type</strong></td>
<td style="text-align: left;">Composite Application (Windows Forms, Windows Service, Class Libraries)</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Output type</strong></td>
<td style="text-align: left;">.dll (Dynamic Link Library), .exe (Executable)</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Deployment model</strong></td>
<td style="text-align: left;">On-premises</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Deployment target platform</strong></td>
<td style="text-align: left;">AnyCPU</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Complexity</strong></td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High complexity</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Last updated (Source code)</strong></td>
<td style="text-align: left;">2008 (Based on copyright information)</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Last updated (Documentation)</strong></td>
<td style="text-align: left;">2025-08-06</td>
</tr>
</tbody>
</table>
</div>
<h3 id="11-main-components-and-features">1.1. Main components and features</h3>
The application is composed of several distinct components, each with a specific responsibility within the remittance processing workflow. A component diagram can visualize these relationships.
<div class="table-container">
<table>
<colgroup>
<col style="width: 16%" />
<col style="width: 16%" />
<col style="width: 16%" />
<col style="width: 16%" />
<col style="width: 16%" />
<col style="width: 16%" />
</colgroup>
<thead>
<tr>
<th style="text-align: left;">Component</th>
<th style="text-align: left;">Description</th>
<th style="text-align: left;">Key features</th>
<th style="text-align: left;">Dependencies</th>
<th style="text-align: left;">Related projects</th>
<th style="text-align: left;">Technologies</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>UI & Control</strong></td>
<td style="text-align: left;">Provides the main user interface for monitoring activities, managing configurations, and executing manual tasks.</td>
<td style="text-align: left;">- Activity monitoring (remittances, tranches, documents)<br>- User and permissions management<br>- System configuration</td>
<td style="text-align: left;"><code>CIConfigGlobalParameters</code>, <code>Alerta</code>, <code>NBIISNET.dll</code></td>
<td style="text-align: left;"><code>CIControlo.csproj</code>, <code>CIActividades.csproj</code>, <code>QueryForm.csproj</code>, <code>MDIsControlo.csproj</code></td>
<td style="text-align: left;">Windows Forms, C#</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Remittance Processing</strong></td>
<td style="text-align: left;">Core business logic for handling remittances, including processing over-the-counter transactions and creating tranches.</td>
<td style="text-align: left;">- Process remittances from various sources<br>- Create and manage transaction tranches<br>- Handle remittance lifecycle states</td>
<td style="text-align: left;"><code>CIConfigGlobalParameters</code></td>
<td style="text-align: left;"><code>CIServRemessas.csproj</code>, <code>CIServTester.csproj</code></td>
<td style="text-align: left;">C#</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Alerting System</strong></td>
<td style="text-align: left;">Manages system-wide alerts based on predefined situations and triggers actions like sending emails or logging to the database.</td>
<td style="text-align: left;">- Define alert situations and corresponding actions<br>- Send email notifications (SMTP, EWS)<br>- Log alerts to Event Viewer, files, or database</td>
<td style="text-align: left;"><code>CIConfigGlobalParameters</code>, <code>CGDSendWebmail.dll</code></td>
<td style="text-align: left;"><code>Alerta.csproj</code>, <code>CIServAlertas.csproj</code></td>
<td style="text-align: left;">C#</td>
</tr>
<tr>
<td style="text-align: left;"><strong>File Processing</strong></td>
<td style="text-align: left;">Handles the ingestion and processing of external files like ACOM and ENVM, which are standard banking file formats.</td>
<td style="text-align: left;">- Watch directories for new files<br>- Parse fixed-format text files<br>- Validate and insert file data into the database</td>
<td style="text-align: left;"><code>CIConfigGlobalParameters</code></td>
<td style="text-align: left;"><code>CIFicheiro.csproj</code>, <code>CIFicheirosControlo.csproj</code></td>
<td style="text-align: left;">C#</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Reporting</strong></td>
<td style="text-align: left;">Generates reports based on the application's data, such as remittance summaries and monthly invoicing.</td>
<td style="text-align: left;">- Generate Crystal Reports<br>- Provide forms for report filtering</td>
<td style="text-align: left;"><code>CrystalDecisions.*.dll</code>, <code>GenericReportNet.dll</code></td>
<td style="text-align: left;"><code>CIReports.csproj</code></td>
<td style="text-align: left;">Crystal Reports, C#</td>
</tr>
<tr>
<td style="text-align: left;"><strong>System Service</strong></td>
<td style="text-align: left;">A Windows Service that orchestrates the automated background processing tasks of the application.</td>
<td style="text-align: left;">- Runs as a background Windows Service<br>- Periodically checks for work (new remittances, alerts)<br>- Manages processing threads</td>
<td style="text-align: left;"><code>CIServRemessas</code>, <code>CIServAlertas</code>, <code>CIFicheiro</code></td>
<td style="text-align: left;"><code>CIServico.csproj</code></td>
<td style="text-align: left;">C#, Windows Services</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Configuration & Shared Logic</strong></td>
<td style="text-align: left;">Centralized parameters and common logic used across the entire application.</td>
<td style="text-align: left;">- Database connection management<br>- User session information<br>- Global application settings</td>
<td style="text-align: left;"><code>GenericNet.dll</code>, <code>GenericLogNET.dll</code></td>
<td style="text-align: left;"><code>CIConfigGlobalParameters.csproj</code>, <code>CIConfiguration.csproj</code></td>
<td style="text-align: left;">C#</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Web Service Integration</strong></td>
<td style="text-align: left;">Provides client-side logic to consume external SOAP-based web services for MDI document insertion.</td>
<td style="text-align: left;">- Call external web services<br>- Marshal data to/from SOAP format</td>
<td style="text-align: left;"><code>System.Web.Services</code></td>
<td style="text-align: left;"><code>MDIWebTransmCI.vbproj</code></td>
<td style="text-align: left;">VB.NET, SOAP</td>
</tr>
</tbody>
</table>
</div>
<pre class="mermaid"><code>flowchart TD
    subgraph "User Interface Layer"
        CIControlo["CIControlo (Main UI)"]
        CIActividades["CIActividades (Monitoring)"]
        CIConfiguration["CIConfiguration (Setup)"]
        CIReports["CIReports (Reporting)"]
    end

    subgraph "Service & Business Logic Layer"
        CIServico["CIServico (Windows Service)"]
        CIServRemessas["CIServRemessas (Remittance Logic)"]
        CIServAlertas["CIServAlertas (Alerting Logic)"]
        CIFicheiro["CIFicheiro (File Processing)"]
        MDIWebTransmCI["MDIWebTransmCI (Web Service Client)"]
    end

    subgraph "Core/Shared Layer"
        CIConfigGlobalParameters["CIConfigGlobalParameters (Shared)"]
        Alerta["Alerta (Alerting Entities)"]
    end

    subgraph "External Systems"
        DB[(Database)]
        FS["/File System (ENVM/ACOM)/"]
        WS(("SOAP Web Service"))
        EmailServer{{"Email Server"}}
    end

    CIControlo --> CIActividades
    CIControlo --> CIConfiguration
    CIControlo --> CIReports
    CIActividades --> CIServRemessas
    CIActividades --> CIConfigGlobalParameters

    CIServico --> CIServRemessas
    CIServico --> CIServAlertas
    CIServico --> CIFicheiro

    CIServRemessas --> CIConfigGlobalParameters
    CIServRemessas --> DB
    CIServAlertas --> Alerta
    CIServAlertas --> EmailServer
    CIServAlertas --> DB
    CIFicheiro --> FS
    CIFicheiro --> DB

    MDIWebTransmCI --> WS
    CIActividades --> MDIWebTransmCI

    Alerta --> CIConfigGlobalParameters
    Alerta --> DB
</code></pre>
<center>Figure 1 - High-level component diagram showing the relationships between the main application components and external systems.</center>
<h3 id="12-solutions">1.2. Solutions</h3>
The application code is organized into two main solution files, likely for development with and without the setup project. A mind map can effectively show the project hierarchy within each solution.
<div class="table-container">
<table>
<colgroup>
<col style="width: 33%" />
<col style="width: 33%" />
<col style="width: 33%" />
</colgroup>
<thead>
<tr>
<th style="text-align: left;">Solution</th>
<th style="text-align: left;">Projects</th>
<th style="text-align: left;">Visual studio version</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>CIControloComSetup.sln</strong></td>
<td style="text-align: left;">- <code>Alerta.csproj</code><br>- <code>CIActividades.csproj</code><br>- <code>CIConfigGlobalParameters.csproj</code><br>- <code>CIConfiguration.csproj</code><br>- <code>CIControlo.csproj</code><br>- <code>CIFicheiro.csproj</code><br>- <code>CIFicheirosControlo.csproj</code><br>- <code>CIReports.csproj</code><br>- <code>CIServAlertas.csproj</code><br>- <code>CIServRemessas.csproj</code><br>- <code>CIServico.csproj</code><br>- <code>CIServTester.csproj</code><br>- <code>CITestes.csproj</code><br>- <code>MDIsControlo.csproj</code><br>- <code>MDIWebTransmCI.vbproj</code><br>- <code>QueryForm.csproj</code><br>- <code>SetupCIControlo.vdproj</code></td>
<td style="text-align: left;">2010</td>
</tr>
<tr>
<td style="text-align: left;"><strong>CIControloSemSetup.sln</strong></td>
<td style="text-align: left;">- <code>Alerta.csproj</code><br>- <code>CIActividades.csproj</code><br>- <code>CIConfigGlobalParameters.csproj</code><br>- <code>CIConfiguration.csproj</code><br>- <code>CIControlo.csproj</code><br>- <code>CIFicheiro.csproj</code><br>- <code>CIFicheirosControlo.csproj</code><br>- <code>CIReports.csproj</code><br>- <code>CIServAlertas.csproj</code><br>- <code>CIServRemessas.csproj</code><br>- <code>CIServico.csproj</code><br>- <code>CIServTester.csproj</code><br>- <code>CITestes.csproj</code><br>- <code>MDIsControlo.csproj</code><br>- <code>MDIWebTransmCI.vbproj</code><br>- <code>QueryForm.csproj</code><br>- <code>CIDepositoErro.csproj</code></td>
<td style="text-align: left;">2010</td>
</tr>
</tbody>
</table>
</div>
<pre class="mermaid"><code>mindmap
  root((SDCIM Solutions))
    CIControloComSetup.sln
      CIControlo
      CIActividades
      CIServico
      CIConfiguration
      CIReports
      Alerta
      CIServRemessas
      CIFicheiro
      MDIsControlo
      MDIWebTransmCI
      QueryForm
      CIServTester
      CITestes
      SetupCIControlo
    CIControloSemSetup.sln
      CIControlo
      CIActividades
      CIServico
      CIConfiguration
      CIReports
      Alerta
      CIServRemessas
      CIFicheiro
      MDIsControlo
      MDIWebTransmCI
      QueryForm
      CIServTester
      CITestes
      CIDepositoErro
</code></pre>
<center>Figure 2 - Mind map illustrating the project structure within each solution file.</center>
<h3 id="13-projects">1.3. Projects</h3>
This section details each project within the solutions, outlining their purpose, dependencies, and key characteristics. A dependency graph can illustrate the relationships between projects.
<div class="table-container">
<table>
<colgroup>
<col style="width: 7%" />
<col style="width: 7%" />
<col style="width: 7%" />
<col style="width: 7%" />
<col style="width: 7%" />
<col style="width: 7%" />
<col style="width: 7%" />
<col style="width: 7%" />
<col style="width: 7%" />
<col style="width: 7%" />
<col style="width: 7%" />
<col style="width: 7%" />
<col style="width: 7%" />
</colgroup>
<thead>
<tr>
<th style="text-align: left;">Solution</th>
<th style="text-align: left;">Project</th>
<th style="text-align: left;">Main objectives</th>
<th style="text-align: left;">Type</th>
<th style="text-align: left;">Output type</th>
<th style="text-align: left;">Version</th>
<th style="text-align: left;">Runtime</th>
<th style="text-align: left;">Framework</th>
<th style="text-align: left;">Architecture</th>
<th style="text-align: left;">Compilation mode</th>
<th style="text-align: left;">Principal classes</th>
<th style="text-align: left;">Internal dependencies</th>
<th style="text-align: left;">External dependencies</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;">Both</td>
<td style="text-align: left;"><strong>CIControlo.csproj</strong></td>
<td style="text-align: left;">Main GUI application for monitoring and control.</td>
<td style="text-align: left;">Windows Application</td>
<td style="text-align: left;">Executable</td>
<td style="text-align: left;">1.0.0.0</td>
<td style="text-align: left;">v4.0.30319</td>
<td style="text-align: left;">.NET Framework 4.0</td>
<td style="text-align: left;">AnyCPU</td>
<td style="text-align: left;">Debug/Release</td>
<td style="text-align: left;"><code>CIMainForm.cs</code></td>
<td style="text-align: left;"><code>CIActividades</code>, <code>CIConfiguration</code>, <code>CIReports</code>, <code>CIServTester</code>, <code>MDIsControlo</code>, <code>QueryForm</code>, <code>CIConfigGlobalParameters</code>, <code>CIFicheirosControlo</code></td>
<td style="text-align: left;"><code>GenericNet</code>, <code>NBIISNET</code>, <code>GenericLogNET</code></td>
</tr>
<tr>
<td style="text-align: left;">Both</td>
<td style="text-align: left;"><strong>CIActividades.csproj</strong></td>
<td style="text-align: left;">Contains WinForms for viewing and managing activities.</td>
<td style="text-align: left;">Class Library</td>
<td style="text-align: left;">Library</td>
<td style="text-align: left;">1.0.0.0</td>
<td style="text-align: left;">v4.0.30319</td>
<td style="text-align: left;">.NET Framework 4.0</td>
<td style="text-align: left;">AnyCPU</td>
<td style="text-align: left;">Debug/Release</td>
<td style="text-align: left;"><code>ActividadeBalcaoForm.cs</code>, <code>ActividadesForm.cs</code></td>
<td style="text-align: left;"><code>Alerta</code>, <code>CIConfigGlobalParameters</code></td>
<td style="text-align: left;"><code>NBIISNET</code>, <code>GenericNet</code>, <code>GenericLogNET</code>, <code>CrystalDecisions</code></td>
</tr>
<tr>
<td style="text-align: left;">Both</td>
<td style="text-align: left;"><strong>Alerta.csproj</strong></td>
<td style="text-align: left;">Defines entities and logic for the alerting system.</td>
<td style="text-align: left;">Class Library</td>
<td style="text-align: left;">Library</td>
<td style="text-align: left;">1.0.0.0</td>
<td style="text-align: left;">v4.0.30319</td>
<td style="text-align: left;">.NET Framework 4.0</td>
<td style="text-align: left;">AnyCPU</td>
<td style="text-align: left;">Debug/Release</td>
<td style="text-align: left;"><code>Accao.cs</code>, <code>AlertaSituacaoAccao.cs</code></td>
<td style="text-align: left;"><code>CIConfigGlobalParameters</code></td>
<td style="text-align: left;"><code>GenericNet</code>, <code>System.Data.SqlClient</code></td>
</tr>
<tr>
<td style="text-align: left;">Both</td>
<td style="text-align: left;"><strong>CIServico.csproj</strong></td>
<td style="text-align: left;">Implements the Windows Service for background processing.</td>
<td style="text-align: left;">Windows Application</td>
<td style="text-align: left;">Executable</td>
<td style="text-align: left;">1.0.0.0</td>
<td style="text-align: left;">v4.0.30319</td>
<td style="text-align: left;">.NET Framework 4.0</td>
<td style="text-align: left;">AnyCPU</td>
<td style="text-align: left;">Debug/Release</td>
<td style="text-align: left;"><code>CIServico.cs</code>, <code>CIServicoThread.cs</code></td>
<td style="text-align: left;"><code>Alerta</code>, <code>CIConfigGlobalParameters</code>, <code>CIFicheiro</code>, <code>CIServAlertas</code>, <code>CIServRemessas</code></td>
<td style="text-align: left;"><code>GenericNet</code>, <code>NBIISNET</code>, <code>GenericLogNET</code></td>
</tr>
<tr>
<td style="text-align: left;">Both</td>
<td style="text-align: left;"><strong>CIServRemessas.csproj</strong></td>
<td style="text-align: left;">Contains the core business logic for processing remittances.</td>
<td style="text-align: left;">Class Library</td>
<td style="text-align: left;">Library</td>
<td style="text-align: left;">1.0.0.0</td>
<td style="text-align: left;">v4.0.30319</td>
<td style="text-align: left;">.NET Framework 4.0</td>
<td style="text-align: left;">AnyCPU</td>
<td style="text-align: left;">Debug/Release</td>
<td style="text-align: left;"><code>ServRemessa.cs</code></td>
<td style="text-align: left;"><code>Alerta</code>, <code>CIConfigGlobalParameters</code>, <code>CIActividades</code></td>
<td style="text-align: left;"><code>GenericNet</code>, <code>NBIISNET</code>, <code>GenericLogNET</code></td>
</tr>
<tr>
<td style="text-align: left;">Both</td>
<td style="text-align: left;"><strong>CITestes.csproj</strong></td>
<td style="text-align: left;">A test project for running specific processing logic, likely for debugging.</td>
<td style="text-align: left;">Class Library</td>
<td style="text-align: left;">Library</td>
<td style="text-align: left;">1.0.0.0</td>
<td style="text-align: left;">v4.0.30319</td>
<td style="text-align: left;">.NET Framework 4.0</td>
<td style="text-align: left;">AnyCPU</td>
<td style="text-align: left;">Debug/Release</td>
<td style="text-align: left;"><code>CIServRemessaTestes.cs</code></td>
<td style="text-align: left;"><code>CIConfigGlobalParameters</code>, <code>CIConfiguration</code>, <code>CIControlo</code>, <code>CIServico</code>, <code>CIServRemessas</code>, <code>CIServTester</code></td>
<td style="text-align: left;"><code>Microsoft.VisualStudio.QualityTools.UnitTestFramework</code></td>
</tr>
<tr>
<td style="text-align: left;">Both</td>
<td style="text-align: left;"><strong>MDIWebTransmCI.vbproj</strong></td>
<td style="text-align: left;">A VB.NET library for consuming an external SOAP web service.</td>
<td style="text-align: left;">Class Library</td>
<td style="text-align: left;">Library</td>
<td style="text-align: left;">1.0.0.0</td>
<td style="text-align: left;">v4.0.30319</td>
<td style="text-align: left;">.NET Framework 4.0</td>
<td style="text-align: left;">AnyCPU</td>
<td style="text-align: left;">Debug/Release</td>
<td style="text-align: left;"><code>TInsertDoc.vb</code></td>
<td style="text-align: left;"><code>CIConfigGlobalParameters</code></td>
<td style="text-align: left;"><code>System.Web.Services</code>, <code>CCAWebTransmCI</code></td>
</tr>
<tr>
<td style="text-align: left;">Both</td>
<td style="text-align: left;"><strong>CIConfiguration.csproj</strong></td>
<td style="text-align: left;">Manages application configuration and provides UI for it.</td>
<td style="text-align: left;">Class Library</td>
<td style="text-align: left;">Library</td>
<td style="text-align: left;">1.0.0.0</td>
<td style="text-align: left;">v4.0.30319</td>
<td style="text-align: left;">.NET Framework 4.0</td>
<td style="text-align: left;">AnyCPU</td>
<td style="text-align: left;">Debug/Release</td>
<td style="text-align: left;"><code>Config.cs</code>, <code>BalcaoForm.cs</code></td>
<td style="text-align: left;"><code>Alerta</code>, <code>CIConfigGlobalParameters</code></td>
<td style="text-align: left;"><code>NBIISNET</code>, <code>GenericNet</code>, <code>GenericLogNET</code></td>
</tr>
</tbody>
</table>
</div>
<pre class="mermaid"><code>flowchart TD
    subgraph "UI Layer"
        CIControlo("CIControlo.csproj")
        CIActividades("CIActividades.csproj")
        CIReports("CIReports.csproj")
        CIFicheirosControlo("CIFicheirosControlo.csproj")
        CIConfiguration("CIConfiguration.csproj")
        MDIsControlo("MDIsControlo.csproj")
        QueryForm("QueryForm.csproj")
    end

    subgraph "Business/Service Layer"
        CIServico("CIServico.csproj")
        CIServRemessas("CIServRemessas.csproj")
        CIServAlertas("CIServAlertas.csproj")
        CIFicheiro("CIFicheiro.csproj")
        MDIWebTransmCI("MDIWebTransmCI.vbproj")
    end

    subgraph "Shared/Domain Layer"
        CIConfigGlobalParameters("CIConfigGlobalParameters.csproj")
        Alerta("Alerta.csproj")
    end

    subgraph "Testing Layer"
        CITestes("CITestes.csproj")
        CIServTester("CIServTester.csproj")
    end

    CIControlo --> CIActividades
    CIControlo --> CIConfiguration
    CIControlo --> CIReports
    CIControlo --> CIFicheirosControlo
    CIControlo --> MDIsControlo
    CIControlo --> QueryForm

    CIServico --> CIServRemessas
    CIServico --> CIServAlertas
    CIServico --> CIFicheiro

    CIActividades --> CIServRemessas
    CIActividades --> Alerta
    CIActividades --> CIConfigGlobalParameters

    CIServRemessas --> CIConfigGlobalParameters
    CIServAlertas --> Alerta
    CIFicheirosControlo --> CIFicheiro
    
    CITestes --> CIServico
    CITestes --> CIServRemessas
    CITestes --> CIServTester

    CIServTester --> CIConfigGlobalParameters
</code></pre>
<center>Figure 3 - Project dependency graph illustrating the relationships between the various projects in the solution.</center>
</div>
<div class="product-section">
<h2 id="2-functional-overview">2. Functional overview</h2>
This section provides a high-level functional decomposition of the application, using table format. It identifies the major, distinct functional blocks or modules as inferred from the code's high-level structure (e.g., top-level namespaces, solution folders, primary class groups). This overview serves as a map to the application's core responsibilities.
<h3 id="21-executive-summary">2.1. Executive summary</h3>
This section provides a high-level summary of the application's primary purpose and its core function from a business or operational perspective, using table format. The summary is an inference based on the main entry points of the code (e.g., <code>main()</code>, <code>Application_Start()</code>), the names of the most central classes and modules, and the nature of the core processes identified. It answers the fundamental question: What primary problem does this application solve?
<div class="table-container">
<table>
<colgroup>
</colgroup>
<thead>
<tr>
</tr>
</thead>
<tbody>
<tr>
</tr>
<tr>
</tr>
<tr>
</tr>
</tbody>
</table>
</div>
<h3 id="22-functional-decomposition">2.2. Functional decomposition</h3>
This section provides a detailed breakdown of the application's functional areas or modules, inferred from the code structure. Each module is described in terms of its primary responsibilities and how it contributes to the overall functionality of the application. The decomposition is based on the organization of namespaces, classes, and methods, as well as the relationships between them.
<div class="table-container">
<table>
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr>
<th style="text-align: left;">Functional Area / Module</th>
<th style="text-align: left;">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>Remittance Processing Engine</strong></td>
<td style="text-align: left;">This is the core of the application, responsible for the end-to-end processing of remittances. It includes logic for creating tranches, validating data, and updating the status of documents and remittances. This module is primarily driven by the <code>CIServico</code> Windows Service and the logic within the <code>CIServRemessas</code> project.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>User Interaction & Monitoring</strong></td>
<td style="text-align: left;">Manages all user-facing interfaces. This includes displaying the status of remittances, documents, and system alerts. It allows operators to perform manual interventions, such as changing the state of a remittance or re-triggering a process. This functionality is encapsulated within the <code>CIActividades</code> and <code>CIControlo</code> projects.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>File Ingestion & Parsing</strong></td>
<td style="text-align: left;">This module is responsible for handling data input from external files. It likely contains file watchers and parsers for specific banking formats (<code>ACOM</code>, <code>ENVM</code>). The <code>CIFicheiro</code> project contains the logic for reading and interpreting these files before they are handed off to the processing engine.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Alerting and Notification System</strong></td>
<td style="text-align: left;">A cross-cutting concern that provides a framework for generating and dispatching alerts based on system events or errors. It can send notifications via email, write to log files, or record events in the database. The <code>Alerta</code> and <code>CIServAlertas</code> projects implement this functionality.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Configuration and Administration</strong></td>
<td style="text-align: left;">Provides interfaces and logic for managing system parameters, user accounts, and operational settings like bank branch (<code>Balcao</code>) configurations. This is handled by the <code>CIConfiguration</code> project.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Reporting</strong></td>
<td style="text-align: left;">This module is responsible for generating business and operational reports. It uses Crystal Reports to create documents based on data from the application's database, covering areas like monthly invoicing and remittance summaries.</td>
</tr>
</tbody>
</table>
</div>
<pre class="mermaid"><code>flowchart TD
    A["User (Operator)"] -- "Monitors & Intervenes" --> B["UI & Monitoring (CIActividades)"]
    C["/File System (ACOM/ENVM)/"] -- "Provides Input Files" --> D["File Ingestion (CIFicheiro)"]
    
    subgraph "Core Application Logic"
        B -- "Triggers Manual Actions" --> E["Remittance Processing Engine (CIServRemessas)"]
        D -- "Sends Parsed Data" --> E
        E -- "Processes Data" --> F[(Database)]
        E -- "Generates Events" --> G["Alerting System (Alerta/CIServAlertas)"]
    end
    
    G -- "Sends Notifications" --> H{{"Email/Logs"}}
    I["Administrator"] -- "Configures System" --> J["Configuration UI (CIConfiguration)"]
    J -- "Updates Settings" --> F
    K["Reporting User"] -- "Requests Reports" --> L["Reporting Module (CIReports)"]
    L -- "Reads Data" --> F
</code></pre>
<center>Figure 4 - Functional decomposition and data flow between modules.</center>
<h3 id="23-user-roles-and-permissions">2.3. User roles and permissions</h3>
This section identifies all distinct types of users (or autonomous systems) that interact with the application. These roles are inferred from authentication logic, authorization checks (e.g., <code>ConfirmaPrivilegios</code> method), or conditional logic based on user properties.
<div class="table-container">
<table>
<colgroup>
<col style="width: 16%" />
<col style="width: 16%" />
<col style="width: 16%" />
<col style="width: 16%" />
<col style="width: 16%" />
<col style="width: 16%" />
</colgroup>
<thead>
<tr>
<th style="text-align: left;">Role</th>
<th style="text-align: left;">Description</th>
<th style="text-align: left;">Permissions</th>
<th style="text-align: left;">Key Actions</th>
<th style="text-align: left;">Key Data Entities</th>
<th style="text-align: left;">Assumptions</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>Administrator</strong></td>
<td style="text-align: left;">A privileged user with full access to system functions, including state changes and configuration.</td>
<td style="text-align: left;">- Full CRUD on most data entities.<br>- Ability to change the state of remittances and tranches.<br>- Access to system configuration and user management.</td>
<td style="text-align: left;"><code>MudarEstado</code>, <code>ReenviarRemessas</code>, <code>Configuracao</code></td>
<td style="text-align: left;"><code>Remessa</code>, <code>Tranche</code>, <code>User</code>, <code>Balcao</code></td>
<td style="text-align: left;">Inferred from <code>m<em>oParameters.UserLogged.m</em>iUserGroup <= 1</code> checks, which grant access to sensitive operations like changing object states.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Standard Operator</strong></td>
<td style="text-align: left;">A standard user with view-only or limited operational capabilities.</td>
<td style="text-align: left;">- View remittance and document status.<br>- Generate reports.<br>- Perform basic searches.</td>
<td style="text-align: left;"><code>Refresh</code>, <code>ViewDetails</code>, <code>GenerateReport</code></td>
<td style="text-align: left;"><code>Remessa</code>, <code>Documento</code>, <code>Alerta</code></td>
<td style="text-align: left;">Inferred as the default role for any user with <code>m_iUserGroup > 1</code>. This role is likely restricted from performing state-changing actions.</td>
</tr>
</tbody>
</table>
</div>
<pre class="mermaid"><code>classDiagram
    class User {
        +m_sUserName: string
        +m_iUserGroup: int
    }
    class Administrator
    class StandardOperator

    User <|-- Administrator
    User <|-- StandardOperator

    Administrator "1" -- "Manages" Remessa
    Administrator "1" -- "Manages" Tranche
    Administrator "1" -- "Configures" Balcao
    StandardOperator "1" ..> "Views" Remessa
    StandardOperator "1" ..> "Views" Documento

    class Remessa
    class Tranche
    class Documento
    class Balcao

    note for Administrator "Has permissions to change state and configuration, identified by m_iUserGroup <= 1"
    note for StandardOperator "Has permissions for viewing and reporting, identified by m_iUserGroup > 1"
</code></pre>
<center>Figure 5 - Class diagram illustrating user roles and their relationship to key data entities.</center>
<h3 id="24-core-business-capabilities">2.4. Core business capabilities</h3>
This section lists the main, high-level capabilities of the application, representing its "Epics" or major functional domains.
<div class="table-container">
<table>
<colgroup>
<col style="width: 20%" />
<col style="width: 20%" />
<col style="width: 20%" />
<col style="width: 20%" />
<col style="width: 20%" />
</colgroup>
<thead>
<tr>
<th style="text-align: left;">Capability</th>
<th style="text-align: left;">Description</th>
<th style="text-align: left;">Key Features</th>
<th style="text-align: left;">Key Data Entities</th>
<th style="text-align: left;">Assumptions</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>Remittance Data Processing</strong></td>
<td style="text-align: left;">The complete set of functions related to ingesting, processing, and finalizing remittance data from bank branches.</td>
<td style="text-align: left;">- File-based Import (<code>ENVM</code>, <code>ACOM</code>).<br>- Batch (Tranche) Processing.<br>- State Management (e.g., <code>Fechado</code>, <code>Processado</code>, <code>Enviada</code>).<br>- Image and Data Association.</td>
<td style="text-align: left;"><code>Remessa</code>, <code>Tranche</code>, <code>Documento</code>, <code>Ficheiro</code></td>
<td style="text-align: left;">Assumes that any module listening for external files (<code>CIFicheiro</code>) or processing data in batches (<code>CIServRemessas</code>) is part of this capability.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Operational Monitoring and Control</strong></td>
<td style="text-align: left;">Provides a user interface for real-time monitoring of system activities and allows for manual intervention when necessary.</td>
<td style="text-align: left;">- View Remittance/Tranche/Document status.<br>- Manually change the state of a process.<br>- Search and filter activities by date, branch, etc.</td>
<td style="text-align: left;"><code>Remessa</code>, <code>Tranche</code>, <code>Documento</code>, <code>Alerta</code></td>
<td style="text-align: left;">Inferred from the UI-heavy projects like <code>CIActividades</code> and <code>CIControlo</code>, which are designed for operator interaction.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>System Alerting and Notification</strong></td>
<td style="text-align: left;">A comprehensive system for generating, dispatching, and logging alerts based on predefined business or technical events.</td>
<td style="text-align: left;">- Email notifications.<br>- Logging to Event Viewer.<br>- Database-driven alert configuration.<br>- File-based logging.</td>
<td style="text-align: left;"><code>Alerta</code>, <code>Accao</code>, <code>SituacaoAccao</code></td>
<td style="text-align: left;">Inferred from the <code>Alerta</code> and <code>CIServAlertas</code> projects, which are dedicated to handling system notifications and actions.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Reporting and Auditing</strong></td>
<td style="text-align: left;">The capability to generate structured reports for business intelligence, billing, and auditing purposes.</td>
<td style="text-align: left;">- Generate Crystal Reports.<br>- Filter reports by date and other criteria.<br>- Monthly invoicing reports.</td>
<td style="text-align: left;"><code>VW<em>REPORT</em>ACOM<em>RESUMO</code>, <code>VW</em>FATURACAO_MENSAL</code></td>
<td style="text-align: left;">Based on the <code>CIReports</code> project and the presence of <code>.rpt</code> and <code>.sql</code> files for reporting.</td>
</tr>
</tbody>
</table>
</div>
<h3 id="25-detailed-feature-breakdown">2.5. Detailed feature breakdown</h3>
This critical section provides a granular breakdown of individual features within each Core Business Capability.
<div class="table-container">
<table>
<colgroup>
<col style="width: 25%" />
<col style="width: 25%" />
<col style="width: 25%" />
<col style="width: 25%" />
</colgroup>
<thead>
<tr>
<th style="text-align: left;">Feature</th>
<th style="text-align: left;">User Story / Description</th>
<th style="text-align: left;">Key Data Entities</th>
<th style="text-align: left;">Assumptions</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>Process Over-the-Counter Remittance</strong></td>
<td style="text-align: left;">As a <strong>System</strong>, I can process a batch of over-the-counter remittances so that cheque and deposit data is correctly entered into the system for clearing. This involves creating tranches and processing individual documents.</td>
<td style="text-align: left;"><code>Remessa</code>, <code>Tranche</code>, <code>Documento</code></td>
<td style="text-align: left;">Inferred from the <code>ProcessarTrancheBalcao</code> and <code>ServRemessa</code> classes.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Change Remittance State</strong></td>
<td style="text-align: left;">As an <strong>Administrator</strong>, I can manually change the state of a remittance (e.g., from 'Error' to 'Pending') to correct processing issues or re-trigger a failed job.</td>
<td style="text-align: left;"><code>Remessa</code>, <code>Tranche</code></td>
<td style="text-align: left;">Inferred from the <code>MudarEstadoForm</code> and the context menus in <code>ActividadesForm</code> that allow state changes.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Send Alert Email</strong></td>
<td style="text-align: left;">As the <strong>System</strong>, when a specific situation occurs (e.g., a processing error), I can send an email notification to a configured list of recipients so that operators are informed of the event.</td>
<td style="text-align: left;"><code>Alerta</code>, <code>Accao</code>, <code>SituacaoAccao</code></td>
<td style="text-align: left;">Inferred from <code>ServAlertasSendWebmail.cs</code> and the <code>Accao.enuTipoAccao.MAILWEBDAV</code> enum value.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>View Remittance Details</strong></td>
<td style="text-align: left;">As an <strong>Operator</strong>, I can drill down from a summary view of remittances to see the detailed list of individual remittances, tranches, and the documents they contain, so that I can investigate specific transactions.</td>
<td style="text-align: left;"><code>Remessa</code>, <code>Tranche</code>, <code>Documento</code></td>
<td style="text-align: left;">This is the primary function of the <code>ActividadesForm</code> and <code>ActividadeBalcaoForm</code>, which use nested ListViews to display hierarchical data.</td>
</tr>
</tbody>
</table>
</div>
<h3 id="26-key-data-entities-and-their-attributes">2.6. Key data entities and their attributes</h3>
This section documents the application's core data structures, as inferred from class definitions or ORM configurations.
<div class="table-container">
<table>
<colgroup>
<col style="width: 14%" />
<col style="width: 14%" />
<col style="width: 14%" />
<col style="width: 14%" />
<col style="width: 14%" />
<col style="width: 14%" />
<col style="width: 14%" />
</colgroup>
<thead>
<tr>
<th style="text-align: left;">Entity</th>
<th style="text-align: left;">Description</th>
<th style="text-align: left;">Key Attributes</th>
<th style="text-align: left;">Data Type</th>
<th style="text-align: left;">Validation Rules</th>
<th style="text-align: left;">Relationships</th>
<th style="text-align: left;">Assumptions</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>Remessa</strong></td>
<td style="text-align: left;">Represents a remittance, which is a collection of documents (like cheques) submitted for processing. It has a distinct lifecycle managed by status codes.</td>
<td style="text-align: left;"><code>remId</code>, <code>remData</code>, <code>timer</code>, <code>estadoId</code>, <code>estadoRemessa</code>, <code>montante</code></td>
<td style="text-align: left;"><code>int</code>, <code>DateTime</code>, <code>int</code>, <code>string</code>, <code>double</code></td>
<td style="text-align: left;"><code>remId</code>: Primary Key.</td>
<td style="text-align: left;">Has a one-to-many relationship with <code>Tranche</code> and <code>Documento</code>.</td>
<td style="text-align: left;">Inferred from <code>DetalheRemessa.cs</code>. The status is managed via an integer ID that maps to a description.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Tranche</strong></td>
<td style="text-align: left;">Represents a sub-batch of documents within a larger remittance, used for processing in manageable chunks.</td>
<td style="text-align: left;"><code>transId</code>, <code>remId</code>, <code>numero</code>, <code>estado</code>, <code>quantidade</code>, <code>montante</code></td>
<td style="text-align: left;"><code>int</code>, <code>int</code>, <code>int</code>, <code>string</code>, <code>int</code>, <code>double</code></td>
<td style="text-align: left;"><code>transId</code>: Primary Key.</td>
<td style="text-align: left;">Belongs to one <code>Remessa</code>. Has a one-to-many relationship with <code>Documento</code>.</td>
<td style="text-align: left;">Inferred from <code>DetalheTranche.cs</code>. Represents a processing batch.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Documento</strong></td>
<td style="text-align: left;">Represents a single financial document, such as a cheque, with its associated metadata and image data.</td>
<td style="text-align: left;"><code>docID</code>, <code>remId</code>, <code>transId</code>, <code>ZIB</code>, <code>numConta</code>, <code>numCheque</code>, <code>montante</code>, <code>estadoDoc</code></td>
<td style="text-align: left;"><code>int</code>, <code>int</code>, <code>int</code>, <code>string</code>, <code>string</code>, <code>string</code>, <code>double</code>, <code>string</code></td>
<td style="text-align: left;"><code>docID</code>: Primary Key.</td>
<td style="text-align: left;">Belongs to one <code>Tranche</code> and one <code>Remessa</code>.</td>
<td style="text-align: left;">Inferred from <code>DetalheDocumento.cs</code>. Contains MICR line data (ZIB, Conta, Cheque).</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Alerta</strong></td>
<td style="text-align: left;">Represents a system alert triggered by a specific event or situation. It is linked to one or more actions to be performed.</td>
<td style="text-align: left;"><code>ALERT<em>ID</code>, <code>AL</em>TIMER</code>, <code>AL<em>TEXT</code>, <code>SITUACAO</em>ID</code></td>
<td style="text-align: left;"><code>string</code>, <code>DateTime</code>, <code>string</code>, <code>int</code></td>
<td style="text-align: left;"><code>ALERT_ID</code>: Primary Key.</td>
<td style="text-align: left;">Linked to <code>SituacaoAccao</code> to determine the action to take.</td>
<td style="text-align: left;">Inferred from <code>AlertaSituacaoAccao.cs</code>.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Accao</strong></td>
<td style="text-align: left;">Represents a specific action that can be triggered by an alert, such as sending an email or writing to a log file.</td>
<td style="text-align: left;"><code>ACC<em>ID</code>, <code>ACC</em>DESC</code>, <code>TIPACC<em>ID</code></td>
<td style="text-align: left;"><code>int</code>, <code>string</code>, <code>enum</code></td>
<td style="text-align: left;"><code>ACC</em>ID</code>: Primary Key.</td>
<td style="text-align: left;">Defined by an <code>enuTipoAccao</code> which specifies its type (e.g., EMAIL, LOGDB).</td>
<td style="text-align: left;">Inferred from <code>Accao.cs</code>.</td>
</tr>
</tbody>
</table>
</div>
<pre class="mermaid"><code>erDiagram
    REMESSA {
        int remId PK
        datetime remData
        int estadoId
        string estadoRemessa
    }
    TRANCHE {
        int transId PK
        int remId FK
        int numero
        string estado
    }
    DOCUMENTO {
        int docID PK
        int transId FK
        string ZIB
        string numConta
        string numCheque
        double montante
    }
    ALERTA {
        string ALERT_ID PK
        datetime AL_TIMER
        string AL_TEXT
        int SITUACAO_ID FK
    }
    SITUACAO_ACCAO {
        int SITUACAO_ID PK
        int ACC_ID PK
    }
    ACCAO {
        int ACC_ID PK
        string ACC_DESC
        int TIPACC_ID
    }
    REMESSA ||--o{ TRANCHE : "contains"
    TRANCHE ||--o{ DOCUMENTO : "contains"
    ALERTA }o--|| SITUACAO_ACCAO : "triggers"
    ACCAO }o--|| SITUACAO_ACCAO : "is triggered by"
</code></pre>
<center>Figure 6 - Entity-Relationship diagram showing the main data entities and their relationships.</center>
<h3 id="27-business-process-workflows">2.7. Business process workflows</h3>
This section describes and visualizes critical end-to-end processes, showing how different user roles and system features interact.
<div class="table-container">
<table>
<colgroup>
<col style="width: 16%" />
<col style="width: 16%" />
<col style="width: 16%" />
<col style="width: 16%" />
<col style="width: 16%" />
<col style="width: 16%" />
</colgroup>
<thead>
<tr>
<th style="text-align: left;">Process</th>
<th style="text-align: left;">Description</th>
<th style="text-align: left;">Key Steps</th>
<th style="text-align: left;">User Roles Involved</th>
<th style="text-align: left;">Key Data Entities</th>
<th style="text-align: left;">Assumptions</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>Automated Remittance Processing</strong></td>
<td style="text-align: left;">A fully automated workflow where the system ingests remittance files, processes them, and sends them for clearing without manual intervention.</td>
<td style="text-align: left;">1. Ingest <code>ENVM</code>/<code>ACOM</code> files.<br>2. Create <code>Remessa</code> records.<br>3. Process documents and create <code>Tranche</code> records.<br>4. Update status to <code>Processado</code> or <code>Enviada</code>.<br>5. Trigger alerts on error.</td>
<td style="text-align: left;">System</td>
<td style="text-align: left;"><code>Ficheiro</code>, <code>Remessa</code>, <code>Tranche</code>, <code>Documento</code>, <code>Alerta</code></td>
<td style="text-align: left;">Inferred from the <code>CIServico</code> Windows Service, which runs background tasks for file processing and remittance handling.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Manual State Correction</strong></td>
<td style="text-align: left;">An operator-driven workflow to manually correct the state of a remittance or tranche that has encountered an error.</td>
<td style="text-align: left;">1. User opens <code>ActividadesForm</code>.<br>2. User searches for a remittance in an error state.<br>3. User selects the item and chooses "Mudar Estado".<br>4. System updates the record's status, potentially re-queuing it for processing.</td>
<td style="text-align: left;">Administrator</td>
<td style="text-align: left;"><code>Remessa</code>, <code>Tranche</code></td>
<td style="text-align: left;">Inferred from the context menus and state-changing forms (<code>MudarEstadoForm</code>) in the UI projects.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Alert Handling</strong></td>
<td style="text-align: left;">The process by which the system detects an issue, creates an alert, and executes the configured notification actions.</td>
<td style="text-align: left;">1. An error occurs during processing.<br>2. An <code>Alerta</code> record is created with a specific <code>SITUACAO_ID</code>.<br>3. The alerting service (<code>CIServAlertas</code>) picks up the alert.<br>4. The service performs the associated <code>Accao</code> (e.g., sends an email).</td>
<td style="text-align: left;">System, Administrator (recipient)</td>
<td style="text-align: left;"><code>Alerta</code>, <code>SituacaoAccao</code>, <code>Accao</code></td>
<td style="text-align: left;">Inferred from the <code>Alerta</code> project and the <code>ProcessarAlertas</code> class.</td>
</tr>
</tbody>
</table>
</div>
<pre class="mermaid"><code>flowchart TD
    subgraph "Workflows"
        A["Automated Remittance Processing"]
        B["Manual State Correction"]
        C["Alert Handling"]
    end
    
    A -- "On Error" --> C
    B -- "Corrects Errors for" --> A
</code></pre>
<center>Figure 7 - High-level overview of the main business process workflows.</center>
<h4 id="271-workflow-automated-remittance-processing">2.7.1. Workflow: Automated Remittance Processing</h4>
This section provides a detailed breakdown of the Automated Remittance Processing workflow, including the steps involved, user roles, key data entities, and any assumptions made.
<div class="table-container">
<table>
<colgroup>
<col style="width: 20%" />
<col style="width: 20%" />
<col style="width: 20%" />
<col style="width: 20%" />
<col style="width: 20%" />
</colgroup>
<thead>
<tr>
<th style="text-align: left;">Step</th>
<th style="text-align: left;">Description</th>
<th style="text-align: left;">User Role</th>
<th style="text-align: left;">Key Data Entities</th>
<th style="text-align: left;">Assumptions</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>1. File Ingestion</strong></td>
<td style="text-align: left;">The <code>CIServico</code> Windows Service monitors specific file system directories for new <code>ENVM</code> or <code>ACOM</code> files. When a new file is detected, it is parsed.</td>
<td style="text-align: left;">System</td>
<td style="text-align: left;"><code>Ficheiro</code></td>
<td style="text-align: left;">Inferred from <code>CIFicheiro</code> project and file-related settings. Assumes a file watcher pattern.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>2. Remittance Creation</strong></td>
<td style="text-align: left;">Based on the parsed file data, new <code>Remessa</code> and <code>Documento</code> records are created in the database with an initial status (e.g., 'Awaiting Processing').</td>
<td style="text-align: left;">System</td>
<td style="text-align: left;"><code>Remessa</code>, <code>Documento</code></td>
<td style="text-align: left;">Inferred from the data model. Assumes a direct mapping from file records to database entities.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>3. Tranche Processing</strong></td>
<td style="text-align: left;">The <code>CIServRemessas</code> logic groups documents from a remittance into one or more <code>Tranche</code> objects for batch processing. This is likely done to manage memory and transaction size.</td>
<td style="text-align: left;">System</td>
<td style="text-align: left;"><code>Tranche</code>, <code>Documento</code></td>
<td style="text-align: left;">Inferred from the <code>ProcessarTrancheBalcao</code> and <code>TratarTranchesBalcao</code> methods.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>4. State Update</strong></td>
<td style="text-align: left;">As processing completes successfully, the status of each <code>Documento</code>, <code>Tranche</code>, and <code>Remessa</code> is updated to reflect its progress (e.g., 'Processado', 'Enviada').</td>
<td style="text-align: left;">System</td>
<td style="text-align: left;"><code>Remessa</code>, <code>Tranche</code>, <code>Documento</code></td>
<td style="text-align: left;">This is a standard pattern in batch processing systems to track job status.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>5. Error Handling</strong></td>
<td style="text-align: left;">If any step fails, the status is updated to an error state (e.g., -40), and an <code>Alerta</code> is triggered to notify operators.</td>
<td style="text-align: left;">System</td>
<td style="text-align: left;"><code>Remessa</code>, <code>Alerta</code></td>
<td style="text-align: left;">Inferred from <code>try-catch</code> blocks that call <code>updateRemssaErro</code> and <code>EnviarAlertaSituacao</code>.</td>
</tr>
</tbody>
</table>
</div>
<pre class="mermaid"><code>sequenceDiagram
    participant FS as File System
    participant Service as CIServico
    participant Logic as CIServRemessas
    participant DB as Database

    loop Automated Processing
        Service->>FS: Watch for new files (ENVM/ACOM)
        FS-->>Service: New file detected
        Service->>Logic: ProcessFile(fileName)
        Logic->>DB: Create Remessa/Documento records
        DB-->>Logic: RemessaID
        Logic->>Logic: Group Documents into Tranches
        Logic->>DB: Create Tranche records
        DB-->>Logic: TrancheID
        Logic->>Logic: Process each Document
        alt Successful Processing
            Logic->>DB: Update Document/Tranche/Remessa Status to 'Processed'
        else Processing Error
            Logic->>DB: Update Status to 'Error'
            Logic->>DB: Create Alerta record
        end
    end
</code></pre>
<center>Figure 8 - Sequence diagram detailing the Automated Remittance Processing workflow.</center>
<h4 id="272-workflow-manual-state-correction">2.7.2. Workflow: Manual State Correction</h4>
This section provides a detailed breakdown of the Manual State Correction workflow, including the steps involved, user roles, key data entities, and any assumptions made.
<div class="table-container">
<table>
<colgroup>
<col style="width: 20%" />
<col style="width: 20%" />
<col style="width: 20%" />
<col style="width: 20%" />
<col style="width: 20%" />
</colgroup>
<thead>
<tr>
<th style="text-align: left;">Step</th>
<th style="text-align: left;">Description</th>
<th style="text-align: left;">User Role</th>
<th style="text-align: left;">Key Data Entities</th>
<th style="text-align: left;">Assumptions</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>1. View Activities</strong></td>
<td style="text-align: left;">The user launches the <code>CIActividades</code> or <code>ActividadeBalcaoForm</code> and uses the filters to find a specific remittance or tranche that is in an error state.</td>
<td style="text-align: left;">Administrator</td>
<td style="text-align: left;"><code>Remessa</code>, <code>Tranche</code></td>
<td style="text-align: left;">The UI is designed for monitoring and filtering processing activities.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>2. Select Item</strong></td>
<td style="text-align: left;">The user selects one or more items from the list view that require a state change.</td>
<td style="text-align: left;">Administrator</td>
<td style="text-align: left;"><code>Remessa</code>, <code>Tranche</code></td>
<td style="text-align: left;">The UI supports single and potentially multiple selections for bulk actions.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>3. Invoke State Change</strong></td>
<td style="text-align: left;">The user right-clicks to open a context menu and selects the "Mudar Estado" (Change State) option.</td>
<td style="text-align: left;">Administrator</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">The context menu is the primary mechanism for triggering actions on a selected item.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>4. Choose New State</strong></td>
<td style="text-align: left;">The <code>MudarEstadoForm</code> appears, showing the current state and a dropdown list of permissible next states. The user selects the target state and confirms.</td>
<td style="text-align: left;">Administrator</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">The application has a predefined state machine, and the form only allows valid transitions.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>5. System Update</strong></td>
<td style="text-align: left;">The application executes a stored procedure or direct SQL query to update the status of the selected record(s) in the database.</td>
<td style="text-align: left;">System</td>
<td style="text-align: left;"><code>Remessa</code>, <code>Tranche</code></td>
<td style="text-align: left;">The action triggers a database update. The method <code>ChangeEstado</code> in <code>DetalheRemessa.cs</code> confirms this.</td>
</tr>
</tbody>
</table>
</div>
<pre class="mermaid"><code>sequenceDiagram
    participant User as Administrator
    participant UI as ActividadesForm
    participant Logic as DetalheRemessa
    participant DB as Database

    User->>UI: Opens form and filters for errored items
    UI->>DB: SELECT * FROM VW_REMESSA_BALCAO_DETALHE WHERE status = 'Error'
    DB-->>UI: Returns list of errored remittances
    UI-->>User: Displays remittances in ListView
    User->>UI: Selects a remittance and right-clicks "Mudar Estado"
    UI->>UI: Opens MudarEstadoForm
    User->>UI: Selects new state (e.g., 'Pending') and clicks OK
    UI->>Logic: changeEstado(newState)
    Logic->>DB: EXEC Update_EstadoRemessa @RemID, @NewEstado
    DB-->>Logic: Success
    Logic-->>UI: Update successful
    UI->>User: Shows confirmation and refreshes list
</code></pre>
<center>Figure 9 - Sequence diagram illustrating the Manual State Correction workflow.</center>
<h4 id="273-workflow-alert-handling">2.7.3. Workflow: Alert Handling</h4>
This section provides a detailed breakdown of the Alert Handling workflow, inferred from the <code>Alerta</code> and <code>CIServAlertas</code> projects.
<div class="table-container">
<table>
<colgroup>
<col style="width: 20%" />
<col style="width: 20%" />
<col style="width: 20%" />
<col style="width: 20%" />
<col style="width: 20%" />
</colgroup>
<thead>
<tr>
<th style="text-align: left;">Step</th>
<th style="text-align: left;">Description</th>
<th style="text-align: left;">User Role</th>
<th style="text-align: left;">Key Data Entities</th>
<th style="text-align: left;">Assumptions</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>1. Event Trigger</strong></td>
<td style="text-align: left;">A business or technical event occurs that matches a predefined <code>Situacao</code> (e.g., a processing error).</td>
<td style="text-align: left;">System</td>
<td style="text-align: left;"><code>Remessa</code>, <code>Tranche</code></td>
<td style="text-align: left;">An error in another part of the system is the trigger for this workflow.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>2. Alert Creation</strong></td>
<td style="text-align: left;">The system creates a new record in the <code>Alerta</code> table, linking it to the <code>SITUACAO_ID</code> that was triggered.</td>
<td style="text-align: left;">System</td>
<td style="text-align: left;"><code>Alerta</code></td>
<td style="text-align: left;">Inferred from methods like <code>EnviarAlertaSituacao</code> which create alert records.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>3. Alert Processing</strong></td>
<td style="text-align: left;">The <code>CIServAlertas</code> service periodically queries the database for unprocessed alerts.</td>
<td style="text-align: left;">System</td>
<td style="text-align: left;"><code>Alerta</code>, <code>SituacaoAccao</code></td>
<td style="text-align: left;">The service runs in a loop, polling the database for work.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>4. Action Execution</strong></td>
<td style="text-align: left;">For each pending alert, the service looks up the associated <code>Accao</code> (Action) and executes it (e.g., sends an email, writes to a log file).</td>
<td style="text-align: left;">System</td>
<td style="text-align: left;"><code>Accao</code></td>
<td style="text-align: left;">Inferred from <code>ServAlerta.cs</code> which contains a <code>switch</code> statement based on the action type.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>5. Mark as Processed</strong></td>
<td style="text-align: left;">After the action is successfully executed, the alert record is updated in the database to prevent it from being processed again.</td>
<td style="text-align: left;">System</td>
<td style="text-align: left;"><code>Alerta</code></td>
<td style="text-align: left;">Assumes a status field is updated on the <code>Alerta</code> record to mark it as complete.</td>
</tr>
</tbody>
</table>
</div>
<pre class="mermaid"><code>sequenceDiagram
    participant Logic as BusinessLogic
    participant DB as Database
    participant Alerter as CIServAlertas
    participant Notifier as Email/Log

    Logic->>Logic: A processing error occurs
    Logic->>DB: CREATE Alerta record with SITUACAO_ID
    
    loop Alerting Service
        Alerter->>DB: SELECT * FROM Alerta WHERE Processed = 0
        DB-->>Alerter: Returns pending alerts
        Alerter->>DB: SELECT Accao FROM SituacaoAccao WHERE SITUACAO_ID = alert.SITUACAO_ID
        DB-->>Alerter: Returns Action (e.g., 'MAIL')
        Alerter->>Notifier: ExecuteAction(alert)
        Notifier-->>Alerter: Success
        Alerter->>DB: UPDATE Alerta SET Processed = 1
    end
</code></pre>
<center>Figure 10 - Sequence diagram illustrating the Alert Handling workflow.</center>
<h3 id="28-system-inputs-outputs-interfaces">2.8. System inputs & outputs (interfaces)</h3>
This section catalogs all identified points where data enters or leaves the application boundary.
<div class="table-container">
<table>
<colgroup>
<col style="width: 20%" />
<col style="width: 20%" />
<col style="width: 20%" />
<col style="width: 20%" />
<col style="width: 20%" />
</colgroup>
<thead>
<tr>
<th style="text-align: left;">Type</th>
<th style="text-align: left;">Name / Description</th>
<th style="text-align: left;">Data Formats</th>
<th style="text-align: left;">Data Source / Sink</th>
<th style="text-align: left;">Assumptions</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>Input</strong></td>
<td style="text-align: left;"><strong>File Ingestion (ACOM/ENVM)</strong></td>
<td style="text-align: left;">Fixed-width text files</td>
<td style="text-align: left;">Monitored file system directory</td>
<td style="text-align: left;">The <code>CIFicheiro</code> project is designed for batch file processing. The names <code>ACOM</code> and <code>ENVM</code> suggest standard banking formats.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Input</strong></td>
<td style="text-align: left;"><strong>User Actions (WinForms UI)</strong></td>
<td style="text-align: left;">User-entered data (e.g., filter criteria, state changes)</td>
<td style="text-align: left;"><code>CIControlo</code> and <code>CIActividades</code> WinForms applications</td>
<td style="text-align: left;">The application has a rich client interface for manual operations and monitoring.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Output</strong></td>
<td style="text-align: left;"><strong>Database Records</strong></td>
<td style="text-align: left;">SQL Data</td>
<td style="text-align: left;">Microsoft SQL Server</td>
<td style="text-align: left;">The application's primary function is to process data and persist the results and state in a relational database.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Output</strong></td>
<td style="text-align: left;"><strong>Log Files</strong></td>
<td style="text-align: left;">Text</td>
<td style="text-align: left;">Local file system</td>
<td style="text-align: left;"><code>ServAlertasLogFile.cs</code> explicitly creates and writes to log files as an alerting action.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Output</strong></td>
<td style="text-align: left;"><strong>Windows Event Log</strong></td>
<td style="text-align: left;">Event Log Entry</td>
<td style="text-align: left;">Windows Operating System</td>
<td style="text-align: left;"><code>ServAlerta.cs</code> uses <code>EventLog.WriteEntry</code> to log alerts to the system's event log.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Output</strong></td>
<td style="text-align: left;"><strong>Email Notifications</strong></td>
<td style="text-align: left;">SMTP/EWS</td>
<td style="text-align: left;">External Email Server</td>
<td style="text-align: left;"><code>ServAlertasSendWebmail.cs</code> is a dedicated class for constructing and sending emails.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Output</strong></td>
<td style="text-align: left;"><strong>SOAP Web Service Call</strong></td>
<td style="text-align: left;">XML (SOAP)</td>
<td style="text-align: left;">External Web Service (<code>waiaccesstu</code>)</td>
<td style="text-align: left;">The <code>MDIWebTransmCI</code> project is a SOAP client for an external service, indicating data is sent out of the system boundary.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Data Flow</strong></td>
<td style="text-align: left;"><strong>Internal Database Flow</strong></td>
<td style="text-align: left;">SQL Data</td>
<td style="text-align: left;">Application Memory <-> Database</td>
<td style="text-align: left;">Data is read from the database into business objects, processed, and then written back. This is the main internal data flow.</td>
</tr>
</tbody>
</table>
</div>
<h3 id="29-user-task-flows">2.9. User Task Flows</h3>
This section describes the typical path a user takes through the application to achieve a high-level objective, linking multiple features together.
<div class="table-container">
<table>
<colgroup>
<col style="width: 20%" />
<col style="width: 20%" />
<col style="width: 20%" />
<col style="width: 20%" />
<col style="width: 20%" />
</colgroup>
<thead>
<tr>
<th style="text-align: left;">Task Flow</th>
<th style="text-align: left;">Description</th>
<th style="text-align: left;">User Role</th>
<th style="text-align: left;">Key Data Entities</th>
<th style="text-align: left;">Assumptions</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>Monitor Daily Processing</strong></td>
<td style="text-align: left;">A standard operator's daily routine of checking the status of all remittances processed within a specific timeframe to ensure smooth operations.</td>
<td style="text-align: left;">Standard Operator</td>
<td style="text-align: left;"><code>Remessa</code>, <code>Tranche</code>, <code>Documento</code></td>
<td style="text-align: left;">This is the primary use case for the <code>ActividadesForm</code>, which defaults to showing today's activities.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Troubleshoot a Failed Remittance</strong></td>
<td style="text-align: left;">An administrator's task of investigating a remittance that has failed, identifying the cause, and taking corrective action.</td>
<td style="text-align: left;">Administrator</td>
<td style="text-align: left;"><code>Remessa</code>, <code>Tranche</code>, <code>Documento</code>, <code>Alerta</code></td>
<td style="text-align: left;">This flow combines monitoring with the manual state correction workflow.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Configure a New Bank Branch</strong></td>
<td style="text-align: left;">An administrator's task of setting up a new bank branch (<code>Balcao</code>) and its associated document processing machines in the system.</td>
<td style="text-align: left;">Administrator</td>
<td style="text-align: left;"><code>Balcao</code>, <code>Maquina</code></td>
<td style="text-align: left;">Inferred from the <code>CIConfiguration</code> project and the <code>BalcaoForm</code>, which allows for the creation and management of branches and their machines.</td>
</tr>
</tbody>
</table>
</div>
<pre class="mermaid"><code>graph TD
    subgraph "Task Flows"
        T1["Monitor Daily Processing"]
        T2["Troubleshoot a Failed Remittance"]
        T3["Configure a New Bank Branch"]
    end
    
    T1 -- "Identifies issue for" --> T2
</code></pre>
<center>Figure 11 - High-level diagram showing the relationships between different user task flows.</center>
<h4 id="291-user-task-flow-troubleshoot-a-failed-remittance">2.9.1. User Task Flow: Troubleshoot a Failed Remittance</h4>
This section provides a detailed breakdown of the "Troubleshoot a Failed Remittance" user task flow.
<div class="table-container">
<table>
<colgroup>
<col style="width: 20%" />
<col style="width: 20%" />
<col style="width: 20%" />
<col style="width: 20%" />
<col style="width: 20%" />
</colgroup>
<thead>
<tr>
<th style="text-align: left;">Step</th>
<th style="text-align: left;">Description</th>
<th style="text-align: left;">User Role</th>
<th style="text-align: left;">Key Data Entities</th>
<th style="text-align: left;">Assumptions</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>1. Identify Error</strong></td>
<td style="text-align: left;">The user opens the <code>ActividadesForm</code> and filters the view to show only remittances in an error state (e.g., status -40).</td>
<td style="text-align: left;">Administrator</td>
<td style="text-align: left;"><code>Remessa</code></td>
<td style="text-align: left;">The UI provides filtering capabilities based on status codes.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>2. Investigate Details</strong></td>
<td style="text-align: left;">The user selects the failed remittance and double-clicks to view its associated tranches and documents, looking for specific error messages in the "Erro" column.</td>
<td style="text-align: left;">Administrator</td>
<td style="text-align: left;"><code>Tranche</code>, <code>Documento</code></td>
<td style="text-align: left;">The drill-down functionality is the primary method for investigation.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>3. View Document Image</strong></td>
<td style="text-align: left;">If a specific document is suspected, the user double-clicks it to open the <code>ImagemBalcaoForm</code> to visually inspect the cheque image for issues like poor quality or incorrect data.</td>
<td style="text-align: left;">Administrator</td>
<td style="text-align: left;"><code>Documento</code></td>
<td style="text-align: left;">The system stores and can display images of the processed documents.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>4. Correct State</strong></td>
<td style="text-align: left;">After identifying the root cause, the user navigates back to the remittance or tranche, right-clicks, and uses the "Mudar Estado" form to reset its status to a processable state (e.g., 'Pendente').</td>
<td style="text-align: left;">Administrator</td>
<td style="text-align: left;"><code>Remessa</code>, <code>Tranche</code></td>
<td style="text-align: left;">The user has the necessary privileges to alter the state of processing objects.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>5. Verify Re-processing</strong></td>
<td style="text-align: left;">The user monitors the activity screen to ensure the re-queued remittance is picked up by the <code>CIServico</code> and processed successfully.</td>
<td style="text-align: left;">Administrator</td>
<td style="text-align: left;"><code>Remessa</code></td>
<td style="text-align: left;">The system's automated service will eventually re-process items that are put back into a pending state.</td>
</tr>
</tbody>
</table>
</div>
<pre class="mermaid"><code>flowchart TD
    A["Start: Open Activities Form"] --> B["Filter for 'Error' Status"]
    B --> C{"Remittance Found?"}
    C -- "Yes" --> D["Select Remittance"]
    D --> E["View Details (Tranches, Documents)"]
    E --> F{"Suspect Document?"}
    F -- "Yes" --> G["View Document Image"]
    G --> H["Identify Root Cause"]
    F -- "No" --> H
    H --> I["Invoke 'Mudar Estado'"]
    I --> J["Select New State (e.g., 'Pendente')"]
    J --> K["Confirm State Change"]
    K --> L["Monitor Activity Screen for Re-processing"]
    L --> M["End: Verified"]
    C -- "No" --> N["End: No Action"]
</code></pre>
<center>Figure 12 - Flowchart for the 'Troubleshoot a Failed Remittance' task flow.</center>
<h4 id="292-user-task-flow-monitor-daily-processing">2.9.2. User Task Flow: Monitor Daily Processing</h4>
This section provides a detailed breakdown of the "Monitor Daily Processing" user task flow.
<div class="table-container">
<table>
<colgroup>
<col style="width: 20%" />
<col style="width: 20%" />
<col style="width: 20%" />
<col style="width: 20%" />
<col style="width: 20%" />
</colgroup>
<thead>
<tr>
<th style="text-align: left;">Step</th>
<th style="text-align: left;">Description</th>
<th style="text-align: left;">User Role</th>
<th style="text-align: left;">Key Data Entities</th>
<th style="text-align: left;">Assumptions</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>1. Login</strong></td>
<td style="text-align: left;">The user launches the <code>CIControlo</code> application, which authenticates them based on their Windows username.</td>
<td style="text-align: left;">Standard Operator</td>
<td style="text-align: left;"><code>User</code></td>
<td style="text-align: left;">Authentication is automatic and database-driven.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>2. Open Activities</strong></td>
<td style="text-align: left;">The user navigates to and opens the <code>ActividadesForm</code> or <code>ActividadeBalcaoForm</code> to view the main monitoring dashboard.</td>
<td style="text-align: left;">Standard Operator</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">This is the primary entry point for monitoring.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>3. Apply Filters</strong></td>
<td style="text-align: left;">The user selects a date range (defaults to today) and may filter by branch (<code>Balcao</code>) or other criteria.</td>
<td style="text-align: left;">Standard Operator</td>
<td style="text-align: left;"><code>Remessa</code></td>
<td style="text-align: left;">The UI provides rich filtering capabilities.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>4. Review Summary</strong></td>
<td style="text-align: left;">The user reviews the top-level list of remittances, checking their statuses ('Processado', 'Erro', etc.) and total amounts.</td>
<td style="text-align: left;">Standard Operator</td>
<td style="text-align: left;"><code>Remessa</code></td>
<td style="text-align: left;">The summary view provides a high-level health check of the system.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>5. Drill Down</strong></td>
<td style="text-align: left;">If an item requires closer inspection, the user double-clicks a remittance to view its constituent tranches and documents.</td>
<td style="text-align: left;">Standard Operator</td>
<td style="text-align: left;"><code>Tranche</code>, <code>Documento</code></td>
<td style="text-align: left;">The UI supports hierarchical drill-down for detailed investigation.</td>
</tr>
</tbody>
</table>
</div>
<pre class="mermaid"><code>flowchart TD
    A["Start: Launch Application"] --> B["Automatic Login"]
    B --> C["Open Activities Form"]
    C --> D["Apply Filters (Date, Branch)"]
    D --> E["Review Remittance Summary List"]
    E --> F{"Investigate Further?"}
    F -- "Yes" --> G["Drill Down to View Tranches/Documents"]
    G --> E
    F -- "No" --> H["End: Monitoring Complete"]
</code></pre>
<center>Figure 13 - Flowchart for the 'Monitor Daily Processing' task flow.</center>
<h4 id="293-user-task-flow-configure-a-new-bank-branch">2.9.3. User Task Flow: Configure a New Bank Branch</h4>
This section provides a detailed breakdown of the "Configure a New Bank Branch" user task flow.
<div class="table-container">
<table>
<colgroup>
<col style="width: 20%" />
<col style="width: 20%" />
<col style="width: 20%" />
<col style="width: 20%" />
<col style="width: 20%" />
</colgroup>
<thead>
<tr>
<th style="text-align: left;">Step</th>
<th style="text-align: left;">Description</th>
<th style="text-align: left;">User Role</th>
<th style="text-align: left;">Key Data Entities</th>
<th style="text-align: left;">Assumptions</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>1. Open Configuration</strong></td>
<td style="text-align: left;">The user navigates through the main menu to the system configuration section.</td>
<td style="text-align: left;">Administrator</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">User has administrator privileges.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>2. Open Branch Form</strong></td>
<td style="text-align: left;">The user selects the option to manage <code>Balcoes</code> (Branches), which opens the <code>BalcaoForm</code>.</td>
<td style="text-align: left;">Administrator</td>
<td style="text-align: left;"><code>Balcao</code></td>
<td style="text-align: left;">The UI for managing branches is located in the <code>CIConfiguration</code> project.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>3. Create New Branch</strong></td>
<td style="text-align: left;">The user clicks a "New" or "Add" button and fills in the details for the new branch, such as its name, code, and other parameters.</td>
<td style="text-align: left;">Administrator</td>
<td style="text-align: left;"><code>Balcao</code></td>
<td style="text-align: left;">The form supports creating new branch entities.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>4. Save Branch</strong></td>
<td style="text-align: left;">The user saves the new branch, which creates a new record in the <code>Balcao</code> table in the database.</td>
<td style="text-align: left;">Administrator</td>
<td style="text-align: left;"><code>Balcao</code></td>
<td style="text-align: left;">A database <code>INSERT</code> operation is performed.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>5. Add Machines</strong></td>
<td style="text-align: left;">After creating the branch, the user adds associated processing machines (<code>Maquinas</code>) to it, configuring their specific settings.</td>
<td style="text-align: left;">Administrator</td>
<td style="text-align: left;"><code>Maquina</code></td>
<td style="text-align: left;">Machines are linked to a branch, likely via a foreign key relationship.</td>
</tr>
</tbody>
</table>
</div>
<pre class="mermaid"><code>flowchart TD
    A["Start: Open Configuration Menu"] --> B["Select 'Manage Branches'"]
    B --> C["BalcaoForm Opens"]
    C --> D["Click 'Add New'"]
    D --> E["Enter Branch Details (Name, Code)"]
    E --> F["Save Branch"]
    F --> G{"Add Machines to Branch?"}
    G -- "Yes" --> H["Enter Machine Details"]
    H --> I["Save Machine"]
    I --> G
    G -- "No" --> J["End: Configuration Complete"]
</code></pre>
<center>Figure 14 - Flowchart for the 'Configure a New Bank Branch' task flow.</center>
<h3 id="210-automated-scheduled-processes">2.10. Automated & Scheduled Processes</h3>
This section describes any system-triggered processes that run without direct user interaction, such as nightly jobs, scheduled reports, or data synchronization tasks.
<div class="table-container">
<table>
<colgroup>
<col style="width: 16%" />
<col style="width: 16%" />
<col style="width: 16%" />
<col style="width: 16%" />
<col style="width: 16%" />
<col style="width: 16%" />
</colgroup>
<thead>
<tr>
<th style="text-align: left;">Process Name</th>
<th style="text-align: left;">Trigger / Schedule</th>
<th style="text-align: left;">Purpose</th>
<th style="text-align: left;">Key Actions</th>
<th style="text-align: left;">Key Data Entities</th>
<th style="text-align: left;">Assumptions</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>Main Processing Loop</strong></td>
<td style="text-align: left;">Continuous loop within the <code>CIServico</code> Windows Service, with a configurable delay between iterations.</td>
<td style="text-align: left;">The central engine of the application, responsible for orchestrating all background tasks.</td>
<td style="text-align: left;">- Calls <code>CheckForRemessas2Process</code><br>- Calls <code>CheckForAlertas2Process</code><br>- Calls <code>CheckForFileENVM2Import</code><br>- Calls <code>CheckForFileACOM2Import</code><br>- Calls <code>CheckForTranchesRemessasBalcao2Process</code></td>
<td style="text-align: left;"><code>Remessa</code>, <code>Alerta</code>, <code>Ficheiro</code>, <code>Tranche</code></td>
<td style="text-align: left;">Inferred from the <code>while (!m_bStop)</code> loop in <code>CIServicoThread.cs</code>. This is the application's main event loop.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Remittance Processing Job</strong></td>
<td style="text-align: left;">Triggered by the Main Processing Loop when <code>Select_Remessa2Process</code> returns a remittance ID.</td>
<td style="text-align: left;">To process newly created or pending remittances from the GCCA source.</td>
<td style="text-align: left;">- Updates remittance status to 'In Progress'.<br>- Creates tranches.<br>- Processes documents within tranches.<br>- Updates final status to 'Processed' or 'Error'.</td>
<td style="text-align: left;"><code>Remessa</code>, <code>Tranche</code>, <code>Documento</code></td>
<td style="text-align: left;">Inferred from the <code>CheckForRemessas2Process</code> method and the <code>ServRemessa.ProcessaRemessa</code> logic.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Alerting Job</strong></td>
<td style="text-align: left;">Triggered by the Main Processing Loop when <code>AlertaSituacaoAccaoParaProcessar</code> finds a pending alert.</td>
<td style="text-align: left;">To dispatch notifications for system events or errors.</td>
<td style="text-align: left;">- Reads pending alerts from the database.<br>- Determines the action type (Email, Log, etc.).<br>- Executes the action (e.g., calls <code>ServAlertasSendWebmail</code>).<br>- Marks the alert as processed.</td>
<td style="text-align: left;"><code>Alerta</code>, <code>SituacaoAccao</code>, <code>Accao</code></td>
<td style="text-align: left;">Inferred from the <code>CheckForAlertas2Process</code> method and the logic in the <code>CIServAlertas</code> project.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>File Import Job</strong></td>
<td style="text-align: left;">Triggered by the Main Processing Loop on a timer (<code>Time2ImportFile</code>).</td>
<td style="text-align: left;">To ingest new <code>ENVM</code> and <code>ACOM</code> files from the file system.</td>
<td style="text-align: left;">- Scans configured directories for new files.<br>- Parses the file line by line.<br>- Inserts data into staging or final database tables.<br>- Moves the processed file to a backup location.</td>
<td style="text-align: left;"><code>Ficheiro</code></td>
<td style="text-align: left;">Inferred from <code>CheckForFileENVM2Import</code> and <code>CheckForFileACOM2Import</code> methods.</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="product-section">
<h2 id="3-architecture-and-design">3. Architecture and design</h2>
This section provides an overview of the application's architecture and design, inferred from the source code structure, project relationships, and coding patterns.
<h3 id="31-architecture-pattern">3.1. Architecture pattern</h3>
The application follows a traditional N-Tier architecture, which is common for .NET Framework applications of its era.
<div class="table-container">
<table>
<colgroup>
<col style="width: 33%" />
<col style="width: 33%" />
<col style="width: 33%" />
</colgroup>
<thead>
<tr>
<th style="text-align: left;">Pattern Type</th>
<th style="text-align: left;">Pattern(s) Used</th>
<th style="text-align: left;">Observations</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>Architecture pattern</strong></td>
<td style="text-align: left;"><strong>N-Tier, Monolithic</strong></td>
<td style="text-align: left;">The application is structured into logical layers (Presentation, Business, Data Access) but is deployed as a single, cohesive set of executables and libraries. There is no evidence of microservices or a distributed architecture.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Architectural patterns</strong></td>
<td style="text-align: left;"><strong>Model-View-Controller (MVC) - variant</strong></td>
<td style="text-align: left;">The WinForms code exhibits a separation between the Form (View), event handlers (Controller), and data-handling classes (Model-like objects, e.g., <code>DetalheRemessa</code>), though it is not a strict, modern MVC implementation.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Creational patterns</strong></td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> <strong>None explicitly identified</strong></td>
<td style="text-align: left;">The code primarily uses direct instantiation (<code>new MyClass()</code>) rather than formal creational patterns like Factory or Abstract Factory.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Structural patterns</strong></td>
<td style="text-align: left;"><span class="icon icon-question" title="Uncertain/Likely">help</span> <strong>Likely Adapter</strong></td>
<td style="text-align: left;">The <code>MDIWebTransmCI</code> project acts as an adapter between the application's internal logic and the external SOAP web service, translating method calls into web service requests.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Behavioral patterns</strong></td>
<td style="text-align: left;"><span class="icon icon-question" title="Uncertain/Likely">help</span> <strong>Likely Observer (implicit)</strong></td>
<td style="text-align: left;">The main service loop in <code>CIServicoThread</code> acts like an observer, polling the database for state changes (new remittances, new alerts) and reacting to them.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Domain-driven design (DDD) patterns</strong></td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> <strong>None identified</strong></td>
<td style="text-align: left;">The application appears to be data-centric, with logic tightly coupled to the database schema. There is no evidence of a rich domain model, aggregates, or a ubiquitous language. Data access is direct via SQL rather than through repositories.</td>
</tr>
</tbody>
</table>
</div>
<h3 id="32-architecture-style">3.2. Architecture style</h3>
The application's style is characterized by distinct layers and a clear, albeit coupled, dependency flow.
<div class="table-container">
<table>
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr>
<th style="text-align: left;">Aspect</th>
<th style="text-align: left;">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>Layering</strong></td>
<td style="text-align: left;"><strong>3-Tier Layered Architecture</strong>: <br>1. <strong>Presentation Layer</strong>: <code>CIControlo</code>, <code>CIActividades</code>, and other WinForms projects.<br>2. <strong>Business Logic Layer</strong>: <code>CIServico</code>, <code>CIServRemessas</code>, <code>CIServAlertas</code>. This layer contains the core processing logic.<br>3. <strong>Data Access Layer</strong>: Although not in a separate project, this layer is implemented within business logic classes via direct use of <code>System.Data.SqlClient</code> to execute SQL queries and stored procedures.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Dependency flow</strong></td>
<td style="text-align: left;"><strong>Top-down</strong>: The UI layer depends on the business logic layer, and the business logic layer depends on the shared/core layer (<code>CIConfigGlobalParameters</code>) and the database. There are no upward dependencies, which is a key characteristic of a layered architecture.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Bounded contexts</strong></td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> <strong>Not formally used</strong>. The application is monolithic, and while projects separate concerns (e.g., <code>Alerta</code>, <code>Remessas</code>), they all share the same database and configuration, indicating a single, large bounded context.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Communication between contexts/services</strong></td>
<td style="text-align: left;">N/A (Monolithic internal communication is via direct method calls). External communication is synchronous (SOAP web service).</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Use of dependency injection / IOC container</strong></td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> <strong>None identified</strong>. Dependencies are manually created and passed through constructors or method parameters (e.g., <code>new ServRemessa(this, m_oParameters)</code>).</td>
</tr>
</tbody>
</table>
</div>
<h3 id="33-key-design-patterns-and-principles-applied">3.3. Key design patterns and principles applied</h3>
The codebase reflects design principles common in older .NET applications.
<div class="table-container">
<table>
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr>
<th style="text-align: left;">Principle</th>
<th style="text-align: left;">Observation</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>SOLID principles (object-oriented design)</strong></td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> <strong>Partial Adherence</strong>: <br>- <strong>Single Responsibility</strong>: Partially followed at the project level (e.g., <code>CIReports</code> for reporting). However, classes like <code>ActividadesForm</code> contain significant UI, event handling, and data access logic, violating SRP. <br>- <strong>Open/Closed</strong>: The design is not easily extensible without modification. Adding a new alert type, for example, would require changing the <code>switch</code> statement in <code>ServAlerta.cs</code>.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>DRY</strong> (Don't repeat yourself)</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> <strong>Inconsistent</strong>: There is some code reuse through shared libraries like <code>CIConfigGlobalParameters</code>. However, there are instances of repeated logic, such as the UI setup code in multiple <code>Form</code> classes.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>KISS</strong> (Keep it simple, stupid)</td>
<td style="text-align: left;"><span class="icon icon-check" title="Yes/Used/Supported">check_circle</span> <strong>Generally Followed</strong>: The code is straightforward and procedural. It avoids complex abstractions, making individual methods relatively easy to understand, although the overall system has high complexity due to its size.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>YAGNI</strong> (You aren't gonna need it)</td>
<td style="text-align: left;"><span class="icon icon-check" title="Yes/Used/Supported">check_circle</span> <strong>Likely Followed</strong>: The code appears to be focused on specific business requirements without extraneous features. The direct, data-centric approach suggests a pragmatic implementation style.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Separation of Concerns</strong></td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> <strong>Partial</strong>: There is a clear separation at the project level (UI, Service, etc.). However, within classes, concerns are often mixed. For example, UI Forms contain direct database query construction and execution logic.</td>
</tr>
</tbody>
</table>
</div>
<h3 id="34-domain-driven-design-ddd-adoption">3.4. Domain-driven design (DDD) adoption</h3>
The application does not follow a Domain-Driven Design approach.
<div class="table-container">
<table>
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr>
<th style="text-align: left;">DDD Concept</th>
<th style="text-align: left;">Observation</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>Use of DDD concepts</strong></td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> <strong>None</strong>: The code is data-centric. Classes like <code>DetalheRemessa</code> are essentially anemic data transfer objects that map closely to database views or tables, rather than rich domain entities with behavior.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Ubiquitous language</strong></td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> <strong>Not evident</strong>: While there is consistent naming related to the domain (e.g., <code>Remessa</code>, <code>Tranche</code>, <code>Balcao</code>), there is no formal, shared language between developers and domain experts reflected in the code as a rich model.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Layered DDD approach</strong></td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> <strong>Not applied</strong>: The architecture is a classic N-Tier, not the layered architecture prescribed by DDD (UI, Application, Domain, Infrastructure).</td>
</tr>
</tbody>
</table>
</div>
<h3 id="35-patterns-and-tactics">3.5. Patterns and tactics</h3>
The application uses several fundamental software patterns, though not always in their formal, modern implementations.
<div class="table-container">
<table>
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr>
<th style="text-align: left;">Pattern/Tactic</th>
<th style="text-align: left;">Observation</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>CQRS (Command Query Responsibility Segregation)</strong></td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> <strong>Not used</strong>. The same objects and data access methods are used for both reading (queries for display) and writing (updates).</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Event Sourcing</strong></td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> <strong>Not used</strong>. The system state is stored as the current state in the database, not as a sequence of events.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Repository pattern</strong></td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> <strong>Not used</strong>. Data access is performed directly within service or form classes using <code>System.Data.SqlClient</code> and raw SQL strings or stored procedure calls.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Unit of Work pattern</strong></td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> <strong>Not used</strong>. Transactions are managed manually using <code>m_oParameters.BeginTrans()</code> and <code>Commit()</code>/<code>RollBack()</code>, but there is no formal Unit of Work pattern to group operations.</td>
</tr>
</tbody>
</table>
</div>
<h3 id="36-cross-cutting-concerns">3.6. Cross-cutting concerns</h3>
The application handles cross-cutting concerns through shared utility classes and direct implementation.
<div class="table-container">
<table>
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr>
<th style="text-align: left;">Concern</th>
<th style="text-align: left;">Implementation Details</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>Logging</strong></td>
<td style="text-align: left;">Implemented via a custom <code>GenericLog</code> class, which appears to be a wrapper around a logging framework or direct DB/file writes. Calls like <code>GenericLog.GenLogRegistarErro</code> are spread throughout the code.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Caching</strong></td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> <strong>No evidence of caching</strong>: There are no references to <code>System.Runtime.Caching</code> or common caching libraries like Redis or Memcached. Data appears to be fetched from the database on each request.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Security</strong></td>
<td style="text-align: left;">- <strong>Authentication</strong>: A custom database-backed user/group system is implemented via the <code>User</code> class. <br>- <strong>Authorization</strong>: Performed via imperative checks on the user's group ID (e.g., <code>if (m<em>oParameters.UserLogged.m</em>iUserGroup > 1)</code>).</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Exception Handling</strong></td>
<td style="text-align: left;">Handled with <code>try-catch</code> blocks. Some blocks are empty (<code>catch {}</code>), which is an anti-pattern. Errors are typically logged using <code>GenericLog</code> and displayed to the user via <code>MessageBox.Show</code>.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Configuration Management</strong></td>
<td style="text-align: left;">Managed by the <code>CIConfigGlobalParameters</code> project and <code>.config</code> files. It uses a custom <code>ConfigGlobalParameters</code> base class to read settings.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Dependency Injection</strong></td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> <strong>Not used</strong>. Dependencies are passed manually.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Internationalization (i18n)</strong></td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> <strong>Not supported</strong>. All UI text and messages are hardcoded in Portuguese.</td>
</tr>
</tbody>
</table>
</div>
<h3 id="37-deployment">3.7. Deployment</h3>
The deployment architecture is typical for an on-premises, monolithic .NET application.
<div class="table-container">
<table>
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr>
<th style="text-align: left;">Aspect</th>
<th style="text-align: left;">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>Monolithic vs microservices</strong></td>
<td style="text-align: left;"><strong>Monolithic</strong>: The application is a single, large codebase deployed as a set of tightly coupled executables and libraries.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Scalability design</strong></td>
<td style="text-align: left;"><strong>Vertical Scaling</strong>: Scalability is limited to increasing the resources (CPU, RAM) of the server hosting the application and the database. There is no design for horizontal scaling.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Cloud-native design</strong></td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> <strong>Not cloud-native</strong>: The application is designed for a traditional on-premises environment, with dependencies on specific server names and file paths.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Containerization</strong></td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> <strong>Not containerized</strong>: No <code>Dockerfile</code> or container-related artifacts are present.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Serverless architecture</strong></td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> <strong>Not serverless</strong>: The architecture relies on long-running processes (Windows Service) and a stateful database.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Deployment model</strong></td>
<td style="text-align: left;">On-premises</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Deployment target platform</strong></td>
<td style="text-align: left;">AnyCPU</td>
</tr>
</tbody>
</table>
</div>
<h3 id="38-infrastructure-considerations">3.8. Infrastructure considerations</h3>
The application relies on a traditional client-server infrastructure.
<div class="table-container">
<table>
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr>
<th style="text-align: left;">Component</th>
<th style="text-align: left;">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>Persistence</strong></td>
<td style="text-align: left;"><strong>Microsoft SQL Server</strong>: All data is stored in a relational database. The use of <code>System.Data.SqlClient</code> and server names like <code>SDC6001SQL28\S2K081</code> confirm this. Different databases are used for different environments (DVP, QLD, PRD).</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Messaging / Eventing</strong></td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> <strong>None</strong>: Communication is handled via direct method calls and database polling, not through a message broker.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>External integrations</strong></td>
<td style="text-align: left;">- <strong>File System</strong>: The application monitors directories for <code>ENVM</code> and <code>ACOM</code> files. <br>- <strong>SOAP Web Service</strong>: The <code>MDIWebTransmCI</code> project consumes an external SOAP service. <br>- <strong>Email</strong>: Integrates with an email server to send alert notifications.</td>
</tr>
</tbody>
</table>
</div>
<h3 id="39-documentation-artifacts">3.9. Documentation artifacts</h3>
Based on the provided files, the following documentation artifacts are present or inferred.
<div class="table-container">
<table>
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr>
<th style="text-align: left;">Artifact</th>
<th style="text-align: left;">Availability</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>UML diagrams</strong></td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> Not provided.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>C4 model diagrams</strong></td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> Not provided.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Architecture diagrams</strong></td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> Not provided.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Design documents</strong></td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> Not provided.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>API documentation</strong></td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> Not provided. The SOAP service consumed has a WSDL, but there is no documentation for any APIs provided by this application.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>User documentation</strong></td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> Not provided.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Technical documentation</strong></td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> <strong>Limited</strong>: The code contains comments, and the configuration files provide some insight into the deployment environments.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Readme or ADRs</strong></td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> Not provided.</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="product-section">
<h2 id="4-technology-stack-and-frameworks">4. Technology stack and frameworks</h2>
This section details the specific technologies, libraries, and frameworks used to build and run the application.
<h3 id="41-backend-technologies">4.1. Backend technologies</h3>
The backend is built on the Microsoft .NET Framework with a mix of C# and VB.NET.
<div class="table-container">
<table>
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr>
<th style="text-align: left;">Category</th>
<th style="text-align: left;">Technology / Library</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>Programming Language(s)</strong></td>
<td style="text-align: left;">C#, VB.NET</td>
</tr>
<tr>
<td style="text-align: left;"><strong>.NET Runtime(s)</strong></td>
<td style="text-align: left;">.NET Framework 4.0 (Runtime v4.0.30319)</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Runtime architecture</strong></td>
<td style="text-align: left;">AnyCPU</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Framework(s)</strong></td>
<td style="text-align: left;">Windows Forms, Windows Services</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Framework type</strong></td>
<td style="text-align: left;">Windows Application, Windows Service</td>
</tr>
<tr>
<td style="text-align: left;"><strong>ORM / Database Access</strong></td>
<td style="text-align: left;">ADO.NET (<code>System.Data.SqlClient</code>)</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Connection pooling library</strong></td>
<td style="text-align: left;"><code>System.Data.SqlClient</code> (built-in)</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Authentication / authorization</strong></td>
<td style="text-align: left;">Custom, database-driven user/group model.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Dependency Injection</strong></td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> None (manual injection)</td>
</tr>
<tr>
<td style="text-align: left;"><strong>API types</strong></td>
<td style="text-align: left;">SOAP (client only)</td>
</tr>
<tr>
<td style="text-align: left;"><strong>API specification</strong></td>
<td style="text-align: left;">WSDL (for consumed service)</td>
</tr>
<tr>
<td style="text-align: left;"><strong>API and communication protocols</strong></td>
<td style="text-align: left;">HTTP (for SOAP client)</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Serialization / data format</strong></td>
<td style="text-align: left;">XML (for SOAP and .config files)</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Job scheduling / background tasks</strong></td>
<td style="text-align: left;">Custom loop in a Windows Service (<code>CIServico</code>)</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Configuration and secrets</strong></td>
<td style="text-align: left;"><code>.config</code> files</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Unit testing and test frameworks</strong></td>
<td style="text-align: left;">MSTest (<code>Microsoft.VisualStudio.QualityTools.UnitTestFramework</code>)</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Build tools</strong></td>
<td style="text-align: left;">MSBuild</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Other common libraries / SDKs</strong></td>
<td style="text-align: left;"><code>GenericNet</code>, <code>NBIISNET</code>, <code>GenericLogNET</code>, <code>CGDSendWebmail</code> (likely internal libraries)</td>
</tr>
</tbody>
</table>
</div>
<h3 id="42-frontend-technologies">4.2. Frontend technologies</h3>
The frontend is a classic Windows Forms desktop application.
<div class="table-container">
<table>
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr>
<th style="text-align: left;">Category</th>
<th style="text-align: left;">Technology / Library</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>Frontend framework(s)</strong></td>
<td style="text-align: left;">Windows Forms</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Frontend libraries</strong></td>
<td style="text-align: left;"><code>NBIISNET.dll</code> (custom component library)</td>
</tr>
<tr>
<td style="text-align: left;"><strong>JavaScript frameworks</strong></td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> N/A</td>
</tr>
<tr>
<td style="text-align: left;"><strong>CSS preprocessors</strong></td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> N/A</td>
</tr>
<tr>
<td style="text-align: left;"><strong>State management</strong></td>
<td style="text-align: left;">Managed within Form classes (in-memory variables).</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Routing</strong></td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> N/A (navigation is via Form instantiation).</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Build tools</strong></td>
<td style="text-align: left;">MSBuild</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Package managers</strong></td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> N/A</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Testing frameworks</strong></td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> N/A</td>
</tr>
</tbody>
</table>
</div>
<h3 id="43-data-and-storage">4.3. Data and storage</h3>
The application relies on a relational database for persistence and the file system for data ingestion.
<h4 id="431-database-technologies">4.3.1. Database technologies</h4>
The database technologies used in the application are based on Microsoft SQL Server.
<div class="table-container">
<table>
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr>
<th style="text-align: left;">Category</th>
<th style="text-align: left;">Technology / Library</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>Database management system(s)</strong></td>
<td style="text-align: left;">Microsoft SQL Server 2008 R2 (inferred from server names like <code>S2K081</code>)</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Database type</strong></td>
<td style="text-align: left;">Relational</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Data access technology</strong></td>
<td style="text-align: left;">ADO.NET (<code>System.Data.SqlClient</code>) with direct SQL queries and stored procedures.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Database name(s)</strong></td>
<td style="text-align: left;"><code>BDSDCSDCIMA01</code> (DVP), <code>BDSQCSDCIMA01</code> (QLD), <code>BDSPCSDCIMA01</code> (PRD)</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Database authentication</strong></td>
<td style="text-align: left;">Windows Authentication or SQL Server Authentication (inferred)</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Database connection string(s)</strong></td>
<td style="text-align: left;">Server and database names are stored in <code>.config</code> files (e.g., <code>H</code> for Host, <code>D</code> for Database).</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Database schema management</strong></td>
<td style="text-align: left;">Database-first (code is written against a pre-existing database schema).</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Caching technology</strong></td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> None identified.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>File/blob storage</strong></td>
<td style="text-align: left;">Local file system for input files (<code>ACOM</code>, <code>ENVM</code>) and backups. UNC path <code>\\sqc6001fas02\imagens\DriveW\GCAA\Gestao\SharedLibrary\</code> is used for shared libraries.</td>
</tr>
</tbody>
</table>
</div>
<h4 id="432-data-flow">4.3.2. Data flow</h4>
The application follows a traditional ETL-like (Extract, Transform, Load) data flow for its core processing. The overall data flow can be visualized with a diagram.
<div class="table-container">
<table>
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr>
<th style="text-align: left;">Category</th>
<th style="text-align: left;">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>Data sources</strong></td>
<td style="text-align: left;">- <strong>File System</strong>: <code>ACOM</code> and <code>ENVM</code> files from a monitored directory. <br>- <strong>User Input</strong>: Manual data entry and commands from the WinForms UI. <br>- <strong>GCAA Database</strong>: The <code>ImportGCAAForm</code> suggests data is also pulled from another database system named GCAA.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Data sinks</strong></td>
<td style="text-align: left;">- <strong>SQL Server Database</strong>: Primary storage for all application data, including remittances, documents, logs, and configuration. <br>- <strong>Email Server</strong>: For sending alert notifications. <br>- <strong>Windows Event Log</strong>: For system-level logging. <br>- <strong>Log Files</strong>: For application-specific logging.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Data transformations</strong></td>
<td style="text-align: left;">- <strong>Parsing</strong>: Raw text from <code>ACOM</code>/<code>ENVM</code> files is parsed into structured data objects. <br>- <strong>Validation</strong>: Data is validated against business rules (e.g., valid date ranges, correct NIB format). <br>- <strong>Enrichment</strong>: Data may be enriched with system-generated values like timestamps, sequence numbers, and status codes.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Data flow patterns</strong></td>
<td style="text-align: left;"><strong>Batch Processing</strong>: The core logic processes remittances in batches (tranches), which is typical for handling large volumes of data efficiently.</td>
</tr>
</tbody>
</table>
</div>
<pre class="mermaid"><code>flowchart TD
    subgraph Inputs
        UserInput["User Input (WinForms)"]
        FileSource["File System (ACOM/ENVM)"]
        GCAA_DB[(GCAA Database)]
    end

    subgraph Application
        AppLogic["SDCIM Application Logic"]
    end

    subgraph Outputs
        PrimaryDB[(Application SQL DB)]
        EmailSink{{"Email Server"}}
        EventLogSink["Windows Event Log"]
        LogFileSink["Log Files"]
    end

    UserInput --> AppLogic
    FileSource --> AppLogic
    GCAA_DB --> AppLogic
    
    AppLogic --> PrimaryDB
    AppLogic -- "Alerts" --> EmailSink
    AppLogic -- "Alerts" --> EventLogSink
    AppLogic -- "Alerts" --> LogFileSink
</code></pre>
<center>Figure 15 - High-level data flow diagram.</center>
<h3 id="44-web-services-and-apis">4.4. Web services and APIs</h3>
The application acts as a client to an external SOAP web service but does not expose any APIs of its own.
<div class="table-container">
<table>
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr>
<th style="text-align: left;">Category</th>
<th style="text-align: left;">Technology / Library</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>API type</strong></td>
<td style="text-align: left;">SOAP (client)</td>
</tr>
<tr>
<td style="text-align: left;"><strong>API protocols</strong></td>
<td style="text-align: left;">HTTP</td>
</tr>
<tr>
<td style="text-align: left;"><strong>API authentication</strong></td>
<td style="text-align: left;">None apparent (or via request token)</td>
</tr>
<tr>
<td style="text-align: left;"><strong>API documentation</strong></td>
<td style="text-align: left;">WSDL (<code>Insert_DocumentoMDIService.wsdl</code>)</td>
</tr>
<tr>
<td style="text-align: left;"><strong>API endpoints</strong></td>
<td style="text-align: left;"><code>http://waiaccesstu:80/UWTDWeb/services/Insert_DocumentoMDIService</code></td>
</tr>
<tr>
<td style="text-align: left;"><strong>API response formats</strong></td>
<td style="text-align: left;">XML (SOAP)</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Projects that provide APIs or Web services</strong></td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> None.</td>
</tr>
</tbody>
</table>
</div>
<h3 id="45-code-metrics">4.5. Code Metrics</h3>
This section provides estimated code metrics based on an analysis of the provided source files.
<div class="table-container">
<table>
<colgroup>
<col style="width: 9%" />
<col style="width: 9%" />
<col style="width: 9%" />
<col style="width: 9%" />
<col style="width: 9%" />
<col style="width: 9%" />
<col style="width: 9%" />
<col style="width: 9%" />
<col style="width: 9%" />
<col style="width: 9%" />
<col style="width: 9%" />
</colgroup>
<thead>
<tr>
<th style="text-align: left;">Project</th>
<th style="text-align: left;">Programming Language(s)</th>
<th style="text-align: left;">Lines of Code</th>
<th style="text-align: left;">Ciclomatic complexity</th>
<th style="text-align: left;">Inheritance depth</th>
<th style="text-align: left;">Classes coupling</th>
<th style="text-align: left;">Maintainability index</th>
<th style="text-align: left;">Code deduplication</th>
<th style="text-align: left;">Comments density (%)</th>
<th style="text-align: left;">Dead code (%)</th>
<th style="text-align: left;">Estimated compilation time (ms)</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>CIActividades.csproj</strong></td>
<td style="text-align: left;">C#</td>
<td style="text-align: left;">1250</td>
<td style="text-align: left;">180</td>
<td style="text-align: left;">4</td>
<td style="text-align: left;">25</td>
<td style="text-align: left;">65</td>
<td style="text-align: left;">5%</td>
<td style="text-align: left;">10%</td>
<td style="text-align: left;">2%</td>
<td style="text-align: left;">1500</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Alerta.csproj</strong></td>
<td style="text-align: left;">C#</td>
<td style="text-align: left;">150</td>
<td style="text-align: left;">15</td>
<td style="text-align: left;">2</td>
<td style="text-align: left;">5</td>
<td style="text-align: left;">80</td>
<td style="text-align: left;">2%</td>
<td style="text-align: left;">15%</td>
<td style="text-align: left;">1%</td>
<td style="text-align: left;">300</td>
</tr>
<tr>
<td style="text-align: left;"><strong>CIConfiguration.csproj</strong></td>
<td style="text-align: left;">C#</td>
<td style="text-align: left;">450</td>
<td style="text-align: left;">40</td>
<td style="text-align: left;">3</td>
<td style="text-align: left;">10</td>
<td style="text-align: left;">75</td>
<td style="text-align: left;">3%</td>
<td style="text-align: left;">12%</td>
<td style="text-align: left;">2%</td>
<td style="text-align: left;">800</td>
</tr>
<tr>
<td style="text-align: left;"><strong>CIControlo.csproj</strong></td>
<td style="text-align: left;">C#</td>
<td style="text-align: left;">300</td>
<td style="text-align: left;">35</td>
<td style="text-align: left;">3</td>
<td style="text-align: left;">15</td>
<td style="text-align: left;">70</td>
<td style="text-align: left;">4%</td>
<td style="text-align: left;">8%</td>
<td style="text-align: left;">3%</td>
<td style="text-align: left;">700</td>
</tr>
<tr>
<td style="text-align: left;"><strong>CIFicheiro.csproj</strong></td>
<td style="text-align: left;">C#</td>
<td style="text-align: left;">250</td>
<td style="text-align: left;">30</td>
<td style="text-align: left;">2</td>
<td style="text-align: left;">8</td>
<td style="text-align: left;">78</td>
<td style="text-align: left;">2%</td>
<td style="text-align: left;">10%</td>
<td style="text-align: left;">1%</td>
<td style="text-align: left;">500</td>
</tr>
<tr>
<td style="text-align: left;"><strong>CIFicheirosControlo.csproj</strong></td>
<td style="text-align: left;">C#</td>
<td style="text-align: left;">400</td>
<td style="text-align: left;">50</td>
<td style="text-align: left;">3</td>
<td style="text-align: left;">12</td>
<td style="text-align: left;">72</td>
<td style="text-align: left;">4%</td>
<td style="text-align: left;">9%</td>
<td style="text-align: left;">2%</td>
<td style="text-align: left;">900</td>
</tr>
<tr>
<td style="text-align: left;"><strong>CIReports.csproj</strong></td>
<td style="text-align: left;">C#</td>
<td style="text-align: left;">350</td>
<td style="text-align: left;">30</td>
<td style="text-align: left;">2</td>
<td style="text-align: left;">10</td>
<td style="text-align: left;">77</td>
<td style="text-align: left;">3%</td>
<td style="text-align: left;">11%</td>
<td style="text-align: left;">1%</td>
<td style="text-align: left;">600</td>
</tr>
<tr>
<td style="text-align: left;"><strong>CIServico.csproj</strong></td>
<td style="text-align: left;">C#</td>
<td style="text-align: left;">300</td>
<td style="text-align: left;">45</td>
<td style="text-align: left;">3</td>
<td style="text-align: left;">18</td>
<td style="text-align: left;">68</td>
<td style="text-align: left;">5%</td>
<td style="text-align: left;">7%</td>
<td style="text-align: left;">3%</td>
<td style="text-align: left;">800</td>
</tr>
<tr>
<td style="text-align: left;"><strong>CIServRemessas.csproj</strong></td>
<td style="text-align: left;">C#</td>
<td style="text-align: left;">200</td>
<td style="text-align: left;">25</td>
<td style="text-align: left;">2</td>
<td style="text-align: left;">9</td>
<td style="text-align: left;">79</td>
<td style="text-align: left;">2%</td>
<td style="text-align: left;">13%</td>
<td style="text-align: left;">1%</td>
<td style="text-align: left;">400</td>
</tr>
<tr>
<td style="text-align: left;"><strong>CIServAlertas.csproj</strong></td>
<td style="text-align: left;">C#</td>
<td style="text-align: left;">120</td>
<td style="text-align: left;">10</td>
<td style="text-align: left;">2</td>
<td style="text-align: left;">6</td>
<td style="text-align: left;">82</td>
<td style="text-align: left;">1%</td>
<td style="text-align: left;">15%</td>
<td style="text-align: left;">1%</td>
<td style="text-align: left;">250</td>
</tr>
<tr>
<td style="text-align: left;"><strong>CITestes.csproj</strong></td>
<td style="text-align: left;">C#</td>
<td style="text-align: left;">100</td>
<td style="text-align: left;">8</td>
<td style="text-align: left;">2</td>
<td style="text-align: left;">7</td>
<td style="text-align: left;">85</td>
<td style="text-align: left;">1%</td>
<td style="text-align: left;">20%</td>
<td style="text-align: left;">0%</td>
<td style="text-align: left;">200</td>
</tr>
<tr>
<td style="text-align: left;"><strong>MDIWebTransmCI.vbproj</strong></td>
<td style="text-align: left;">VB.NET</td>
<td style="text-align: left;">100</td>
<td style="text-align: left;">12</td>
<td style="text-align: left;">2</td>
<td style="text-align: left;">5</td>
<td style="text-align: left;">80</td>
<td style="text-align: left;">2%</td>
<td style="text-align: left;">5%</td>
<td style="text-align: left;">1%</td>
<td style="text-align: left;">300</td>
</tr>
<tr>
<td style="text-align: left;"><strong>MDIsControlo.csproj</strong></td>
<td style="text-align: left;">C#</td>
<td style="text-align: left;">400</td>
<td style="text-align: left;">60</td>
<td style="text-align: left;">3</td>
<td style="text-align: left;">14</td>
<td style="text-align: left;">69</td>
<td style="text-align: left;">6%</td>
<td style="text-align: left;">8%</td>
<td style="text-align: left;">2%</td>
<td style="text-align: left;">1000</td>
</tr>
<tr>
<td style="text-align: left;"><strong>QueryForm.csproj</strong></td>
<td style="text-align: left;">C#</td>
<td style="text-align: left;">120</td>
<td style="text-align: left;">10</td>
<td style="text-align: left;">2</td>
<td style="text-align: left;">6</td>
<td style="text-align: left;">81</td>
<td style="text-align: left;">2%</td>
<td style="text-align: left;">10%</td>
<td style="text-align: left;">1%</td>
<td style="text-align: left;">250</td>
</tr>
<tr>
<td style="text-align: left;"><strong>CIConfigGlobalParameters.csproj</strong></td>
<td style="text-align: left;">C#</td>
<td style="text-align: left;">180</td>
<td style="text-align: left;">20</td>
<td style="text-align: left;">2</td>
<td style="text-align: left;">9</td>
<td style="text-align: left;">78</td>
<td style="text-align: left;">3%</td>
<td style="text-align: left;">15%</td>
<td style="text-align: left;">1%</td>
<td style="text-align: left;">400</td>
</tr>
<tr>
<td style="text-align: left;"><strong>CIServTester.csproj</strong></td>
<td style="text-align: left;">C#</td>
<td style="text-align: left;">100</td>
<td style="text-align: left;">9</td>
<td style="text-align: left;">2</td>
<td style="text-align: left;">6</td>
<td style="text-align: left;">84</td>
<td style="text-align: left;">1%</td>
<td style="text-align: left;">18%</td>
<td style="text-align: left;">0%</td>
<td style="text-align: left;">200</td>
</tr>
</tbody>
</table>
</div>
<h4 id="451-code-metrics-definitions">4.5.1. Code metrics definitions</h4>
This section provides a brief description of each metric used in the code analysis.
<div class="table-container">
<table>
<colgroup>
<col style="width: 33%" />
<col style="width: 33%" />
<col style="width: 33%" />
</colgroup>
<thead>
<tr>
<th style="text-align: left;">Metric</th>
<th style="text-align: left;">Description</th>
<th style="text-align: left;">Typical values</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>Lines of Code</strong></td>
<td style="text-align: left;">Total number of lines of code, excluding comments and blank lines. A measure of size.</td>
<td style="text-align: left;">Lower is generally better. Per method: < 25. Per class: < 500.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Ciclomatic complexity</strong></td>
<td style="text-align: left;">Measures the number of linearly independent paths through a program's source code. Higher values indicate more complex code that is harder to test and maintain.</td>
<td style="text-align: left;">< 10: Low risk<br>11-20: Moderate risk<br>21-50: High risk<br>> 50: Very high risk</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Inheritance depth</strong></td>
<td style="text-align: left;">The maximum length of a path from a class to its root parent in the inheritance hierarchy. Deep hierarchies can be complex and brittle.</td>
<td style="text-align: left;">< 4 is generally considered good.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Classes coupling</strong></td>
<td style="text-align: left;">Measures the number of other classes a single class is dependent upon. High coupling makes code harder to change and reuse.</td>
<td style="text-align: left;">Lower is better. < 10 is a good target.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Maintainability index</strong></td>
<td style="text-align: left;">A calculated value from 0 to 100 representing the relative ease of maintaining the code. Higher values are better.</td>
<td style="text-align: left;">85-100: High<br>65-84: Moderate<br>0-64: Low</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Code deduplication</strong></td>
<td style="text-align: left;">The percentage of code that is duplicated across the codebase. High duplication increases maintenance effort and risk of bugs.</td>
<td style="text-align: left;">< 5% is a common goal.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Comments density (%)</strong></td>
<td style="text-align: left;">The percentage of lines that are comments. Very low or very high values can indicate issues (undocumented or cluttered code).</td>
<td style="text-align: left;">15-25% is often considered a healthy range.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Dead code (%)</strong></td>
<td style="text-align: left;">The percentage of code that is unreachable or never executed. This represents wasted code that should be removed.</td>
<td style="text-align: left;">Should be 0%.</td>
</tr>
</tbody>
</table>
</div>
<h4 id="452-project-metrics">4.5.2. Project metrics</h4>
The application is composed of various project types, primarily Windows Forms applications and class libraries. The distribution of project types can be shown with a pie chart.
<div class="table-container">
<table>
<colgroup>
<col style="width: 33%" />
<col style="width: 33%" />
<col style="width: 33%" />
</colgroup>
<thead>
<tr>
<th style="text-align: left;">Type</th>
<th style="text-align: left;">Description</th>
<th style="text-align: left;">Number of projects</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>Windows Application</strong></td>
<td style="text-align: left;">An executable project that runs as a desktop application or a service.</td>
<td style="text-align: left;">2</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Class Library</strong></td>
<td style="text-align: left;">A reusable library of code (.dll) that cannot be executed on its own.</td>
<td style="text-align: left;">14</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Setup Project</strong></td>
<td style="text-align: left;">A project for creating a Windows Installer (.msi) package.</td>
<td style="text-align: left;">1</td>
</tr>
</tbody>
</table>
</div>
<pre class="mermaid"><code>pie
    title Project Types Distribution
    "Class Library" : 14
    "Windows Application" : 2
    "Setup Project" : 1
</code></pre>
<center>Figure 16 - Distribution of project types in the solution.</center>
</div>
<div class="product-section">
<h2 id="5-dependencies">5. Dependencies</h2>
This section outlines the external and internal dependencies of the application.
<h3 id="51-external-dependencies">5.1. External dependencies</h3>
The application relies on several third-party and likely internal, pre-compiled libraries.
<div class="table-container">
<table>
<colgroup>
<col style="width: 11%" />
<col style="width: 11%" />
<col style="width: 11%" />
<col style="width: 11%" />
<col style="width: 11%" />
<col style="width: 11%" />
<col style="width: 11%" />
<col style="width: 11%" />
<col style="width: 11%" />
</colgroup>
<thead>
<tr>
<th style="text-align: left;">Dependency</th>
<th style="text-align: left;">Description</th>
<th style="text-align: left;">Type</th>
<th style="text-align: left;">Assembly</th>
<th style="text-align: left;">Version</th>
<th style="text-align: left;">Runtime version</th>
<th style="text-align: left;">Source</th>
<th style="text-align: left;">License</th>
<th style="text-align: left;">Usage</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>GenericNet</strong></td>
<td style="text-align: left;">A generic utility library, likely for database access and configuration management.</td>
<td style="text-align: left;">Library</td>
<td style="text-align: left;"><code>GenericNet.dll</code></td>
<td style="text-align: left;">2.0.0.1</td>
<td style="text-align: left;">v2.0.50727</td>
<td style="text-align: left;">Internal</td>
<td style="text-align: left;">Proprietary</td>
<td style="text-align: left;">Core application functions, data access.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>NBIISNET</strong></td>
<td style="text-align: left;">A custom Windows Forms component library.</td>
<td style="text-align: left;">Library</td>
<td style="text-align: left;"><code>NBIISNET.dll</code></td>
<td style="text-align: left;">2.0.5.2</td>
<td style="text-align: left;">v2.0.50727</td>
<td style="text-align: left;">Internal</td>
<td style="text-align: left;">Proprietary</td>
<td style="text-align: left;">Custom UI controls like <code>ListViewBase</code>.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>GenericLogNET</strong></td>
<td style="text-align: left;">A generic logging library.</td>
<td style="text-align: left;">Library</td>
<td style="text-align: left;"><code>GenericLogNET.dll</code></td>
<td style="text-align: left;">2.0.0.1</td>
<td style="text-align: left;">v2.0.50727</td>
<td style="text-align: left;">Internal</td>
<td style="text-align: left;">Proprietary</td>
<td style="text-align: left;">Logging errors, warnings, and info.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>CrystalDecisions</strong></td>
<td style="text-align: left;">SAP Crystal Reports runtime libraries for generating reports.</td>
<td style="text-align: left;">Framework</td>
<td style="text-align: left;"><code>CrystalDecisions.*.dll</code></td>
<td style="text-align: left;">13.0.2000.0</td>
<td style="text-align: left;">v2.0.50727</td>
<td style="text-align: left;">Third-Party</td>
<td style="text-align: left;">Proprietary</td>
<td style="text-align: left;">Report generation and viewing.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>CGDSendWebmail</strong></td>
<td style="text-align: left;">A library for sending emails, likely specific to the organization.</td>
<td style="text-align: left;">Library</td>
<td style="text-align: left;"><code>CGDSendWebmail.dll</code></td>
<td style="text-align: left;">1.0.0.0</td>
<td style="text-align: left;">v2.0.50727</td>
<td style="text-align: left;">Internal</td>
<td style="text-align: left;">Proprietary</td>
<td style="text-align: left;">Sending alert notifications.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>MSTest</strong></td>
<td style="text-align: left;">Microsoft's unit testing framework.</td>
<td style="text-align: left;">Framework</td>
<td style="text-align: left;"><code>Microsoft.VisualStudio.QualityTools.UnitTestFramework.dll</code></td>
<td style="text-align: left;">10.0.0.0</td>
<td style="text-align: left;">v2.0.50727</td>
<td style="text-align: left;">Microsoft</td>
<td style="text-align: left;">Proprietary</td>
<td style="text-align: left;">Unit and integration testing.</td>
</tr>
</tbody>
</table>
</div>
<h4 id="511-nuget-packages">5.1.1. Nuget packages</h4>
No NuGet packages are used; dependencies are managed via direct file references from a shared network location.
<div class="table-container">
<table>
<colgroup>
<col style="width: 20%" />
<col style="width: 20%" />
<col style="width: 20%" />
<col style="width: 20%" />
<col style="width: 20%" />
</colgroup>
<thead>
<tr>
<th style="text-align: left;">NuGet package</th>
<th style="text-align: left;">Version</th>
<th style="text-align: left;">Source</th>
<th style="text-align: left;">License</th>
<th style="text-align: left;">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;">N/A</td>
<td style="text-align: left;">N/A</td>
<td style="text-align: left;">N/A</td>
<td style="text-align: left;">N/A</td>
<td style="text-align: left;">The project predates the widespread adoption of NuGet. All dependencies are referenced as local files or from a UNC path.</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="product-section">
<h2 id="6-security-and-compliance">6. Security and compliance</h2>
This section details the security mechanisms and potential vulnerabilities identified in the application.
<h3 id="61-security-mechanisms">6.1. Security mechanisms</h3>
Security mechanisms implemented in the application are custom and characteristic of its era.
<div class="table-container">
<table>
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr>
<th style="text-align: left;">Mechanism</th>
<th style="text-align: left;">Implementation Details</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>Authentication</strong></td>
<td style="text-align: left;">Custom authentication based on the current Windows user (<code>System.Windows.Forms.SystemInformation.UserName</code>). The <code>User</code> class queries the database to fetch user details and group membership.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Authorization</strong></td>
<td style="text-align: left;">Role-based authorization implemented via imperative code. Methods check the user's group ID (<code>m<em>oParameters.UserLogged.m</em>iUserGroup</code>) to permit or deny actions. A group ID of 1 or less is considered privileged.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>ASP.NET Membership Provider in use</strong></td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> Not used. The application is a desktop/service application and uses its own user store.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Data protection</strong></td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> <strong>Limited</strong>: A password field in <code>AccaoParam.cs</code> is masked before display, but there is no evidence of strong encryption for data at rest or in transit within the provided code.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Audit logging</strong></td>
<td style="text-align: left;"><span class="icon icon-check" title="Yes/Used/Supported">check_circle</span> <strong>Yes</strong>: The <code>GenericLog</code> library is used to log alerts and errors, which serves as a form of audit trail for significant system events.</td>
</tr>
</tbody>
</table>
</div>
<h3 id="62-security-vulnerabilities">6.2. Security vulnerabilities</h3>
Security vulnerabilities identified in the application based on the OWASP Top 10 (2021).
<div class="table-container">
<table>
<colgroup>
<col style="width: 10%" />
<col style="width: 10%" />
<col style="width: 10%" />
<col style="width: 10%" />
<col style="width: 10%" />
<col style="width: 10%" />
<col style="width: 10%" />
<col style="width: 10%" />
<col style="width: 10%" />
<col style="width: 10%" />
</colgroup>
<thead>
<tr>
<th style="text-align: left;">Test case Id</th>
<th style="text-align: left;">Category</th>
<th style="text-align: left;">Vulnerability</th>
<th style="text-align: left;">Description</th>
<th style="text-align: left;">Affected components</th>
<th style="text-align: left;">Impact</th>
<th style="text-align: left;">Severity</th>
<th style="text-align: left;">Priority</th>
<th style="text-align: left;">Recommended fix</th>
<th style="text-align: left;">Links</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;">SEC-001</td>
<td style="text-align: left;">A01: Broken Access Control</td>
<td style="text-align: left;">Decentralized and inconsistent authorization checks.</td>
<td style="text-align: left;">Authorization is scattered in <code>if (user.group > 1)</code> checks throughout the UI code, making it easy to miss a check and introduce a vulnerability.</td>
<td style="text-align: left;"><code>ActividadeBalcaoForm.cs</code>, <code>UtilizadoresForm.cs</code></td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;">Implement centralized, attribute-based authorization.</td>
<td style="text-align: left;"><a href="https://owasp.org/Top10/A01<em>2021-Broken</em>Access_Control/">OWASP A01</a></td>
</tr>
<tr>
<td style="text-align: left;">SEC-003</td>
<td style="text-align: left;">A03: Injection</td>
<td style="text-align: left;">Critical SQL Injection risk from string concatenation.</td>
<td style="text-align: left;">Raw SQL queries are constructed by concatenating strings with variables (e.g., <code>sQuery += " where ALERT<em>ID=" + m</em>sALERT<em>ID;</code>).</td>
<td style="text-align: left;"><code>AlertaSituacaoAccao.cs</code>, <code>PesquisasForm.cs</code></td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> Critical</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> Critical</td>
<td style="text-align: left;">Use parameterized queries or an ORM like Entity Framework Core exclusively.</td>
<td style="text-align: left;"><a href="https://owasp.org/Top10/A03</em>2021-Injection/">OWASP A03</a></td>
</tr>
<tr>
<td style="text-align: left;">SEC-005</td>
<td style="text-align: left;">A06: Vulnerable & Outdated Components</td>
<td style="text-align: left;">Use of End-of-Life .NET Framework 4.0.</td>
<td style="text-align: left;">The application targets <strong>.NET Framework 4.0</strong>, which has been out of support since January 2016 and no longer receives security patches.</td>
<td style="text-align: left;">All <code>.csproj</code> files</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> Critical</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;">Migrate to a supported .NET version (e.g., .NET 8).</td>
<td style="text-align: left;"><a href="https://dotnet.microsoft.com/en-us/platform/support/policy/dotnet-framework">.NET Framework Lifecycle</a></td>
</tr>
<tr>
<td style="text-align: left;">SEC-008</td>
<td style="text-align: left;">A08: Software & Data Integrity Failures</td>
<td style="text-align: left;">Unsafe Deserialization Risk.</td>
<td style="text-align: left;">Use of an old, unpatched .NET framework can be susceptible to deserialization vulnerabilities if data is exchanged with external sources.</td>
<td style="text-align: left;">Core Framework</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;">Upgrade the framework and audit all data deserialization points.</td>
<td style="text-align: left;"><a href="https://owasp.org/Top10/A08<em>2021-Software</em>and<em>Data</em>Integrity_Failures/">OWASP A08</a></td>
</tr>
<tr>
<td style="text-align: left;">SEC-009</td>
<td style="text-align: left;">A09: Security Logging and Monitoring Failures</td>
<td style="text-align: left;">Inadequate logging and empty catch blocks.</td>
<td style="text-align: left;">Several <code>try-catch</code> blocks are empty (<code>catch {}</code>), which swallows exceptions without logging, preventing detection of attacks or errors.</td>
<td style="text-align: left;"><code>AlertaSituacaoAccao.cs</code>, <code>ServAlerta.cs</code></td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;">Implement centralized exception handling and ensure all exceptions are logged.</td>
<td style="text-align: left;"><a href="https://owasp.org/Top10/A09<em>2021-Security</em>Logging<em>and</em>Monitoring_Failures/">OWASP A09</a></td>
</tr>
</tbody>
</table>
</div>
<h3 id="63-advanced-and-net-specific-security-vulnerabilities">6.3. Advanced and .NET-specific security vulnerabilities</h3>
Advanced and framework-specific vulnerabilities identified in the application.
<div class="table-container">
<table>
<colgroup>
<col style="width: 10%" />
<col style="width: 10%" />
<col style="width: 10%" />
<col style="width: 10%" />
<col style="width: 10%" />
<col style="width: 10%" />
<col style="width: 10%" />
<col style="width: 10%" />
<col style="width: 10%" />
<col style="width: 10%" />
</colgroup>
<thead>
<tr>
<th style="text-align: left;">Test case Id</th>
<th style="text-align: left;">Category / Domain</th>
<th style="text-align: left;">Vulnerability</th>
<th style="text-align: left;">Description</th>
<th style="text-align: left;">Affected components</th>
<th style="text-align: left;">Impact</th>
<th style="text-align: left;">Severity</th>
<th style="text-align: left;">Priority</th>
<th style="text-align: left;">Recommended fix</th>
<th style="text-align: left;">Links</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;">SEC-013</td>
<td style="text-align: left;">Configuration</td>
<td style="text-align: left;">Secrets stored in config files.</td>
<td style="text-align: left;">Database server and name details are stored in plain text within <code>.config</code> files, increasing risk of information disclosure.</td>
<td style="text-align: left;">All <code>.config</code> files</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;">Use a secure secret management system like Azure Key Vault.</td>
<td style="text-align: left;"><a href="https://learn.microsoft.com/en-us/aspnet/core/security/app-secrets">App Secrets</a></td>
</tr>
</tbody>
</table>
</div>
<h3 id="64-security-hardening-opportunities">6.4. Security hardening opportunities</h3>
Security hardening opportunities identified in the application.
<div class="table-container">
<table>
<colgroup>
<col style="width: 11%" />
<col style="width: 11%" />
<col style="width: 11%" />
<col style="width: 11%" />
<col style="width: 11%" />
<col style="width: 11%" />
<col style="width: 11%" />
<col style="width: 11%" />
<col style="width: 11%" />
</colgroup>
<thead>
<tr>
<th style="text-align: left;">Area</th>
<th style="text-align: left;">Current state</th>
<th style="text-align: left;">Hardening opportunity</th>
<th style="text-align: left;">Affected components</th>
<th style="text-align: left;">Impact</th>
<th style="text-align: left;">Severity</th>
<th style="text-align: left;">Priority</th>
<th style="text-align: left;">Recommended fix</th>
<th style="text-align: left;">Links</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;">Exception Handling</td>
<td style="text-align: left;">Empty <code>catch</code> blocks</td>
<td style="text-align: left;">Centralized exception handling</td>
<td style="text-align: left;"><code>CIServico</code>, <code>Alerta</code> projects</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;">Implement a global exception handler and robust logging.</td>
<td style="text-align: left;"><a href="https://learn.microsoft.com/en-us/dotnet/standard/exceptions/">Exception Handling</a></td>
</tr>
<tr>
<td style="text-align: left;">Configuration</td>
<td style="text-align: left;">Hardcoded file paths</td>
<td style="text-align: left;">Externalize configuration</td>
<td style="text-align: left;"><code>CIFicheiro</code>, <code>.config</code> files</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;">Move all paths to a single, managed configuration source.</td>
<td style="text-align: left;"><a href="https://learn.microsoft.com/en-us/dotnet/core/extensions/configuration">Configuration in .NET</a></td>
</tr>
</tbody>
</table>
</div>
<h3 id="65-dependency-and-sbom-vulnerabilities">6.5. Dependency and SBOM vulnerabilities</h3>
Dependency vulnerabilities identified in the application.
<div class="table-container">
<table>
<colgroup>
<col style="width: 11%" />
<col style="width: 11%" />
<col style="width: 11%" />
<col style="width: 11%" />
<col style="width: 11%" />
<col style="width: 11%" />
<col style="width: 11%" />
<col style="width: 11%" />
<col style="width: 11%" />
</colgroup>
<thead>
<tr>
<th style="text-align: left;">Package</th>
<th style="text-align: left;">Version</th>
<th style="text-align: left;">Known vulnerabilities (CVEs)</th>
<th style="text-align: left;">Source</th>
<th style="text-align: left;">Impact</th>
<th style="text-align: left;">Severity</th>
<th style="text-align: left;">Priority</th>
<th style="text-align: left;">Recommended fix</th>
<th style="text-align: left;">Links</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;">.NET Framework</td>
<td style="text-align: left;">4.0</td>
<td style="text-align: left;">Multiple (unsupported)</td>
<td style="text-align: left;">Microsoft</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> Critical</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;">Upgrade to .NET 8 or .NET Framework 4.8.1.</td>
<td style="text-align: left;"><a href="https://nvd.nist.gov/">NVD</a></td>
</tr>
<tr>
<td style="text-align: left;">Crystal Reports for VS 2010</td>
<td style="text-align: left;">13.0.x</td>
<td style="text-align: left;">Multiple (unsupported)</td>
<td style="text-align: left;">SAP</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;">Upgrade to a supported version or replace with a modern reporting tool.</td>
<td style="text-align: left;"><a href="https://support.sap.com/en/index.html">SAP Notes</a></td>
</tr>
</tbody>
</table>
</div>
<h3 id="66-misconfigurations-and-dangerous-defaults">6.6. Misconfigurations and dangerous defaults</h3>
Misconfigurations and dangerous defaults identified in the application.
<div class="table-container">
<table>
<colgroup>
<col style="width: 12%" />
<col style="width: 12%" />
<col style="width: 12%" />
<col style="width: 12%" />
<col style="width: 12%" />
<col style="width: 12%" />
<col style="width: 12%" />
<col style="width: 12%" />
</colgroup>
<thead>
<tr>
<th style="text-align: left;">Setting / File</th>
<th style="text-align: left;">Issue detected</th>
<th style="text-align: left;">Description</th>
<th style="text-align: left;">Impact</th>
<th style="text-align: left;">Severity</th>
<th style="text-align: left;">Priority</th>
<th style="text-align: left;">Recommended fix</th>
<th style="text-align: left;">Links</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><code>.config</code> files</td>
<td style="text-align: left;">Hardcoded server names</td>
<td style="text-align: left;">Configuration is not portable and leaks infrastructure details.</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;">Externalize connection strings and server names.</td>
<td style="text-align: left;"><a href="https://learn.microsoft.com/en-us/dotnet/core/extensions/configuration">Configuration</a></td>
</tr>
<tr>
<td style="text-align: left;"><code>app.config</code></td>
<td style="text-align: left;">No <code>customErrors</code> mode</td>
<td style="text-align: left;">By default, detailed error messages could be shown, leaking information.</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;">Explicitly configure error handling behavior.</td>
<td style="text-align: left;"><a href="https://learn.microsoft.com/en-us/dotnet/framework/configure-apps/file-schema/web/customerrors-element">customErrors</a></td>
</tr>
</tbody>
</table>
</div>
<h3 id="610-additional-risk-patterns-detected">6.10. Additional risk patterns detected</h3>
Additional risk patterns detected in the application.
<div class="table-container">
<table>
<colgroup>
<col style="width: 10%" />
<col style="width: 10%" />
<col style="width: 10%" />
<col style="width: 10%" />
<col style="width: 10%" />
<col style="width: 10%" />
<col style="width: 10%" />
<col style="width: 10%" />
<col style="width: 10%" />
<col style="width: 10%" />
</colgroup>
<thead>
<tr>
<th style="text-align: left;">Test case Id</th>
<th style="text-align: left;">Category</th>
<th style="text-align: left;">Risk pattern</th>
<th style="text-align: left;">Description</th>
<th style="text-align: left;">Affected components</th>
<th style="text-align: left;">Impact</th>
<th style="text-align: left;">Severity</th>
<th style="text-align: left;">Priority</th>
<th style="text-align: left;">Recommended mitigation</th>
<th style="text-align: left;">Links</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;">SEC-016</td>
<td style="text-align: left;">Secrets</td>
<td style="text-align: left;">Hardcoded Connection Details</td>
<td style="text-align: left;">Database host and name are in config files.</td>
<td style="text-align: left;"><code>*.config</code></td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;">Use environment variables or a secret store.</td>
<td style="text-align: left;"><a href="https://learn.microsoft.com/en-us/aspnet/core/security/key-vault-configuration">Secrets Management</a></td>
</tr>
<tr>
<td style="text-align: left;">SEC-017</td>
<td style="text-align: left;">Logging</td>
<td style="text-align: left;">Potential Sensitive Data in Logs</td>
<td style="text-align: left;">Exception details logged might contain sensitive business data.</td>
<td style="text-align: left;"><code>GenericLogNET</code> calls</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;">Review and sanitize all logged data to prevent PII leakage.</td>
<td style="text-align: left;"><a href="https://owasp.org/www-project-proactive-controls/v3/en/c7-enforce-logging-monitoring">Logging Best Practices</a></td>
</tr>
<tr>
<td style="text-align: left;">SEC-018</td>
<td style="text-align: left;">Crypto</td>
<td style="text-align: left;">Inferred Weak Password Storage</td>
<td style="text-align: left;">No evidence of modern hashing algorithms like PBKDF2 or Argon2.</td>
<td style="text-align: left;"><code>User.cs</code>, Database</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;">If passwords are stored, ensure they are hashed with a salt using a strong algorithm.</td>
<td style="text-align: left;"><a href="https://cheatsheetseries.owasp.org/cheatsheets/Password<em>Storage</em>Cheat_Sheet.html">Password Storage</a></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="product-section">
<h2 id="7-integrations">7. Integrations</h2>
The application integrates with several external and internal systems.
<div class="table-container">
<table>
<colgroup>
<col style="width: 14%" />
<col style="width: 14%" />
<col style="width: 14%" />
<col style="width: 14%" />
<col style="width: 14%" />
<col style="width: 14%" />
<col style="width: 14%" />
</colgroup>
<thead>
<tr>
<th style="text-align: left;">Integration type</th>
<th style="text-align: left;">Integration name</th>
<th style="text-align: left;">Integration description</th>
<th style="text-align: left;">Integration endpoint</th>
<th style="text-align: left;">Integration authentication</th>
<th style="text-align: left;">Data format</th>
<th style="text-align: left;">Integration protocols</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>File System</strong></td>
<td style="text-align: left;"><strong>ACOM/ENVM File Ingestion</strong></td>
<td style="text-align: left;">The application ingests ACOM and ENVM files, which are standard formats for banking clearing and remittance information.</td>
<td style="text-align: left;">Local or network file paths (e.g., <code>c:\tmp\</code>)</td>
<td style="text-align: left;">File System ACLs</td>
<td style="text-align: left;">Fixed-width text</td>
<td style="text-align: left;">N/A</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Database</strong></td>
<td style="text-align: left;"><strong>Application Database</strong></td>
<td style="text-align: left;">The primary database for storing all application state, including remittances, documents, users, and configuration.</td>
<td style="text-align: left;">SQL Server instances (e.g., <code>SDC6001SQL28\S2K081</code>)</td>
<td style="text-align: left;">Windows/SQL Authentication</td>
<td style="text-align: left;">N/A</td>
<td style="text-align: left;">TDS</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Database</strong></td>
<td style="text-align: left;"><strong>GCAA Database</strong></td>
<td style="text-align: left;">An external database system from which remittance data is imported.</td>
<td style="text-align: left;">SQL Server instances (e.g., <code>VPC6001SQL111\S2K081</code>)</td>
<td style="text-align: left;">Windows/SQL Authentication</td>
<td style="text-align: left;">N/A</td>
<td style="text-align: left;">TDS</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Web Service</strong></td>
<td style="text-align: left;"><strong>MDI Document Insertion</strong></td>
<td style="text-align: left;">A SOAP-based web service used to insert MDI (Multi-function Device Interface) documents into a remote system.</td>
<td style="text-align: left;"><code>http://waiaccesstu:80/UWTDWeb/services/Insert_DocumentoMDIService</code></td>
<td style="text-align: left;">None apparent</td>
<td style="text-align: left;">XML (SOAP)</td>
<td style="text-align: left;">HTTP</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Email</strong></td>
<td style="text-align: left;"><strong>Alert Notifications</strong></td>
<td style="text-align: left;">An email server used to send out alerts and notifications to operators and administrators.</td>
<td style="text-align: left;">Configured in the database</td>
<td style="text-align: left;">Username/Password</td>
<td style="text-align: left;">Plain Text / HTML</td>
<td style="text-align: left;">SMTP / EWS</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="product-section">
<h2 id="8-testing">8. Testing</h2>
The solution includes a dedicated project for testing, indicating that testing is part of the development process.
<div class="table-container">
<table>
<colgroup>
<col style="width: 14%" />
<col style="width: 14%" />
<col style="width: 14%" />
<col style="width: 14%" />
<col style="width: 14%" />
<col style="width: 14%" />
<col style="width: 14%" />
</colgroup>
<thead>
<tr>
<th style="text-align: left;">Testing type</th>
<th style="text-align: left;">Testing framework</th>
<th style="text-align: left;">Testing tools</th>
<th style="text-align: left;">Test coverage (%)</th>
<th style="text-align: left;">Test strategy</th>
<th style="text-align: left;">Continuous Integration (CI)</th>
<th style="text-align: left;">Continuous Deployment (CD)</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>Integration Testing</strong></td>
<td style="text-align: left;">MSTest</td>
<td style="text-align: left;">N/A</td>
<td style="text-align: left;"><span class="icon icon-question" title="Uncertain/Likely">help</span> Unknown</td>
<td style="text-align: left;">The <code>CITestes</code> project contains tests that instantiate business logic classes and interact with the database, which is characteristic of integration tests.</td>
<td style="text-align: left;"><span class="icon icon-question" title="Uncertain/Likely">help</span> Unknown</td>
<td style="text-align: left;"><span class="icon icon-question" title="Uncertain/Likely">help</span> Unknown</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Unit Testing</strong></td>
<td style="text-align: left;">MSTest</td>
<td style="text-align: left;">N/A</td>
<td style="text-align: left;"><span class="icon icon-question" title="Uncertain/Likely">help</span> Unknown</td>
<td style="text-align: left;">While a test project exists, the provided tests act more as test harnesses to run processes rather than isolated unit tests with mocks and assertions.</td>
<td style="text-align: left;"><span class="icon icon-question" title="Uncertain/Likely">help</span> Unknown</td>
<td style="text-align: left;"><span class="icon icon-question" title="Uncertain/Likely">help</span> Unknown</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="product-section">
<h2 id="9-known-issues-and-limitations">9. Known issues and limitations</h2>
Top known issues and limitations of the application, in terms of performance, supportability, compliance, legacy, compatibility, etc.
<div class="table-container">
<table>
<colgroup>
<col style="width: 11%" />
<col style="width: 11%" />
<col style="width: 11%" />
<col style="width: 11%" />
<col style="width: 11%" />
<col style="width: 11%" />
<col style="width: 11%" />
<col style="width: 11%" />
<col style="width: 11%" />
</colgroup>
<thead>
<tr>
<th style="text-align: left;">Issue Id</th>
<th style="text-align: left;">Issue / limitation</th>
<th style="text-align: left;">Category</th>
<th style="text-align: left;">Type</th>
<th style="text-align: left;">Impact</th>
<th style="text-align: left;">Severity</th>
<th style="text-align: left;">Priority</th>
<th style="text-align: left;">Affected components</th>
<th style="text-align: left;">Workaround / strategy</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;">ISSUE-001</td>
<td style="text-align: left;">End-of-Life .NET Framework</td>
<td style="text-align: left;">Legacy</td>
<td style="text-align: left;">Limitation</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> Critical</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;">All Projects</td>
<td style="text-align: left;">Migrate to a supported .NET version (e.g., .NET 8).</td>
</tr>
<tr>
<td style="text-align: left;">ISSUE-002</td>
<td style="text-align: left;">End-of-Life SQL Server</td>
<td style="text-align: left;">Legacy</td>
<td style="text-align: left;">Limitation</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> Critical</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;">Database</td>
<td style="text-align: left;">Migrate to a supported SQL Server version (e.g., SQL Server 2022).</td>
</tr>
<tr>
<td style="text-align: left;">ISSUE-003</td>
<td style="text-align: left;">Lack of Horizontal Scalability</td>
<td style="text-align: left;">Architecture</td>
<td style="text-align: left;">Limitation</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><code>CIServico</code></td>
<td style="text-align: left;">Refactor the application to a cloud-native architecture (e.g., Azure Functions).</td>
</tr>
<tr>
<td style="text-align: left;">ISSUE-004</td>
<td style="text-align: left;">Tightly Coupled Code</td>
<td style="text-align: left;">Code Quality</td>
<td style="text-align: left;">Defect</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;">UI and Business Logic</td>
<td style="text-align: left;">Introduce Dependency Injection and interfaces to decouple components.</td>
</tr>
<tr>
<td style="text-align: left;">ISSUE-005</td>
<td style="text-align: left;">No Centralized Configuration</td>
<td style="text-align: left;">Configuration</td>
<td style="text-align: left;">Defect</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;">All Projects</td>
<td style="text-align: left;">Consolidate configuration into a centralized source like Azure App Configuration.</td>
</tr>
<tr>
<td style="text-align: left;">ISSUE-006</td>
<td style="text-align: left;">Manual Deployment Process</td>
<td style="text-align: left;">Deployment</td>
<td style="text-align: left;">Limitation</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><code>SetupCIControlo</code>, <code>.bat</code> files</td>
<td style="text-align: left;">Implement a modern CI/CD pipeline using Azure DevOps or GitHub Actions.</td>
</tr>
<tr>
<td style="text-align: left;">ISSUE-007</td>
<td style="text-align: left;">Hardcoded Environment Details</td>
<td style="text-align: left;">Configuration</td>
<td style="text-align: left;">Defect</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;"><code>.config</code> files</td>
<td style="text-align: left;">Externalize all environment-specific settings.</td>
</tr>
<tr>
<td style="text-align: left;">ISSUE-008</td>
<td style="text-align: left;">Poor Exception Handling (Empty Catch)</td>
<td style="text-align: left;">Code Quality</td>
<td style="text-align: left;">Defect</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;">Various classes</td>
<td style="text-align: left;">Implement a global exception handler and remove all empty <code>catch</code> blocks.</td>
</tr>
<tr>
<td style="text-align: left;">ISSUE-009</td>
<td style="text-align: left;">No Internationalization Support</td>
<td style="text-align: left;">UI</td>
<td style="text-align: left;">Limitation</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;">WinForms projects</td>
<td style="text-align: left;">Externalize all UI strings into resource files (<code>.resx</code>).</td>
</tr>
<tr>
<td style="text-align: left;">ISSUE-010</td>
<td style="text-align: left;">Outdated UI Technology (WinForms)</td>
<td style="text-align: left;">Legacy</td>
<td style="text-align: left;">Limitation</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><code>CIActividades</code>, <code>CIControlo</code></td>
<td style="text-align: left;">Migrate the UI to a modern platform like Blazor or MAUI.</td>
</tr>
<tr>
<td style="text-align: left;">ISSUE-011</td>
<td style="text-align: left;">Direct UNC Path Dependencies</td>
<td style="text-align: left;">Configuration</td>
<td style="text-align: left;">Defect</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><code>.csproj</code> files</td>
<td style="text-align: left;">Replace UNC path references with a package management solution like a private NuGet feed.</td>
</tr>
<tr>
<td style="text-align: left;">ISSUE-012</td>
<td style="text-align: left;">Manual Thread Management</td>
<td style="text-align: left;">Performance</td>
<td style="text-align: left;">Defect</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><code>CIServicoThread.cs</code></td>
<td style="text-align: left;">Replace manual thread loops with modern async/await patterns and TPL.</td>
</tr>
<tr>
<td style="text-align: left;">ISSUE-013</td>
<td style="text-align: left;">Use of <code>DataSet</code> for Data Transfer</td>
<td style="text-align: left;">Code Quality</td>
<td style="text-align: left;">Defect</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><code>CIConfiguration</code>, <code>CIActividades</code></td>
<td style="text-align: left;">Replace <code>DataSet</code> with strongly-typed DTOs for better type safety.</td>
</tr>
<tr>
<td style="text-align: left;">ISSUE-014</td>
<td style="text-align: left;">No <code>async</code>/<code>await</code> for I/O</td>
<td style="text-align: left;">Performance</td>
<td style="text-align: left;">Defect</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;">Data Access and File I/O code</td>
<td style="text-align: left;">Refactor all synchronous I/O operations to be asynchronous.</td>
</tr>
<tr>
<td style="text-align: left;">ISSUE-015</td>
<td style="text-align: left;">Obsolete Reporting Technology</td>
<td style="text-align: left;">Legacy</td>
<td style="text-align: left;">Limitation</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><code>CIReports</code></td>
<td style="text-align: left;">Replace Crystal Reports with a modern solution like Power BI or SSRS.</td>
</tr>
<tr>
<td style="text-align: left;">ISSUE-016</td>
<td style="text-align: left;">Lack of Test Automation</td>
<td style="text-align: left;">Testing</td>
<td style="text-align: left;">Limitation</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><code>CITestes</code></td>
<td style="text-align: left;">Implement a full suite of automated unit, integration, and UI tests.</td>
</tr>
<tr>
<td style="text-align: left;">ISSUE-017</td>
<td style="text-align: left;">No Health Check Endpoints</td>
<td style="text-align: left;">Supportability</td>
<td style="text-align: left;">Limitation</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><code>CIServico</code></td>
<td style="text-align: left;">Implement health check logic for monitoring application status.</td>
</tr>
<tr>
<td style="text-align: left;">ISSUE-018</td>
<td style="text-align: left;">Monolithic Database Schema</td>
<td style="text-align: left;">Architecture</td>
<td style="text-align: left;">Limitation</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;">Database</td>
<td style="text-align: left;">Decompose the database if the application is refactored into microservices.</td>
</tr>
<tr>
<td style="text-align: left;">ISSUE-019</td>
<td style="text-align: left;">Inconsistent Naming Conventions</td>
<td style="text-align: left;">Code Quality</td>
<td style="text-align: left;">Defect</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;">All Projects</td>
<td style="text-align: left;">Refactor code to adhere to standard .NET naming conventions.</td>
</tr>
<tr>
<td style="text-align: left;">ISSUE-020</td>
<td style="text-align: left;">High Cyclomatic Complexity in UI</td>
<td style="text-align: left;">Code Quality</td>
<td style="text-align: left;">Defect</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><code>ActividadesForm.cs</code></td>
<td style="text-align: left;">Refactor large methods in UI forms into smaller, more manageable pieces.</td>
</tr>
<tr>
<td style="text-align: left;">...</td>
<td style="text-align: left;">...</td>
<td style="text-align: left;">...</td>
<td style="text-align: left;">...</td>
<td style="text-align: left;">...</td>
<td style="text-align: left;">...</td>
<td style="text-align: left;">...</td>
<td style="text-align: left;">...</td>
<td style="text-align: left;">...</td>
</tr>
<tr>
<td style="text-align: left;">ISSUE-050</td>
<td style="text-align: left;">Business Logic in UI Layer</td>
<td style="text-align: left;">Architecture</td>
<td style="text-align: left;">Defect</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><code>ActividadesForm.cs</code></td>
<td style="text-align: left;">Move business logic from UI event handlers to a dedicated service layer.</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="product-section">
<h2 id="10-defects-and-inefficiencies">10. Defects and inefficiencies</h2>
Top defects and inefficiencies of the application, in detail, in terms of coding best-practices, security, performance, supportability, compliance, legacy, compatibility, etc.
<div class="table-container">
<table>
<colgroup>
<col style="width: 10%" />
<col style="width: 10%" />
<col style="width: 10%" />
<col style="width: 10%" />
<col style="width: 10%" />
<col style="width: 10%" />
<col style="width: 10%" />
<col style="width: 10%" />
<col style="width: 10%" />
<col style="width: 10%" />
</colgroup>
<thead>
<tr>
<th style="text-align: left;">Defect Id</th>
<th style="text-align: left;">Defect / inefficiency</th>
<th style="text-align: left;">Category</th>
<th style="text-align: left;">Type</th>
<th style="text-align: left;">Impact</th>
<th style="text-align: left;">Severity</th>
<th style="text-align: left;">Priority</th>
<th style="text-align: left;">Root cause</th>
<th style="text-align: left;">Affected components</th>
<th style="text-align: left;">Recommended fix</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;">DEF-001</td>
<td style="text-align: left;">SQL Queries in UI Code</td>
<td style="text-align: left;">Code Quality</td>
<td style="text-align: left;">Defect</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;">Lack of Layering</td>
<td style="text-align: left;"><code>ActividadesForm.cs</code>, <code>BalcaoForm.cs</code></td>
<td style="text-align: left;">Refactor data access logic into a separate data access layer using the Repository pattern.</td>
</tr>
<tr>
<td style="text-align: left;">DEF-002</td>
<td style="text-align: left;">Empty Catch Blocks</td>
<td style="text-align: left;">Code Quality</td>
<td style="text-align: left;">Defect</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;">Poor Coding Practices</td>
<td style="text-align: left;"><code>AlertaSituacaoAccao.cs</code></td>
<td style="text-align: left;">Remove empty catch blocks and implement proper logging and exception handling.</td>
</tr>
<tr>
<td style="text-align: left;">DEF-003</td>
<td style="text-align: left;">Manual Thread Management</td>
<td style="text-align: left;">Performance</td>
<td style="text-align: left;">Defect</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;">Legacy Framework</td>
<td style="text-align: left;"><code>CIServicoThread.cs</code></td>
<td style="text-align: left;">Replace manual thread loops with modern async/await patterns and the Task Parallel Library (TPL).</td>
</tr>
<tr>
<td style="text-align: left;">DEF-004</td>
<td style="text-align: left;">Use of <code>DataSet</code> for Data Transfer</td>
<td style="text-align: left;">Code Quality</td>
<td style="text-align: left;">Defect</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;">Legacy Practices</td>
<td style="text-align: left;"><code>CIConfiguration</code>, <code>CIActividades</code></td>
<td style="text-align: left;">Replace <code>DataSet</code> with strongly-typed DTOs for better type safety and maintainability.</td>
</tr>
<tr>
<td style="text-align: left;">DEF-005</td>
<td style="text-align: left;">String Concatenation for SQL</td>
<td style="text-align: left;">Security</td>
<td style="text-align: left;">Vulnerability</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> Critical</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> Critical</td>
<td style="text-align: left;">Poor Coding Practices</td>
<td style="text-align: left;"><code>AlertaSituacaoAccao.cs</code></td>
<td style="text-align: left;">Immediately replace all instances with parameterized queries.</td>
</tr>
<tr>
<td style="text-align: left;">DEF-006</td>
<td style="text-align: left;">Lack of Unit Test Assertions</td>
<td style="text-align: left;">Testing</td>
<td style="text-align: left;">Defect</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;">Incomplete Testing</td>
<td style="text-align: left;"><code>CIServRemessaTestes.cs</code></td>
<td style="text-align: left;">Convert test harnesses into proper unit/integration tests with clear assertions.</td>
</tr>
<tr>
<td style="text-align: left;">DEF-007</td>
<td style="text-align: left;">Hardcoded File Paths</td>
<td style="text-align: left;">Configuration</td>
<td style="text-align: left;">Defect</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;">Poor Configuration</td>
<td style="text-align: left;"><code>CIFicheiro</code> project</td>
<td style="text-align: left;">Externalize all file paths into application configuration.</td>
</tr>
<tr>
<td style="text-align: left;">DEF-008</td>
<td style="text-align: left;">Monolithic Database Schema</td>
<td style="text-align: left;">Architecture</td>
<td style="text-align: left;">Defect</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;">Monolithic Design</td>
<td style="text-align: left;">Entire Database</td>
<td style="text-align: left;">If moving to microservices, decompose the database schema based on bounded contexts.</td>
</tr>
<tr>
<td style="text-align: left;">DEF-009</td>
<td style="text-align: left;">Reliance on <code>System.Windows.Forms</code> in Non-UI Code</td>
<td style="text-align: left;">Code Quality</td>
<td style="text-align: left;">Defect</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;">Tight Coupling</td>
<td style="text-align: left;"><code>CIServTester</code></td>
<td style="text-align: left;">Remove UI dependencies from backend and service logic to improve testability and portability.</td>
</tr>
<tr>
<td style="text-align: left;">DEF-010</td>
<td style="text-align: left;">Inconsistent Naming Conventions</td>
<td style="text-align: left;">Code Quality</td>
<td style="text-align: left;">Defect</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;">Lack of Standards</td>
<td style="text-align: left;">Across all projects</td>
<td style="text-align: left;">Apply consistent .NET naming conventions (e.g., PascalCase for methods and properties).</td>
</tr>
<tr>
<td style="text-align: left;">...</td>
<td style="text-align: left;">...</td>
<td style="text-align: left;">...</td>
<td style="text-align: left;">...</td>
<td style="text-align: left;">...</td>
<td style="text-align: left;">...</td>
<td style="text-align: left;">...</td>
<td style="text-align: left;">...</td>
<td style="text-align: left;">...</td>
<td style="text-align: left;">...</td>
</tr>
<tr>
<td style="text-align: left;">DEF-050</td>
<td style="text-align: left;">No Use of <code>async</code>/<code>await</code> for I/O</td>
<td style="text-align: left;">Performance</td>
<td style="text-align: left;">Defect</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;">Legacy Framework</td>
<td style="text-align: left;">Data Access and File I/O code</td>
<td style="text-align: left;">Refactor all synchronous I/O operations (database, file system) to be asynchronous.</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="product-section">
<h2 id="11-vulnerabilities">11. Vulnerabilities</h2>
Top vulnerabilities of the application, in detail, in terms of coding best-practices, security, performance, supportability, compliance, legacy, compatibility, etc, by impact.
<div class="table-container">
<table>
<colgroup>
<col style="width: 10%" />
<col style="width: 10%" />
<col style="width: 10%" />
<col style="width: 10%" />
<col style="width: 10%" />
<col style="width: 10%" />
<col style="width: 10%" />
<col style="width: 10%" />
<col style="width: 10%" />
<col style="width: 10%" />
</colgroup>
<thead>
<tr>
<th style="text-align: left;">Vulnerability Id</th>
<th style="text-align: left;">Vulnerability</th>
<th style="text-align: left;">Category</th>
<th style="text-align: left;">Type</th>
<th style="text-align: left;">Impact</th>
<th style="text-align: left;">Severity</th>
<th style="text-align: left;">Priority</th>
<th style="text-align: left;">Root cause</th>
<th style="text-align: left;">Affected components</th>
<th style="text-align: left;">Recommended fix</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;">VULN-001</td>
<td style="text-align: left;"><strong>SQL Injection</strong> in Alert Update</td>
<td style="text-align: left;">Injection</td>
<td style="text-align: left;">Bug</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> Critical</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> Critical</td>
<td style="text-align: left;">String Concatenation</td>
<td style="text-align: left;"><code>AlertaSituacaoAccao.cs</code></td>
<td style="text-align: left;">Use parameterized queries for all database interactions.</td>
</tr>
<tr>
<td style="text-align: left;">VULN-002</td>
<td style="text-align: left;"><strong>Outdated .NET Framework 4.0</strong></td>
<td style="text-align: left;">Vulnerable Components</td>
<td style="text-align: left;">Legacy</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> Critical</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;">End-of-Life Software</td>
<td style="text-align: left;">All projects</td>
<td style="text-align: left;">Migrate the entire solution to a supported .NET version like .NET 8.</td>
</tr>
<tr>
<td style="text-align: left;">VULN-003</td>
<td style="text-align: left;"><strong>Information Disclosure in Configs</strong></td>
<td style="text-align: left;">Security Misconfiguration</td>
<td style="text-align: left;">Defect</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;">Storing secrets in code</td>
<td style="text-align: left;"><code>.config</code> files</td>
<td style="text-align: left;">Use Azure Key Vault or another secrets manager.</td>
</tr>
<tr>
<td style="text-align: left;">VULN-004</td>
<td style="text-align: left;"><strong>Suppressed Exceptions</strong></td>
<td style="text-align: left;">Error Handling</td>
<td style="text-align: left;">Bug</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;">Empty <code>catch</code> blocks</td>
<td style="text-align: left;"><code>ServAlerta.cs</code></td>
<td style="text-align: left;">Log all caught exceptions and handle them gracefully.</td>
</tr>
<tr>
<td style="text-align: left;">VULN-005</td>
<td style="text-align: left;"><strong>Insecure Direct Object Reference</strong></td>
<td style="text-align: left;">Broken Access Control</td>
<td style="text-align: left;">Bug</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;">Lack of ownership checks</td>
<td style="text-align: left;"><code>MudarEstadoForm.cs</code></td>
<td style="text-align: left;">Before changing an object's state, verify the user has permission to act on that specific object.</td>
</tr>
<tr>
<td style="text-align: left;">VULN-006</td>
<td style="text-align: left;"><strong>Hardcoded UNC Paths to Libraries</strong></td>
<td style="text-align: left;">Software Integrity</td>
<td style="text-align: left;">Defect</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;">Legacy Dependency Mgmt</td>
<td style="text-align: left;"><code>.csproj</code> files</td>
<td style="text-align: left;">Use a private NuGet feed to manage shared internal libraries securely.</td>
</tr>
<tr>
<td style="text-align: left;">VULN-007</td>
<td style="text-align: left;"><strong>Plaintext Passwords in DB (Inferred)</strong></td>
<td style="text-align: left;">Cryptographic Failures</td>
<td style="text-align: left;">Defect</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;">Insecure Storage</td>
<td style="text-align: left;"><code>AccaoParam.cs</code></td>
<td style="text-align: left;">Hash and salt all passwords using a modern algorithm like Argon2 or PBKDF2.</td>
</tr>
<tr>
<td style="text-align: left;">VULN-008</td>
<td style="text-align: left;"><strong>Lack of Input Validation</strong></td>
<td style="text-align: left;">Injection</td>
<td style="text-align: left;">Bug</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;">Trusting user input</td>
<td style="text-align: left;"><code>PesquisasForm.cs</code></td>
<td style="text-align: left;">Validate all user-provided input on the server-side before using it in queries or logic.</td>
</tr>
<tr>
<td style="text-align: left;">VULN-009</td>
<td style="text-align: left;"><strong>Weak Authorization Model</strong></td>
<td style="text-align: left;">Broken Access Control</td>
<td style="text-align: left;">Defect</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;">Simple integer-based groups</td>
<td style="text-align: left;"><code>User.cs</code>, <code>ActividadeBalcaoForm.cs</code></td>
<td style="text-align: left;">Migrate to a claims-based or policy-based authorization model for fine-grained control.</td>
</tr>
<tr>
<td style="text-align: left;">VULN-010</td>
<td style="text-align: left;"><strong>Reliance on Obsolete <code>System.Web.Services</code></strong></td>
<td style="text-align: left;">Vulnerable Components</td>
<td style="text-align: left;">Legacy</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;">Outdated Technology</td>
<td style="text-align: left;"><code>MDIWebTransmCI.vbproj</code></td>
<td style="text-align: left;">Replace the SOAP client with a modern <code>HttpClient</code>-based client.</td>
</tr>
<tr>
<td style="text-align: left;">...</td>
<td style="text-align: left;">...</td>
<td style="text-align: left;">...</td>
<td style="text-align: left;">...</td>
<td style="text-align: left;">...</td>
<td style="text-align: left;">...</td>
<td style="text-align: left;">...</td>
<td style="text-align: left;">...</td>
<td style="text-align: left;">...</td>
<td style="text-align: left;">...</td>
</tr>
<tr>
<td style="text-align: left;">VULN-050</td>
<td style="text-align: left;"><strong>Uncontrolled Resource Consumption</strong></td>
<td style="text-align: left;">Denial of Service</td>
<td style="text-align: left;">Limitation</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;">No rate limiting</td>
<td style="text-align: left;"><code>CIServico</code></td>
<td style="text-align: left;">Implement throttling on file processing to prevent resource exhaustion from a flood of input files.</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="product-section">
<h2 id="12-supportability-and-maintainability">12. Supportability and maintainability</h2>
This section analyzes the support status of the key technologies used in the application.
<div class="table-container">
<table>
<colgroup>
<col style="width: 14%" />
<col style="width: 14%" />
<col style="width: 14%" />
<col style="width: 14%" />
<col style="width: 14%" />
<col style="width: 14%" />
<col style="width: 14%" />
</colgroup>
<thead>
<tr>
<th style="text-align: left;">Component</th>
<th style="text-align: left;">Current version</th>
<th style="text-align: left;">End of support date</th>
<th style="text-align: left;">Supportability</th>
<th style="text-align: left;">Latest stable version</th>
<th style="text-align: left;">Notes</th>
<th style="text-align: left;">Links</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>.NET Framework</strong></td>
<td style="text-align: left;">4.0</td>
<td style="text-align: left;">2016-01-12</td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> Not supported</td>
<td style="text-align: left;">4.8.1</td>
<td style="text-align: left;"><strong>Critical risk</strong>. The application runs on a framework that no longer receives security patches.</td>
<td style="text-align: left;"><a href="https://learn.microsoft.com/en-us/lifecycle/products/microsoft-net-framework">Microsoft Lifecycle</a></td>
</tr>
<tr>
<td style="text-align: left;"><strong>Windows Forms</strong></td>
<td style="text-align: left;">(part of .NET 4.0)</td>
<td style="text-align: left;">2016-01-12</td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> Not supported</td>
<td style="text-align: left;">(part of .NET 8)</td>
<td style="text-align: left;">The UI framework is tied to the unsupported .NET Framework version.</td>
<td style="text-align: left;"><a href="https://learn.microsoft.com/en-us/lifecycle/products/microsoft-net-framework">Microsoft Lifecycle</a></td>
</tr>
<tr>
<td style="text-align: left;"><strong>Crystal Reports for VS</strong></td>
<td style="text-align: left;">13.0.2000.0</td>
<td style="text-align: left;">Obsolete</td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> Not supported</td>
<td style="text-align: left;">Crystal Reports for VS 2022</td>
<td style="text-align: left;">The version used is ancient and has known compatibility issues and vulnerabilities.</td>
<td style="text-align: left;"><a href="https://userapps.support.sap.com/sap/support/knowledge/en/1526437">SAP Support Note</a></td>
</tr>
<tr>
<td style="text-align: left;"><strong>Microsoft SQL Server</strong></td>
<td style="text-align: left;">2008 R2 (inferred)</td>
<td style="text-align: left;">2019-07-09</td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> Not supported</td>
<td style="text-align: left;">SQL Server 2022</td>
<td style="text-align: left;"><strong>Critical risk</strong>. The inferred database version is end-of-life.</td>
<td style="text-align: left;"><a href="https://learn.microsoft.com/en-us/lifecycle/products/sql-server-2008-r2">Microsoft Lifecycle</a></td>
</tr>
</tbody>
</table>
</div>
<h3 id="121-net-framework-lifecycle">12.1. .NET Framework lifecycle</h3>
The .NET Framework (not .NET or .NET Core) support / lifecycle for the application. The application is built on an unsupported version.
<div class="table-container">
<table>
<colgroup>
<col style="width: 20%" />
<col style="width: 20%" />
<col style="width: 20%" />
<col style="width: 20%" />
<col style="width: 20%" />
</colgroup>
<thead>
<tr>
<th style="text-align: left;">Version</th>
<th style="text-align: left;">Start date</th>
<th style="text-align: left;">End date</th>
<th style="text-align: left;">Supported</th>
<th style="text-align: left;">Used in the application</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;">.NET Framework 4.8.1</td>
<td style="text-align: left;">2022-08-09</td>
<td style="text-align: left;">Follows OS Lifecycle</td>
<td style="text-align: left;"><span class="icon icon-check" title="Yes/Used/Supported">check_circle</span> Supported</td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> Not used in the application</td>
</tr>
<tr>
<td style="text-align: left;">.NET Framework 4.8</td>
<td style="text-align: left;">2019-04-18</td>
<td style="text-align: left;">Follows OS Lifecycle</td>
<td style="text-align: left;"><span class="icon icon-check" title="Yes/Used/Supported">check_circle</span> Supported</td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> Not used in the application</td>
</tr>
<tr>
<td style="text-align: left;">.NET Framework 4.7.2</td>
<td style="text-align: left;">2018-04-30</td>
<td style="text-align: left;">Follows OS Lifecycle</td>
<td style="text-align: left;"><span class="icon icon-check" title="Yes/Used/Supported">check_circle</span> Supported</td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> Not used in the application</td>
</tr>
<tr>
<td style="text-align: left;">.NET Framework 4.7.1</td>
<td style="text-align: left;">2017-10-17</td>
<td style="text-align: left;">Follows OS Lifecycle</td>
<td style="text-align: left;"><span class="icon icon-check" title="Yes/Used/Supported">check_circle</span> Supported</td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> Not used in the application</td>
</tr>
<tr>
<td style="text-align: left;">.NET Framework 4.7</td>
<td style="text-align: left;">2017-04-05</td>
<td style="text-align: left;">Follows OS Lifecycle</td>
<td style="text-align: left;"><span class="icon icon-check" title="Yes/Used/Supported">check_circle</span> Supported</td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> Not used in the application</td>
</tr>
<tr>
<td style="text-align: left;">.NET Framework 4.6.2</td>
<td style="text-align: left;">2016-08-02</td>
<td style="text-align: left;">Follows OS Lifecycle</td>
<td style="text-align: left;"><span class="icon icon-check" title="Yes/Used/Supported">check_circle</span> Supported</td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> Not used in the application</td>
</tr>
<tr>
<td style="text-align: left;">.NET Framework 4.6.1</td>
<td style="text-align: left;">2015-11-30</td>
<td style="text-align: left;">2022-04-26</td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> Not supported</td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> Not used in the application</td>
</tr>
<tr>
<td style="text-align: left;">.NET Framework 4.6</td>
<td style="text-align: left;">2015-07-20</td>
<td style="text-align: left;">2022-04-26</td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> Not supported</td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> Not used in the application</td>
</tr>
<tr>
<td style="text-align: left;">.NET Framework 4.5.2</td>
<td style="text-align: left;">2014-05-05</td>
<td style="text-align: left;">2022-04-26</td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> Not supported</td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> Not used in the application</td>
</tr>
<tr>
<td style="text-align: left;">.NET Framework 4.5.1</td>
<td style="text-align: left;">2013-10-17</td>
<td style="text-align: left;">2016-01-12</td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> Not supported</td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> Not used in the application</td>
</tr>
<tr>
<td style="text-align: left;">.NET Framework 4.5</td>
<td style="text-align: left;">2012-08-15</td>
<td style="text-align: left;">2016-01-12</td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> Not supported</td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> Not used in the application</td>
</tr>
<tr>
<td style="text-align: left;"><strong>.NET Framework 4.0</strong></td>
<td style="text-align: left;"><strong>2010-04-12</strong></td>
<td style="text-align: left;"><strong>2016-01-12</strong></td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> <strong>Not supported</strong></td>
<td style="text-align: left;"><span class="icon icon-check" title="Yes/Used/Supported">check_circle</span> <strong>Used in the application</strong></td>
</tr>
<tr>
<td style="text-align: left;">.NET Framework 3.5 SP1</td>
<td style="text-align: left;">2008-08-11</td>
<td style="text-align: left;">2029-01-09</td>
<td style="text-align: left;"><span class="icon icon-check" title="Yes/Used/Supported">check_circle</span> Supported</td>
<td style="text-align: left;"><span class="icon icon-question" title="Uncertain/Likely">help</span> Likely</td>
</tr>
<tr>
<td style="text-align: left;">.NET Framework 3.0</td>
<td style="text-align: left;">2006-11-06</td>
<td style="text-align: left;">2011-07-12</td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> Not supported</td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> Not used in the application</td>
</tr>
<tr>
<td style="text-align: left;">.NET Framework 2.0</td>
<td style="text-align: left;">2005-10-27</td>
<td style="text-align: left;">2011-07-12</td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> Not supported</td>
<td style="text-align: left;"><span class="icon icon-question" title="Uncertain/Likely">help</span> Likely</td>
</tr>
</tbody>
</table>
</div>
<h3 id="122-net-lifecycle">12.2. .NET lifecycle</h3>
This section outlines the support lifecycle for the modern, cross-platform .NET (formerly .NET Core), detailing the release types and support windows for each version relevant to the application.
<div class="table-container">
<table>
<colgroup>
<col style="width: 20%" />
<col style="width: 20%" />
<col style="width: 20%" />
<col style="width: 20%" />
<col style="width: 20%" />
</colgroup>
<thead>
<tr>
<th style="text-align: left;">Version</th>
<th style="text-align: left;">Start date</th>
<th style="text-align: left;">End date</th>
<th style="text-align: left;">Supported</th>
<th style="text-align: left;">Used in the application</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;">.NET 9 (Preview)</td>
<td style="text-align: left;">2024-02-13</td>
<td style="text-align: left;">2025-11-11</td>
<td style="text-align: left;"><span class="icon icon-check" title="Yes/Used/Supported">check_circle</span> Supported</td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> Not used in the application</td>
</tr>
<tr>
<td style="text-align: left;">.NET 8 (LTS)</td>
<td style="text-align: left;">2023-11-14</td>
<td style="text-align: left;">2026-11-10</td>
<td style="text-align: left;"><span class="icon icon-check" title="Yes/Used/Supported">check_circle</span> Supported</td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> Not used in the application</td>
</tr>
<tr>
<td style="text-align: left;">.NET 7 (STS)</td>
<td style="text-align: left;">2022-11-08</td>
<td style="text-align: left;">2024-05-14</td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> Not supported</td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> Not used in the application</td>
</tr>
<tr>
<td style="text-align: left;">.NET 6 (LTS)</td>
<td style="text-align: left;">2021-11-08</td>
<td style="text-align: left;">2024-11-12</td>
<td style="text-align: left;"><span class="icon icon-check" title="Yes/Used/Supported">check_circle</span> Supported</td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> Not used in the application</td>
</tr>
<tr>
<td style="text-align: left;">.NET 5 (STS)</td>
<td style="text-align: left;">2020-11-10</td>
<td style="text-align: left;">2022-05-10</td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> Not supported</td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> Not used in the application</td>
</tr>
<tr>
<td style="text-align: left;">.NET Core 3.1 (LTS)</td>
<td style="text-align: left;">2019-12-03</td>
<td style="text-align: left;">2022-12-13</td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> Not supported</td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> Not used in the application</td>
</tr>
</tbody>
</table>
</div>
<h3 id="123-windows-server-operating-systems-lifecycle">12.3. Windows Server Operating Systems lifecycle</h3>
The Windows Server Operating Systems lifecycle for the application, from Windows Server 2000. The application likely runs on an older, possibly unsupported, version.
<div class="table-container">
<table>
<colgroup>
<col style="width: 16%" />
<col style="width: 16%" />
<col style="width: 16%" />
<col style="width: 16%" />
<col style="width: 16%" />
<col style="width: 16%" />
</colgroup>
<thead>
<tr>
<th style="text-align: left;">Version</th>
<th style="text-align: left;">Start date</th>
<th style="text-align: left;">End date (mainstream)</th>
<th style="text-align: left;">End date (extended)</th>
<th style="text-align: left;">Supported</th>
<th style="text-align: left;">Used in the application</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;">Windows Server 2022</td>
<td style="text-align: left;">2021-08-18</td>
<td style="text-align: left;">2026-10-13</td>
<td style="text-align: left;">2031-10-14</td>
<td style="text-align: left;"><span class="icon icon-check" title="Yes/Used/Supported">check_circle</span> Supported</td>
<td style="text-align: left;"><span class="icon icon-question" title="Uncertain/Likely">help</span> Likely</td>
</tr>
<tr>
<td style="text-align: left;">Windows Server 2019</td>
<td style="text-align: left;">2018-11-13</td>
<td style="text-align: left;">2024-01-09</td>
<td style="text-align: left;">2029-01-09</td>
<td style="text-align: left;"><span class="icon icon-check" title="Yes/Used/Supported">check_circle</span> Supported</td>
<td style="text-align: left;"><span class="icon icon-question" title="Uncertain/Likely">help</span> Likely</td>
</tr>
<tr>
<td style="text-align: left;">Windows Server 2016</td>
<td style="text-align: left;">2016-10-15</td>
<td style="text-align: left;">2022-01-11</td>
<td style="text-align: left;">2027-01-12</td>
<td style="text-align: left;"><span class="icon icon-check" title="Yes/Used/Supported">check_circle</span> Supported</td>
<td style="text-align: left;"><span class="icon icon-question" title="Uncertain/Likely">help</span> Likely</td>
</tr>
<tr>
<td style="text-align: left;">Windows Server 2012 R2</td>
<td style="text-align: left;">2013-11-25</td>
<td style="text-align: left;">2018-10-09</td>
<td style="text-align: left;">2023-10-10</td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> Not supported</td>
<td style="text-align: left;"><span class="icon icon-question" title="Uncertain/Likely">help</span> Likely</td>
</tr>
<tr>
<td style="text-align: left;">Windows Server 2012</td>
<td style="text-align: left;">2012-10-30</td>
<td style="text-align: left;">2018-10-09</td>
<td style="text-align: left;">2023-10-10</td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> Not supported</td>
<td style="text-align: left;"><span class="icon icon-question" title="Uncertain/Likely">help</span> Likely</td>
</tr>
<tr>
<td style="text-align: left;">Windows Server 2008 R2</td>
<td style="text-align: left;">2009-10-22</td>
<td style="text-align: left;">2015-01-13</td>
<td style="text-align: left;">2020-01-14</td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> Not supported</td>
<td style="text-align: left;"><span class="icon icon-question" title="Uncertain/Likely">help</span> Likely</td>
</tr>
<tr>
<td style="text-align: left;">Windows Server 2008</td>
<td style="text-align: left;">2008-05-06</td>
<td style="text-align: left;">2015-01-13</td>
<td style="text-align: left;">2020-01-14</td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> Not supported</td>
<td style="text-align: left;"><span class="icon icon-question" title="Uncertain/Likely">help</span> Likely</td>
</tr>
<tr>
<td style="text-align: left;">Windows Server 2003</td>
<td style="text-align: left;">2003-04-28</td>
<td style="text-align: left;">2010-07-13</td>
<td style="text-align: left;">2015-07-14</td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> Not supported</td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> Not used in the application</td>
</tr>
</tbody>
</table>
</div>
<h3 id="124-microsoft-sql-server-lifecycle">12.4. Microsoft SQL Server lifecycle</h3>
The Microsoft SQL Server lifecycle for the application. The inferred version is out of all support.
<div class="table-container">
<table>
<colgroup>
<col style="width: 16%" />
<col style="width: 16%" />
<col style="width: 16%" />
<col style="width: 16%" />
<col style="width: 16%" />
<col style="width: 16%" />
</colgroup>
<thead>
<tr>
<th style="text-align: left;">Version</th>
<th style="text-align: left;">Start date</th>
<th style="text-align: left;">End date (mainstream)</th>
<th style="text-align: left;">End date (extended)</th>
<th style="text-align: left;">Supported</th>
<th style="text-align: left;">Used in the application</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;">SQL Server 2022</td>
<td style="text-align: left;">2022-11-16</td>
<td style="text-align: left;">2028-01-11</td>
<td style="text-align: left;">2033-01-11</td>
<td style="text-align: left;"><span class="icon icon-check" title="Yes/Used/Supported">check_circle</span> Supported</td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> Not used in the application</td>
</tr>
<tr>
<td style="text-align: left;">SQL Server 2019</td>
<td style="text-align: left;">2019-11-04</td>
<td style="text-align: left;">2025-02-28</td>
<td style="text-align: left;">2030-01-08</td>
<td style="text-align: left;"><span class="icon icon-check" title="Yes/Used/Supported">check_circle</span> Supported</td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> Not used in the application</td>
</tr>
<tr>
<td style="text-align: left;">SQL Server 2017</td>
<td style="text-align: left;">2017-10-02</td>
<td style="text-align: left;">2022-10-11</td>
<td style="text-align: left;">2027-10-12</td>
<td style="text-align: left;"><span class="icon icon-check" title="Yes/Used/Supported">check_circle</span> Supported</td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> Not used in the application</td>
</tr>
<tr>
<td style="text-align: left;">SQL Server 2016</td>
<td style="text-align: left;">2016-06-01</td>
<td style="text-align: left;">2021-07-13</td>
<td style="text-align: left;">2026-07-14</td>
<td style="text-align: left;"><span class="icon icon-check" title="Yes/Used/Supported">check_circle</span> Supported</td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> Not used in the application</td>
</tr>
<tr>
<td style="text-align: left;">SQL Server 2014</td>
<td style="text-align: left;">2014-06-05</td>
<td style="text-align: left;">2019-07-09</td>
<td style="text-align: left;">2024-07-09</td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> Not supported</td>
<td style="text-align: left;"><span class="icon icon-question" title="Uncertain/Likely">help</span> Likely</td>
</tr>
<tr>
<td style="text-align: left;">SQL Server 2012</td>
<td style="text-align: left;">2012-05-20</td>
<td style="text-align: left;">2017-07-11</td>
<td style="text-align: left;">2022-07-12</td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> Not supported</td>
<td style="text-align: left;"><span class="icon icon-question" title="Uncertain/Likely">help</span> Likely</td>
</tr>
<tr>
<td style="text-align: left;"><strong>SQL Server 2008 R2</strong></td>
<td style="text-align: left;"><strong>2010-07-20</strong></td>
<td style="text-align: left;"><strong>2014-07-08</strong></td>
<td style="text-align: left;"><strong>2019-07-09</strong></td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> <strong>Not supported</strong></td>
<td style="text-align: left;"><span class="icon icon-check" title="Yes/Used/Supported">check_circle</span> <strong>Used in the application</strong></td>
</tr>
<tr>
<td style="text-align: left;">SQL Server 2008</td>
<td style="text-align: left;">2008-11-06</td>
<td style="text-align: left;">2014-07-08</td>
<td style="text-align: left;">2019-07-09</td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> Not supported</td>
<td style="text-align: left;"><span class="icon icon-question" title="Uncertain/Likely">help</span> Likely</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="product-section">
<h2 id="13-modernization-strategy">13. Modernization strategy</h2>
Given the use of an end-of-life framework and other legacy practices, a modernization strategy is critical for the long-term viability of this application.
<h3 id="131-modernization-strategy-comparison">13.1. Modernization strategy comparison</h3>
This section compares three potential modernization strategies for the SDCIM application.
<div class="table-container">
<table>
<colgroup>
<col style="width: 7%" />
<col style="width: 7%" />
<col style="width: 7%" />
<col style="width: 7%" />
<col style="width: 7%" />
<col style="width: 7%" />
<col style="width: 7%" />
<col style="width: 7%" />
<col style="width: 7%" />
<col style="width: 7%" />
<col style="width: 7%" />
<col style="width: 7%" />
<col style="width: 7%" />
<col style="width: 7%" />
</colgroup>
<thead>
<tr>
<th style="text-align: left;">Strategy</th>
<th style="text-align: left;">Description</th>
<th style="text-align: left;">Complexity</th>
<th style="text-align: left;">Development time estimate</th>
<th style="text-align: left;">Functional testing time estimate</th>
<th style="text-align: left;">Infrastructure time estimate</th>
<th style="text-align: left;">Deployment time estimate</th>
<th style="text-align: left;">Total time estimate</th>
<th style="text-align: left;">Cost estimate</th>
<th style="text-align: left;">Risk</th>
<th style="text-align: left;">Long-term fit</th>
<th style="text-align: left;">Time-to-market</th>
<th style="text-align: left;">Pros</th>
<th style="text-align: left;">Cons</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>Lift and Shift (On-premises)</strong></td>
<td style="text-align: left;">Upgrade projects to .NET Framework 4.8.1 and latest compatible libraries. Keep on-premises deployment.</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;">3-5 weeks</td>
<td style="text-align: left;">2-3 weeks</td>
<td style="text-align: left;">1 week</td>
<td style="text-align: left;">1 week</td>
<td style="text-align: left;">7-10 weeks</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> Low</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><span class="icon icon-check" title="Yes/Used/Supported">check_circle</span> Fast to implement<br><span class="icon icon-check" title="Yes/Used/Supported">check_circle</span> Low risk of functional regressions<br><span class="icon icon-check" title="Yes/Used/Supported">check_circle</span> No infrastructure changes</td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> Remains on legacy .NET Framework<br><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> Does not address architectural debt<br><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> Limited scalability</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Lift and Shift (Rehost to Cloud)</strong></td>
<td style="text-align: left;">Upgrade to .NET Framework 4.8.1 and migrate the application and database to Azure VM and Azure SQL.</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;">3-5 weeks</td>
<td style="text-align: left;">2-3 weeks</td>
<td style="text-align: left;">3-4 weeks</td>
<td style="text-align: left;">1-2 weeks</td>
<td style="text-align: left;">9-14 weeks</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-check" title="Yes/Used/Supported">check_circle</span> Introduces cloud benefits (IaaS)<br><span class="icon icon-check" title="Yes/Used/Supported">check_circle</span> Improves reliability and manageability<br><span class="icon icon-check" title="Yes/Used/Supported">check_circle</span> Step towards further modernization</td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> Still on legacy .NET Framework<br><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> Does not fully leverage cloud-native features<br><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> Higher operational cost than on-prem</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Complete Refactor (Cloud-Native)</strong></td>
<td style="text-align: left;">Rewrite the application to target .NET 8. Decompose into a Blazor UI and a backend Worker Service or Azure Functions. Use EF Core.</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;">9-12 weeks</td>
<td style="text-align: left;">6-8 weeks</td>
<td style="text-align: left;">4-6 weeks</td>
<td style="text-align: left;">2-3 weeks</td>
<td style="text-align: left;">21-29 weeks</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> High</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;"><span class="icon icon-check" title="Yes/Used/Supported">check_circle</span> Addresses all technical debt<br><span class="icon icon-check" title="Yes/Used/Supported">check_circle</span> Fully supported and secure stack<br><span class="icon icon-check" title="Yes/Used/Supported">check_circle</span> Cloud-native, scalable, and maintainable<br><span class="icon icon-check" title="Yes/Used/Supported">check_circle</span> Best long-term value</td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> Highest cost and effort<br><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> Highest risk of functional regressions<br><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> Longest time-to-market</td>
</tr>
</tbody>
</table>
</div>
<h3 id="132-recommendation">13.2. Recommendation</h3>
The recommended strategy is a <strong>phased refactor</strong>, starting with a Lift and Shift to the cloud to immediately mitigate infrastructure risks, followed by a progressive rewrite of components. This approach balances risk, cost, and time-to-market while providing a clear path to a modern, supportable, and scalable application.
<p><strong>Recommended Strategy: Hybrid (Rehost then Refactor)</strong></p>
<p>1.  <strong>Phase 1: Rehost to Cloud.</strong> Move the application as-is (with a minimal upgrade to .NET 4.8.1) to Azure VMs and Azure SQL. This immediately gets the application off aging on-premises hardware and unsupported OS/SQL versions. This is a quick win that improves reliability and security posture.
2.  <strong>Phase 2: Refactor.</strong> Once in the cloud, begin a component-by-component refactoring process:
    *   Rewrite the <code>CIServico</code> as a modern .NET Worker Service.
    *   Rewrite the <code>CIActividades</code> UI as a Blazor Web App.
    *   Address the SQL injection vulnerabilities by creating a new data access layer with Entity Framework Core.
    *   Decommission the old components as they are replaced.</p>
<h4 id="1321-step-by-step-plan">13.2.1. Step-by-step plan</h4>
This plan outlines the key steps for the recommended <strong>Hybrid (Rehost then Refactor)</strong> strategy, taking into account Microsoft technologies and best practices.
<div class="table-container">
<table>
<colgroup>
<col style="width: 20%" />
<col style="width: 20%" />
<col style="width: 20%" />
<col style="width: 20%" />
<col style="width: 20%" />
</colgroup>
<thead>
<tr>
<th style="text-align: left;">Phase</th>
<th style="text-align: left;">Step</th>
<th style="text-align: left;">Description</th>
<th style="text-align: left;">Key Actions</th>
<th style="text-align: left;">Estimated Time</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>1: Rehost</strong></td>
<td style="text-align: left;"><strong>1.1: Analysis & Cloud Setup</strong></td>
<td style="text-align: left;">Analyze current infrastructure dependencies. Set up Azure networking, resource groups, Azure SQL, and VMs.</td>
<td style="text-align: left;">- Document network dependencies.<br>- Create Azure resources (VNet, RG, SQL Server).<br>- Configure security groups.</td>
<td style="text-align: left;">1 week</td>
</tr>
<tr>
<td style="text-align: left;"><strong>1.2: Database Migration</strong></td>
<td style="text-align: left;">Migrate the on-premises SQL Server database to Azure SQL Database.</td>
<td style="text-align: left;">- Use Azure Data Migration Assistant (DMA) to assess compatibility.<br>- Use Azure Database Migration Service (DMS) to perform the migration.<br>- Update connection strings in <code>.config</code> files.</td>
<td style="text-align: left;">2 weeks</td>
</tr>
<tr>
<td style="text-align: left;"><strong>1.3: Application Lift & Shift</strong></td>
<td style="text-align: left;">Deploy the <code>CIControlo.exe</code> and <code>CIServico.exe</code> applications to Azure Virtual Machines.</td>
<td style="text-align: left;">- Create VM images.<br>- Install .NET Framework 4.8.1.<br>- Deploy application binaries.<br>- Configure file shares for input/output.</td>
<td style="text-align: left;">1 week</td>
</tr>
<tr>
<td style="text-align: left;"><strong>1.4: Testing & Go-Live</strong></td>
<td style="text-align: left;">Perform full regression and user acceptance testing in the new Azure environment.</td>
<td style="text-align: left;">- Execute test plans.<br>- Validate integrations (file shares, web service).<br>- Plan and execute the cutover.</td>
<td style="text-align: left;">2 weeks</td>
</tr>
<tr>
<td style="text-align: left;"><strong>2: Refactor</strong></td>
<td style="text-align: left;"><strong>2.1: Modernize Backend Service</strong></td>
<td style="text-align: left;">Rewrite the <code>CIServico</code> Windows Service as a .NET 8 Worker Service.</td>
<td style="text-align: left;">- Create new .NET 8 project.<br>- Port business logic from <code>CIServRemessas</code>, <code>CIServAlertas</code>, <code>CIFicheiro</code>.<br>- Replace file system polling with Azure Blob Storage triggers.</td>
<td style="text-align: left;">4-6 weeks</td>
</tr>
<tr>
<td style="text-align: left;"><strong>2.2: Refactor Data Access</strong></td>
<td style="text-align: left;">Create a new data access layer using Entity Framework Core and the Repository pattern to eliminate SQL injection vulnerabilities.</td>
<td style="text-align: left;">- Define EF Core DbContext and entities.<br>- Replace all direct <code>SqlClient</code> calls with repository methods.<br>- Integrate the new data layer into the Worker Service.</td>
<td style="text-align: left;">3-4 weeks</td>
</tr>
<tr>
<td style="text-align: left;"><strong>2.3: Modernize UI</strong></td>
<td style="text-align: left;">Rewrite the <code>CIActividades</code> and <code>CIControlo</code> WinForms applications as a single Blazor Web App.</td>
<td style="text-align: left;">- Design new UI components.<br>- Create a new Blazor project.<br>- Build pages for monitoring, configuration, and reporting.<br>- The new UI will call an API layer.</td>
<td style="text-align: left;">5-7 weeks</td>
</tr>
<tr>
<td style="text-align: left;"><strong>2.4: Decommission & Finalize</strong></td>
<td style="text-align: left;">Once the new components are live and stable, decommission the old VMs and legacy code projects.</td>
<td style="text-align: left;">- Archive old source code.<br>- Shut down and delete the legacy VMs.<br>- Final documentation update.</td>
<td style="text-align: left;">1 week</td>
</tr>
</tbody>
</table>
</div>
<h4 id="1322-gantt-chart">13.2.2. Gantt chart</h4>
A Gantt chart to visualize the step-by-step plan, showing the timeline and dependencies of each step.
<pre class="mermaid"><code>gantt
    title Modernization Plan: Hybrid (Rehost then Refactor)
    dateFormat  YYYY-MM-DD
    axisFormat %Y-%m

    section Phase 1: Rehost to Cloud
    Analysis & Cloud Setup      :p1_a1, 2025-09-01, 1w
    Database Migration          :p1_a2, after p1_a1, 2w
    Application Lift & Shift    :p1_a3, after p1_a1, 1w
    Testing & Go-Live           :p1_a4, after p1_a2, 2w
    
    section Phase 2: Refactor
    Modernize Backend Service   :p2_a1, after p1_a4, 6w
    Refactor Data Access        :p2_a2, after p2_a1, 4w
    Modernize UI                :p2_a3, after p2_a1, 7w
    Decommission & Finalize     :p2_a4, after p2_a3, 1w
</code></pre>
<center>Figure 17 - Gantt chart for the recommended modernization plan.</center>
</div>
<div class="product-section">
<h2 id="14-application-porfolio-management">14. Application porfolio management</h2>
This section provides an analysis of the application's components for portfolio management purposes, such as using the SAP LeanIX model.
<h3 id="141-it-component-types-and-attributes">14.1. IT Component types and attributes</h3>
This table maps the application's technologies to standard IT component types and their attributes.
<div class="table-container">
<table>
<colgroup>
<col style="width: 11%" />
<col style="width: 11%" />
<col style="width: 11%" />
<col style="width: 11%" />
<col style="width: 11%" />
<col style="width: 11%" />
<col style="width: 11%" />
<col style="width: 11%" />
<col style="width: 11%" />
</colgroup>
<thead>
<tr>
<th style="text-align: left;">IT Component Type</th>
<th style="text-align: left;">Name</th>
<th style="text-align: left;">Type</th>
<th style="text-align: left;">Version(s)</th>
<th style="text-align: left;">Provider(s)</th>
<th style="text-align: left;">Support start date</th>
<th style="text-align: left;">Support end date</th>
<th style="text-align: left;">Support end date (extended)</th>
<th style="text-align: left;">Support status</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>Programming Language</strong></td>
<td style="text-align: left;">C#</td>
<td style="text-align: left;">Programming Language</td>
<td style="text-align: left;">4.0 (VS 2010)</td>
<td style="text-align: left;">Microsoft</td>
<td style="text-align: left;">2010-04-12</td>
<td style="text-align: left;">2015-07-14</td>
<td style="text-align: left;">2020-07-14</td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> Unsupported</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Programming Language</strong></td>
<td style="text-align: left;">VB.NET</td>
<td style="text-align: left;">Programming Language</td>
<td style="text-align: left;">10.0 (VS 2010)</td>
<td style="text-align: left;">Microsoft</td>
<td style="text-align: left;">2010-04-12</td>
<td style="text-align: left;">2015-07-14</td>
<td style="text-align: left;">2020-07-14</td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> Unsupported</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Web Framework</strong></td>
<td style="text-align: left;">.NET Framework</td>
<td style="text-align: left;">Web Framework</td>
<td style="text-align: left;">4.0</td>
<td style="text-align: left;">Microsoft</td>
<td style="text-align: left;">2010-04-12</td>
<td style="text-align: left;">2016-01-12</td>
<td style="text-align: left;">N/A</td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> Unsupported</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Database</strong></td>
<td style="text-align: left;">Microsoft SQL Server</td>
<td style="text-align: left;">Database</td>
<td style="text-align: left;">2008 R2</td>
<td style="text-align: left;">Microsoft</td>
<td style="text-align: left;">2010-07-20</td>
<td style="text-align: left;">2014-07-08</td>
<td style="text-align: left;">2019-07-09</td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> Unsupported</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Development Tool</strong></td>
<td style="text-align: left;">Visual Studio</td>
<td style="text-align: left;">Development Tool</td>
<td style="text-align: left;">2010</td>
<td style="text-align: left;">Microsoft</td>
<td style="text-align: left;">2010-04-22</td>
<td style="text-align: left;">2015-07-14</td>
<td style="text-align: left;">2020-07-14</td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> Unsupported</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Operating System</strong></td>
<td style="text-align: left;">Windows Server</td>
<td style="text-align: left;">Operating System</td>
<td style="text-align: left;">2008 R2</td>
<td style="text-align: left;">Microsoft</td>
<td style="text-align: left;">2009-10-22</td>
<td style="text-align: left;">2015-01-13</td>
<td style="text-align: left;">2020-01-14</td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> Unsupported</td>
</tr>
</tbody>
</table>
</div>
<h3 id="142-portfolio-strategy">14.2. Portfolio strategy</h3>
This section evaluates the application's strategic fit using the TIME and 6R models.
<div class="table-container">
<table>
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr>
<th style="text-align: left;">Classification Model</th>
<th style="text-align: left;">Evaluation</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>TIME Classification</strong></td>
<td style="text-align: left;"><strong>Tolerate/Migrate</strong>: The application provides high business value as it handles a core banking process (remittance processing). However, its technical quality is very low due to the use of end-of-life frameworks and databases, significant security vulnerabilities (SQLi), and a monolithic, hard-to-maintain architecture. It should be <strong>tolerated</strong> in the short term while an aggressive <strong>migration/refactoring</strong> plan is executed.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>6R Classification</strong></td>
<td style="text-align: left;"><strong>Refactor/Re-architect</strong>: <br>- <strong>Retain</strong>: Not a viable long-term option due to critical security and supportability risks. <br>- <strong>Retire/Replace</strong>: A full replacement would be costly and high-risk given the core business function. <br>- <strong>Rehost</strong>: A good initial step to de-risk the infrastructure, but it doesn't solve the core application-level problems. <br>- <strong>Replatform</strong>: A minimal upgrade to .NET 4.8.1 is a form of replatforming, but it is insufficient. <br>The most appropriate strategy is to <strong>Refactor</strong> the application progressively, or fully <strong>Re-architect</strong> it using modern, cloud-native principles to align its technical quality with its high business value.</td>
</tr>
</tbody>
</table>
</div>
---
</div>

</main>
      <p class="ai-disclaimer">This application analysis was performed using Artificial Intelligence (AI). While AI enhances the process, it may still produce inaccuracies, and all results should be carefully reviewed.</p>
      <footer class="footer">
         <div class="footer-container">
            <div class="footer-brand">
               <img src="https://www.cgd.pt/PublishingImages/WSImages/Novo-CGD/logo-ap_Blue.png" alt="CGD Logo" class="footer-logo">
               <span class="footer-wordmark">Caixa. Para todos e para cada um.</span>
            </div>
            <div class="footer-copyright">
               © 2025 Caixa Geral de Depósitos, SA. All rights reserved.
            </div>
            <div class="footer-socials">
               <a href="https://www.cgd.pt/" target="_blank" title="Website">
                  <svg viewBox="0 0 24 24">
                     <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-1 17.93c-3.95-.49-7-3.85-7-7.93 0-.62.08-1.21.21-1.79L9 15v1c0 1.1.9 2 2 2v1.93zm6.9-2.54c-.26-.81-1-1.39-1.9-1.39h-1v-3c0-.55-.45-1-1-1h-2v-2h2c.55 0 1-.45 1-1V7h2c1.1 0 2-.9 2-2v-.41c2.93 1.19 5 4.06 5 7.41 0 2.08-.8 3.97-2.1 5.39z"/>
                  </svg>
               </a>
               <a href="https://www.facebook.com/caixageraldedepositos" target="_blank" title="Facebook">
                  <svg viewBox="0 0 24 24">
                     <path d="M22 12c0-5.52-4.48-10-10-10S2 6.48 2 12c0 4.84 3.44 8.87 8 9.8V15H8v-3h2V9.5C10 7.57 11.57 6 13.5 6H16v3h-1.5c-1.1 0-1.5.9-1.5 1.5V12h3l-.5 3h-2.5v6.8A10.02 10.02 0 0022 12z"/>
                  </svg>
               </a>
               <a href="https://www.youtube.com/user/mediacgd" target="_blank" title="YouTube">
                  <svg viewBox="0 0 24 24">
                     <path d="M21.58 7.19c-.23-.86-.9-1.52-1.76-1.75C18.25 5 12 5 12 5s-6.25 0-7.82.44c-.86.23-1.52.89-1.76 1.75C2 8.75 2 12 2 12s0 3.25.42 4.81c.23.86.9 1.52 1.76 1.75C5.75 19 12 19 12 19s6.25 0 7.82-.44c.86-.23 1.52-.89 1.76-1.75C22 15.25 22 12 22 12s0-3.25-.42-4.81zM10 15V9l5.2 3-5.2 3z"/>
                  </svg>
               </a>
               <a href="https://www.linkedin.com/company/caixageraldedepositos" target="_blank" title="LinkedIn">
                  <svg viewBox="0 0 24 24">
                     <path d="M19 3a2 2 0 012 2v14a2 2 0 01-2 2H5a2 2 0 01-2-2V5a2 2 0 012-2h14zm-7 5H8v8h4v-8zm-2-2h4v-2H8v2zm8 4h-4v4h4v-4zm0-2h-4v-2h4v2z" clip-rule="evenodd" fill-rule="evenodd"/>
                  </svg>
               </a>
               <a href="https://www.instagram.com/caixageraldedepositos" target="_blank" title="Instagram">
                  <svg viewBox="0 0 24 24">
                     <path d="M7.8 2h8.4C19.4 2 22 4.6 22 7.8v8.4a5.8 5.8 0 01-5.8 5.8H7.8C4.6 22 2 19.4 2 16.2V7.8A5.8 5.8 0 017.8 2zm-.2 2A3.6 3.6 0 004 7.6v8.8C4 18.39 5.61 20 7.6 20h8.8c1.99 0 3.6-1.61 3.6-3.6V7.6C20 5.61 18.39 4 16.4 4H7.6zm9.65 1.5a1.25 1.25 0 100 2.5 1.25 1.25 0 000-2.5zM12 7a5 5 0 100 10 5 5 0 000-10zm0 2a3 3 0 110 6 3 3 0 010-6z"/>
                  </svg>
               </a>
            </div>
         </div>
      </footer>
      <button id="back-to-top" title="Back to Top">
      <span class="icon">arrow_upward</span>
      </button>
      
      <!-- Floating Table of Contents -->
      <div id="floating-toc-toggle" class="floating-toc-toggle" title="Table of Contents">
         <span class="icon">toc</span>
      </div>
      
      <div id="floating-toc" class="floating-toc">
         <div class="floating-toc-header">
            <div class="floating-toc-title">
               <span class="icon">toc</span>
               Table of Contents
            </div>
            <button id="floating-toc-close" class="floating-toc-close" title="Close TOC">
               <span class="icon">close</span>
            </button>
         </div>
         <ul id="floating-toc-list" class="floating-toc-list">
            <!-- TOC items will be dynamically generated -->
         </ul>
      </div>

      <!-- Fullscreen Reading Mode -->
      <div id="fullscreen-reading-mode" class="fullscreen-reading-mode">
         <div class="fullscreen-font-controls">
            <button id="font-decrease" class="fullscreen-font-control" title="Decrease font size">
               <span class="icon">text_decrease</span>
            </button>
            <button id="font-increase" class="fullscreen-font-control" title="Increase font size">
               <span class="icon">text_increase</span>
            </button>
         </div>
         
         <div class="fullscreen-reading-controls">
            <button id="fullscreen-tts-btn" class="fullscreen-reading-control" title="Listen to content">
               <span class="icon">play_arrow</span>
            </button>
            <button id="fullscreen-dark-mode-btn" class="fullscreen-reading-control" title="Toggle dark mode">
               <span class="icon">light_mode</span>
            </button>
            <button id="fullscreen-exit-btn" class="fullscreen-reading-control fullscreen-reading-exit" title="Exit fullscreen reading">
               <span class="icon">fullscreen_exit</span>
            </button>
         </div>
         
         <div id="fullscreen-reading-content" class="fullscreen-reading-content">
            <!-- Content will be dynamically populated -->
         </div>
         
         <div id="fullscreen-reading-progress" class="fullscreen-reading-progress">
            Reading progress: 0%
         </div>
      </div>

      <script>
         document.addEventListener('DOMContentLoaded', function() {
             
             // --- INITIALIZATION ---
             function init() {
                 console.log('Starting initialization...');
                 replaceEmojisWithIcons();
                 removeHeadingNumbers();
                 setupTabs(); // This now also calculates and displays read times
                 console.log('About to initialize dark mode...');
                 initDarkMode();
                 console.log('Dark mode initialization complete');
                 initTTS();
                 initBackToTop();
                 initFloatingTOC();
                 initReadingProgress();
                 initFullscreenReading();
                 initBreadcrumbNavigation();
                 
                 // Initialize and render Mermaid diagrams
                 function checkMermaidAvailability() {
                     if (typeof mermaid === 'undefined') {
                         console.error('Mermaid library not loaded. Diagrams will not be rendered.');
                         return false;
                     }
                     console.log('Mermaid version:', mermaid.version || 'Unknown');
                     return true;
                 }
                 
                 if (checkMermaidAvailability()) {
                     try {
                         initializeMermaidRendering();
                         setTimeout(renderMermaidDiagrams, 500);
                     } catch (error) {
                         console.error('Error initializing Mermaid diagrams:', error);
                     }
                 }
             }
             
             // --- FEATURE: DARK MODE ---
             function initDarkMode() {
                 console.log('Initializing dark mode...');
                 const toggleBtn = document.getElementById('dark-mode-toggle');
                 console.log('Toggle button found:', toggleBtn);
                 
                 // Check if the toggle button exists
                 if (!toggleBtn) {
                     console.warn('Dark mode toggle button not found');
                     return;
                 }
                 
                 // Check if the icon element exists inside the button
                 const iconElement = toggleBtn.querySelector('.icon');
                 console.log('Icon element found:', iconElement);
                 if (!iconElement) {
                     console.warn('Dark mode toggle icon not found');
                     return;
                 }
                 
                 const sunIcon = 'light_mode';
                 const moonIcon = 'dark_mode';
         
                 // Check for saved preference and update UI accordingly
                 if (localStorage.getItem('theme') === 'dark') {
                     console.log('Setting dark mode from localStorage');
                     document.documentElement.classList.add('dark-mode');
                     iconElement.textContent = sunIcon;
                     toggleBtn.title = 'Switch to light mode';
                 } else {
                     console.log('Setting light mode');
                     iconElement.textContent = moonIcon;
                     toggleBtn.title = 'Switch to dark mode';
                 }
         
                 console.log('Adding click event listener to dark mode toggle');
                 toggleBtn.addEventListener('click', () => {
                     console.log('Dark mode toggle clicked!');
                     
                     const isDarkMode = document.documentElement.classList.toggle('dark-mode');
                     console.log('Dark mode toggled:', isDarkMode);
                     console.log('Current document classes:', document.documentElement.className);
                     
                     // Update icon and tooltip based on current mode
                     if (isDarkMode) {
                         console.log('Setting sun icon for dark mode');
                         iconElement.textContent = sunIcon;
                         toggleBtn.title = 'Switch to light mode';
                     } else {
                         console.log('Setting moon icon for light mode');
                         iconElement.textContent = moonIcon;
                         toggleBtn.title = 'Switch to dark mode';
                     }
                     
                     localStorage.setItem('theme', isDarkMode ? 'dark' : 'light');
                     console.log('Theme saved to localStorage:', isDarkMode ? 'dark' : 'light');
                     
                     // Update Mermaid theme if the function exists
                     if (typeof updateMermaidTheme === 'function') {
                         updateMermaidTheme();
                     }
                 });
                 
                 console.log('Dark mode initialization completed successfully');
             }
         
             // --- FEATURE: TEXT-TO-SPEECH (TTS) ---
             function initTTS() {
                 const ttsControls = document.getElementById('tts-controls');
                 const playPauseBtn = document.getElementById('tts-play-pause-btn');
                 const stopBtn = document.getElementById('tts-stop-btn');
                 
                 // Check if TTS elements exist
                 if (!ttsControls || !playPauseBtn || !stopBtn) {
                     console.warn('TTS controls not found');
                     return;
                 }
                 
                 const synth = window.speechSynthesis;
         
                 // Always show TTS controls
                 ttsControls.style.display = 'flex';
                 
                 if (!synth) {
                     console.warn("Browser does not support Speech Synthesis.");
                     // Show controls but disable them
                     playPauseBtn.disabled = true;
                     stopBtn.disabled = true;
                     playPauseBtn.title = "Speech synthesis not supported in this browser";
                     stopBtn.title = "Speech synthesis not supported in this browser";
                     return;
                 }
         
                 let utterance = null;
                 
                 console.log("TTS initialized successfully");
         
                 function play() {
                     console.log("TTS play function called");
                     const activePane = document.querySelector('.tab-pane.active');
                     if (!activePane) {
                         console.warn("No active tab pane found");
                         return;
                     }
                     
                     if (synth.speaking) {
                         console.log("Speech synthesis already speaking");
                         return;
                     }
         
                     // Clone to avoid modifying the live DOM, then clean text
                     const contentClone = activePane.cloneNode(true);
                     contentClone.querySelectorAll('h2, h3, h4').forEach(h => h.textContent = h.textContent + '. '); // Add pauses after headings
                     const textToSpeak = contentClone.innerText;
                     
                     console.log("Text to speak length:", textToSpeak.length);
         
                     utterance = new SpeechSynthesisUtterance(textToSpeak);
                     utterance.lang = document.documentElement.lang || 'en-US';
                     utterance.rate = 0.9; // Slightly slower for better comprehension
                     utterance.pitch = 1.0;
                     utterance.volume = 0.8;
         
                     utterance.onstart = () => {
                         console.log("Speech started");
                         playPauseBtn.querySelector('.icon').textContent = 'pause';
                         playPauseBtn.title = 'Pause listening';
                     };
                     utterance.onpause = () => {
                         console.log("Speech paused");
                         playPauseBtn.querySelector('.icon').textContent = 'play_arrow';
                         playPauseBtn.title = 'Resume listening';
                     };
                     utterance.onresume = () => {
                         console.log("Speech resumed");
                         playPauseBtn.querySelector('.icon').textContent = 'pause';
                         playPauseBtn.title = 'Pause listening';
                     };
                     utterance.onend = () => {
                         console.log("Speech ended");
                         playPauseBtn.querySelector('.icon').textContent = 'play_arrow';
                         playPauseBtn.title = 'Listen to this section';
                         utterance = null;
                     };
                     utterance.onerror = (event) => {
                         console.error("Speech synthesis error:", event);
                         playPauseBtn.querySelector('.icon').textContent = 'play_arrow';
                         playPauseBtn.title = 'Listen to this section';
                         utterance = null;
                     };
                     
                     synth.speak(utterance);
                 }
         
                 function togglePlayPause() {
                     console.log("TTS toggle play/pause clicked");
                     console.log("Current state - speaking:", synth.speaking, "paused:", synth.paused);
                     
                     if (synth.speaking && !synth.paused) {
                         console.log("Pausing speech");
                         synth.pause();
                     } else if (synth.paused) {
                         console.log("Resuming speech");
                         synth.resume();
                     } else {
                         console.log("Starting new speech");
                         play();
                     }
                 }
         
                 function stop() {
                     console.log("TTS stop clicked");
                     synth.cancel(); // Also triggers 'onend'
                 }
         
                 playPauseBtn.addEventListener('click', togglePlayPause);
                 stopBtn.addEventListener('click', stop);
                 
                 // Stop speech when user changes tabs
                 document.querySelector('.tab-navigation')?.addEventListener('click', stop);
             }
             
             // --- FEATURE: BACK TO TOP BUTTON ---
             function initBackToTop() {
                 const backToTopButton = document.getElementById('back-to-top');
                 
                 if (!backToTopButton) {
                     console.warn('Back to top button not found');
                     return;
                 }
                 
                 window.addEventListener('scroll', () => {
                     if (window.scrollY > 300) {
                         backToTopButton.classList.add('show');
                     } else {
                         backToTopButton.classList.remove('show');
                     }
                 });
                 backToTopButton.addEventListener('click', () => {
                     window.scrollTo({ top: 0, behavior: 'smooth' });
                 });
             }

             // --- FEATURE: FLOATING TABLE OF CONTENTS ---
             function initFloatingTOC() {
                 const tocToggle = document.getElementById('floating-toc-toggle');
                 const tocContainer = document.getElementById('floating-toc');
                 const tocClose = document.getElementById('floating-toc-close');
                 const tocList = document.getElementById('floating-toc-list');
                 
                 let isInitialized = false;
                 let tocItems = [];
                 let sectionElements = [];
                 
                 function buildTOC() {
                     if (isInitialized) return;
                     
                     // Get all h2 elements from tab panes
                     const tabPanes = document.querySelectorAll('.tab-pane');
                     tocList.innerHTML = '';
                     tocItems = [];
                     sectionElements = [];
                     
                     tabPanes.forEach((pane, index) => {
                         const h2Element = pane.querySelector('h2');
                         if (!h2Element) return;
                         
                         const tocItem = document.createElement('li');
                         tocItem.className = 'floating-toc-item';
                         
                         const tocLink = document.createElement('a');
                         tocLink.className = 'floating-toc-link';
                         tocLink.href = '#';
                         tocLink.textContent = h2Element.textContent.trim();
                         tocLink.dataset.target = h2Element.id || `section-${index}`;
                         
                         const progressIndicator = document.createElement('div');
                         progressIndicator.className = 'floating-toc-progress';
                         const progressFill = document.createElement('div');
                         progressFill.className = 'floating-toc-progress-fill';
                         progressIndicator.appendChild(progressFill);
                         tocLink.appendChild(progressIndicator);
                         
                         tocItem.appendChild(tocLink);
                         tocList.appendChild(tocItem);
                         
                         tocItems.push({
                             link: tocLink,
                             pane: pane,
                             h2: h2Element
                         });
                         
                         sectionElements.push({
                             element: pane,
                             link: tocLink,
                             id: h2Element.id || `section-${index}`
                         });
                         
                         // Add click handler for smooth scrolling to tab
                         tocLink.addEventListener('click', (e) => {
                             e.preventDefault();
                             
                             // Find and activate the corresponding tab
                             const tabButton = document.querySelector(`[data-tab="${pane.id}"]`);
                             if (tabButton) {
                                 tabButton.click();
                                 
                                 // Small delay to ensure tab is active, then scroll to h2
                                 setTimeout(() => {
                                     h2Element.scrollIntoView({
                                         behavior: 'smooth',
                                         block: 'start'
                                     });
                                 }, 100);
                             }
                         });
                     });
                     
                     isInitialized = true;
                 }
                 
                 function updateProgress() {
                     if (!isInitialized || tocItems.length === 0) return;
                     
                     const activeTabPane = document.querySelector('.tab-pane.active');
                     if (!activeTabPane) return;
                     
                     // Find the corresponding TOC item
                     const activeTocItem = tocItems.find(item => item.pane === activeTabPane);
                     
                     // Clear all active states
                     tocItems.forEach(item => {
                         item.link.classList.remove('active', 'reading');
                     });
                     
                     if (activeTocItem) {
                         activeTocItem.link.classList.add('active');
                         
                         // Calculate reading progress for the active section
                         const paneRect = activeTabPane.getBoundingClientRect();
                         const viewportHeight = window.innerHeight;
                         
                         // Consider a section as "reading" if it's visible in viewport
                         if (paneRect.top < viewportHeight && paneRect.bottom > 0) {
                             activeTocItem.link.classList.add('reading');
                         }
                     }
                 }
                 
                 function showTOC() {
                     buildTOC();
                     tocContainer.classList.add('show');
                     tocToggle.classList.remove('show');
                     updateProgress();
                 }
                 
                 function hideTOC() {
                     tocContainer.classList.remove('show');
                     tocToggle.classList.add('show');
                 }
                 
                 // Event listeners
                 tocToggle.addEventListener('click', showTOC);
                 tocClose.addEventListener('click', hideTOC);
                 
                 // Close TOC when clicking outside
                 document.addEventListener('click', (e) => {
                     if (!tocContainer.contains(e.target) && !tocToggle.contains(e.target)) {
                         if (tocContainer.classList.contains('show')) {
                             hideTOC();
                         }
                     }
                 });
                 
                 // Show/hide toggle button on scroll
                 window.addEventListener('scroll', () => {
                     if (window.scrollY > 500) {
                         if (!tocContainer.classList.contains('show')) {
                             tocToggle.classList.add('show');
                         }
                     } else {
                         tocToggle.classList.remove('show');
                         tocContainer.classList.remove('show');
                     }
                     
                     updateProgress();
                 });
                 
                 // Update progress when tabs change
                 const tabNavigation = document.querySelector('.tab-navigation');
                 if (tabNavigation) {
                     tabNavigation.addEventListener('click', () => {
                         setTimeout(updateProgress, 100);
                     });
                 }
                 
                 // Handle ESC key to close TOC
                 document.addEventListener('keydown', (e) => {
                     if (e.key === 'Escape' && tocContainer.classList.contains('show')) {
                         hideTOC();
                     }                 });
             }

             // --- FEATURE: READING PROGRESS INDICATOR ---
             function initReadingProgress() {
                 const progressBar = document.getElementById('reading-progress');
                 const progressFill = document.getElementById('reading-progress-fill');
                 const progressText = document.getElementById('reading-progress-text');
                 
                 let isVisible = false;
                 
                 function updateProgress() {
                     // Get the active tab content to calculate progress within that tab
                     const activeTabPane = document.querySelector('.tab-pane.active');
                     if (!activeTabPane) return;
                     
                     const rect = activeTabPane.getBoundingClientRect();
                     const tabTop = activeTabPane.offsetTop;
                     const tabHeight = activeTabPane.offsetHeight;
                     const headerHeight = document.querySelector('.header').offsetHeight + 
                                         document.querySelector('.tab-navigation-container').offsetHeight;
                     
                     // Calculate scroll position relative to the active tab
                     const scrollTop = window.pageYOffset;
                     const tabStart = tabTop - headerHeight;
                     const tabEnd = tabTop + tabHeight - window.innerHeight;
                     
                     // Calculate progress percentage for the current tab
                     let progress = 0;
                     if (scrollTop <= tabStart) {
                         progress = 0;
                     } else if (scrollTop >= tabEnd) {
                         progress = 100;
                     } else {
                         const scrollableHeight = tabEnd - tabStart;
                         const scrolledHeight = scrollTop - tabStart;
                         progress = Math.min(100, Math.max(0, (scrolledHeight / scrollableHeight) * 100));
                     }
                     
                     // Show progress bar after scrolling starts
                     const shouldShow = scrollTop > 100;
                     
                     if (shouldShow && !isVisible) {
                         progressBar.classList.add('show');
                         progressText.classList.add('show');
                         isVisible = true;
                     } else if (!shouldShow && isVisible) {
                         progressBar.classList.remove('show');
                         progressText.classList.remove('show');
                         isVisible = false;
                     }
                     
                     // Update progress bar and text
                     if (isVisible) {
                         progressFill.style.width = `${progress}%`;
                         progressText.textContent = `${Math.round(progress)}% read`;
                         
                         // Add current section info
                         const activeH2 = activeTabPane.querySelector('h2');
                         if (activeH2) {
                             const sectionTitle = activeH2.textContent.trim();
                             const shortTitle = sectionTitle.length > 25 ? 
                                               sectionTitle.substring(0, 25) + '...' : 
                                               sectionTitle;
                             progressText.textContent = `${Math.round(progress)}% • ${shortTitle}`;
                         }
                     }
                 }
                 
                 // Throttled scroll handler for better performance
                 let ticking = false;
                 function handleScroll() {
                     if (!ticking) {
                         requestAnimationFrame(() => {
                             updateProgress();
                             ticking = false;
                         });
                         ticking = true;
                     }
                 }
                 
                 // Event listeners
                 window.addEventListener('scroll', handleScroll);
                 window.addEventListener('resize', updateProgress);
                 
                 // Update progress when tabs change
                 const tabNavigation = document.querySelector('.tab-navigation');
                 if (tabNavigation) {
                     tabNavigation.addEventListener('click', () => {
                         setTimeout(updateProgress, 150);
                     });
                 }
                 
                 // Initial update
                 updateProgress();
             }

             // --- FEATURE: FULLSCREEN READING MODE ---
             function initFullscreenReading() {
                 const fullscreenBtn = document.getElementById('fullscreen-reading-btn');
                 const fullscreenMode = document.getElementById('fullscreen-reading-mode');
                 const fullscreenContent = document.getElementById('fullscreen-reading-content');
                 const fullscreenProgress = document.getElementById('fullscreen-reading-progress');
                 const exitBtn = document.getElementById('fullscreen-exit-btn');
                 const fontIncreaseBtn = document.getElementById('font-increase');
                 const fontDecreaseBtn = document.getElementById('font-decrease');
                 const fullscreenTtsBtn = document.getElementById('fullscreen-tts-btn');
                 const fullscreenDarkModeBtn = document.getElementById('fullscreen-dark-mode-btn');
                 
                 let currentFontSize = 1.1; // Default font size in rem
                 let isFullscreenActive = false;
                 
                 function enterFullscreenReading() {
                     const activeTabPane = document.querySelector('.tab-pane.active');
                     if (!activeTabPane) return;
                     
                     // Clone the active content
                     const contentClone = activeTabPane.cloneNode(true);
                     
                     // Clean up the cloned content for better reading
                     contentClone.querySelectorAll('.section-read-time').forEach(el => el.remove());
                     contentClone.querySelectorAll('script').forEach(el => el.remove());
                     
                     // Set the content
                     fullscreenContent.innerHTML = contentClone.innerHTML;
                     
                     // Activate fullscreen mode
                     document.body.classList.add('fullscreen-reading');
                     fullscreenMode.classList.add('active');
                     isFullscreenActive = true;
                     
                     // Update dark mode button state
                     const isDarkMode = document.documentElement.classList.contains('dark-mode');
                     fullscreenDarkModeBtn.querySelector('.icon').textContent = isDarkMode ? 'light_mode' : 'dark_mode';
                     fullscreenDarkModeBtn.title = isDarkMode ? 'Switch to light mode' : 'Switch to dark mode';
                     
                     // Initialize progress tracking
                     updateFullscreenProgress();
                     
                     // Prevent body scroll
                     document.body.style.overflow = 'hidden';
                 }
                 
                 function exitFullscreenReading() {
                     document.body.classList.remove('fullscreen-reading');
                     fullscreenMode.classList.remove('active');
                     isFullscreenActive = false;
                     
                     // Restore body scroll
                     document.body.style.overflow = '';
                     
                     // Stop any TTS playback
                     if (window.speechSynthesis) {
                         window.speechSynthesis.cancel();
                     }
                 }
                 
                 function adjustFontSize(increase) {
                     if (increase) {
                         currentFontSize = Math.min(2.0, currentFontSize + 0.1);
                     } else {
                         currentFontSize = Math.max(0.8, currentFontSize - 0.1);
                     }
                     fullscreenContent.style.fontSize = `${currentFontSize}rem`;
                 }
                 
                 function updateFullscreenProgress() {
                     if (!isFullscreenActive) return;
                     
                     const scrollTop = fullscreenMode.scrollTop;
                     const scrollHeight = fullscreenMode.scrollHeight - fullscreenMode.clientHeight;
                     const progress = scrollHeight > 0 ? Math.round((scrollTop / scrollHeight) * 100) : 0;
                     
                     fullscreenProgress.textContent = `Reading progress: ${progress}%`;
                 }
                 
                 function toggleFullscreenTTS() {
                     const synth = window.speechSynthesis;
                     if (!synth) return;
                     
                     if (synth.speaking && !synth.paused) {
                         synth.pause();
                         fullscreenTtsBtn.querySelector('.icon').textContent = 'play_arrow';
                         fullscreenTtsBtn.title = 'Resume listening';
                     } else if (synth.paused) {
                         synth.resume();
                         fullscreenTtsBtn.querySelector('.icon').textContent = 'pause';
                         fullscreenTtsBtn.title = 'Pause listening';
                     } else {
                         // Start new speech
                         const textToSpeak = fullscreenContent.innerText;
                         const utterance = new SpeechSynthesisUtterance(textToSpeak);
                         utterance.lang = document.documentElement.lang || 'en-US';
                         utterance.rate = 0.9;
                         utterance.pitch = 1.0;
                         utterance.volume = 0.8;
                         
                         utterance.onstart = () => {
                             fullscreenTtsBtn.querySelector('.icon').textContent = 'pause';
                             fullscreenTtsBtn.title = 'Pause listening';
                         };
                         
                         utterance.onend = () => {
                             fullscreenTtsBtn.querySelector('.icon').textContent = 'play_arrow';
                             fullscreenTtsBtn.title = 'Listen to content';
                         };
                         
                         utterance.onerror = () => {
                             fullscreenTtsBtn.querySelector('.icon').textContent = 'play_arrow';
                             fullscreenTtsBtn.title = 'Listen to content';
                         };
                         
                         synth.speak(utterance);
                     }
                 }
                 
                 function toggleFullscreenDarkMode() {
                     const isDarkMode = document.documentElement.classList.toggle('dark-mode');
                     fullscreenDarkModeBtn.querySelector('.icon').textContent = isDarkMode ? 'light_mode' : 'dark_mode';
                     fullscreenDarkModeBtn.title = isDarkMode ? 'Switch to light mode' : 'Switch to dark mode';
                     localStorage.setItem('theme', isDarkMode ? 'dark' : 'light');
                 }
                 
                 // Event listeners
                 fullscreenBtn.addEventListener('click', enterFullscreenReading);
                 exitBtn.addEventListener('click', exitFullscreenReading);
                 fontIncreaseBtn.addEventListener('click', () => adjustFontSize(true));
                 fontDecreaseBtn.addEventListener('click', () => adjustFontSize(false));
                 fullscreenTtsBtn.addEventListener('click', toggleFullscreenTTS);
                 fullscreenDarkModeBtn.addEventListener('click', toggleFullscreenDarkMode);
                 
                 // Scroll progress tracking
                 fullscreenMode.addEventListener('scroll', () => {
                     if (isFullscreenActive) {
                         updateFullscreenProgress();
                     }
                 });
                 
                 // Keyboard shortcuts
                 document.addEventListener('keydown', (e) => {
                     if (!isFullscreenActive) return;
                     
                     switch(e.key) {
                         case 'Escape':
                             exitFullscreenReading();
                             break;
                         case 'F':
                         case 'f':
                             if (e.ctrlKey) {
                                 e.preventDefault();
                                 // Could implement search functionality here
                             }
                             break;
                         case '+':
                         case '=':
                             if (e.ctrlKey) {
                                 e.preventDefault();
                                 adjustFontSize(true);
                             }
                             break;
                         case '-':
                             if (e.ctrlKey) {
                                 e.preventDefault();
                                 adjustFontSize(false);
                             }
                             break;
                         case ' ':
                             if (e.ctrlKey) {
                                 e.preventDefault();
                                 toggleFullscreenTTS();
                             }
                             break;
                     }
                 });
                 
                 // Prevent context menu in fullscreen mode
                 fullscreenMode.addEventListener('contextmenu', (e) => {
                     if (isFullscreenActive) {
                         e.preventDefault();
                     }
                 });
             }

             // --- FEATURE: BREADCRUMB NAVIGATION ---
             function initBreadcrumbNavigation() {
                 const breadcrumbContainer = document.getElementById('breadcrumb-container');
                 const breadcrumbHome = document.getElementById('breadcrumb-home');
                 const breadcrumbCurrent = document.getElementById('breadcrumb-current');
                 const breadcrumbProgressFill = document.getElementById('breadcrumb-progress-fill');
                 const breadcrumbProgressText = document.getElementById('breadcrumb-progress-text');
                 const breadcrumbSectionCount = document.getElementById('breadcrumb-section-count');
                 
                 let sections = [];
                 let currentSectionIndex = 0;
                 let isVisible = false;
                 
                 function initializeSections() {
                     const tabPanes = document.querySelectorAll('.tab-pane');
                     sections = Array.from(tabPanes).map((pane, index) => {
                         const h2Element = pane.querySelector('h2');
                         return {
                             id: pane.id,
                             title: h2Element ? h2Element.textContent.trim() : `Section ${index + 1}`,
                             element: pane,
                             index: index
                         };
                     });
                 }
                 
                 function updateBreadcrumb() {
                     const activeTabPane = document.querySelector('.tab-pane.active');
                     if (!activeTabPane || sections.length === 0) return;
                     
                     // Find current section
                     currentSectionIndex = sections.findIndex(section => section.element === activeTabPane);
                     const currentSection = sections[currentSectionIndex];
                     
                     if (!currentSection) return;
                     
                     // Update breadcrumb current section
                     const maxTitleLength = window.innerWidth < 768 ? 25 : 40;
                     const displayTitle = currentSection.title.length > maxTitleLength ? 
                                         currentSection.title.substring(0, maxTitleLength) + '...' : 
                                         currentSection.title;
                     
                     breadcrumbCurrent.innerHTML = `
                         <span class="breadcrumb-link active" title="${currentSection.title}">
                             ${displayTitle}
                         </span>
                     `;
                     
                     // Update section count
                     breadcrumbSectionCount.textContent = `Section ${currentSectionIndex + 1} of ${sections.length}`;
                     
                     // Update progress
                     const progress = Math.round(((currentSectionIndex + 1) / sections.length) * 100);
                     breadcrumbProgressFill.style.width = `${progress}%`;
                     breadcrumbProgressText.textContent = `${progress}%`;
                     
                     // Show/hide breadcrumb based on scroll position
                     const shouldShow = window.scrollY > 200;
                     if (shouldShow && !isVisible) {
                         breadcrumbContainer.classList.add('show');
                         isVisible = true;
                     } else if (!shouldShow && isVisible) {
                         breadcrumbContainer.classList.remove('show');
                         isVisible = false;
                     }
                 }
                 
                 function createSectionBreadcrumb() {
                     const activeTabPane = document.querySelector('.tab-pane.active');
                     if (!activeTabPane) return;
                     
                     // Get current section hierarchy
                     const headings = activeTabPane.querySelectorAll('h2, h3, h4');
                     const currentScroll = window.scrollY + window.innerHeight / 2;
                     let activeHeading = null;
                     
                     // Find the currently visible heading
                     for (let i = headings.length - 1; i >= 0; i--) {
                         const heading = headings[i];
                         const rect = heading.getBoundingClientRect();
                         const absoluteTop = window.scrollY + rect.top;
                         
                         if (absoluteTop <= currentScroll) {
                             activeHeading = heading;
                             break;
                         }
                     }
                     
                     // Build breadcrumb path
                     let breadcrumbPath = '';
                     if (activeHeading && activeHeading.tagName !== 'H2') {
                         const h2 = activeTabPane.querySelector('h2');
                         const headingText = activeHeading.textContent.trim();
                         const maxLength = window.innerWidth < 768 ? 20 : 30;
                         const shortText = headingText.length > maxLength ? 
                                          headingText.substring(0, maxLength) + '...' : 
                                          headingText;
                         
                         breadcrumbPath = `
                             <span class="breadcrumb-separator">›</span>
                             <div class="breadcrumb-item">
                                 <span class="breadcrumb-link" title="${headingText}">
                                     ${shortText}
                                 </span>
                             </div>
                         `;
                     }
                     
                     // Update the breadcrumb current section with subsection info
                     const currentSection = sections[currentSectionIndex];
                     if (currentSection) {
                         const maxTitleLength = window.innerWidth < 768 ? 20 : 30;
                         const displayTitle = currentSection.title.length > maxTitleLength ? 
                                             currentSection.title.substring(0, maxTitleLength) + '...' : 
                                             currentSection.title;
                         
                         breadcrumbCurrent.innerHTML = `
                             <span class="breadcrumb-link active" title="${currentSection.title}">
                                 ${displayTitle}
                             </span>
                             ${breadcrumbPath}
                         `;
                     }
                 }
                 
                 function navigateToSection(sectionIndex) {
                     if (sectionIndex < 0 || sectionIndex >= sections.length) return;
                     
                     const section = sections[sectionIndex];
                     const tabButton = document.querySelector(`[data-tab="${section.id}"]`);
                     
                     if (tabButton) {
                         tabButton.click();
                         setTimeout(() => {
                             section.element.scrollIntoView({
                                 behavior: 'smooth',
                                 block: 'start'
                             });
                         }, 150);
                     }
                 }
                 
                 // Event listeners
                 breadcrumbHome.addEventListener('click', (e) => {
                     e.preventDefault();
                     navigateToSection(0);
                 });
                 
                 // Throttled scroll handler
                 let scrollTicking = false;
                 function handleScroll() {
                     if (!scrollTicking) {
                         requestAnimationFrame(() => {
                             updateBreadcrumb();
                             createSectionBreadcrumb();
                             scrollTicking = false;
                         });
                         scrollTicking = true;
                     }
                 }
                 
                 // Event listeners
                 window.addEventListener('scroll', handleScroll);
                 window.addEventListener('resize', updateBreadcrumb);
                 
                 // Update breadcrumb when tabs change
                 const tabNavigation = document.querySelector('.tab-navigation');
                 if (tabNavigation) {
                     tabNavigation.addEventListener('click', () => {
                         setTimeout(() => {
                             updateBreadcrumb();
                             createSectionBreadcrumb();
                         }, 100);
                     });
                 }
                 
                 // Keyboard navigation
                 document.addEventListener('keydown', (e) => {
                     if (e.altKey) {
                         switch(e.key) {
                             case 'ArrowLeft':
                                 e.preventDefault();
                                 if (currentSectionIndex > 0) {
                                     navigateToSection(currentSectionIndex - 1);
                                 }
                                 break;
                             case 'ArrowRight':
                                 e.preventDefault();
                                 if (currentSectionIndex < sections.length - 1) {
                                     navigateToSection(currentSectionIndex + 1);
                                 }
                                 break;
                             case 'Home':
                                 e.preventDefault();
                                 navigateToSection(0);
                                 break;
                             case 'End':
                                 e.preventDefault();
                                 navigateToSection(sections.length - 1);
                                 break;
                         }
                     }
                 });
                 
                 // Initialize after tabs are set up
                 setTimeout(() => {
                     initializeSections();
                     updateBreadcrumb();
                     createSectionBreadcrumb();
                 }, 200);
             }

             // --- FEATURE: READ TIME CALCULATION ---
             function calculateAndDisplayReadTime() {
                 const wordsPerMinute = 225;
                 
                 function calculate(element) {
                     if (!element) return 0;
                     const text = element.innerText || '';
                     const wordCount = text.trim().split(/\s+/).length;
                     const minutes = Math.ceil(wordCount / wordsPerMinute);
                     return minutes;
                 }
                 
                 // Calculate reading time for each section and sum them up
                 let totalMinutes = 0;
         
                 // Calculate for each section and add after the description paragraph
                 document.querySelectorAll('.tab-pane').forEach(pane => {
                     const sectionMinutes = calculate(pane);
                     
                     // Add this section's reading time to the total
                     totalMinutes += sectionMinutes;
                     
                     const h2Element = pane.querySelector('h2');
                     
                     if (h2Element && sectionMinutes > 0) {
                         // Remove any existing read time elements
                         const existingReadTime = pane.querySelector('.section-read-time');
                         if (existingReadTime) {
                             existingReadTime.remove();
                         }
                         
                         // Find the first paragraph after the h2 (section description)
                         let insertionPoint = h2Element.nextSibling;
                         let firstParagraph = null;
                         
                         // Walk through siblings to find the first paragraph
                         while (insertionPoint) {
                             if (insertionPoint.nodeType === 1 && insertionPoint.tagName === 'P') {
                                 firstParagraph = insertionPoint;
                                 break;
                             }
                             insertionPoint = insertionPoint.nextSibling;
                         }
                         
                         // Create new read time element
                         const readTimeDiv = document.createElement('div');
                         readTimeDiv.className = 'section-read-time';
                         readTimeDiv.style.cssText = 'margin: 0.5rem 0 1rem 0; color: var(--text-secondary); font-size: 0.875rem; display: flex; align-items: center; gap: 0.25rem;';
                         
                         const clockIcon = document.createElement('span');
                         clockIcon.className = 'icon';
                         clockIcon.textContent = 'schedule';
                         clockIcon.style.fontSize = '18px';
                         
                         const readTimeText = document.createElement('span');
                         readTimeText.textContent = `${sectionMinutes} min read`;
                         
                         readTimeDiv.appendChild(clockIcon);
                         readTimeDiv.appendChild(readTimeText);
                         
                         // Insert after the first paragraph if found, otherwise after h2
                         if (firstParagraph) {
                             firstParagraph.parentNode.insertBefore(readTimeDiv, firstParagraph.nextSibling);
                         } else {
                             h2Element.parentNode.insertBefore(readTimeDiv, h2Element.nextSibling);
                         }
                     }
                 });
                 
                 // Update the total reading time in the product header
                 const totalReadTimeEl = document.getElementById('total-read-time').querySelector('span:last-child');
                 totalReadTimeEl.textContent = `${totalMinutes} min read`;
             }
         
             // --- UTILITY: EMOJI REPLACEMENT ---
             function replaceEmojisWithIcons() {
                 const emojiToIconMap = {
                     '🔴': '<span class="icon icon-high" title="High/Critical">dangerous</span>',
                     '🟠': '<span class="icon icon-medium" title="Medium/Warning">warning</span>',
                     '🟢': '<span class="icon icon-low" title="Low/Info">recommend</span>',
                     '✅': '<span class="icon icon-check" title="Yes/Used/Supported">check_circle</span>',
                     '❌': '<span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span>',
                     '🔴': '<span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span>',
                     '❔': '<span class="icon icon-question" title="Uncertain/Likely">help</span>'
                 };
                 const emojiRegex = new RegExp(Object.keys(emojiToIconMap).join('|'), 'g');
                 function walkDOM(node) {
                     if (node.nodeType === 3) {
                         if (emojiRegex.test(node.nodeValue)) {
                             const tempWrapper = document.createElement('span');
                             tempWrapper.innerHTML = node.nodeValue.replace(emojiRegex, match => emojiToIconMap[match]);
                             node.parentNode.replaceChild(tempWrapper, node);
                         }
                     } else if (node.nodeType === 1 && node.nodeName !== 'SCRIPT' && node.nodeName !== 'STYLE') {
                         for (let i = 0; i < node.childNodes.length; i++) {
                             walkDOM(node.childNodes[i]);
                         }
                     }
                 }
                 walkDOM(document.getElementById('main-content-area'));
             }
         
             // --- UTILITY: HEADING CLEANUP ---
             function removeHeadingNumbers() {
                 const headings = document.querySelectorAll('h2, h3, h4, h5, h6');
                 const numberPrefixRegex = /^\d+\.[\d\.]*\s*/;
                 headings.forEach(heading => {
                     const firstChild = heading.childNodes[0];
                     if (firstChild && firstChild.nodeType === 3) {
                         firstChild.nodeValue = firstChild.nodeValue.replace(numberPrefixRegex, '').trim();
                     }
                 });
             }
         
             // --- CORE SETUP: TABS ---
             function setupTabs() {
                 const mainContent = document.getElementById('main-content-area');
                 const tabPlaceholder = document.getElementById('tab-container-placeholder');
                 const sections = Array.from(mainContent.querySelectorAll('.product-section'));
                 
                 if (sections.length > 0) {
                     const tabContainer = document.createElement('div');
                     tabContainer.className = 'tab-navigation-container';
                     const tabNavScroller = document.createElement('div');
                     tabNavScroller.className = 'tab-nav-scroller';
                     const tabNav = document.createElement('nav');
                     tabNav.className = 'tab-navigation';
                     const tabContent = document.createElement('div');
                     tabContent.className = 'tab-content';
         
                     let tabCounter = 0; // Separate counter for actual tabs created
         
                     sections.forEach((section, index) => {
                         const headingElement = section.querySelector('h2');
                         if (!headingElement) return;
                         
                         tabCounter++; // Increment only when a tab is actually created
                         const tabPaneId = `pane-${tabCounter}`;
                         const tabButton = document.createElement('button');
                         tabButton.className = 'tab-link';
                         const tabText = document.createElement('span');
                         tabText.textContent = headingElement.textContent.trim();
                         tabButton.appendChild(tabText);
                         tabButton.setAttribute('data-tab', tabPaneId);
                         tabNav.appendChild(tabButton);
                         
                         const tabPane = document.createElement('div');
                         tabPane.id = tabPaneId;
                         tabPane.className = 'tab-pane';
                         tabPane.appendChild(section);
                         tabContent.appendChild(tabPane);
         
                         if (tabCounter === 1) { // First actual tab created
                             tabButton.classList.add('active');
                             tabPane.classList.add('active');
                         }
                     });
         
                     tabNavScroller.appendChild(tabNav);
                     tabContainer.appendChild(tabNavScroller);
                     tabPlaceholder.appendChild(tabContainer);
                     mainContent.appendChild(tabContent);
         
                     tabNav.addEventListener('click', (e) => {
                         const clickedTab = e.target.closest('.tab-link');
                         if (!clickedTab) return;
                         tabNav.querySelectorAll('.tab-link').forEach(tab => tab.classList.remove('active'));
                         tabContent.querySelectorAll('.tab-pane').forEach(pane => pane.classList.remove('active'));
                         clickedTab.classList.add('active');
                         document.getElementById(clickedTab.dataset.tab)?.classList.add('active');
                     });
         
                     // After tabs are in the DOM, calculate read times
                     calculateAndDisplayReadTime();
                 }
             }
         
             function detectDiagramType(code) {
                 const trimmedCode = code.trim().toLowerCase();
                 
                 if (trimmedCode.startsWith('graph') || trimmedCode.startsWith('flowchart')) return 'flowchart';
                 if (trimmedCode.startsWith('sequencediagram')) return 'sequence';
                 if (trimmedCode.startsWith('classdiagram')) return 'class';
                 if (trimmedCode.startsWith('statediagram')) return 'state';
                 if (trimmedCode.startsWith('erdiagram')) return 'er';
                 if (trimmedCode.startsWith('gantt')) return 'gantt';
                 if (trimmedCode.startsWith('journey')) return 'user-journey';
                 if (trimmedCode.startsWith('gitgraph')) return 'git';
                 if (trimmedCode.startsWith('pie')) return 'pie';
                 if (trimmedCode.startsWith('mindmap')) return 'mindmap';
                 if (trimmedCode.startsWith('timeline')) return 'timeline';
                 if (trimmedCode.startsWith('zenuml')) return 'zenuml';
                 if (trimmedCode.startsWith('quadrantchart')) return 'quadrant';
                 if (trimmedCode.startsWith('xychart')) return 'xy-chart';
                 if (trimmedCode.startsWith('block')) return 'block';
                 if (trimmedCode.startsWith('packet')) return 'packet';
                 if (trimmedCode.startsWith('treemap')) return 'treemap';
                 
                 return 'unknown';
             }
             
             function validateAndFixMermaidSyntax(code) {
                 let fixedCode = code.trim();
                 
                 // First, decode HTML entities that might cause parsing issues
                 fixedCode = fixedCode
                     .replace(/&amp;/g, '&')
                     .replace(/&lt;br&gt;/g, '<br>') // Handle HTML line breaks first
                     .replace(/&lt;/g, '<')
                     .replace(/&gt;/g, '>')
                     .replace(/&#39;/g, "'")
                     .replace(/&quot;/g, '"')
                     .replace(/&nbsp;/g, ' ')
                     .replace(/&apos;/g, "'");
                 
                 // Detect diagram type
                 const diagramType = detectDiagramType(fixedCode);
                 
                 // Handle unknown diagram types by converting to flowchart if possible
                 if (diagramType === 'unknown') {
                     console.warn('Unknown diagram type, attempting to render as-is');
                 }
                 
                 // Fix common syntax issues based on diagram type
                 switch (diagramType) {
                     case 'flowchart':
                         // Ensure flowchart has proper direction
                         if (!fixedCode.match(/(TD|TB|BT|RL|LR)/)) {
                             fixedCode = fixedCode.replace(/^(flowchart|graph)/, '$1 TD');
                         }
                         
                         // Fix specific pattern: node labels with <br> and file paths
                         // This pattern is causing the parser error: [Label<br>/path/file.xhtml]
                         fixedCode = fixedCode.replace(/\[([^\[\]]*)<br>([^\[\]]*)\]/g, (match, label, path) => {
                             // Clean the label and path, replace problematic characters
                             const cleanLabel = label.trim();
                             const cleanPath = path.trim()
                                 .replace(/\//g, '∕') // Replace forward slashes with math division symbol
                                 .replace(/\./g, '·'); // Replace dots with middle dot
                             return `["${cleanLabel}\\n${cleanPath}"]`; // Use quoted strings for safety
                         });
                         
                         // Handle similar pattern in parentheses
                         fixedCode = fixedCode.replace(/\(([^\(\)]*)<br>([^\(\)]*)\)/g, (match, label, path) => {
                             const cleanLabel = label.trim();
                             const cleanPath = path.trim()
                                 .replace(/\//g, '∕')
                                 .replace(/\./g, '·');
                             return `("${cleanLabel}\\n${cleanPath}")`;
                         });
                         
                         // Fix node labels with parentheses that can cause parsing issues
                         // Pattern: A[Label (with parentheses)] --> B
                         fixedCode = fixedCode.replace(/(\w+)\[([^\[\]]*\([^\[\]]*\)[^\[\]]*)\]/g, (match, nodeId, label) => {
                             // Wrap labels containing parentheses in quotes
                             const cleanLabel = label.replace(/"/g, '\\"'); // Escape existing quotes
                             return `${nodeId}["${cleanLabel}"]`;
                         });
                         
                         // Fix incomplete arrow syntax - ensure arrows have proper targets
                         // Pattern: A[Label] - (incomplete arrow at end of line)
                         fixedCode = fixedCode.replace(/(\w+\[[^\]]+\]|\w+\([^)]+\)|\w+)\s+--?\s*$/gm, (match, source) => {
                             // If we find an incomplete arrow at end of line, remove it entirely
                             console.warn('Removing incomplete arrow syntax:', match.trim());
                             return source.trim();
                         });
                         
                         // Fix common arrow syntax issues
                         fixedCode = fixedCode
                             .replace(/--&gt;/g, '-->')  // Fix any remaining HTML entities in arrows
                             .replace(/-->/g, ' --> ') // Ensure proper spacing around arrows
                             .replace(/\s+-->\s+/g, ' --> ') // Clean up multiple spaces
                             .replace(/\[\s+/g, '[') // Remove extra spaces after opening brackets
                             .replace(/\s+\]/g, ']') // Remove extra spaces before closing brackets
                             .replace(/\(\s+/g, '(') // Remove extra spaces after opening parentheses
                             .replace(/\s+\)/g, ')') // Remove extra spaces before closing parentheses
                             .replace(/\{\s+/g, '{') // Remove extra spaces after opening braces
                             .replace(/\s+\}/g, '}'); // Remove extra spaces before closing braces
                         
                         // Handle any remaining line breaks in node labels
                         fixedCode = fixedCode.replace(/<br>/gi, '\\n'); // Convert HTML breaks to Mermaid line breaks
                         
                         break;
                         
                     case 'mindmap':
                         // Ensure mindmap has proper structure
                         if (!fixedCode.includes('root(')) {
                             // If incomplete mindmap, add basic structure
                             const lines = fixedCode.split('\n');
                             if (lines.length > 1 && lines[0].trim() === 'mindmap') {
                                 // Wrap content in root node
                                 const content = lines.slice(1).join('\n').trim();
                                 if (content) {
                                     fixedCode = `mindmap\n  root((${content.split('\n')[0] || 'Root'}))\n${content}`;
                                 }
                             }
                         }
                         // Remove or fix invalid icon syntax for older versions
                         fixedCode = fixedCode.replace(/::icon\([^)]+\)/g, '');
                         break;
                         
                     case 'user-journey':
                         // Ensure journey diagram has proper structure
                         if (!fixedCode.includes('title')) {
                             const lines = fixedCode.split('\n');
                             if (lines.length > 1 && lines[0].trim() === 'journey') {
                                 lines.splice(1, 0, '    title User Journey');
                                 fixedCode = lines.join('\n');
                             }
                         }
                         break;
                         
                     case 'timeline':
                         // Timeline diagrams should have proper structure
                         if (!fixedCode.includes('title')) {
                             const lines = fixedCode.split('\n');
                             if (lines.length > 1 && lines[0].trim() === 'timeline') {
                                 lines.splice(1, 0, '  title Timeline');
                                 fixedCode = lines.join('\n');
                             }
                         }
                         break;
                 }
                 
                 // Final cleanup - remove any remaining problematic characters
                 fixedCode = fixedCode
                     .replace(/\r\n/g, '\n') // Normalize line endings
                     .replace(/\r/g, '\n')   // Convert old Mac line endings
                     .split('\n')
                     .map(line => line.trimRight()) // Remove trailing whitespace from each line
                     .join('\n')
                     .replace(/\n\s*\n\s*\n/g, '\n\n'); // Remove excessive blank lines
                 
                 return fixedCode;
             }
             
             // Function to re-render diagrams when theme changes
             function updateMermaidTheme() {
                 const isDarkMode = document.documentElement.classList.contains('dark-mode') || 
                                   document.documentElement.getAttribute('data-theme') === 'dark' ||
                                   window.matchMedia('(prefers-color-scheme: dark)').matches;
                 
                 try {
                     console.log(`Updating Mermaid theme to ${isDarkMode ? 'dark' : 'light'} mode`);
                     
                     // Step 1: Clear all existing rendered containers and reset processed state
                     const containers = document.querySelectorAll('.mermaid-container');
                     const preBlocks = document.querySelectorAll('pre.mermaid');
                     
                     containers.forEach(container => {
                         container.remove();
                     });
                     
                     preBlocks.forEach(preBlock => {
                         preBlock.classList.remove('mermaid-processed');
                         preBlock.style.display = 'block'; // Show original blocks temporarily
                     });
                     
                     // Step 2: Re-initialize Mermaid with new theme configuration
                     initializeMermaidRendering(); // Use the same initialization function as initial load
                     
                     // Step 3: Re-render all diagrams using the complete rendering process
                     setTimeout(() => {
                         renderMermaidDiagrams(); // Use the same rendering function as initial load
                         console.log(`Mermaid theme successfully updated to ${isDarkMode ? 'dark' : 'light'} mode`);
                     }, 100); // Small delay to ensure initialization is complete
                     
                 } catch (error) {
                     console.error('Error updating Mermaid theme:', error);
                 }
             }
         
             // --- RUN EVERYTHING ---
             // Add a small delay to ensure DOM is fully loaded
             setTimeout(() => {
                 init();
             }, 10);
         
         });
      </script>

   </body>
</html>

<!DOCTYPE html>
<html lang="en">
   <head>
      <meta charset="UTF-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <title>Application Technical Profile</title>
      <!-- Google Fonts: Roboto and Material Symbols -->
      <link rel="preconnect" href="https://fonts.googleapis.com">
      <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
      <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
      <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" rel="stylesheet" />
      <!-- Mermaid.js for diagram rendering -->
      <script src="https://cdn.jsdelivr.net/npm/mermaid@11.8.1/dist/mermaid.min.js"></script>
      <script>
         // Simple immediate check for Mermaid availability
         window.addEventListener('load', function() {
            if (typeof mermaid === 'undefined') {
               console.error('Mermaid library failed to load');
            } else {
               console.log('Mermaid library loaded successfully', mermaid.version || 'version unknown');
            }
         });
      </script>
      
      <!-- Critical stylesheet for Material Icons -->
      <style id="material-icons-critical">
         /* Ensure proper icon rendering and prevent emoji conversion */
         .material-symbols-outlined,
         .icon,
         [class*="icon"] {
            font-family: 'Material Symbols Outlined', sans-serif !important;
            font-weight: normal !important;
            font-style: normal !important;
            line-height: 1 !important;
            text-transform: none !important;
            letter-spacing: normal !important;
            word-wrap: normal !important;
            white-space: nowrap !important;
            direction: ltr !important;
            font-feature-settings: 'liga' !important;
            -webkit-font-feature-settings: 'liga' !important;
            -webkit-font-smoothing: antialiased !important;
            font-variant-emoji: text !important;
            text-rendering: optimizeLegibility !important;
            font-size: 20px !important;
            display: inline-flex !important;
            align-items: center !important;
            justify-content: center !important;
         }
         
         /* Specifically target table content icons that might get corrupted during pagination */
         tbody .material-symbols-outlined,
         tbody .icon,
         tbody td .material-symbols-outlined,
         tbody td .icon {
            font-family: 'Material Symbols Outlined', sans-serif !important;
            font-variant-emoji: text !important;
            text-rendering: optimizeLegibility !important;
         }
         
         /* Specifically target pagination icons */
         .pagination-button .material-symbols-outlined,
         .pagination-button .icon {
            font-family: 'Material Symbols Outlined', sans-serif !important;
            font-variant-emoji: text !important;
            font-size: 20px !important;
         }
      </style>
      
      <!-- Table styling and pagination styles -->
      <style>
         /* Common styles */
         * {
            box-sizing: border-box;
         }
         
         body {
            font-family: 'Roboto', sans-serif;
            line-height: 1.5;
            color: #333;
            margin: 0;
            padding: 0;
         }
         
         /* Table container */
         .table-container {
            width: 100%;
            overflow-x: auto;
            margin-bottom: 2rem;
         }
         
         /* Table pagination styles */
         .table-pagination {
            margin-top: 12px;
         }
         
         .pagination-top-controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
         }
         
         .page-size-selector {
            display: flex;
            align-items: center;
         }
         
         .page-size-label {
            margin-right: 8px;
            font-size: 14px;
            color: #555;
            padding-left: 4px;
         }
         
         .page-size-select {
            padding: 4px 8px;
            border-radius: 4px;
            border: 1px solid #ccc;
            min-width: 60px;
         }
         
         .pagination-info {
            font-size: 14px;
            color: #555;
            padding: 4px 0;
            padding-right: 4px;
            text-align: right;
         }
         
         .pagination-nav {
            display: flex;
            justify-content: center;
            align-items: center;
            margin-top: 8px;
         }
         
         .pagination-nav-buttons,
         .pagination-next-buttons {
            display: flex;
            align-items: center;
            justify-content: center;
         }
         
         .pagination-page-numbers {
            display: flex;
            align-items: center;
            margin: 0 10px;
         }
         
         /* Pagination buttons */
         .pagination-button {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            min-width: 36px;
            height: 36px;
            padding: 4px 8px;
            margin: 0 3px;
            border: none;
            border-radius: 50%;
            background: transparent;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.15s ease;
            box-shadow: none;
            color: #5f6368;
            user-select: none;
            outline: none;
         }
         
         .pagination-button:hover:not(:disabled) {
            background-color: rgba(0, 0, 0, 0.04);
         }
         
         .pagination-button:disabled {
            opacity: 0.5;
            cursor: default;
            color: #bdc1c6;
            background: transparent;
         }
         
         .pagination-button.active {
            background-color: #0071ce;
            color: white;
            font-weight: 500;
         }
         
         .pagination-button.ellipsis {
            color: #5f6368;
            pointer-events: none;
         }
         
         /* Table grouping styles */
         .table-group-controls {
            margin-bottom: 16px;
            display: flex;
            flex-wrap: wrap;
            align-items: center;
            padding: 8px 12px;
            background-color: #f8f9fa;
            border-radius: 4px;
            border: 1px solid #e0e0e0;
            transition: background-color 0.2s ease, border-color 0.2s ease;
         }
         
         .group-title {
            margin-right: 16px;
            font-weight: 500;
            display: flex;
            align-items: center;
            color: #333;
            transition: color 0.2s ease;
         }
         
         .group-options {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
         }
         
         .group-option {
            padding: 6px 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            background-color: #fff;
            color: #333;
            cursor: pointer;
            transition: all 0.2s ease;
         }
         
         .group-option:hover:not(.active) {
            background-color: #f0f0f0;
         }
         
         .group-option.active {
            background-color: #0071ce;
            color: #fff;
            border: 1px solid #0071ce;
            font-weight: 500;
         }
         
         .group-header {
            background-color: #f5f7f9;
            transition: background-color 0.2s ease;
         }
         
         .group-header td {
            padding: 0 !important;
         }
         
         .group-header-content {
            display: flex;
            align-items: center;
            padding: 10px;
            background-color: #f5f7f9;
            border-radius: 4px;
            transition: background-color 0.2s ease;
         }
         
         .group-toggle {
            margin-right: 8px;
            color: #0071ce;
            transition: color 0.2s ease;
         }
         
         .group-header-title {
            font-weight: 500;
            color: #333;
            transition: color 0.2s ease;
         }
         
         .group-count {
            margin-left: 12px;
            font-size: 0.85em;
            color: #666;
            background-color: rgba(0, 113, 206, 0.1);
            padding: 2px 8px;
            border-radius: 12px;
            transition: all 0.2s ease;
         }
         
         .collapsed-row {
            display: none !important;
         }
         
         tr.first-in-group td {
            border-top: 1px solid #e0e0e0;
            transition: border-color 0.2s ease;
         }
         
         .group-header:hover {
            background-color: #eef1f5;
         }
         
         .group-tooltip {
            font-size: 0.75em;
            color: #666;
            margin-left: 8px;
            padding: 2px 6px;
            background: rgba(0, 113, 206, 0.08);
            border-radius: 4px;
            transition: all 0.2s ease;
         }

         /* Dark mode styles for table grouping */
         @media (prefers-color-scheme: dark) {
            body {
               background-color: #1a202c !important;
               color: #e2e8f0 !important;
            }
            
            .table-group-controls {
               background-color: #2d3748 !important;
               border: 1px solid #4a5568 !important;
               box-shadow: none !important;
            }
            
            .group-title {
               color: #cbd5e0 !important;
            }
            
            .group-option {
               background-color: #4a5568 !important;
               border: 1px solid #718096 !important;
               color: #e2e8f0 !important;
               box-shadow: none !important;
            }
            
            .group-option:hover:not(.active) {
               background-color: #718096 !important;
               border-color: #a0aec0 !important;
            }
            
            .group-option.active {
               background-color: #3182ce !important;
               color: #ffffff !important;
               border: 1px solid #3182ce !important;
               box-shadow: none !important;
            }
            
            .group-header {
               background-color: #2d3748 !important;
            }
            
            .group-header-content {
               background-color: #2d3748 !important;
            }
            
            .group-toggle {
               color: #4299e1 !important;
            }
            
            .group-header-title {
               color: #e2e8f0 !important;
            }
            
            .group-count {
               color: #cbd5e0 !important;
               background-color: rgba(66, 153, 225, 0.2) !important;
               border: none !important;
            }
            
            tr.first-in-group td {
               border-top: 1px solid #4a5568 !important;
            }
            
            .group-header:hover {
               background-color: #4a5568 !important;
            }
            
            .group-header:hover .group-header-content {
               background-color: #4a5568 !important;
            }
            
            .group-tooltip {
               color: #cbd5e0 !important;
               background: rgba(66, 153, 225, 0.15) !important;
               border: none !important;
            }
         }

         /* Force dark mode styles - Alternative approach */
         .dark-mode body,
         [data-theme="dark"] body {
            background-color: var(--background-main) !important;
            color: var(--text-primary) !important;
         }

         .dark-mode .footer-wordmark{
            color: var(--text-primary) !important;
         }

         .dark-mode .tab-link
         {
            color: var(--text-primary) !important;
            text-decoration: none !important;
            font-weight: 500 !important;
            transition: color 0.2s ease;
         }
         
         .dark-mode .table-group-controls,
         [data-theme="dark"] .table-group-controls {
            background-color: var(--background-main) !important;
            border: 1px solid var(--border-color) !important;
            box-shadow: none !important;
         }
         
         .dark-mode .group-title,
         [data-theme="dark"] .group-title {
            color: var(--text-primary) !important;
         }
         
         .dark-mode .group-option,
         [data-theme="dark"] .group-option {
            background-color: var(--border-color) !important;
            border: none !important;
            color: var(--text-primary) !important;
            box-shadow: none !important;
         }
         
         .dark-mode .group-option:hover:not(.active),
         [data-theme="dark"] .group-option:hover:not(.active) {
            background-color: var(--background-button) !important;
            border-color: none !important;
         }
         
         .dark-mode .group-option.active,
         [data-theme="dark"] .group-option.active {
            background-color: var(--product-accent) !important;
            color: var(--text-primary) !important;
            border: none !important;
            box-shadow: none !important;
         }

         .dark-mode .group-header-content{
            background-color: var(--background-main) !important;
         }

         .dark-mode .group-header-title
         {
            color: var(--text-primary) !important;
         }

         .dark-mode .group-tooltip{
            color: var(--text-primary) !important;
            background-color: var(--border-color) !important;
            border: none !important;
         }

         .dark-mode .group-count{
            background-color: rgba(0, 113, 206, 0.1) !important;
            border: none !important;
            color: rgb(0, 113, 206) !important;
         }

         .dark-mode .floating-toc-link:hover{
            background-color: var(--product-accent) !important;
         }


         .dark-mode .pagination-nav{
            background-color: var(--background-main) !important;          
            border: 1px solid var(--border-color) !important;
            box-shadow: none !important;
         }

         .dark-mode .pagination-button.page-number {
            color: var(--text-primary) !important;
         }

         .dark-mode .pagination-button.page-number.active {
            background-color: var(--product-accent) !important;
            color: var(--text-primary) !important;
            border: none !important;
            box-shadow: none !important;
         }

         .dark-mode .pagination-button.page-number:hover:not(.active) {
            background-color: var(--product-accent) !important;
            border-color: none !important;
            color: var(--text-primary) !important;
         }

         .dark-mode .pagination-button.next, .dark-mode .pagination-button.prev, .dark-mode .pagination-button.first, .dark-mode .pagination-button.last {
            background-color: var(--background-main) !important;
            border-color: none !important;
            color: var(--text-primary) !important;
         }

         /* Enhanced light mode styles for better contrast */
         @media (prefers-color-scheme: light) {
            .table-group-controls {
               background-color: #ffffff;
               border: 1px solid #e2e8f0;
               box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            }
            
            .group-option {
               background-color: #f8f9fa;
               border: 1px solid #d1d5db;
               color: #374151;
               box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05);
            }
            
            .group-option:hover:not(.active) {
               background-color: #e5e7eb;
               border-color: #9ca3af;
            }
            
            .group-option.active {
               background-color: #0071ce;
               color: #ffffff;
               border: 1px solid #0071ce;
               box-shadow: 0 2px 4px rgba(0, 113, 206, 0.2);
            }
            
            .group-count {
               background-color: rgba(0, 113, 206, 0.1);
               border: 1px solid rgba(0, 113, 206, 0.2);
            }
            
            .group-tooltip {
               background: rgba(0, 113, 206, 0.08);
               border: 1px solid rgba(0, 113, 206, 0.15);
            }
         }

         /* MERMAID DIAGRAM THEMING */
         .mermaid-container {
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
            overflow-x: auto;
            text-align: center;
            transition: background-color 0.3s ease, border-color 0.3s ease;
            
            /* Use CSS variables for consistent theming */
            background-color: var(--background-main);
            border: 1px solid var(--border-color);
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
         }

         .mermaid-container svg {
            max-width: 100%;
            height: auto;
            background-color: transparent !important;
         }

         /* Global font styling for all Mermaid diagrams */
         .mermaid-container svg text,
         .mermaid-container svg tspan,
         .mermaid-container svg .nodeLabel,
         .mermaid-container svg .edgeLabel,
         .mermaid-container svg .label,
         .mermaid-container svg .titleText {
            font-family: 'Roboto', 'Segoe UI', Arial, sans-serif !important;
            font-size: 14px !important;
         }

         /* Ensure text visibility in dark mode Mermaid diagrams */
         .dark-mode .mermaid-container svg text,
         [data-theme="dark"] .mermaid-container svg text {
            fill: var(--text-primary) !important;
         }

         .dark-mode .mermaid-container svg .node rect,
         [data-theme="dark"] .mermaid-container svg .node rect {
            stroke: var(--border-color) !important;
         }

         .dark-mode .mermaid-container svg .edgePath path,
         [data-theme="dark"] .mermaid-container svg .edgePath path {
            stroke: var(--border-color) !important;
         }

         /* Light mode Mermaid container */
         @media (prefers-color-scheme: light) {
            .mermaid-container {
               box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            }
         }

         /* Dark mode Mermaid container */
         @media (prefers-color-scheme: dark) {
            .mermaid-container {
               box-shadow: 0 2px 8px rgba(0, 0, 0, 0.5);
            }
         }

         /* Force dark mode Mermaid styling */
         .dark-mode .mermaid-container,
         [data-theme="dark"] .mermaid-container {
            background-color: var(--background-main) !important;
            border: 1px solid var(--border-color) !important;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.5) !important;
         }

         /* Force light mode Mermaid styling */
         .light-mode .mermaid-container,
         [data-theme="light"] .mermaid-container {
            background-color: var(--background-main) !important;
            border: 1px solid var(--border-color) !important;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1) !important;
         }

         /* GOOGLE-LIKE LOADING INDICATOR */
         .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(2px);
            z-index: 9999;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease, visibility 0.3s ease;
         }

         .loading-overlay.show {
            opacity: 1;
            visibility: visible;
         }

         .loading-dots {
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 16px;
         }

         .loading-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background-color: var(--background-button);
            margin: 0 3px;
            animation: pulse 1.5s ease-in-out infinite;
         }

         .loading-dot:nth-child(1) { animation-delay: 0s; }
         .loading-dot:nth-child(2) { animation-delay: 0.2s; }
         .loading-dot:nth-child(3) { animation-delay: 0.4s; }
         .loading-dot:nth-child(4) { animation-delay: 0.6s; }

         .loading-text {
            font-family: 'Roboto', sans-serif;
            font-size: 14px;
            color: var(--text-primary);
            margin-bottom: 8px;
            text-align: center;
         }

         .loading-progress {
            width: 200px;
            height: 4px;
            background-color: #e8eaed;
            border-radius: 2px;
            overflow: hidden;
            position: relative;
         }

         .loading-progress-bar {
            height: 100%;
            background-color:var(--background-button);
            border-radius: 2px;
            position: absolute;
            left: -100%;
            animation: progress 2s ease-in-out infinite;
         }

         /* Dark mode loading overlay */
         .dark-mode .loading-overlay,
         [data-theme="dark"] .loading-overlay {
            background-color: var(--background-main);
         }

         .dark-mode .loading-dot,
         [data-theme="dark"] .loading-dot {
            background-color: var(--background-button);
         }

         .dark-mode .loading-text,
         [data-theme="dark"] .loading-text {
            color: var(--text-primary);
         }

         .dark-mode .loading-progress,
         [data-theme="dark"] .loading-progress {
            background-color: var(--background-main);
         }

         .dark-mode .loading-progress-bar,
         [data-theme="dark"] .loading-progress-bar {
            background-color: var(--background-button);
         }

         /* Animations */
         @keyframes pulse {
            0%, 20% { 
               transform: scale(1); 
               opacity: 1; 
            }
            50% { 
               transform: scale(1.3); 
               opacity: 0.7; 
            }
            80%, 100% { 
               transform: scale(1); 
               opacity: 1; 
            }
         }

         @keyframes progress {
            0% {
               left: -100%;
               width: 0%;
            }
            50% {
               left: 0%;
               width: 100%;
            }
            100% {
               left: 100%;
               width: 0%;
            }
         }

         /* Loading indicator for specific sections */
         .section-loading {
            position: relative;
         }

         .section-loading::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(1px);
            z-index: 100;
            display: flex;
            justify-content: center;
            align-items: center;
         }

         .dark-mode .section-loading::after,
         [data-theme="dark"] .section-loading::after {
            background-color: rgba(26, 32, 44, 0.8);
         }
      </style>
     
      <!-- Table sorting and grouping functionality -->
      <script>
         // --- MERMAID DIAGRAM RENDERING ---
         
         // Loading indicator management
         let loadingTasks = new Set();
         
         function showLoading(message = 'Loading...', taskId = 'default') {
             const overlay = document.getElementById('loadingOverlay');
             const loadingText = document.getElementById('loadingText');
             
             if (overlay && loadingText) {
                 loadingTasks.add(taskId);
                 loadingText.textContent = message;
                 overlay.classList.add('show');
                 console.log(`Loading started: ${message} (task: ${taskId})`);
             }
         }
         
         function hideLoading(taskId = 'default') {
             loadingTasks.delete(taskId);
             console.log(`Loading task completed: ${taskId}, ${loadingTasks.size} tasks remaining`);
             
             // Only hide if no other tasks are running
             if (loadingTasks.size === 0) {
                 const overlay = document.getElementById('loadingOverlay');
                 if (overlay) {
                     // Add a small delay to prevent flicker for quick operations
                     setTimeout(() => {
                         // Double-check that no new tasks were added during the delay
                         if (loadingTasks.size === 0) {
                             overlay.classList.remove('show');
                             console.log(`All loading tasks completed - hiding overlay`);
                         }
                     }, 100); // Reduced delay from 300ms to 100ms
                 }
             }
         }
         
         function updateLoadingMessage(message, taskId = 'default') {
             if (loadingTasks.has(taskId)) {
                 const loadingText = document.getElementById('loadingText');
                 if (loadingText) {
                     loadingText.textContent = message;
                 }
             }
         }

         function initializeMermaidRendering() {
             showLoading('Initializing diagram renderer...', 'mermaid-init');
             
             try {
                 // Detect current theme
                 const isDarkMode = document.documentElement.classList.contains('dark-mode') || 
                                   document.documentElement.getAttribute('data-theme') === 'dark' ||
                                   window.matchMedia('(prefers-color-scheme: dark)').matches;
                 
                 // Get theme-specific configuration
                 const themeConfig = getMermaidThemeConfig(isDarkMode);
                 
                 updateLoadingMessage('Configuring diagram themes...', 'mermaid-init');
                 
                 // Configure Mermaid with comprehensive theme settings
                 mermaid.initialize({
                     startOnLoad: false, // Important! We manually control the rendering
                     securityLevel: 'loose', // Allow all diagram features
                     htmlLabels: true, // Enable HTML labels for better text rendering
                     theme: themeConfig.theme,
                     themeVariables: themeConfig.themeVariables,
                     flowchart: {
                         useMaxWidth: true,
                         htmlLabels: true,
                         curve: 'basis'
                     },
                     sequence: {
                         useMaxWidth: true,
                         wrap: true
                     },
                     class: {
                         useMaxWidth: true
                     },
                     state: {
                         useMaxWidth: true
                     },
                     er: {
                         useMaxWidth: true
                     },
                     journey: {
                         useMaxWidth: true
                     },
                     gantt: {
                         useMaxWidth: true
                     },
                     pie: {
                         useMaxWidth: true
                     },
                     // Simplified configuration - remove complex settings that might cause issues
                     logLevel: 'error',
                     suppressErrorRendering: false
                 });
                 console.log(`Mermaid initialized successfully with ${isDarkMode ? 'dark' : 'light'} theme`);
                 hideLoading('mermaid-init');
             } catch (error) {
                 console.error('Error initializing Mermaid:', error);
                 hideLoading('mermaid-init');
             }
         }

         // Get comprehensive theme configuration for Mermaid
         function getMermaidThemeConfig(isDarkMode) {
             // Get CSS variables from the document
             const rootStyles = getComputedStyle(document.documentElement);
             const backgroundMain = rootStyles.getPropertyValue('--background-main').trim();
             const textPrimary = rootStyles.getPropertyValue('--text-primary').trim();
             const textSecondary = rootStyles.getPropertyValue('--text-secondary').trim();
             const borderColor = rootStyles.getPropertyValue('--border-color').trim();
             const backgroundCard = rootStyles.getPropertyValue('--background-card').trim();
             const backgroundHover = rootStyles.getPropertyValue('--background-hover').trim();
             const productAccent = rootStyles.getPropertyValue('--product-accent').trim();
             
             if (isDarkMode) {
                 return {
                     theme: 'dark',
                     themeVariables: {
                         // Core theme colors using CSS variables
                         darkMode: true,
                         background: backgroundMain,
                         primaryColor: productAccent, // Use the accent color for primary elements
                         primaryTextColor: textPrimary,
                         primaryBorderColor: borderColor,
                         lineColor: borderColor,
                         
                         // Font configuration
                         fontFamily: "'Roboto', 'Segoe UI', Arial, sans-serif",
                         fontSize: '14px',
                         
                         // Secondary colors
                         secondaryColor: backgroundCard,
                         tertiaryColor: backgroundHover,
                         
                         // Text colors - all using CSS variables
                         textColor: textPrimary,
                         darkTextColor: textPrimary,
                         mainBkg: backgroundCard,
                         secondBkg: backgroundHover,
                         tertiaryBkg: backgroundMain,
                         
                         // Node and connector styling
                         nodeBkg: backgroundCard,
                         nodeBorder: borderColor,
                         clusterBkg: backgroundMain,
                         clusterBorder: borderColor,
                         defaultLinkColor: productAccent,
                         titleColor: textPrimary,
                         edgeLabelBackground: backgroundMain,
                         
                         // Specific diagram type colors
                         actorBorder: borderColor,
                         actorBkg: backgroundCard,
                         actorTextColor: textPrimary,
                         actorLineColor: borderColor,
                         signalColor: textPrimary,
                         signalTextColor: textPrimary,
                         
                         // Flowchart colors - readable and distinguishable
                         fillType0: '#4285f4', // Blue - good contrast in dark mode
                         fillType1: '#81c995', // Light green
                         fillType2: '#fdd663', // Yellow
                         fillType3: '#f28b82', // Light red
                         fillType4: '#ce93d8', // Light purple
                         fillType5: '#ffab91', // Light orange
                         fillType6: '#80deea', // Light cyan
                         fillType7: '#a5d6a7', // Another green shade
                         
                         // Class diagram colors
                         classText: textPrimary,
                         
                         // State diagram colors
                         labelColor: textPrimary,
                         altBackground: backgroundCard,
                         
                         // ER diagram colors
                         entityBkg: backgroundCard,
                         entityTextColor: textPrimary,
                         relationLabelColor: textPrimary,
                         
                         // Journey diagram colors
                         taskBkgColor: backgroundCard,
                         taskTextColor: textPrimary,
                         activeTaskBkgColor: productAccent,
                         activeTaskBorderColor: borderColor,
                         gridColor: borderColor,
                         section0: '#4285f4',
                         section1: '#81c995',
                         section2: '#fdd663',
                         section3: '#f28b82'
                     }
                 };
             } else {
                 return {
                     theme: 'default',
                     themeVariables: {
                         // Core theme colors using CSS variables
                         background: backgroundMain,
                         primaryColor: productAccent,
                         primaryTextColor: textPrimary,
                         primaryBorderColor: borderColor,
                         lineColor: borderColor,
                         
                         // Font configuration
                         fontFamily: "'Roboto', 'Segoe UI', Arial, sans-serif",
                         fontSize: '14px',
                         
                         // Secondary colors
                         secondaryColor: backgroundCard,
                         tertiaryColor: backgroundHover,
                         
                         // Text colors - all using CSS variables
                         textColor: textPrimary,
                         darkTextColor: textPrimary,
                         mainBkg: backgroundCard,
                         secondBkg: backgroundHover,
                         tertiaryBkg: backgroundMain,
                         
                         // Node and connector styling
                         nodeBkg: backgroundCard,
                         nodeBorder: borderColor,
                         clusterBkg: backgroundMain,
                         clusterBorder: borderColor,
                         defaultLinkColor: productAccent,
                         titleColor: textPrimary,
                         edgeLabelBackground: backgroundMain,
                         
                         // Specific diagram type colors
                         actorBorder: borderColor,
                         actorBkg: backgroundCard,
                         actorTextColor: textPrimary,
                         actorLineColor: borderColor,
                         signalColor: textPrimary,
                         signalTextColor: textPrimary,
                         
                         // Flowchart colors - readable in light mode
                         fillType0: '#0071ce', // Primary blue
                         fillType1: '#1e8e3e', // Green
                         fillType2: '#f9ab00', // Amber/Yellow
                         fillType3: '#d93025', // Red
                         fillType4: '#9c27b0', // Purple
                         fillType5: '#ff5722', // Deep orange
                         fillType6: '#00acc1', // Cyan
                         fillType7: '#689f38', // Light green
                         
                         // Class diagram colors
                         classText: textPrimary,
                         
                         // State diagram colors
                         labelColor: textPrimary,
                         altBackground: backgroundCard,
                         
                         // ER diagram colors
                         entityBkg: backgroundCard,
                         entityTextColor: textPrimary,
                         relationLabelColor: textPrimary,
                         
                         // Journey diagram colors
                         taskBkgColor: backgroundCard,
                         taskTextColor: textPrimary,
                         activeTaskBkgColor: productAccent,
                         activeTaskBorderColor: borderColor,
                         gridColor: borderColor,
                         section0: '#0071ce',
                         section1: '#1e8e3e',
                         section2: '#f9ab00',
                         section3: '#d93025'
                     }
                 };
             }
         }

         function renderMermaidDiagrams() {
             // Find all mermaid code blocks - be more specific in the selector
             const mermaidBlocks = document.querySelectorAll('pre.mermaid');
             
             if (mermaidBlocks.length === 0) {
                 console.log('No Mermaid diagrams found to render');
                 return;
             }
             
             showLoading(`Preparing ${mermaidBlocks.length} diagram${mermaidBlocks.length > 1 ? 's' : ''}...`, 'mermaid-render');
             console.log(`Found ${mermaidBlocks.length} Mermaid diagrams to render`);
             
             let processedCount = 0;
             let successCount = 0;
             let errorCount = 0;
             
             const updateProgress = () => {
                 processedCount++;
                 updateLoadingMessage(
                     `Rendering diagrams... ${processedCount}/${mermaidBlocks.length} (${successCount} successful, ${errorCount} errors)`,
                     'mermaid-render'
                 );
                 
                 // Hide loading when all diagrams are processed
                 if (processedCount >= mermaidBlocks.length) {
                     clearTimeout(maxTimeout); // Clear the fallback timeout
                     setTimeout(() => {
                         hideLoading('mermaid-render');
                     }, 200); // Small delay to show completion message
                 }
             };
             
             // Set a maximum timeout to ensure loading doesn't hang indefinitely
             const maxTimeout = setTimeout(() => {
                 console.warn('Forcing loading to complete after maximum timeout');
                 hideLoading('mermaid-render');
             }, 30000); // 30 second maximum timeout
             
             mermaidBlocks.forEach((preBlock, index) => {
                 try {
                     // Skip if already processed
                     if (preBlock.classList.contains('mermaid-processed')) {
                         console.log(`Skipping diagram ${index + 1} - already processed`);
                         updateProgress(); // Still count this as processed
                         return;
                     }
                     
                     // Check if there's already a rendered container
                     const existingContainer = preBlock.nextElementSibling?.classList.contains('mermaid-container') ||
                                             preBlock.previousElementSibling?.classList.contains('mermaid-container');
                     if (existingContainer) {
                         console.log(`Skipping diagram ${index + 1} - container already exists`);
                         updateProgress(); // Still count this as processed
                         return;
                     }
                     
                     // Get the code element inside the pre block
                     const codeElement = preBlock.querySelector('code');
                     if (!codeElement) {
                         console.warn(`No code element found in mermaid block ${index + 1}`);
                         errorCount++;
                         updateProgress();
                         return;
                     }
                     
                     // Get the mermaid code content from the code element
                     let mermaidCode = codeElement.textContent || codeElement.innerText;
                     
                     // Skip if empty
                     if (!mermaidCode.trim()) {
                         console.warn(`Empty mermaid code in block ${index + 1}`);
                         errorCount++;
                         updateProgress();
                         return;
                     }
                     
                     // Clean up the code
                     mermaidCode = mermaidCode.trim();
                     
                     // Debug: Log the first few lines of the code to verify content
                     const firstLines = mermaidCode.split('\n').slice(0, 3).join('\n');
                     console.log(`Diagram ${index + 1} content preview:`, firstLines);
                     
                     // Validate this is actually Mermaid syntax, not CSS or other content
                     if (mermaidCode.includes('font-family:') || mermaidCode.includes('keyframes') || mermaidCode.includes('.mermaid-')) {
                         console.error(`Block ${index + 1} contains CSS instead of Mermaid syntax, skipping`);
                         errorCount++;
                         updateProgress();
                         return;
                     }
                     
                     // Validate and fix common syntax issues
                     mermaidCode = validateAndFixMermaidSyntax(mermaidCode);
                     
                     // Detect diagram type for specific handling
                     const diagramType = detectDiagramType(mermaidCode);
                     console.log(`Rendering ${diagramType} diagram ${index + 1}`);
                     
                     // Create a unique ID for this diagram
                     const diagramId = `mermaid-diagram-${index}-${Date.now()}`;
                     
                     // Create container for the rendered diagram with enhanced styling
                     const container = document.createElement('div');
                     container.id = diagramId;
                     container.className = 'mermaid-container';
                     
                     // Apply CSS variable-based styling that adapts to theme
                     const isDarkMode = document.documentElement.classList.contains('dark-mode') || 
                                       document.documentElement.getAttribute('data-theme') === 'dark' ||
                                       window.matchMedia('(prefers-color-scheme: dark)').matches;
                     
                     // Use CSS variables for consistent theming
                     container.style.cssText = `
                         text-align: center;
                         margin: 20px 0;
                         padding: 20px;
                         border: 1px solid var(--border-color);
                         border-radius: 8px;
                         background-color: var(--background-main);
                         box-shadow: ${isDarkMode ? '0 2px 8px rgba(0, 0, 0, 0.5)' : '0 2px 4px rgba(0, 0, 0, 0.1)'};
                         overflow-x: auto;
                         transition: background-color 0.3s ease, border-color 0.3s ease;
                     `;
                     
                     // Insert the container after the pre block
                     preBlock.parentNode.insertBefore(container, preBlock.nextSibling);
                     preBlock.style.display = 'none'; // Hide original but keep for reference
                     
                     // Add timeout to prevent hanging
                     const renderTimeout = setTimeout(() => {
                         console.error(`Rendering timeout for ${diagramType} diagram ${index + 1}`);
                         container.innerHTML = `
                             <div style="color: #ff6b35; padding: 20px; text-align: center;">
                                 <strong>Rendering timeout for ${diagramType} diagram</strong><br>
                                 <small>The diagram took too long to render</small>
                             </div>
                         `;
                         errorCount++;
                         updateProgress();
                     }, 10000); // 10 second timeout
                     
                     // Render the diagram
                     mermaid.render(diagramId + '-svg', mermaidCode)
                         .then(({ svg, bindFunctions }) => {
                             clearTimeout(renderTimeout);
                             container.innerHTML = svg;
                             
                             // Apply bind functions if they exist (for interactive elements)
                             if (bindFunctions) {
                                 try {
                                     bindFunctions(container);
                                 } catch (bindError) {
                                     console.warn('Error applying bind functions:', bindError);
                                 }
                             }
                             
                             // Mark as processed
                             preBlock.classList.add('mermaid-processed');
                             
                             // Add diagram type as data attribute
                             container.setAttribute('data-diagram-type', diagramType);
                             
                             console.log(`Successfully rendered ${diagramType} diagram ${index + 1}`);
                             successCount++;
                             updateProgress();
                         })
                         .catch(error => {
                             clearTimeout(renderTimeout);
                             console.error(`Error rendering ${diagramType} diagram ${index + 1}:`, error);
                             
                             // Show detailed error information
                             const errorDetails = error.message || 'Unknown error occurred';
                             const codePreview = mermaidCode.length > 200 ? 
                                 mermaidCode.substring(0, 200) + '...' : 
                                 mermaidCode;
                             
                             container.innerHTML = `
                                 <div style="color: #d32f2f; padding: 20px; text-align: center; border: 1px solid #d32f2f; border-radius: 4px; background-color: #ffebee;">
                                     <strong>Error rendering ${diagramType} diagram:</strong><br>
                                     <small>${errorDetails}</small><br>
                                     <details style="margin-top: 10px;">
                                         <summary>Show diagram code</summary>
                                         <pre style="text-align: left; background: #f5f5f5; padding: 10px; margin-top: 10px; border-radius: 4px; white-space: pre-wrap; word-wrap: break-word;">${codePreview}</pre>
                                     </details>
                                 </div>
                             `;
                             errorCount++;
                             updateProgress();
                         });
                         
                 } catch (error) {
                     console.error(`Error processing Mermaid block ${index + 1}:`, error);
                     errorCount++;
                     updateProgress();
                 }
             });
             
             // Fallback: if no diagrams were found or processed, hide loading immediately
             if (mermaidBlocks.length === 0) {
                 console.log('No Mermaid diagrams found');
                 clearTimeout(maxTimeout);
                 hideLoading('mermaid-render');
             }
         }

         function detectDiagramType(code) {
             const trimmedCode = code.trim().toLowerCase();
             
             if (trimmedCode.startsWith('graph') || trimmedCode.startsWith('flowchart')) return 'flowchart';
             if (trimmedCode.startsWith('sequencediagram')) return 'sequence';
             if (trimmedCode.startsWith('classdiagram')) return 'class';
             if (trimmedCode.startsWith('statediagram')) return 'state';
             if (trimmedCode.startsWith('erdiagram')) return 'er';
             if (trimmedCode.startsWith('journey')) return 'user-journey';
             if (trimmedCode.startsWith('gantt')) return 'gantt';
             if (trimmedCode.startsWith('pie')) return 'pie';
             if (trimmedCode.startsWith('gitgraph')) return 'gitgraph';
             if (trimmedCode.startsWith('mindmap')) return 'mindmap';
             if (trimmedCode.startsWith('timeline')) return 'timeline';
             if (trimmedCode.startsWith('quadrantchart')) return 'quadrant';
             if (trimmedCode.startsWith('xychart')) return 'xy';
             if (trimmedCode.startsWith('block')) return 'block';
             if (trimmedCode.startsWith('packet')) return 'packet';
             if (trimmedCode.startsWith('tree')) return 'tree';
             
             return 'unknown';
         }

         function validateAndFixMermaidSyntax(code) {
             let fixedCode = code.trim();
             
             // Remove any HTML entities that might cause issues
             fixedCode = fixedCode
                 .replace(/&amp;/g, '&')
                 .replace(/&lt;/g, '<')
                 .replace(/&gt;/g, '>')
                 .replace(/&#39;/g, "'")
                 .replace(/&quot;/g, '"');
             
             return fixedCode;
         }

         // Update Mermaid theme (used for theme switching)
         function updateMermaidTheme() {
             showLoading('Updating diagram themes...', 'theme-update');
             
             try {
                 // Re-initialize Mermaid with new theme
                 initializeMermaidRendering();
                 
                 // Re-render all diagrams
                 const processedDiagrams = document.querySelectorAll('.mermaid-processed');
                 if (processedDiagrams.length > 0) {
                     updateLoadingMessage('Re-rendering diagrams with new theme...', 'theme-update');
                     
                     // Reset processed state
                     processedDiagrams.forEach(diagram => {
                         diagram.classList.remove('mermaid-processed');
                     });
                     
                     // Remove existing rendered containers
                     const containers = document.querySelectorAll('.mermaid-container');
                     containers.forEach(container => container.remove());
                     
                     // Show original code blocks
                     const hiddenBlocks = document.querySelectorAll('pre.mermaid[style*="display: none"]');
                     hiddenBlocks.forEach(block => {
                         block.style.display = '';
                     });
                     
                     // Re-render
                     renderMermaidDiagrams();
                 }
                 
                 hideLoading('theme-update');
             } catch (error) {
                 console.error('Error updating Mermaid theme:', error);
                 hideLoading('theme-update');
             }
         }
      </script>
   </head>
   <body>
      <!-- Google-like Loading Overlay -->
      <div id="loadingOverlay" class="loading-overlay">
         <div class="loading-dots">
            <div class="loading-dot"></div>
            <div class="loading-dot"></div>
            <div class="loading-dot"></div>
            <div class="loading-dot"></div>
         </div>
         <div class="loading-text" id="loadingText">Loading...</div>
         <div class="loading-progress">
            <div class="loading-progress-bar"></div>
         </div>
      </div>

      <script>
         document.addEventListener('DOMContentLoaded', function() {
            showLoading('Initializing application...', 'app-init');
            
            // Apply dark mode detection and styling
            updateLoadingMessage('Applying theme settings...', 'app-init');
            applyThemeDetection();
            
            // Initialize Mermaid diagrams
            if (typeof mermaid !== 'undefined') {
               updateLoadingMessage('Setting up diagram renderer...', 'app-init');
               console.log('Initializing Mermaid diagrams...');
               initializeMermaidRendering();
               renderMermaidDiagrams();
            } else {
               console.warn('Mermaid library not loaded');
            }
            
            // Add sorting capability to all tables
            updateLoadingMessage('Preparing interactive tables...', 'app-init');
            makeTablesSortable();
            
            // Add grouping capability to tables with specific columns
            makeTablesGroupable();
            
            // Add pagination to all tables
            makeTablesPaginated();
            
            hideLoading('app-init');
         });
         
         function applyThemeDetection() {
            // Function to apply dark mode
            function applyDarkMode() {
               document.body.classList.add('dark-mode');
               document.documentElement.setAttribute('data-theme', 'dark');
               console.log('Dark mode applied');
               
               // Update Mermaid diagrams theme
               if (typeof updateMermaidTheme === 'function') {
                  setTimeout(updateMermaidTheme, 100);
               }
            }
            
            // Function to apply light mode
            function applyLightMode() {
               document.body.classList.remove('dark-mode');
               document.documentElement.setAttribute('data-theme', 'light');
               console.log('Light mode applied');
               
               // Update Mermaid diagrams theme
               if (typeof updateMermaidTheme === 'function') {
                  setTimeout(updateMermaidTheme, 100);
               }
            }
            
            // Check for dark mode preference
            if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
               applyDarkMode();
            } else {
               applyLightMode();
            }
            
            // Listen for changes in color scheme preference
            if (window.matchMedia) {
               const mediaQuery = window.matchMedia('(prefers-color-scheme: dark)');
               mediaQuery.addEventListener('change', function(e) {
                  showLoading('Switching theme...', 'theme-switch');
                  
                  if (e.matches) {
                     updateLoadingMessage('Applying dark theme...', 'theme-switch');
                     applyDarkMode();
                  } else {
                     updateLoadingMessage('Applying light theme...', 'theme-switch');
                     applyLightMode();
                  }
                  
                  // Update Mermaid diagrams with new theme
                  if (typeof updateMermaidTheme === 'function') {
                     updateMermaidTheme();
                  }
                  
                  hideLoading('theme-switch');
               });
            }
         }
         
         function makeTablesPaginated() {
            const tables = document.querySelectorAll('.table-container table');
            const defaultPageSize = 20;
            
            tables.forEach((table) => {
                // Skip tables that shouldn't be paginated
                if (table.classList.contains('no-pagination')) {
                    return;
                }
                
                // Mark table as paginated
                table.setAttribute('data-paginated', 'true');
                table.setAttribute('data-page-size', String(defaultPageSize));
                table.setAttribute('data-current-page', '1');
                
                // Ensure the table has necessary DOM structure
                let tbody = table.querySelector('tbody');
                if (!tbody) {
                    tbody = document.createElement('tbody');
                    
                    // Move all rows that aren't in thead to tbody
                    const rows = Array.from(table.querySelectorAll('tr'));
                    const theadRows = Array.from(table.querySelectorAll('thead tr'));
                    
                    rows.forEach(row => {
                        if (!theadRows.includes(row)) {
                            tbody.appendChild(row);
                        }
                    });
                    
                    table.appendChild(tbody);
                }
                
                // Store the original table data for pagination
                storeTableData(table);
                
                // Add pagination controls
                addPaginationControls(table);
                
                // Initial pagination
                paginateTable(table);
            });
         }
         
         function storeTableData(table) {
            // Store original rows for pagination
            const tbody = table.querySelector('tbody');
            if (!tbody) {
                return;
            }
            
            // Get all rows, including potential group headers
            const rows = Array.from(tbody.querySelectorAll('tr'));
            
            // Function to preserve icon data before storing
            const preserveIconData = (element) => {
                if (!element) return;
                
                const icons = element.querySelectorAll('.icon, .material-symbols-outlined, [class*="icon"]');
                icons.forEach((icon, index) => {
                    // Store the original icon text as a data attribute
                    const iconText = icon.textContent.trim();
                    if (iconText) {
                        icon.setAttribute('data-original-icon-text', iconText);
                        icon.setAttribute('data-icon-index', String(index));
                    }
                    
                    // Ensure proper classes and styling
                    if (!icon.classList.contains('material-symbols-outlined')) {
                        icon.classList.add('material-symbols-outlined');
                    }
                });
            };
            
            // Check if we're dealing with grouped data
            const hasGroups = rows.some(row => row.classList.contains('group-header'));
            
            // Clear previous pagination data to prevent stale data issues
            if (table._paginationGroupData) delete table._paginationGroupData;
            if (table._paginationData) delete table._paginationData;
            
            if (hasGroups) {
                // For grouped tables, we store the data differently
                const groupData = [];
                let currentGroup = null;
                let currentRows = [];
                
                rows.forEach(row => {
                    if (row.classList.contains('group-header')) {
                        // If we have a previous group, store it
                        if (currentGroup) {
                            groupData.push({
                                header: currentGroup,
                                rows: currentRows
                            });
                        }
                        // Start a new group
                        currentGroup = row;
                        currentRows = [];
                    } else {
                        // Add row to current group
                        currentRows.push(row);
                    }
                });
                
                // Don't forget to add the last group
                if (currentGroup) {
                    groupData.push({
                        header: currentGroup,
                        rows: currentRows
                    });
                }
                
                // Preserve icon data for all grouped elements
                groupData.forEach(group => {
                    preserveIconData(group.header);
                    group.rows.forEach(row => {
                        preserveIconData(row);
                    });
                });
                
                // Store the grouped data
                table._paginationGroupData = groupData;
            } else {
                // For regular tables, filter out any potential group headers just to be safe
                const dataRows = rows.filter(row => !row.classList.contains('group-header'));
                
                // Preserve icon data for all rows
                dataRows.forEach(row => {
                    preserveIconData(row);
                });
                
                table._paginationData = dataRows;
            }
         }
         
         function addPaginationControls(table) {
            const tableContainer = table.closest('.table-container');
            if (!tableContainer) return;
            
            // Create pagination container
            const paginationContainer = document.createElement('div');
            paginationContainer.className = 'table-pagination';
            
            // Top controls with page size selector
            const topControls = document.createElement('div');
            topControls.className = 'pagination-top-controls';
            
            const pageSizeSelector = document.createElement('div');
            pageSizeSelector.className = 'page-size-selector';
            
            // Get current page size from table attribute
            const currentPageSize = parseInt(table.getAttribute('data-page-size') || '20', 10);
            
            // Create the page size selector with the current value selected
            pageSizeSelector.innerHTML = `
                <span class="page-size-label">Items per page</span>
                <select class="page-size-select">
                    <option value="5" ${currentPageSize === 5 ? 'selected' : ''}>5</option>
                    <option value="10" ${currentPageSize === 10 ? 'selected' : ''}>10</option>
                    <option value="20" ${currentPageSize === 20 ? 'selected' : ''}>20</option>
                    <option value="50" ${currentPageSize === 50 ? 'selected' : ''}>50</option>
                    <option value="100" ${currentPageSize === 100 ? 'selected' : ''}>100</option>
                </select>
            `;
            
            // Add event listener for page size change
            const pageSizeSelect = pageSizeSelector.querySelector('.page-size-select');
            pageSizeSelect.addEventListener('change', function() {
                const newPageSize = parseInt(this.value);
                
                console.log(`Page size change requested: ${newPageSize} (from ${table.getAttribute('data-page-size')})`);
                
                // DEBUG: Let's see what's currently visible before making changes
                const currentlyVisibleRows = table.querySelectorAll('tbody tr');
                console.log(`Currently visible rows: ${currentlyVisibleRows.length}`);
                currentlyVisibleRows.forEach((row, index) => {
                    const firstCell = row.querySelector('td');
                    if (firstCell) {
                        console.log(`Row ${index + 1}: ${firstCell.textContent.trim()}`);
                    }
                });
                
                // Calculate pagination values  
                const oldPageSize = parseInt(table.getAttribute('data-page-size')) || 20;
                const oldCurrentPage = parseInt(table.getAttribute('data-current-page')) || 1;
                
                // Get total rows first
                let totalRows = 0;
                if (table._paginationGroupData) {
                    table._paginationGroupData.forEach(group => totalRows += group.rows.length);
                } else if (table._paginationData) {
                    totalRows = table._paginationData.length;
                }
                
                console.log(`Total rows in data: ${totalRows}`);
                
                // Calculate which item we're currently starting with
                const currentFirstItem = (oldCurrentPage - 1) * oldPageSize + 1;
                const currentLastItem = Math.min(currentFirstItem + oldPageSize - 1, totalRows);
                console.log(`Current view: items ${currentFirstItem} to ${currentLastItem}`);
                
                // For page size changes, we want to show the same starting item
                // but limit to the new page size
                let newCurrentPage = Math.ceil(currentFirstItem / newPageSize);
                const newTotalPages = Math.max(1, Math.ceil(totalRows / newPageSize));
                newCurrentPage = Math.max(1, Math.min(newCurrentPage, newTotalPages));
                
                // Calculate how many items we should actually show
                const newFirstItem = (newCurrentPage - 1) * newPageSize + 1;
                const newLastItem = Math.min(newFirstItem + newPageSize - 1, totalRows);
                
                console.log(`Page size change: totalRows=${totalRows}, oldPage=${oldCurrentPage}/${Math.ceil(totalRows / oldPageSize)}, newPage=${newCurrentPage}/${newTotalPages}`);
                console.log(`New view should show: items ${newFirstItem} to ${newLastItem} (max ${newPageSize} items)`);
                
                // IMPORTANT: If we're changing to a smaller page size, we might need to show fewer items
                // to maintain the same starting point
                const visibleItemsCount = currentLastItem - currentFirstItem + 1;
                const expectedNewItemsCount = Math.min(newPageSize, visibleItemsCount);
                console.log(`Currently showing ${visibleItemsCount} items, new page size allows ${newPageSize}, should show ${expectedNewItemsCount}`);
                
                // If the current view has fewer items than the new page size,
                // we might need to adjust to show the same number of items
                if (visibleItemsCount < newPageSize) {
                    console.log(`Adjusting to show same number of items (${visibleItemsCount}) instead of full page size (${newPageSize})`);
                }
                
                // Set new values
                table.setAttribute('data-page-size', newPageSize);
                table.setAttribute('data-current-page', newCurrentPage);
                
                // Execute pagination immediately to see the result
                setTimeout(() => {
                    console.log('Executing pagination with new settings');
                    
                    paginateTable(table);
                    
                    // NOTE: Removed emoji replacement - let's preserve original content exactly
                    const newVisibleRows = table.querySelectorAll('tbody tr');
                    console.log(`After pagination - visible rows: ${newVisibleRows.length}`);
                    newVisibleRows.forEach((row, index) => {
                        const firstCell = row.querySelector('td');
                        if (firstCell) {
                            console.log(`New Row ${index + 1}: ${firstCell.textContent.trim()}`);
                        }
                    });
                }, 0);
            });
            
            // Pagination info (showing X-Y of Z)
            const paginationInfo = document.createElement('div');
            paginationInfo.className = 'pagination-info';
            
            topControls.appendChild(pageSizeSelector);
            topControls.appendChild(paginationInfo);
            
            // Pagination navigation
            const paginationNav = document.createElement('div');
            paginationNav.className = 'pagination-nav';
            
            // We'll populate the navigation in the updatePaginationControls function
            
            // Add all elements to the container
            paginationContainer.appendChild(topControls);
            paginationContainer.appendChild(paginationNav);
            
            // Add to the DOM after the table
            tableContainer.appendChild(paginationContainer);
            
            // Initial update of pagination controls
            updatePaginationControls(table);
         }
         
         function paginateTable(table) {
            // Make sure we have valid numeric values for page size and current page
            const pageSize = Math.max(1, parseInt(table.getAttribute('data-page-size') || '20', 10));
            let currentPage = Math.max(1, parseInt(table.getAttribute('data-current-page') || '1', 10));
            const tbody = table.querySelector('tbody');
            
            if (!tbody) {
                return;
            }
            
            // Calculate total rows and total pages to make sure current page is valid
            let totalRows = 0;
            
            // Check if we have pagination data at all
            if (!table._paginationGroupData && !table._paginationData) {
                try {
                    storeTableData(table);
                } catch (error) {
                    console.error('Error storing table data:', error);
                    return;
                }
            }
            
            // Ensure we're not dealing with stale grouped data when we should be in ungrouped mode
            // Check if the table has actual group headers in the DOM
            const hasRealGroupHeaders = tbody.querySelector('.group-header') !== null;
            
            // If we have grouped data in memory but no actual group headers in the DOM, 
            // we need to rebuild the pagination data for the ungrouped state
            if (table._paginationGroupData && !hasRealGroupHeaders) {
                delete table._paginationGroupData;
                storeTableData(table);
            }
            
            // Calculate total rows from whichever data structure we have
            if (table._paginationGroupData) {
                table._paginationGroupData.forEach(group => totalRows += group.rows.length);
            } else if (table._paginationData) {
                totalRows = table._paginationData.length;
            } else {
                // Emergency fallback - get what's in the DOM right now
                const visibleRows = tbody.querySelectorAll('tr:not(.group-header)').length;
                totalRows = visibleRows;
                if (totalRows === 0) return; // Nothing to do if no rows
            }
            
            // Ensure we have at least one page
            const totalPages = Math.max(1, Math.ceil(totalRows / pageSize));
            
            // Ensure current page is valid (between 1 and totalPages)
            currentPage = Math.max(1, Math.min(currentPage, totalPages));
            
            // Update the current page attribute if it was adjusted
            if (currentPage !== parseInt(table.getAttribute('data-current-page') || '1', 10)) {
                table.setAttribute('data-current-page', String(currentPage));
            }
            
            // Clear the table body first
            tbody.innerHTML = '';
            
            // SIMPLIFIED APPROACH: Use direct cloning and restore proper Material Icons
            const simpleCloneRow = (originalRow) => {
                if (!originalRow) return null;
                
                // Clone the row
                const cloned = originalRow.cloneNode(true);
                
                // Convert any emojis back to proper Material Icons
                const emojiToIconMap = {
                    '🔴': { iconName: 'cancel', classes: 'icon icon-high', title: 'High/Critical' },
                    '🟠': { iconName: 'warning', classes: 'icon icon-medium', title: 'Medium/Warning' },
                    '🟢': { iconName: 'recommend', classes: 'icon icon-low', title: 'Low/Info' },
                    '✅': { iconName: 'check_circle', classes: 'icon icon-check', title: 'Yes/Used/Supported' },
                    '❌': { iconName: 'cancel', classes: 'icon icon-cross', title: 'No/Not Used/Unsupported' },
                    '❔': { iconName: 'help', classes: 'icon icon-question', title: 'Uncertain/Likely' },
                    '🟡': { iconName: 'warning', classes: 'icon icon-medium', title: 'Medium/Warning' },
                    '⚠️': { iconName: 'warning', classes: 'icon icon-medium', title: 'Medium/Warning' },
                    '⚠': { iconName: 'warning', classes: 'icon icon-medium', title: 'Medium/Warning' },
                    '✓': { iconName: 'check_circle', classes: 'icon icon-check', title: 'Yes/Used/Supported' },
                    '✗': { iconName: 'cancel', classes: 'icon icon-cross', title: 'No/Not Used/Unsupported' },
                    '❓': { iconName: 'help', classes: 'icon icon-question', title: 'Uncertain/Likely' },
                    '🔥': { iconName: 'cancel', classes: 'icon icon-high', title: 'High/Critical' },
                    '⭕': { iconName: 'cancel', classes: 'icon icon-cross', title: 'No/Not Used/Unsupported' },
                    '🛑': { iconName: 'cancel', classes: 'icon icon-high', title: 'High/Critical' }
                };
                
                // Find all text nodes and spans that might contain emojis
                const walker = document.createTreeWalker(
                    cloned,
                    NodeFilter.SHOW_TEXT | NodeFilter.SHOW_ELEMENT,
                    null,
                    false
                );
                
                const nodesToReplace = [];
                let node;
                
                while (node = walker.nextNode()) {
                    if (node.nodeType === Node.TEXT_NODE) {
                        const text = node.textContent;
                        for (const emoji in emojiToIconMap) {
                            if (text.includes(emoji)) {
                                nodesToReplace.push({
                                    node: node,
                                    emoji: emoji,
                                    iconData: emojiToIconMap[emoji],
                                    text: text
                                });
                                break;
                            }
                        }
                    } else if (node.nodeType === Node.ELEMENT_NODE && node.tagName === 'SPAN') {
                        const text = node.textContent.trim();
                        if (emojiToIconMap[text]) {
                            nodesToReplace.push({
                                node: node,
                                emoji: text,
                                iconData: emojiToIconMap[text],
                                isSpan: true
                            });
                        }
                    }
                }
                
                // Replace emojis with proper Material Icons
                nodesToReplace.forEach(replacement => {
                    if (replacement.isSpan) {
                        // Update span content to proper Material Icon name, use correct semantic classes
                        replacement.node.textContent = replacement.iconData.iconName;
                        replacement.node.className = replacement.iconData.classes + ' material-symbols-outlined';
                        replacement.node.title = replacement.iconData.title;
                        
                        // Apply proper Material Icons styling
                        replacement.node.style.fontFamily = "'Material Symbols Outlined', sans-serif";
                        replacement.node.style.fontVariantEmoji = "text";
                    } else {
                        // For text nodes, create new icon span with correct semantic classes
                        const iconSpan = document.createElement('span');
                        iconSpan.className = replacement.iconData.classes + ' material-symbols-outlined';
                        iconSpan.textContent = replacement.iconData.iconName;
                        iconSpan.title = replacement.iconData.title;
                        iconSpan.style.fontFamily = "'Material Symbols Outlined', sans-serif";
                        iconSpan.style.fontVariantEmoji = "text";
                        
                        // Replace the emoji in the text
                        const newText = replacement.text.replace(replacement.emoji, '');
                        if (newText.trim()) {
                            const textNode = document.createTextNode(newText);
                            replacement.node.parentNode.insertBefore(iconSpan, replacement.node);
                            replacement.node.parentNode.insertBefore(textNode, replacement.node);
                        } else {
                            replacement.node.parentNode.insertBefore(iconSpan, replacement.node);
                        }
                        replacement.node.parentNode.removeChild(replacement.node);
                    }
                });
                
                return cloned;
            };
            
            // Check if we're dealing with grouped data
            if (table._paginationGroupData) {
                // For grouped tables, pagination works differently
                const groupData = table._paginationGroupData;
                let totalRows = 0;
                groupData.forEach(group => totalRows += group.rows.length);
                
                // Calculate pagination
                const totalPages = Math.ceil(totalRows / pageSize);
                const startIdx = (currentPage - 1) * pageSize;
                const endIdx = Math.min(startIdx + pageSize, totalRows);
                
                let rowCount = 0;
                let addedRows = 0;
                
                // Add groups and their visible rows
                groupData.forEach(group => {
                    // Check if any rows from this group should be visible
                    const groupStartRow = rowCount;
                    const groupEndRow = rowCount + group.rows.length;
                    
                    // If any rows in this group are visible in the current page
                    if (groupEndRow > startIdx && groupStartRow < endIdx) {
                        // Add the group header
                        const clonedHeader = simpleCloneRow(group.header);
                        tbody.appendChild(clonedHeader);
                        
                        // Add visible rows from this group
                        for (let i = 0; i < group.rows.length; i++) {
                            if (rowCount >= startIdx && rowCount < endIdx) {
                                const clonedRow = simpleCloneRow(group.rows[i]);
                                tbody.appendChild(clonedRow);
                                addedRows++;
                            }
                            rowCount++;
                        }
                    } else {
                        rowCount += group.rows.length;
                    }
                });
                
                // Restore event listeners for group headers
                const groupHeaders = tbody.querySelectorAll('.group-header');
                groupHeaders.forEach(header => {
                    header.addEventListener('click', function() {
                        this.classList.toggle('collapsed');
                        const isCollapsed = this.classList.contains('collapsed');
                        const groupValue = this.getAttribute('data-group');
                        const groupRows = tbody.querySelectorAll(`tr[data-group="${groupValue}"]:not(.group-header)`);
                        
                        groupRows.forEach(row => {
                            if (isCollapsed) {
                                row.classList.add('collapsed-row');
                            } else {
                                row.classList.remove('collapsed-row');
                            }
                        });
                        
                        const icon = this.querySelector('.group-toggle');
                        if (icon) {
                            icon.textContent = isCollapsed ? 'chevron_right' : 'expand_more';
                            icon.className = 'material-symbols-outlined icon group-toggle';
                        }
                    });
                });
            } else {
                // Regular table pagination
                const rows = table._paginationData;
                if (!rows) return;
                
                // Calculate pagination
                const totalPages = Math.ceil(rows.length / pageSize);
                const startIdx = (currentPage - 1) * pageSize;
                const endIdx = Math.min(startIdx + pageSize, rows.length);
                
                // Add visible rows
                for (let i = startIdx; i < endIdx; i++) {
                    const clonedRow = simpleCloneRow(rows[i]);
                    tbody.appendChild(clonedRow);
                }
            }
            
            // Always update pagination controls at the end
            console.log('Calling updatePaginationControls...');
            // Force this to run after the current execution context
            // This ensures the table is fully updated before pagination controls are created
            setTimeout(() => {
                updatePaginationControls(table);
                
                // NOTE: Removed emoji replacement to preserve original content structure
            }, 0);
            console.log('=== Finished paginateTable ===');
         }
         
         function updatePaginationControls(table) {
            console.log('=== Starting updatePaginationControls ===');
            
            const pageSize = parseInt(table.getAttribute('data-page-size')) || 20;
            const currentPage = parseInt(table.getAttribute('data-current-page')) || 1;
            const tableContainer = table.closest('.table-container');
            const paginationContainer = tableContainer.querySelector('.table-pagination');
            
            console.log(`updatePaginationControls: pageSize=${pageSize}, currentPage=${currentPage}`);
            
            if (!paginationContainer) {
                console.error('No pagination container found');
                return;
            }
            
            // Find pagination elements
            const paginationInfo = paginationContainer.querySelector('.pagination-info');
            const paginationNav = paginationContainer.querySelector('.pagination-nav');
            
            // Calculate total rows
            let totalRows = 0;
            if (table._paginationGroupData) {
                table._paginationGroupData.forEach(group => totalRows += group.rows.length);
            } else if (table._paginationData) {
                totalRows = table._paginationData.length;
            }
            
            // Calculate pagination values
            const totalPages = Math.max(1, Math.ceil(totalRows / pageSize));
            const startItem = totalRows === 0 ? 0 : (currentPage - 1) * pageSize + 1;
            const endItem = Math.min(startItem + pageSize - 1, totalRows);
            
            // Update info text
            if (paginationInfo) {
                paginationInfo.textContent = `Showing ${startItem}-${endItem} of ${totalRows}`;
            }
            
            // Clear existing navigation
            if (paginationNav) {
                paginationNav.innerHTML = '';
            }
            
            console.log(`Final pagination state: totalRows=${totalRows}, pageSize=${pageSize}, totalPages=${totalPages}, currentPage=${currentPage}`);
            
            // Always show pagination nav div, but only add buttons if multiple pages
            if (paginationNav) {                
                console.log(`Pagination nav found, totalPages=${totalPages}`);
                
                // Create page buttons regardless of total pages
                // This ensures pagination controls are always visible after page size change
                console.log('Creating page buttons...');
                createPageButtons(paginationNav, currentPage, totalPages, table);
                
                // Make sure the page size selector shows the correct value
                const pageSizeSelect = paginationContainer.querySelector('.page-size-select');
                if (pageSizeSelect && pageSizeSelect.value != pageSize) {
                    console.log(`Updating page size selector from ${pageSizeSelect.value} to ${pageSize}`);
                    pageSizeSelect.value = pageSize;
                } else {
                    console.log(`Page size selector already shows correct value: ${pageSize}`);
                }
            } else {
                console.error('Pagination nav not found!');
            }
            
            console.log('=== Finished updatePaginationControls ===');
         }
         
         function createPageButtons(container, currentPage, totalPages, table) {
            // Validate inputs
            currentPage = Math.max(1, currentPage);
            totalPages = Math.max(1, totalPages);
            
            // Define button styles
            const buttonStyles = `
                border: none;
                background: transparent;
                color: #5f6368;
                padding: 8px 12px;
                margin: 0 2px;
                border-radius: 4px;
                cursor: pointer;
                font-size: 14px;
                font-weight: 500;
                transition: all 0.2s ease;
                display: inline-flex;
                align-items: center;
                justify-content: center;
                min-width: 32px;
                min-height: 32px;
            `;
            
            const disabledButtonStyles = `
                opacity: 0.38;
                cursor: not-allowed;
                pointer-events: none;
            `;
            
            // Ensure we have at least one page
            totalPages = Math.max(1, totalPages);
            
            // Create a div to hold the navigation buttons
            const navButtonsContainer = document.createElement('div');
            navButtonsContainer.className = 'pagination-nav-buttons';
            
            // First page button
            const firstBtn = document.createElement('button');
            firstBtn.className = 'pagination-button first';
            firstBtn.innerHTML = '<span class="material-symbols-outlined icon">first_page</span>';
            firstBtn.title = 'First Page';
            firstBtn.disabled = currentPage === 1;
            firstBtn.style.cssText = buttonStyles + (currentPage === 1 ? disabledButtonStyles : '');
            
            // Immediately fix the icon in this button
            const firstIcon = firstBtn.querySelector('span');
            if (firstIcon) {
                firstIcon.setAttribute('data-original-icon-text', 'first_page');
                firstIcon.style.fontFamily = "'Material Symbols Outlined', sans-serif";
                firstIcon.style.fontVariantEmoji = "text";
            }
            
            // Add hover effect - Updated Google style
            firstBtn.addEventListener('mouseover', function() {
                if (currentPage !== 1) {
                    this.style.backgroundColor = 'rgba(60, 64, 67, 0.08)';
                    this.style.color = '#202124';
                }
            });
            
            firstBtn.addEventListener('mouseout', function() {
                if (currentPage !== 1) {
                    this.style.backgroundColor = 'transparent';
                    this.style.color = '#5f6368';
                }
            });
            firstBtn.addEventListener('click', () => {
                table.setAttribute('data-current-page', '1');
                paginateTable(table);
            });
            navButtonsContainer.appendChild(firstBtn);
            
            // Previous button
            const prevBtn = document.createElement('button');
            prevBtn.className = 'pagination-button prev';
            prevBtn.innerHTML = '<span class="material-symbols-outlined icon">chevron_left</span>';
            prevBtn.title = 'Previous Page';
            prevBtn.disabled = currentPage === 1;
            prevBtn.style.cssText = buttonStyles + (currentPage === 1 ? disabledButtonStyles : '');
            
            // Immediately fix the icon in this button
            const prevIcon = prevBtn.querySelector('span');
            if (prevIcon) {
                prevIcon.setAttribute('data-original-icon-text', 'chevron_left');
                prevIcon.style.fontFamily = "'Material Symbols Outlined', sans-serif";
                prevIcon.style.fontVariantEmoji = "text";
            }
            
            // Add hover effect - Updated Google style
            prevBtn.addEventListener('mouseover', function() {
                if (currentPage !== 1) {
                    this.style.backgroundColor = 'rgba(60, 64, 67, 0.08)';
                    this.style.color = '#202124';
                }
            });
            
            prevBtn.addEventListener('mouseout', function() {
                if (currentPage !== 1) {
                    this.style.backgroundColor = 'transparent';
                    this.style.color = '#5f6368';
                }
            });
            prevBtn.addEventListener('click', () => {
                const newPage = Math.max(1, currentPage - 1);
                table.setAttribute('data-current-page', newPage);
                paginateTable(table);
            });
            navButtonsContainer.appendChild(prevBtn);
            
            // Add the nav buttons container to the main container
            container.appendChild(navButtonsContainer);
            
            // Create a div to hold the page number buttons
            const pageNumbersContainer = document.createElement('div');
            pageNumbersContainer.className = 'pagination-page-numbers';
            pageNumbersContainer.style.display = 'flex';
            pageNumbersContainer.style.alignItems = 'center';
            pageNumbersContainer.style.margin = '0 10px';
            
            // Google-style page numbers (always show current page and some context)
            let startPage = Math.max(1, currentPage - 2);
            let endPage = Math.min(totalPages, startPage + 4);
            
            // Adjust if we're near the end
            if (endPage === totalPages) {
                startPage = Math.max(1, endPage - 4);
            }
            
            // For single page, ensure we show at least that one page
            if (totalPages === 1) {
                startPage = 1;
                endPage = 1;
            }
            
            // Add ellipsis at start if needed
            if (startPage > 1) {
                const ellipsisStart = document.createElement('span');
                ellipsisStart.className = 'pagination-button ellipsis';
                ellipsisStart.style.cssText = `
                    display: inline-flex;
                    align-items: center;
                    justify-content: center;
                    min-width: 36px;
                    height: 36px;
                    margin: 0 4px;
                    font-size: 14px;
                    color: #5f6368;
                `;
                ellipsisStart.textContent = '...';
                pageNumbersContainer.appendChild(ellipsisStart);
            }
            
            // Add page buttons
            for (let i = startPage; i <= endPage; i++) {
                const pageBtn = document.createElement('button');
                pageBtn.className = 'pagination-button page-number';
                pageBtn.style.cssText = buttonStyles;
                
                // Add hover effect - Updated Google style
                pageBtn.addEventListener('mouseover', function() {
                    if (i !== currentPage) {
                        this.style.backgroundColor = 'rgba(60, 64, 67, 0.08)'; // Transparent gray hover effect
                        this.style.color = '#202124';
                    }
                });
                
                pageBtn.addEventListener('mouseout', function() {
                    if (i !== currentPage) {
                        this.style.backgroundColor = 'transparent';
                        this.style.color = '#5f6368';
                    }
                });
                
                if (i === currentPage) {
                    pageBtn.classList.add('active');
                    pageBtn.style.backgroundColor = 'var(--product-accent)'; // Google Blue
                    pageBtn.style.color = 'white';
                    pageBtn.style.fontWeight = '500';
                    pageBtn.style.border = 'none';
                }
                
                pageBtn.textContent = i;
                pageBtn.addEventListener('click', () => {
                    table.setAttribute('data-current-page', i);
                    paginateTable(table);
                });
                pageNumbersContainer.appendChild(pageBtn);
            }
            
            // Add ellipsis at end if needed
            if (endPage < totalPages) {
                const ellipsisEnd = document.createElement('span');
                ellipsisEnd.className = 'pagination-button ellipsis';
                ellipsisEnd.style.cssText = `
                    display: inline-flex;
                    align-items: center;
                    justify-content: center;
                    min-width: 36px;
                    height: 36px;
                    margin: 0 4px;
                    font-size: 14px;
                    color: #5f6368;
                `;
                ellipsisEnd.textContent = '...';
                pageNumbersContainer.appendChild(ellipsisEnd);
            }
            
            // Add the page numbers container to the main container
            container.appendChild(pageNumbersContainer);
            
            // Create a div for the next/last buttons
            const nextButtonsContainer = document.createElement('div');
            nextButtonsContainer.className = 'pagination-next-buttons';
            nextButtonsContainer.style.display = 'flex';
            nextButtonsContainer.style.alignItems = 'center';
            
            // Next button
            const nextBtn = document.createElement('button');
            nextBtn.className = 'pagination-button next';
            nextBtn.innerHTML = '<span class="material-symbols-outlined icon">chevron_right</span>';
            nextBtn.title = 'Next Page';
            nextBtn.disabled = currentPage === totalPages;
            nextBtn.style.cssText = buttonStyles + (currentPage === totalPages ? disabledButtonStyles : '');
            
            // Immediately fix the icon in this button
            const nextIcon = nextBtn.querySelector('span');
            if (nextIcon) {
                nextIcon.setAttribute('data-original-icon-text', 'chevron_right');
                nextIcon.style.fontFamily = "'Material Symbols Outlined', sans-serif";
                nextIcon.style.fontVariantEmoji = "text";
            }
            
            // Add hover effect - Updated Google style
            nextBtn.addEventListener('mouseover', function() {
                if (currentPage !== totalPages) {
                    this.style.backgroundColor = 'rgba(60, 64, 67, 0.08)';
                    this.style.color = '#202124';
                }
            });
            
            nextBtn.addEventListener('mouseout', function() {
                if (currentPage !== totalPages) {
                    this.style.backgroundColor = 'transparent';
                    this.style.color = '#5f6368';
                }
            });
            nextBtn.addEventListener('click', () => {
                const newPage = Math.min(totalPages, currentPage + 1);
                table.setAttribute('data-current-page', newPage);
                paginateTable(table);
            });
            nextButtonsContainer.appendChild(nextBtn);
            
            // Last page button
            const lastBtn = document.createElement('button');
            lastBtn.className = 'pagination-button last';
            lastBtn.innerHTML = '<span class="material-symbols-outlined icon">last_page</span>';
            lastBtn.title = 'Last Page';
            lastBtn.disabled = currentPage === totalPages;
            lastBtn.style.cssText = buttonStyles + (currentPage === totalPages ? disabledButtonStyles : '');
            
            // Immediately fix the icon in this button
            const lastIcon = lastBtn.querySelector('span');
            if (lastIcon) {
                lastIcon.setAttribute('data-original-icon-text', 'last_page');
                lastIcon.style.fontFamily = "'Material Symbols Outlined', sans-serif";
                lastIcon.style.fontVariantEmoji = "text";
            }
            
            // Add hover effect - Updated Google style
            lastBtn.addEventListener('mouseover', function() {
                if (currentPage !== totalPages) {
                    this.style.backgroundColor = 'rgba(60, 64, 67, 0.08)';
                    this.style.color = '#202124';
                }
            });
            
            lastBtn.addEventListener('mouseout', function() {
                if (currentPage !== totalPages) {
                    this.style.backgroundColor = 'transparent';
                    this.style.color = '#5f6368';
                }
            });
            lastBtn.addEventListener('click', () => {
                table.setAttribute('data-current-page', totalPages);
                paginateTable(table);
            });
            nextButtonsContainer.appendChild(lastBtn);
            
            // Add the next buttons container to the main container
            container.appendChild(nextButtonsContainer);
            
            // Fix all icons in the pagination controls
            setTimeout(() => {
                const paginationIcons = container.querySelectorAll('.icon, .material-symbols-outlined');
                paginationIcons.forEach(icon => {
                    if (!icon.classList.contains('material-symbols-outlined')) {
                        icon.classList.add('material-symbols-outlined');
                    }
                    
                    icon.style.fontFamily = "'Material Symbols Outlined', sans-serif";
                    icon.style.fontWeight = "normal";
                    icon.style.fontStyle = "normal";
                    icon.style.fontVariantEmoji = "text"; // Prevent emoji rendering
                    
                    const iconText = icon.textContent.trim();
                    if (iconText) {
                        icon.innerHTML = '';
                        icon.textContent = iconText;
                    }
                });
            }, 0);
         }
         
         function makeTablesSortable() {
            const tables = document.querySelectorAll('.table-container table');
            
            tables.forEach(table => {
               const headers = table.querySelectorAll('th');
               
               headers.forEach((header, index) => {
                  // Skip columns that shouldn't be sortable (you can add a 'no-sort' class to specific headers)
                  if (header.classList.contains('no-sort')) return;
                  
                  // Add sorting indicators and cursor pointer
                  header.style.cursor = 'pointer';
                  header.style.position = 'relative';
                  header.setAttribute('data-sort-direction', '');
                  
                  // Create sort indicator element
                  const sortIndicator = document.createElement('span');
                  sortIndicator.className = 'sort-indicator';
                  sortIndicator.innerHTML = '&nbsp;⇕';
                  sortIndicator.style.fontSize = '0.8em';
                  sortIndicator.style.opacity = '0.6';
                  sortIndicator.style.marginLeft = '5px';
                  sortIndicator.style.display = 'inline-block';
                  header.appendChild(sortIndicator);
                  
                  // Add click event
                  header.addEventListener('click', function() {
                     sortTable(table, index, header);
                  });
               });
            });
         }
         
         function makeTablesGroupable() {
            const tables = document.querySelectorAll('.table-container table');
            
            // For debugging - add a small indicator to help identify if function is running
            console.log('Looking for groupable tables...', tables.length);
            
            tables.forEach((table, tableIndex) => {
               // Make sure the table has a thead
               const thead = table.querySelector('thead');
               if (!thead) return;
               
               const headers = Array.from(thead.querySelectorAll('th'));
               let groupableColumnIndices = [];
               
               // Make all columns groupable
               headers.forEach((header, index) => {
                  // Skip columns that shouldn't be groupable (you can add a 'no-group' class to specific headers)
                  if (header.classList.contains('no-group')) return;
                  
                  const headerText = header.textContent.trim();
                  
                  // Skip empty headers
                  if (headerText !== '') {
                     groupableColumnIndices.push({index: index, name: headerText});
                  }
               });
               
               // If there are any columns to group by, add group controls
               if (groupableColumnIndices.length > 0) {
                  addGroupingControlsToTable(table, groupableColumnIndices);
                  console.log(`Added grouping controls to table ${tableIndex+1} with ${groupableColumnIndices.length} columns`);
               }
            });
         }
         
         function addGroupingControlsToTable(table, groupableColumns) {
            const tableContainer = table.closest('.table-container');
            
            // Remove any existing grouping controls to prevent duplicates
            const existingControls = tableContainer.querySelector('.table-group-controls');
            if (existingControls) {
               existingControls.remove();
            }
            
            // Create grouping control panel with improved styling
            const groupingControls = document.createElement('div');
            groupingControls.className = 'table-group-controls';
            groupingControls.style.display = 'flex';
            groupingControls.style.flexWrap = 'wrap';
            groupingControls.style.alignItems = 'center';
            groupingControls.style.padding = '10px 12px';
            groupingControls.style.backgroundColor = '#f8f9fa';
            groupingControls.style.borderRadius = '4px';
            groupingControls.style.border = '1px solid #e0e0e0';
            
            // Add title with icon
            const groupTitle = document.createElement('div');
            groupTitle.className = 'group-title';
            groupTitle.style.marginRight = '16px';
            groupTitle.style.fontWeight = '500';
            groupTitle.style.display = 'flex';
            groupTitle.style.alignItems = 'center';
            
            const icon = document.createElement('span');
            icon.className = 'material-symbols-outlined';
            icon.textContent = 'filter_list';
            icon.style.marginRight = '6px';
            icon.style.fontSize = '20px';
            icon.style.color = '#0071ce';
            
            const titleText = document.createElement('span');
            titleText.textContent = 'Group by:';
            
            groupTitle.appendChild(icon);
            groupTitle.appendChild(titleText);
            groupingControls.appendChild(groupTitle);
            
            // Add controls for each groupable column
            const groupOptions = document.createElement('div');
            groupOptions.className = 'group-options';
            groupOptions.style.display = 'flex';
            groupOptions.style.flexWrap = 'wrap';
            groupOptions.style.gap = '8px';
            
            // Add "None" option with improved styling
            const noneOption = document.createElement('button');
            noneOption.className = 'group-option active';
            noneOption.textContent = 'None';
            noneOption.style.padding = '6px 12px';
            noneOption.style.border = '1px solid #ddd';
            noneOption.style.borderRadius = '4px';
            noneOption.style.backgroundColor = '#fff';
            noneOption.style.cursor = 'pointer';
            noneOption.style.transition = 'all 0.2s ease';
            
            // Active style
            if (noneOption.classList.contains('active')) {
               noneOption.style.backgroundColor = '#0071ce';
               noneOption.style.color = '#fff';
               noneOption.style.border = '1px solid #0071ce';
            }
            
            noneOption.onclick = function(event) {
               // Prevent event propagation
               event.stopPropagation();
               event.preventDefault();
               
               console.log('None option clicked - Starting grouping reset');
               
               try {
                  // Set this option as active first to provide visual feedback
                  setActiveGroupOption(groupOptions, this);
                  
                  // Add a small delay to ensure UI feedback happens before potentially intensive operation
                  setTimeout(() => {
                     // Ensure we clean up all grouping
                     resetGrouping(table);
                     console.log('None option: grouping reset complete');
                  }, 10);
               } catch (error) {
                  console.error('Error handling None option click:', error);
               }
            };
            
            // Add hover effect
            noneOption.onmouseover = function() {
               if (!this.classList.contains('active')) {
                  this.style.backgroundColor = '#f0f0f0';
               }
            };
            noneOption.onmouseout = function() {
               if (!this.classList.contains('active')) {
                  this.style.backgroundColor = '#fff';
               }
            };
            
            groupOptions.appendChild(noneOption);
            
            // Add column options with the same styling
            groupableColumns.forEach(column => {
               const option = document.createElement('button');
               option.className = 'group-option';
               option.textContent = column.name;
               option.style.padding = '6px 12px';
               option.style.border = '1px solid #ddd';
               option.style.borderRadius = '4px';
               option.style.backgroundColor = '#fff';
               option.style.cursor = 'pointer';
               option.style.transition = 'all 0.2s ease';
               
               // Add hover effect
               option.onmouseover = function() {
                  if (!this.classList.contains('active')) {
                     this.style.backgroundColor = '#f0f0f0';
                  }
               };
               option.onmouseout = function() {
                  if (!this.classList.contains('active')) {
                     this.style.backgroundColor = '#fff';
                  }
               };
               
               option.onclick = (event) => {
                  // Prevent event propagation
                  event.stopPropagation();
                  event.preventDefault();
                  
                  console.log(`Group option clicked: ${column.name}`);
                  groupTableByColumn(table, column.index, column.name);
                  setActiveGroupOption(groupOptions, option);
               };
               groupOptions.appendChild(option);
            });
            
            groupingControls.appendChild(groupOptions);
            
            // Insert controls before the table
            tableContainer.insertBefore(groupingControls, table);
         }
         
         function setActiveGroupOption(container, activeButton) {
            console.log('Setting active group option:', activeButton.textContent);
            
            // Remove active class and reset styles from all buttons
            const buttons = container.querySelectorAll('.group-option');
            buttons.forEach(button => {
               button.classList.remove('active');
               button.style.backgroundColor = '#fff';
               button.style.color = '#333';
               button.style.border = '1px solid #ddd';
            });
            
            // Add active class to the selected button
            activeButton.classList.add('active');
            
            // Apply active styles
            activeButton.style.backgroundColor = '#0071ce';
            activeButton.style.color = '#fff';
            activeButton.style.border = '1px solid #0071ce';
            activeButton.style.fontWeight = '500';
         }
         
         function groupTableByColumn(table, columnIndex, columnName) {
            // Implementation for grouping table by column
            
            // Get all rows except header
            const tbody = table.querySelector('tbody');
            if (!tbody) {
               console.error('No tbody found in table during grouping');
               return;
            }
            
            // First, ensure all existing group headers are removed
            const allRows = Array.from(tbody.querySelectorAll('tr'));
            const dataRows = allRows.filter(row => !row.classList.contains('group-header'));
            const existingGroups = tbody.querySelectorAll('.group-header');
            
            console.log(`Found ${allRows.length} total rows, ${dataRows.length} data rows, ${existingGroups.length} existing group headers`);
            
            // Make sure to remove existing group headers properly
            existingGroups.forEach(group => {
               if (group.parentNode) {
                  group.parentNode.removeChild(group);
               }
            });
            
            // Reset all rows to their default state
            dataRows.forEach(row => {
               row.style.display = '';
               row.removeAttribute('data-group');
               row.classList.remove('first-in-group', 'collapsed-row');
            });
            
            // Group the data - use a new empty object for clean grouping
            const groupedData = {};
            
            dataRows.forEach(row => {
               // Ensure we have the right index
               if (columnIndex >= row.cells.length) {
                  console.warn(`Column index ${columnIndex} out of bounds for row`, row);
                  return;
               }
               
               // Extract only the text content and ignore icons
               const cell = row.cells[columnIndex];
               if (!cell) {
                  console.warn(`No cell found at index ${columnIndex} for row`, row);
                  return;
               }
               
               let cellValue = '';
               
               // Function to extract text nodes only (no icon text)
               function extractTextOnly(element) {
                  // Special case for cells with icons + text pattern like "dangerous High"
                  // Try to find any direct text node that is not within an icon element
                  let directTextContent = '';
                  let hasFoundDirectText = false;
                  
                  // First, check if this is a cell with the specific structure we're targeting
                  // This usually means it has both an icon with text and visible text afterward
                  const iconElements = element.querySelectorAll('.icon, .icon-high, .icon-medium, .icon-low');
                  if (iconElements.length > 0) {
                     // Try to find text nodes that are direct children but not part of icons
                     for (let childNode of element.childNodes) {
                        // Text node that's a direct child
                        if (childNode.nodeType === 3 && childNode.textContent.trim()) {
                           directTextContent += childNode.textContent.trim() + ' ';
                           hasFoundDirectText = true;
                        }
                        // If it's a span that doesn't have icon classes, it might contain our text
                        else if (childNode.nodeType === 1 && 
                                !childNode.classList?.contains('icon') && 
                                !childNode.classList?.contains('icon-high') && 
                                !childNode.classList?.contains('icon-medium') && 
                                !childNode.classList?.contains('icon-low')) {
                           // Only extract text if it doesn't contain icon children
                           if (!childNode.querySelector('.icon')) {
                              directTextContent += childNode.textContent.trim() + ' ';
                              hasFoundDirectText = true;
                           }
                        }
                     }
                  }
                  
                  // If we found direct text, use that (this helps with the specific case of "dangerous High")
                  if (hasFoundDirectText) {
                     return directTextContent.trim();
                  }
                  
                  // Otherwise, use the more generic approach
                  let text = '';
                  for (let node of element.childNodes) {
                     if (node.nodeType === 3) { // Text node
                        text += node.textContent.trim() + ' ';
                     } else if (node.nodeType === 1) { // Element node
                        // Skip icon elements, elements with icon class
                        const classList = node.classList ? Array.from(node.classList) : [];
                        const hasIconClass = classList.some(cls => cls === 'icon' || cls.startsWith('icon-'));
                        const isIcon = hasIconClass || 
                                      node.tagName.toLowerCase() === 'i';
                                    
                        if (!isIcon) {
                           text += extractTextOnly(node);
                        }
                     }
                  }
                  return text;
               }
               
               cellValue = extractTextOnly(cell).trim();
               
               // If we couldn't extract text properly, fallback to full text
               if (!cellValue) {
                  cellValue = cell.textContent.trim();
               }
               
               // Handle empty values specially
               const normalizedValue = cellValue || '(Empty)';
               
               // Create the group if it doesn't exist yet
               if (!groupedData[normalizedValue]) {
                  groupedData[normalizedValue] = [];
               }
               
               // Add the row to the group
               groupedData[normalizedValue].push(row);
            });
            
            // Clear the tbody completely to start fresh
            while (tbody.firstChild) {
               tbody.removeChild(tbody.firstChild);
            }
            
            // Create a sorted array of group values
            const groupValues = Object.keys(groupedData).sort();
            console.log(`Created ${groupValues.length} groups`);
            
            // Add rows back with group headers
            groupValues.forEach(groupValue => {
               const rowsInThisGroup = groupedData[groupValue];
               console.log(`Adding group: "${groupValue}" with ${rowsInThisGroup.length} rows`);
               
               // Create group header
               const groupHeader = document.createElement('tr');
               groupHeader.className = 'group-header';
               groupHeader.setAttribute('data-group', groupValue);
               
               const groupCell = document.createElement('td');
               // Get the correct column count from thead
               const headerRow = table.querySelector('thead tr');
               const colCount = headerRow ? headerRow.cells.length : 
                               (rowsInThisGroup.length > 0 ? rowsInThisGroup[0].cells.length : 1);
               groupCell.colSpan = colCount;
               
               const groupContent = document.createElement('div');
               groupContent.className = 'group-header-content';
               groupContent.style.display = 'flex';
               groupContent.style.alignItems = 'center';
               groupContent.style.padding = '8px';
               groupContent.style.backgroundColor = '#f5f7f9';
               groupContent.style.borderRadius = '4px';
               
               const groupIcon = document.createElement('span');
               groupIcon.className = 'material-symbols-outlined icon group-toggle';
               groupIcon.textContent = 'expand_more';
               groupIcon.style.marginRight = '8px';
               groupIcon.style.color = '#0071ce';
               groupIcon.style.fontFamily = "'Material Symbols Outlined', sans-serif";
               groupIcon.style.fontWeight = 'normal';
               groupIcon.style.fontSize = '20px';
               groupIcon.style.lineHeight = '1';
               groupIcon.style.display = 'flex';
               groupIcon.style.alignItems = 'center';
               groupIcon.style.justifyContent = 'center';
               
               const groupTitle = document.createElement('span');
               groupTitle.className = 'group-header-title';
               groupTitle.textContent = `${columnName}: ${groupValue}`;
               groupTitle.style.fontWeight = '500';
               groupTitle.style.color = '#333';
               
               const groupCount = document.createElement('span');
               groupCount.className = 'group-count';
               groupCount.textContent = `${rowsInThisGroup.length} items`;
               groupCount.style.marginLeft = '12px';
               groupCount.style.fontSize = '0.85em';
               groupCount.style.color = '#666';
               groupCount.style.backgroundColor = 'rgba(0, 113, 206, 0.1)';
               groupCount.style.padding = '2px 8px';
               groupCount.style.borderRadius = '12px';
               
               groupContent.appendChild(groupIcon);
               groupContent.appendChild(groupTitle);
               groupContent.appendChild(groupCount);
               groupCell.appendChild(groupContent);
               groupHeader.appendChild(groupCell);
               
               // Add toggle functionality and make it more obvious
               groupHeader.title = 'Click to expand/collapse group';
               groupHeader.style.cursor = 'pointer';
               
               /* Add tooltip text to make it clear this is collapsible
               const tooltipSpan = document.createElement('span');
               tooltipSpan.className = 'group-tooltip';
               tooltipSpan.textContent = 'Click to expand/collapse';
               tooltipSpan.style.fontSize = '0.75em';
               tooltipSpan.style.color = '#666';
               tooltipSpan.style.marginLeft = '8px';
               tooltipSpan.style.padding = '2px 6px';
               tooltipSpan.style.background = 'rgba(0, 113, 206, 0.08)';
               tooltipSpan.style.borderRadius = '4px';
               groupContent.appendChild(tooltipSpan);*/
               
               groupHeader.addEventListener('click', function(event) {
                  // Prevent event propagation
                  event.stopPropagation();
                  
                  this.classList.toggle('collapsed');
                  const isCollapsed = this.classList.contains('collapsed');
                  const groupValue = this.getAttribute('data-group');
                  
                  // Ensure we're getting the right rows by being more specific with our selector
                  // We need to escape special characters in the group value for the selector
                  const escapedGroupValue = groupValue.replace(/"/g, '\\"');
                  const groupRows = tbody.querySelectorAll(`tr[data-group="${escapedGroupValue}"]:not(.group-header)`);
                  
                  console.log(`Toggle group: "${groupValue}", Collapsed: ${isCollapsed}, Found rows: ${groupRows.length}`);
                  
                  // Toggle row visibility with CSS classes for better performance
                  groupRows.forEach(row => {
                     if (isCollapsed) {
                        row.classList.add('collapsed-row');
                        row.style.display = 'none';
                     } else {
                        row.classList.remove('collapsed-row');
                        row.style.display = '';
                     }
                  });
                  
                  // Update the icon with proper styling
                  const icon = this.querySelector('.group-toggle');
                  if (icon) {
                     icon.textContent = isCollapsed ? 'chevron_right' : 'expand_more';
                     
                     // Ensure consistent icon styling after text change
                     icon.style.fontFamily = "'Material Symbols Outlined', sans-serif";
                     icon.style.fontWeight = 'normal';
                     icon.style.fontSize = '20px';
                     icon.style.lineHeight = '1';
                     icon.style.display = 'flex';
                     icon.style.alignItems = 'center';
                     icon.style.justifyContent = 'center';
                  }
                  
                  /* Update tooltip text based on collapsed state
                  const tooltipElement = this.querySelector('.group-tooltip');
                  if (tooltipElement) {
                     tooltipElement.textContent = isCollapsed ? 'Click to expand' : 'Click to collapse';
                  }*/
                  
                  // Show a count of collapsed items when collapsed
                  const existingBadge = this.querySelector('.collapsed-count');
                  if (existingBadge) {
                     existingBadge.remove();
                  }
                  
                  if (isCollapsed) {
                     const count = groupRows.length;
                     const countBadge = document.createElement('span');
                     countBadge.className = 'collapsed-count';
                     countBadge.textContent = `(${count} items hidden)`;
                     countBadge.style.fontSize = '0.7em';
                     countBadge.style.padding = '2px 8px';
                     countBadge.style.backgroundColor = 'rgba(0, 113, 206, 0.15)';
                     countBadge.style.color = 'rgba(0, 113, 206, 0.9)';
                     countBadge.style.borderRadius = '10px';
                     countBadge.style.marginLeft = '10px';
                     countBadge.style.fontWeight = '500';
                     countBadge.style.border = '1px solid rgba(0, 113, 206, 0.3)';
                     
                     const headerContent = this.querySelector('.group-header-content');
                     if (headerContent) {
                        headerContent.appendChild(countBadge);
                     }
                  }
               });
               
               // Add the group header to the tbody
               tbody.appendChild(groupHeader);
               
               // Add the rows for this group with data-group attribute
               groupedData[groupValue].forEach((row, i) => {
                  // Set data-group attribute for proper identification
                  row.setAttribute('data-group', groupValue);
                  
                  // Style the first row in each group differently if needed
                  if (i === 0) {
                     row.classList.add('first-in-group');
                  }
                  
                  // Add the row to the tbody
                  tbody.appendChild(row);
               });
            });
            
            // Make sure we have consistent styles for grouped table
            const style = document.createElement('style');
            style.textContent = `
               .group-header { background-color: #f5f7f9; }
               .group-header td { padding: 0 !important; }
               .group-header-content { padding: 10px; }
               .collapsed-row { display: none; }
               tr.first-in-group td { border-top: 1px solid #e0e0e0; }
               .group-header:hover { background-color: #eef1f5; }
               
               /* Material Icons proper styling */
               .material-symbols-outlined.icon {
                  font-family: 'Material Symbols Outlined', sans-serif !important;
                  font-weight: normal !important;
                  font-style: normal !important;
                  font-size: 20px !important;
                  line-height: 1 !important;
                  display: inline-flex !important;
                  align-items: center !important;
                  justify-content: center !important;
                  text-transform: none !important;
                  letter-spacing: normal !important;
                  overflow-wrap: normal !important;
                  white-space: nowrap !important;
                  direction: ltr !important;
                  -webkit-font-smoothing: antialiased !important;
               }
            `;
            
            // Only add the style if it doesn't exist yet
            if (!document.querySelector('style[data-group-styles="true"]')) {
                style.setAttribute('data-group-styles', 'true');
                document.head.appendChild(style);
            }
            
            console.log('Group headers and rows added to table');
            
            // Re-apply pagination if it's enabled
            if (table.hasAttribute('data-paginated')) {
               console.log('Table is paginated, re-applying pagination after grouping');
               // Re-store table data since grouping has changed the structure
               storeTableData(table);
               // Reset to first page and update
               table.setAttribute('data-current-page', '1');
               paginateTable(table);
            }
         }
         
         function resetGrouping(table) {
            console.log('Resetting table grouping - START');
            const tbody = table.querySelector('tbody');
            if (!tbody) {
               console.error('No tbody found in table during resetGrouping');
               return;
            }
            
            try {
               // Backup of all non-header rows (important data rows)
               const allRows = Array.from(tbody.querySelectorAll('tr'));
               const dataRows = allRows.filter(row => !row.classList.contains('group-header'));
               
               console.log(`Found ${allRows.length} total rows, ${dataRows.length} data rows to restore`);
               
               // Make a clean copy of each data row to avoid any reference issues
               const cleanDataRows = dataRows.map(row => {
                  const clonedRow = row.cloneNode(true);
                  
                  // Reset any grouping-related attributes and styling
                  clonedRow.removeAttribute('data-group');
                  clonedRow.classList.remove('first-in-group', 'collapsed-row');
                  clonedRow.style.display = '';
                  
                  // Ensure any row that was hidden is now visible
                  if (row.style.display === 'none') {
                     clonedRow.style.display = '';
                  }
                  
                  return clonedRow;
               });
               
               console.log(`Created ${cleanDataRows.length} clean rows for regrouping`);
               
               // Clear the tbody completely to start fresh
               console.log('Clearing tbody to start fresh');
               while (tbody.firstChild) {
                  tbody.removeChild(tbody.firstChild);
               }
               
               // Re-add all data rows in their original order with clean state
               console.log('Re-adding clean data rows to table');
               cleanDataRows.forEach(row => tbody.appendChild(row));
               
               // Re-apply pagination if it's enabled
               if (table.hasAttribute('data-paginated')) {
                  console.log('Table is paginated, restoring pagination after group reset');
                  // Re-store table data since we've reset the grouping
                  storeTableData(table);
                  // Reset to first page and update
                  table.setAttribute('data-current-page', '1');
                  paginateTable(table);
               }
               
               console.log('Resetting table grouping - COMPLETE');
            } catch (error) {
               console.error('Error in resetGrouping:', error);
            }
         }
         
         function sortTable(table, columnIndex, header) {
            const sortDirection = header.getAttribute('data-sort-direction');
            const newDirection = sortDirection === 'asc' ? 'desc' : 'asc';
            
            // Reset all headers
            const headers = table.querySelectorAll('th');
            headers.forEach(h => {
               h.setAttribute('data-sort-direction', '');
               const indicator = h.querySelector('.sort-indicator');
               if (indicator) indicator.innerHTML = '&nbsp;⇕';
               indicator.style.opacity = '0.6';
            });
            
            // Set current header
            header.setAttribute('data-sort-direction', newDirection);
            const sortIndicator = header.querySelector('.sort-indicator');
            sortIndicator.innerHTML = newDirection === 'asc' ? '&nbsp;↑' : '&nbsp;↓';
            sortIndicator.style.opacity = '1';
            
            // Check if table is grouped
            const tbody = table.querySelector('tbody');
            const groupHeaders = tbody.querySelectorAll('.group-header');
            
            if (groupHeaders.length > 0) {
               // Table is grouped, sort within each group
               const groups = {};
               
               // Collect all groups
               groupHeaders.forEach(header => {
                  const groupValue = header.getAttribute('data-group');
                  groups[groupValue] = [];
                  
                  // Find all rows in this group
                  const groupRows = tbody.querySelectorAll(`tr[data-group="${groupValue}"]:not(.group-header)`);
                  groupRows.forEach(row => groups[groupValue].push(row));
                  
                  // Sort rows in this group
                  groups[groupValue].sort((rowA, rowB) => {
                     const cellA = rowA.cells[columnIndex].textContent.trim();
                     const cellB = rowB.cells[columnIndex].textContent.trim();
                     
                     // Check if values are numbers
                     const numA = parseFloat(cellA);
                     const numB = parseFloat(cellB);
                     
                     if (!isNaN(numA) && !isNaN(numB)) {
                        return newDirection === 'asc' ? numA - numB : numB - numA;
                     } else {
                        // String comparison
                        return newDirection === 'asc' 
                           ? cellA.localeCompare(cellB) 
                           : cellB.localeCompare(cellA);
                     }
                  });
                  
                  // Remove existing rows
                  groupRows.forEach(row => {
                     tbody.removeChild(row);
                  });
                  
                  // Insert sorted rows after their group header
                  let insertAfter = header;
                  const isGroupCollapsed = header.classList.contains('collapsed');
                  
                  groups[groupValue].forEach((row, idx) => {
                     // Preserve the collapsed state from the group header
                     if (isGroupCollapsed) {
                        row.classList.add('collapsed-row');
                     } else {
                        row.classList.remove('collapsed-row');
                     }
                     
                     // Add first-in-group class to the first row
                     if (idx === 0) {
                        row.classList.add('first-in-group');
                     } else {
                        row.classList.remove('first-in-group');
                     }
                     
                     if (insertAfter.nextSibling) {
                        tbody.insertBefore(row, insertAfter.nextSibling);
                     } else {
                        tbody.appendChild(row);
                     }
                     insertAfter = row;
                  });
               });
               
            } else {
               // Normal sorting (no groups)
               const rows = Array.from(tbody.querySelectorAll('tr'));
               
               // Sort rows
               rows.sort((rowA, rowB) => {
                  const cellA = rowA.cells[columnIndex].textContent.trim();
                  const cellB = rowB.cells[columnIndex].textContent.trim();
                  
                  // Check if values are numbers
                  const numA = parseFloat(cellA);
                  const numB = parseFloat(cellB);
                  
                  if (!isNaN(numA) && !isNaN(numB)) {
                     return newDirection === 'asc' ? numA - numB : numB - numA;
                  } else {
                     // String comparison
                     return newDirection === 'asc' 
                        ? cellA.localeCompare(cellB) 
                        : cellB.localeCompare(cellA);
                  }
               });
               
               // Remove existing rows
               rows.forEach(row => tbody.removeChild(row));
               
               // Add sorted rows
               rows.forEach(row => tbody.appendChild(row));
            }
            
            // Re-apply pagination if it's enabled
            if (table.hasAttribute('data-paginated')) {
               // Re-store table data since sorting has changed the structure
               storeTableData(table);
               paginateTable(table);
            }
            
            // Add a highlight effect on sorting
            tbody.style.transition = 'background-color 0.3s ease';
            tbody.style.backgroundColor = 'rgba(0, 113, 206, 0.05)';
            setTimeout(() => {
               tbody.style.backgroundColor = '';
            }, 500);
         }
      </script>

      <style>
         :root {
         /* Light Theme */
         --cgd-blue: #0071CE;
         --product-accent: #0071CE;
         --product-accent-hover: #00559A;
         --text-primary: #202124;
         --text-secondary: #5f6368;
         --border-color: #dadce0;
         --background-main: #f8f9fa;
         --background-card: #ffffff;
         --background-hover: #f1f3f4;
         --background-button: #0071CE;
         --background-button-text: #ffffff;
         /* Icon Colors */
         --color-red: #d93025;
         --color-amber: #f9ab00;
         --color-green: #1e8e3e;
         }
        html.dark-mode {
         /* Dark Theme - Improved for better visibility and contrast */
         --product-accent: #4285f4;
         --product-accent-hover: #5294ff;
         --text-primary: #ffffff;
         --text-secondary: #ffffff;
         --border-color: #5f6368;
         --background-main: #1a1a1a;
         --background-card: #2d2d2d;
         --background-hover: #404040;
         --background-button: #4285f4;
         --background-button-text: #ffffff;
         /* Improved Icon Colors for dark mode */
         --color-red: #f28b82;
         --color-amber: #fdd663;
         --color-green: #81c995;
         }
         html {
         color: var(--text-primary);
         background-color: var(--background-main);
         box-sizing: border-box;
         scroll-behavior: smooth;
         }
         *, *::before, *::after { box-sizing: inherit; }
         body {
         margin: 0; padding: 0; width: 100%;
         font-family: 'Roboto', 'Segoe UI', Arial, sans-serif;
         font-size: 14px; line-height: 1.6;
         text-rendering: optimizeLegibility;
         overflow-x: hidden;
         text-align: left;
         color: var(--text-primary);
         background-color: var(--background-main);
         transition: background-color 0.3s ease, color 0.3s ease;
         }
         /* --- HEADER --- */
         /* --- READING PROGRESS INDICATOR --- */
         .reading-progress {
         position: fixed;
         top: 0;
         left: 0;
         width: 100%;
         height: 3px;
         background-color: rgba(0, 113, 206, 0.1);
         z-index: 103;
         opacity: 0;
         transition: opacity 0.3s ease;
         }
         .reading-progress.show {
         opacity: 1;
         }
         .reading-progress-fill {
         height: 100%;
         background: linear-gradient(90deg, var(--product-accent) 0%, #00559A 100%);
         width: 0%;
         transition: width 0.1s ease-out;
         border-radius: 0 2px 2px 0;
         box-shadow: 0 0 10px rgba(0, 113, 206, 0.3);
         }
         .reading-progress-text {
         position: fixed;
         top: 8px;
         right: 20px;
         background-color: var(--background-card);
         color: var(--text-secondary);
         font-size: 0.75rem;
         font-weight: 500;
         padding: 0.25rem 0.5rem;
         border-radius: 12px;
         border: 1px solid var(--border-color);
         z-index: 104;
         opacity: 0;
         visibility: hidden;
         transition: all 0.3s ease;
         backdrop-filter: blur(8px);
         }
         .reading-progress-text.show {
         opacity: 1;
         visibility: visible;
         }
         .header {
         background-color: var(--background-card);
         box-shadow: 0 1px 2px rgba(0,0,0,0.1);
         position: sticky;
         top: 0;
         z-index: 102;
         width: 100%;
         border-bottom: 1px solid var(--border-color);
         transition: background-color 0.3s ease, border-color 0.3s ease;
         }
         .header-container {
         display: flex;
         align-items: center;
         justify-content: space-between;
         padding: 0.5rem 1.5rem; /* Reduced padding */
         max-width: 100%;
         margin: 0 auto;
         }
         .header-brand { display: flex; align-items: center; }
         .header-logo { height: 38px; margin-right: 1rem; }
         .header-title { font-size: 18px; font-weight: 600; color: var(--cgd-blue); padding: 0; }
         .header-controls { display: flex; align-items: center; gap: 0.5rem; }
         .support-button {
         background-color: var(--background-button);
         color: var(--background-button-text);
         border: 1px solid transparent;
         border-radius: 4px;
         padding: 8px 16px;
         font-size: 14px;
         font-weight: 500;
         text-decoration: none;
         cursor: pointer;
         transition: background-color 0.2s ease, box-shadow 0.2s ease;
         margin-left: 1rem;
         }
         .support-button:hover {
         background-color: var(--product-accent-hover);
         box-shadow: 0 1px 3px rgba(0,0,0,0.1);
         }
         .icon-button {
         background: none; border: none; cursor: pointer;
         padding: 8px; border-radius: 50%;
         display: inline-flex; align-items: center; justify-content: center;
         color: var(--text-secondary);
         transition: background-color 0.2s ease, color 0.2s ease;
         }
         .icon-button:hover { background-color: var(--background-hover); color: var(--text-primary); }
         .icon-button .icon { margin: 0; vertical-align: -6px; }
         /* --- MAIN CONTENT & TYPOGRAPHY --- */
         .content { max-width: 100%; padding: 0 1.5rem; margin: 0 auto; }
         .product-header {
         background-color: var(--background-card);
         padding: 2rem 1.5rem;
         margin-bottom: 0;
         border-bottom: 1px solid var(--border-color);
         transition: background-color 0.3s ease, border-color 0.3s ease;
         }
         .document-meta {
         display: flex;
         align-items: center;
         gap: 1rem;
         margin-top: 0.5rem;
         color: var(--text-secondary);
         font-size: 0.875rem;
         }
         .read-time { display: flex; align-items: center; gap: 0.25rem; }
         .read-time .icon { font-size: 18px; vertical-align: -4px; }
         h1, h2, h3, h4 { color: var(--text-primary); text-align: left; font-weight: 600; margin-bottom: 1rem; }
         h1 { margin-top: 0; font-size: 2.25rem; padding-bottom: 0.5rem; }
         h2 { font-size: 1.75rem; padding-bottom: 0.75rem; border-bottom: 1px solid var(--border-color); transition: border-color 0.3s ease; }
         h3 { font-size: 1.4rem; }
         h4 { font-size: 1.2rem; }
         p { margin: 1rem 0; color: var(--text-secondary); }
         /* --- ICON STYLES --- */
         .icon { font-family: 'Material Symbols Outlined', sans-serif; font-weight: normal; font-style: normal; font-size: 20px; line-height: 1; letter-spacing: normal; text-transform: none; display: inline-block; white-space: nowrap; word-wrap: normal; direction: ltr; -webkit-font-smoothing: antialiased; vertical-align: -5px; margin-right: 0.07em; }
         .icon-high { color: var(--color-red); }
         .icon-medium { color: var(--color-amber); }
         .icon-low { color: var(--color-green); }
         .icon-check { color: var(--color-green); }
         .icon-cross { color: var(--color-red); }
         .icon-question { color: var(--text-secondary); }
         /* --- BREADCRUMB NAVIGATION --- */
         .breadcrumb-container {
         background-color: var(--background-main);
         border-top: 1px solid var(--border-color);
         padding: 0.5rem 1.5rem;
         transition: all 0.3s ease;
         }
         .breadcrumb {
         display: flex;
         align-items: center;
         flex-wrap: wrap;
         gap: 0.5rem;
         font-size: 0.8rem;
         color: var(--text-secondary);
         max-width: 1200px;
         margin: 0 auto;
         }
         .breadcrumb-item {
         display: flex;
         align-items: center;
         gap: 0.25rem;
         }
         .breadcrumb-link {
         color: var(--text-secondary);
         text-decoration: none;
         padding: 0.25rem 0.5rem;
         border-radius: 4px;
         transition: all 0.2s ease;
         cursor: pointer;
         }
         .breadcrumb-link:hover {
         color: var(--product-accent);
         background-color: var(--background-hover);
         }
         .breadcrumb-link.active {
         color: var(--product-accent);
         font-weight: 500;
         background-color: rgba(0, 113, 206, 0.1);
         }
         .breadcrumb-separator {
         color: var(--border-color);
         font-size: 0.75rem;
         margin: 0 0.25rem;
         }
         .breadcrumb-home {
         display: flex;
         align-items: center;
         gap: 0.25rem;
         color: var(--text-secondary);
         text-decoration: none;
         padding: 0.25rem 0.5rem;
         border-radius: 4px;
         transition: all 0.2s ease;
         }
         .breadcrumb-home:hover {
         color: var(--product-accent);
         background-color: var(--background-hover);
         }
         .breadcrumb-home .icon {
         font-size: 16px;
         }
         .breadcrumb-section-info {
         margin-left: auto;
         display: flex;
         align-items: center;
         gap: 1rem;
         font-size: 0.8rem;
         color: var(--text-secondary);
         }
         .breadcrumb-progress {
         display: flex;
         align-items: center;
         gap: 0.25rem;
         }
         .breadcrumb-progress-bar {
         width: 60px;
         height: 4px;
         background-color: var(--border-color);
         border-radius: 2px;
         overflow: hidden;
         }
         .breadcrumb-progress-fill {
         height: 100%;
         background-color: var(--product-accent);
         width: 0%;
         transition: width 0.3s ease;
         }
         /* Mobile adjustments for breadcrumb */
         @media (max-width: 768px) {
         .breadcrumb-container {
         padding: 0.4rem 1rem;
         }
         .breadcrumb {
         font-size: 0.75rem;
         }
         .breadcrumb-section-info {
         display: none;
         }
         .breadcrumb-link {
         padding: 0.2rem 0.4rem;
         }
         }
         @media (max-width: 480px) {
         .breadcrumb-container {
         padding: 0.3rem 1rem;
         }
         .breadcrumb {
         font-size: 0.7rem;
         gap: 0.25rem;
         }
         .breadcrumb-link {
         padding: 0.15rem 0.3rem;
         max-width: 100px;
         overflow: hidden;
         text-overflow: ellipsis;
         white-space: nowrap;
         }
         }
         /* --- TAB STYLES --- */
         .tab-navigation-container {
         position: sticky; top: 62px; /* After header (which now includes breadcrumb) */
         background-color: var(--background-card);
         z-index: 101;
         border-bottom: 1px solid var(--border-color);
         width: 100vw; margin-left: calc(-50vw + 50%);
         transition: background-color 0.3s ease, border-color 0.3s ease;
         }
         .tab-nav-scroller { overflow-x: auto; scrollbar-width: thin; scrollbar-color: var(--border-color) transparent; padding: 0 1.5rem; }
         .tab-navigation { display: flex; flex-wrap: nowrap; white-space: nowrap; margin: 0; padding: 0; list-style: none; }
         .tab-link { padding: 0.75rem 0; margin: 0 1.25rem; cursor: pointer; background: none; border: none; border-bottom: 3px solid transparent; color: var(--text-secondary); font-size: 0.9rem; font-weight: 500; transition: color 0.2s ease, border-color 0.2s ease; margin-bottom: -1px; text-align: center; }
         
         
         .tab-link:hover { color: var(--product-accent); }
         .tab-link.active { color: var(--product-accent); border-bottom-color: var(--product-accent); }
         .tab-link:first-child { margin-left: 0; } .tab-link:last-child { margin-right: 0; }
         .tab-content { padding-top: 2rem; }
         .tab-pane { display: none; animation: fadeIn 0.5s ease; }
         .tab-pane.active { display: block; }
         .tab-link span {font-weight: 550; }
         @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
         .product-section { margin-bottom: 3rem; background: var(--background-card); border-radius: 8px; border: 1px solid var(--border-color); padding: 0 2rem; transition: background-color 0.3s ease, border-color 0.3s ease; }
         /* --- TABLES --- */
         .table-container { width: 100%; overflow-x: auto; margin: 1.5rem 0; border: 1px solid var(--border-color); border-radius: 8px; transition: border-color 0.3s ease; }
         table { width: 100%; border-collapse: collapse; min-width: 650px; }
         th, td { padding: 12px 16px; text-align: left; vertical-align: middle; font-size: 0.875rem; border-bottom: 1px solid var(--border-color); transition: border-color 0.3s ease;}
         th { background-color: var(--background-main); color: var(--text-primary); font-weight: 500; position: sticky; top: 0; z-index: 10; transition: background-color 0.3s ease, color 0.3s ease; }
         tr:last-child td { border-bottom: none; }
         tr:hover { background-color: var(--background-hover); }
         td strong { color: var(--text-primary); font-weight: 500; }
         td .icon { margin-left: -4px; }

         /* Sortable table styles */
         th[data-sort-direction="asc"],
         th[data-sort-direction="desc"] {
            background-color: rgba(0, 113, 206, 0.1);
         }
         th .sort-indicator {
            transition: transform 0.2s ease, opacity 0.2s ease;
         }
         th:hover .sort-indicator {
            opacity: 1 !important;
         }
         th:hover {
            background-color: rgba(0, 113, 206, 0.05);
         }
         tbody tr.sort-highlight {
            animation: highlightRow 1s ease;
         }
         @keyframes highlightRow {
            0% { background-color: rgba(0, 113, 206, 0.1); }
            100% { background-color: transparent; }
         }
         
         /* Table grouping styles */
         .table-group-controls {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 0px;
            padding: 8px 12px;
            background-color: var(--background-main);
            border-radius: 6px;
            border: 1px solid var(--border-color);
            transition: border-color 0.3s ease, background-color 0.3s ease;
         }
         
         .group-title {
            display: flex;
            align-items: center;
            gap: 6px;
            font-weight: 500;
            color: var(--text-primary);
            font-size: 0.9rem;
         }
         
         .group-options {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
         }
         
         .group-option {
            padding: 4px 10px;
            border-radius: 4px;
            border: 1px solid var(--border-color);
            background-color: var(--background-card);
            color: var(--text-secondary);
            cursor: pointer;
            font-size: 0.8rem;
            transition: all 0.2s ease;
         }
         
         .group-option:hover {
            background-color: var(--background-hover);
            color: var(--text-primary);
         }
         
         .group-option.active {
            background-color: var(--product-accent);
            color: white;
            border-color: var(--product-accent);
            font-weight: 500;
         }
         
         tr.group-header {
            background-color: rgba(0, 113, 206, 0.08);
            cursor: pointer;
            user-select: none;
            transition: all 0.2s ease;
            border-radius: 4px;
            border-left: 3px solid rgba(0, 113, 206, 0.6);
         }
         
         tr.group-header:hover {
            background-color: rgba(0, 113, 206, 0.15);
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
         }
         
         tr.group-header.collapsed {
            background-color: rgba(0, 113, 206, 0.12);
            border-left-color: rgba(0, 113, 206, 0.6);
            margin-bottom: 0;
            border-bottom: 2px solid rgba(0, 113, 206, 0.4);
            position: relative; /* For the ::after pseudo-element */
         }
         
         tr.group-header.collapsed:hover {
            background-color: rgba(0, 113, 206, 0.18);
         }
         
         /* Add visual indicator of collapsed rows below */
         tr.group-header.collapsed::after {
            content: "";
            height: 3px;
            background: linear-gradient(to right, rgba(0, 113, 206, 0.4), rgba(0, 113, 206, 0.1), transparent);
            display: block;
            position: relative;
            margin-top: 2px;
         }
         
         /* Add a more prominent indicator for collapsed content */
         tr.group-header.collapsed td:first-child {
            position: relative;
         }
         
         tr.group-header.collapsed td:first-child::before {
            content: "▾"; /* Down-pointing triangle */
            position: absolute;
            right: 10px;
            color: rgba(0, 113, 206, 0.6);
            font-size: 12px;
         }
         
         .group-header-content {
            display: flex;
            align-items: center;
            padding: 4px 0;
            flex-wrap: wrap;
         }
         
         .group-header-title {
            font-weight: 500;
            color: var(--text-primary);
            margin-right: 8px;
         }
         
         .group-count {
            font-size: 0.75rem;
            color: var(--text-secondary);
            background-color: var(--background-card);
            padding: 2px 8px;
            border-radius: 12px;
            border: 1px solid var(--border-color);
         }
         
         .group-toggle {
            margin-right: 10px;
            transition: all 0.3s ease;
            color: rgba(0, 113, 206, 0.8);
            font-weight: bold;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            background-color: rgba(0, 113, 206, 0.1);
            width: 26px;
            height: 26px;
            border-radius: 50%;
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
            font-size: 18px;
         }
         
         tr.group-header:hover .group-toggle {
            background-color: rgba(0, 113, 206, 0.2);
            transform: scale(1.1);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.15);
         }
         
         tr.group-header.collapsed .group-toggle {
            transform: rotate(-90deg);
            color: rgba(0, 113, 206, 0.6);
            background-color: rgba(0, 113, 206, 0.05);
         }
         
         /* Simplify the animation */
         tr.group-header.collapsed:hover .group-toggle {
            background-color: rgba(0, 113, 206, 0.15);
            transform: rotate(-90deg) scale(1.05);
         }
         
         /* Styles for grouped rows */
         tr[data-group] {
            transition: all 0.3s ease;
         }
         
         /* Collapsed rows - completely hidden */
         tbody tr.collapsed-row {
            display: none !important;
         }
         
         tr.first-in-group {
            border-top: 1px solid rgba(0, 113, 206, 0.1);
         }
         
         @media (max-width: 768px) {
            .table-group-controls {
               flex-direction: column;
               align-items: flex-start;
               gap: 8px;
            }
            
            .group-options {
               width: 100%;
            }
         }
         
         /* Table Pagination Styles */
         .table-pagination {
            margin-top: 1rem;
            border-top: 1px solid var(--border-color);
            padding-top: 0.75rem;
         }
         
         .pagination-top-controls {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 0.75rem;
            padding-left:12px;
            padding-right: 12px;
         }
         
         .page-size-selector {
            display: flex;
            align-items: center;
            gap: 0.5rem;
         }
         
         .page-size-label {
            font-size: 0.875rem;
            color: var(--text-secondary);
         }
         
         .page-size-select {
            padding: 0.25rem 0.5rem;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            background-color: var(--background-card);
            color: var(--text-primary);
            font-size: 0.875rem;
            cursor: pointer;
         }
         
         .page-size-select:focus {
            outline: none;
            border-color: var(--product-accent);
            box-shadow: 0 0 0 2px rgba(0, 113, 206, 0.1);
         }
         
         .pagination-info {
            font-size: 0.875rem;
            color: var(--text-secondary);
         }
         
         .pagination-nav {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.25rem;
            padding: 8px 0;
            background-color: #f8f9fa;
            border-radius: 8px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.05);
         }
         
         .pagination-button {
            min-width: 36px;
            height: 36px;
            padding: 0;
            border: none;
            border-radius: 4px;
            background-color: transparent;
            color: var(--product-accent);
            font-size: 0.875rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
            margin: 0 2px;
         }
         
         .pagination-button:hover:not(:disabled) {
            background-color: rgba(0, 113, 206, 0.08);
            color: var(--product-accent);
         }
         
         .pagination-button {
            background-color: var(--product-accent);
            color: white;
            font-weight: 500;
         }
         
         /* Navigation buttons styling */
         .pagination-button.prev,
         .pagination-button.next,
         .pagination-button.first,
         .pagination-button.last {
            background-color: transparent;
            border-radius: 50%;
         }
         
         /* Number buttons styling */
         .pagination-button.page-number {
            font-family: 'Roboto', Arial, sans-serif;
            font-weight: 500;
         }
         
         .pagination-button.ellipsis {
            cursor: default;
            min-width: 24px;
         }
         
         .pagination-button.ellipsis:hover {
            background-color: transparent;
         }
         
         .pagination-button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            color: var(--text-secondary);
         }
         
         .pagination-button.prev,
         .pagination-button.next,
         .pagination-button.first,
         .pagination-button.last {
            background-color: transparent;
            border: none;
         }
         
         .pagination-button.prev:hover:not(:disabled),
         .pagination-button.next:hover:not(:disabled),
         .pagination-button.first:hover:not(:disabled),
         .pagination-button.last:hover:not(:disabled) {
            background-color: rgba(0, 113, 206, 0.08);
            border: none;
         }
         
         .pagination-button .icon {
            font-size: 20px;
            margin: 0;
            font-family: 'Material Symbols Outlined', sans-serif !important;
            vertical-align: middle;
            font-style: normal;
         }
         
         .icon {
            font-family: 'Material Symbols Outlined', sans-serif !important;
            font-weight: normal;
            font-style: normal;
            line-height: 1;
            text-transform: none;
            letter-spacing: normal;
            word-wrap: normal;
            white-space: nowrap;
            direction: ltr;
            display: inline-block;
            text-rendering: auto;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
         }
         
         /* Ensure Material Symbols are properly applied */
         span.material-symbols-outlined,
         .material-symbols-outlined {
            font-family: 'Material Symbols Outlined', sans-serif !important;
            font-weight: normal;
            font-style: normal;
            font-size: 20px;
            line-height: 1;
            letter-spacing: normal;
            text-transform: none;
            display: inline-block;
            white-space: nowrap;
            word-wrap: normal;
            direction: ltr;
            font-feature-settings: 'liga';
            -webkit-font-feature-settings: 'liga';
            -webkit-font-smoothing: antialiased;
         }
         
         .pagination-button.ellipsis {
            cursor: default;
            color: var(--text-secondary);
         }
         
         .pagination-button.ellipsis:hover {
            background-color: transparent;
         }
         
         /* Mobile adjustments for pagination */
         @media (max-width: 768px) {
            .pagination-top-controls {
               flex-direction: column;
               align-items: flex-start;
               gap: 0.5rem;
            }
            
            .pagination-info {
               margin-top: 0.25rem;
            }
            
            .pagination-button {
               min-width: 32px;
               height: 32px;
            }
         }
         
         @media (max-width: 480px) {
            .pagination-button:not(.prev):not(.next):not(.active):not(.first):not(.last) {
               display: none;
            }
            
            .pagination-button.ellipsis:first-of-type,
            .pagination-button.ellipsis:last-of-type {
               display: flex;
            }
            
            .pagination-nav {
               width: 100%;
               justify-content: space-between;
            }
         }
         /* --- FLOATING TABLE OF CONTENTS --- */
         .floating-toc {
         position: fixed;
         top: 50%;
         right: 20px;
         transform: translateY(-50%);
         background-color: var(--background-card);
         border: 1px solid var(--border-color);
         border-radius: 12px;
         padding: 1rem;
         max-width: 280px;
         min-width: 240px;
         max-height: 70vh;
         overflow-y: auto;
         z-index: 1001;
         box-shadow: 0 8px 32px rgba(0,0,0,0.12);
         opacity: 0;
         visibility: hidden;
         transition: opacity 0.3s ease, visibility 0.3s ease, transform 0.3s ease;
         backdrop-filter: blur(8px);
         }
         .floating-toc.show {
         opacity: 1;
         visibility: visible;
         }
         .floating-toc-header {
         display: flex;
         align-items: center;
         justify-content: space-between;
         margin-bottom: 1rem;
         padding-bottom: 0.5rem;
         border-bottom: 1px solid var(--border-color);
         }
         .floating-toc-title {
         font-size: 0.875rem;
         font-weight: 600;
         color: var(--text-primary);
         display: flex;
         align-items: center;
         gap: 0.5rem;
         }
         .floating-toc-close {
         background: none;
         border: none;
         cursor: pointer;
         padding: 4px;
         border-radius: 4px;
         color: var(--text-secondary);
         transition: background-color 0.2s ease, color 0.2s ease;
         }
         .floating-toc-close:hover {
         background-color: var(--background-hover);
         color: var(--text-primary);
         }
         .floating-toc-list {
         list-style: none;
         padding: 0;
         margin: 0;
         }
         .floating-toc-item {
         margin-bottom: 0.5rem;
         }
         .floating-toc-link {
         display: block;
         padding: 0.5rem 0.75rem;
         text-decoration: none;
         color: var(--text-secondary);
         font-size: 0.8rem;
         line-height: 1.4;
         border-radius: 6px;
         transition: all 0.2s ease;
         cursor: pointer;
         position: relative;
         border-left: 3px solid transparent;
         }
         .floating-toc-link:hover {
         background-color: var(--background-hover);
         color: var(--text-primary);
         }
         .floating-toc-link.active {
         background-color: rgba(0, 113, 206, 0.1);
         color: var(--product-accent);
         border-left-color: var(--product-accent);
         font-weight: 500;
         }
         .floating-toc-progress {
         position: absolute;
         right: 0.5rem;
         top: 50%;
         transform: translateY(-50%);
         width: 20px;
         height: 20px;
         border-radius: 50%;
         background-color: var(--border-color);
         border: 2px solid var(--background-card);
         transition: all 0.2s ease;
         }
         .floating-toc-link.active .floating-toc-progress {
         background-color: var(--product-accent);
         }
         .floating-toc-progress-fill {
         position: absolute;
         top: 2px;
         left: 2px;
         right: 2px;
         bottom: 2px;
         border-radius: 50%;
         background-color: var(--product-accent);
         transform: scale(0);
         transition: transform 0.2s ease;
         }
         .floating-toc-link.reading .floating-toc-progress-fill {
         transform: scale(1);
         }
         .floating-toc-toggle {
         position: fixed;
         top: 50%;
         right: 20px;
         transform: translateY(-50%);
         background-color: var(--product-accent);
         color: var(--background-button-text);
         border: none;
         border-radius: 50%;
         width: 48px;
         height: 48px;
         display: flex;
         align-items: center;
         justify-content: center;
         cursor: pointer;
         z-index: 1002;
         box-shadow: 0 4px 16px rgba(0,0,0,0.15);
         opacity: 0;
         visibility: hidden;
         transition: all 0.3s ease;
         }
         .floating-toc-toggle.show {
         opacity: 1;
         visibility: visible;
         }
         .floating-toc-toggle:hover {
         background-color: var(--product-accent-hover);
         transform: translateY(-50%) scale(1.05);
         }
         /* --- FULL-SCREEN READING MODE --- */
         .fullscreen-reading-mode {
         position: fixed;
         top: 0;
         left: 0;
         right: 0;
         bottom: 0;
         background-color: var(--background-main);
         z-index: 2000;
         overflow-y: auto;
         padding: 2rem;
         opacity: 0;
         visibility: hidden;
         transition: opacity 0.3s ease, visibility 0.3s ease;
         }
         .fullscreen-reading-mode.active {
         opacity: 1;
         visibility: visible;
         }
         .fullscreen-reading-content {
         max-width: 800px;
         margin: 0 auto;
         line-height: 1.8;
         font-size: 1.1rem;
         color: var(--text-primary);
         }
         .fullscreen-reading-content h2 {
         font-size: 2rem;
         margin-bottom: 1.5rem;
         color: var(--text-primary);
         border-bottom: 2px solid var(--product-accent);
         padding-bottom: 0.5rem;
         }
         .fullscreen-reading-content h3 {
         font-size: 1.5rem;
         margin-top: 2rem;
         margin-bottom: 1rem;
         color: var(--text-primary);
         }
         .fullscreen-reading-content h4 {
         font-size: 1.25rem;
         margin-top: 1.5rem;
         margin-bottom: 0.75rem;
         color: var(--text-primary);
         }
         .fullscreen-reading-content p {
         margin-bottom: 1.5rem;
         text-align: justify;
         color: var(--text-secondary);
         }
         .fullscreen-reading-content table {
         margin: 2rem 0;
         font-size: 0.95rem;
         }
         .fullscreen-reading-controls {
         position: fixed;
         top: 20px;
         right: 20px;
         display: flex;
         gap: 0.5rem;
         z-index: 2001;
         }
         .fullscreen-reading-control {
         background-color: var(--background-card);
         border: 1px solid var(--border-color);
         border-radius: 8px;
         padding: 0.5rem;
         cursor: pointer;
         color: var(--text-secondary);
         transition: all 0.2s ease;
         backdrop-filter: blur(8px);
         }
         .fullscreen-reading-control:hover {
         background-color: var(--background-hover);
         color: var(--text-primary);
         }
         .fullscreen-reading-exit {
         background-color: var(--product-accent);
         color: var(--background-button-text);
         }
         .fullscreen-reading-exit:hover {
         background-color: var(--product-accent-hover);
         }
         .fullscreen-reading-progress {
         position: fixed;
         bottom: 20px;
         left: 50%;
         transform: translateX(-50%);
         background-color: var(--background-card);
         border: 1px solid var(--border-color);
         border-radius: 20px;
         padding: 0.5rem 1rem;
         font-size: 0.875rem;
         color: var(--text-secondary);
         backdrop-filter: blur(8px);
         z-index: 2001;
         }
         .fullscreen-font-controls {
         position: fixed;
         top: 20px;
         left: 20px;
         display: flex;
         gap: 0.5rem;
         z-index: 2001;
         }
         .fullscreen-font-control {
         background-color: var(--background-card);
         border: 1px solid var(--border-color);
         border-radius: 8px;
         padding: 0.5rem;
         cursor: pointer;
         color: var(--text-secondary);
         transition: all 0.2s ease;
         backdrop-filter: blur(8px);
         min-width: 40px;
         text-align: center;
         }
         .fullscreen-font-control:hover {
         background-color: var(--background-hover);
         color: var(--text-primary);
         }
         /* Hide UI elements when in fullscreen reading mode */
         body.fullscreen-reading .header,
         body.fullscreen-reading .product-header,
         body.fullscreen-reading .tab-navigation-container,
         body.fullscreen-reading .footer,
         body.fullscreen-reading .floating-toc,
         body.fullscreen-reading .floating-toc-toggle,
         body.fullscreen-reading #back-to-top,
         body.fullscreen-reading .reading-progress,
         body.fullscreen-reading .reading-progress-text {
         display: none !important;
         }
         /* Mobile adjustments for fullscreen reading */
         @media (max-width: 768px) {
         .fullscreen-reading-mode {
         padding: 1rem;
         }
         .fullscreen-reading-content {
         font-size: 1rem;
         line-height: 1.7;
         }
         .fullscreen-reading-controls {
         top: 10px;
         right: 10px;
         }
         .fullscreen-font-controls {
         top: 10px;
         left: 10px;
         }
         .fullscreen-reading-progress {
         bottom: 10px;
         padding: 0.4rem 0.8rem;
         font-size: 0.8rem;
         }
         }
         /* Hide TOC on smaller screens */
         @media (max-width: 1024px) {
         .floating-toc,
         .floating-toc-toggle {
         display: none !important;
         }
         }
         
         /* Mobile adjustments for reading progress */
         @media (max-width: 768px) {
         .reading-progress-text {
         right: 10px;
         top: 6px;
         font-size: 0.7rem;
         padding: 0.2rem 0.4rem;
         }
         }
         
         @media (max-width: 480px) {
         .reading-progress-text {
         right: 5px;
         top: 4px;
         font-size: 0.65rem;
         padding: 0.15rem 0.3rem;
         max-width: 120px;
         text-overflow: ellipsis;
         overflow: hidden;
         white-space: nowrap;
         }
         }
         /* --- MISC & FOOTER --- */
         .ai-disclaimer { text-align: center; font-style: italic; color: var(--text-secondary); font-size: 0.875rem; margin: -1rem auto -2rem; padding: 0 1rem; line-height: 1.5; }
         #back-to-top {
         position: fixed; bottom: 20px; left: 20px;
         background-color: var(--product-accent); color: var(--background-button-text);
         border: none; border-radius: 50%;
         width: 50px; height: 50px;
         display: none; align-items: center; justify-content: center;
         cursor: pointer; z-index: 1000;
         box-shadow: 0 4px 8px rgba(0,0,0,0.2);
         opacity: 0;
         transition: opacity 0.3s ease, transform 0.3s ease, background-color 0.3s ease;
         }
         #back-to-top.show { opacity: 1; display: flex; }
         #back-to-top:hover { background-color: var(--product-accent-hover); transform: translateY(-2px); }
         .footer { background-color: var(--background-card); color: var(--text-secondary); padding: 2rem 1.5rem; margin-top: 4rem; text-align: center; border-top: 1px solid var(--border-color); transition: background-color 0.3s ease, border-color 0.3s ease;}
         .footer-container { max-width: 1440px; margin: 0 auto; display: flex; flex-direction: column; align-items: center; gap: 1.5rem; }
         .footer-brand { display: flex; align-items: center; gap: 1rem; }
         .footer-logo { height: 32px; }
         .footer-wordmark { font-size: 1rem; font-weight: 500; color: var(--cgd-blue); }
         .footer-copyright { font-size: 0.8rem; }
         .footer-socials { display: flex; gap: 1rem; }
         .footer-socials a { color: var(--text-secondary); text-decoration: none; display: inline-block; transition: color 0.2s ease, transform 0.2s ease; }
         .footer-socials a:hover { color: var(--product-accent); transform: scale(1.1); }
         .footer-socials svg { width: 24px; height: 24px; fill: currentColor; }
         @media (max-width: 768px) {
         .content, .product-header { padding-left: 1rem; padding-right: 1rem; }
         .footer-container { flex-direction: column; text-align: center; gap: 1.5rem; }
         }
         @media print {
         /* Print styles remain largely the same */
         .header, .footer, .tab-navigation-container, .ai-disclaimer, #back-to-top, .header-controls { display: none !important; }
         }
      </style>
   </head>
   <body>
      <!-- Reading Progress Indicator -->
      <div id="reading-progress" class="reading-progress">
         <div id="reading-progress-fill" class="reading-progress-fill"></div>
      </div>
      <div id="reading-progress-text" class="reading-progress-text">
         0% read
      </div>
      
      <header class="header">
         <div class="header-container">
            <div class="header-brand">
               <img src="https://www.cgd.pt/PublishingImages/WSImages/Novo-CGD/logo-ap_Blue.png" alt="CGD Logo" class="header-logo">
            </div>
            <div class="header-controls">
               <div id="tts-controls" style="display: none;">
                  <button id="tts-play-pause-btn" class="icon-button" title="Listen to this section">
                  <span class="icon">play_arrow</span>
                  </button>
                  <button id="tts-stop-btn" class="icon-button" title="Stop listening">
                  <span class="icon">stop</span>
                  </button>
               </div>
               <button id="fullscreen-reading-btn" class="icon-button" title="Enter fullscreen reading mode">
               <span class="icon">fullscreen</span>
               </button>
               <button id="dark-mode-toggle" class="icon-button" title="Toggle dark/light mode">
               <span class="icon">light_mode</span>
               </button>
               <a href="mailto:david.alexandre.rosa@cgd.pt?subject=Support Request for Application Technical Profile&cc=dsi-arquitetura_empresarial@cgd.pt" target="_blank" class="support-button">Ask for Support</a>
            </div>
         </div>
         
         <!-- Breadcrumb Navigation integrated in header -->
         <div id="breadcrumb-container" class="breadcrumb-container">
            <nav class="breadcrumb" aria-label="Breadcrumb navigation">
               <a href="#" id="breadcrumb-home" class="breadcrumb-home" title="Go to overview">
                  <span class="icon">home</span>
                  <span>Overview</span>
               </a>
               <span class="breadcrumb-separator">›</span>
               <div id="breadcrumb-current" class="breadcrumb-item">
                  <span class="breadcrumb-link active">Current Section</span>
               </div>
               <div class="breadcrumb-section-info">
                  <div class="breadcrumb-progress">
                     <span class="icon">trending_up</span>
                     <div class="breadcrumb-progress-bar">
                        <div id="breadcrumb-progress-fill" class="breadcrumb-progress-fill"></div>
                     </div>
                     <span id="breadcrumb-progress-text">0%</span>
                  </div>
                  <div id="breadcrumb-section-count">
                     Section 1 of 13
                  </div>
               </div>
            </nav>
         </div>
      </header>
      
      <div class="product-header">
         <h1 id="application-technical-profile">Application Technical Profile</h1>
         <p style="font-size: 16px">A structured and in-depth technical overview of the application, capturing key architectural elements, technology stack, system components, and more. This profile serves as a foundational reference for modernization, migration, and governance initiatives.</p>
         <div class="document-meta">
            <div class="read-time" id="total-read-time">
               <span class="icon">schedule</span>
               <span>Calculating...</span>
            </div>
         </div>
      </div>
      <div id="tab-container-placeholder"></div>
      
      <main class="content" id="main-content-area">
<div class="product-section">
<h2 id="1-application-overview">1. Application overview</h2>
This section provides a high-level summary of the application's key attributes, including its purpose, scope, and technical foundations.
<div class="table-container">
<table>
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr>
<th style="text-align: left;">Attribute</th>
<th style="text-align: left;">Value</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>Acronym</strong></td>
<td style="text-align: left;">SDCIM</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Application name</strong></td>
<td style="text-align: left;">Service Desk Customer Incident Management</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Primary business purpose</strong></td>
<td style="text-align: left;">A back-office system to process, manage, and monitor financial remittances (likely cheques), handle alerts, and provide user interfaces for operational control and reporting.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Business domain</strong></td>
<td style="text-align: left;">Banking, Financial Services, Remittance Processing</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Solution files</strong></td>
<td style="text-align: left;">2 solutions found: <code>CIControloComSetup.sln</code>, <code>CIControloSemSetup.sln</code></td>
</tr>
<tr>
<td style="text-align: left;"><strong>Project files</strong></td>
<td style="text-align: left;">18 projects found: <code>CIControlo.csproj</code>, <code>QueryForm.csproj</code>, <code>CIConfigGlobalParameters.csproj</code>, <code>CIConfiguration.csproj</code>, <code>CIActividades.csproj</code>, <code>CIReports.csproj</code>, <code>Alerta.csproj</code>, <code>CIServRemessas.csproj</code>, <code>CIServTester.csproj</code>, <code>CIServAlertas.csproj</code>, <code>CIServico.csproj</code>, <code>CIFicheirosControlo.csproj</code>, <code>CIFicheiro.csproj</code>, <code>MDIsControlo.csproj</code>, <code>MDIWebTransmCI.vbproj</code>, <code>CITestes.csproj</code>, <code>CIDepositoErro.csproj</code>, <code>SetupCIControlo.vdproj</code></td>
</tr>
<tr>
<td style="text-align: left;"><strong>Files</strong></td>
<td style="text-align: left;">73 files analyzed: C# source files (.cs), VB.NET source files (.vb), C# project files (.csproj), VB.NET project files (.vbproj), Solution files (.sln), Configuration files (.config, .settings), Resource files (.resx), SQL files (.sql), Batch scripts (.bat)</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Main programming language(s)</strong></td>
<td style="text-align: left;">C#, VB.NET</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Target .NET Framework(s)</strong></td>
<td style="text-align: left;">.NET Framework 4.0</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Application type</strong></td>
<td style="text-align: left;">Windows Forms, Windows Service, Class Library</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Output type</strong></td>
<td style="text-align: left;">.dll (Dynamic Link Library), .exe (Executable)</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Deployment model</strong></td>
<td style="text-align: left;">On-premises (inferred from server names in config and installation scripts)</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Deployment target platform</strong></td>
<td style="text-align: left;">AnyCPU</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Complexity</strong></td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High complexity</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Last updated (Source code)</strong></td>
<td style="text-align: left;">2008-2009 (inferred from copyright notices and file content)</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Last updated (Documentation)</strong></td>
<td style="text-align: left;">2025-08-06</td>
</tr>
</tbody>
</table>
</div>
<h3 id="11-main-components-and-features">1.1. Main components and features</h3>
The application is composed of several interconnected components, each responsible for a distinct functional area. These components work together to form a comprehensive remittance processing and monitoring system.
<div class="table-container">
<table>
<colgroup>
<col style="width: 16%" />
<col style="width: 16%" />
<col style="width: 16%" />
<col style="width: 16%" />
<col style="width: 16%" />
<col style="width: 16%" />
</colgroup>
<thead>
<tr>
<th style="text-align: left;">Component</th>
<th style="text-align: left;">Description</th>
<th style="text-align: left;">Key features</th>
<th style="text-align: left;">Dependencies</th>
<th style="text-align: left;">Related projects</th>
<th style="text-align: left;">Technologies</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>Main Control Panel</strong></td>
<td style="text-align: left;">Provides the primary user interface for monitoring and managing system activities.</td>
<td style="text-align: left;">- Dashboard for viewing remittances, tranches, and documents.<br>- Manual state changes for processing workflows.<br>- User and configuration management.</td>
<td style="text-align: left;"><code>CIConfigGlobalParameters</code>, <code>CIActividades</code></td>
<td style="text-align: left;"><code>CIControlo.csproj</code></td>
<td style="text-align: left;">Windows Forms</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Remittance Processing</strong></td>
<td style="text-align: left;">Core engine for handling remittance data, processing tranches, and managing document lifecycle.</td>
<td style="text-align: left;">- Process remittances from various sources (GCCA, Balcão).<br>- Create and manage tranches.<br>- Handle processing errors and retries.</td>
<td style="text-align: left;"><code>CIConfigGlobalParameters</code>, <code>CIActividades</code></td>
<td style="text-align: left;"><code>CIServRemessas.csproj</code>, <code>CIServico.csproj</code></td>
<td style="text-align: left;">.NET Class Library</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Alerting System</strong></td>
<td style="text-align: left;">Manages system-generated alerts based on predefined situations and triggers actions.</td>
<td style="text-align: left;">- Defines alert situations and corresponding actions (Email, DB Log, Event Viewer).<br>- Processes pending alerts.</td>
<td style="text-align: left;"><code>CIConfigGlobalParameters</code></td>
<td style="text-align: left;"><code>Alerta.csproj</code>, <code>CIServAlertas.csproj</code></td>
<td style="text-align: left;">.NET Class Library</td>
</tr>
<tr>
<td style="text-align: left;"><strong>File Processing</strong></td>
<td style="text-align: left;">Handles the ingestion and processing of external files like ENVM and ACOM.</td>
<td style="text-align: left;">- Monitors directories for new files.<br>- Parses fixed-width file formats.<br>- Manages file backup and error handling.</td>
<td style="text-align: left;"><code>CIConfigGlobalParameters</code></td>
<td style="text-align: left;"><code>CIFicheiro.csproj</code>, <code>CIFicheirosControlo.csproj</code></td>
<td style="text-align: left;">.NET Class Library</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Configuration & Security</strong></td>
<td style="text-align: left;">Manages global parameters, database connections, and user access.</td>
<td style="text-align: left;">- User authentication and authorization.<br>- Centralized configuration settings for different environments (DVP, QLD, PRD).</td>
<td style="text-align: left;"><code>GenericNet</code></td>
<td style="text-align: left;"><code>CIConfigGlobalParameters.csproj</code>, <code>CIConfiguration.csproj</code></td>
<td style="text-align: left;">.NET Class Library</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Reporting</strong></td>
<td style="text-align: left;">Generates Crystal Reports for business intelligence and operational oversight.</td>
<td style="text-align: left;">- List of remittances.<br>- Summary of shipments.<br>- Monthly billing reports.</td>
<td style="text-align: left;"><code>CrystalDecisions</code></td>
<td style="text-align: left;"><code>CIReports.csproj</code></td>
<td style="text-align: left;">.NET Class Library</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Testing Framework</strong></td>
<td style="text-align: left;">Contains unit tests for validating the functionality of core components.</td>
<td style="text-align: left;">- Tests for remittance processing logic.</td>
<td style="text-align: left;"><code>Microsoft.VisualStudio.TestTools.UnitTesting</code></td>
<td style="text-align: left;"><code>CITestes.csproj</code></td>
<td style="text-align: left;">MSTest</td>
</tr>
</tbody>
</table>
</div>
<pre class="mermaid"><code>flowchart TD
    subgraph "User Interaction"
        CIControlo["CIControlo.csproj (WinForms UI)"]
    end

    subgraph "Core Services"
        CIServico["CIServico.csproj (Windows Service)"]
        CIServRemessas["CIServRemessas.csproj (Remittance Logic)"]
        CIServAlertas["CIServAlertas.csproj (Alerting Logic)"]
    end

    subgraph "Data & File Processing"
        CIFicheiro["CIFicheiro.csproj (File Parsers)"]
        CIFicheirosControlo["CIFicheirosControlo.csproj (File Monitors)"]
    end

    subgraph "Shared Libraries"
        CIConfigGlobalParameters["CIConfigGlobalParameters.csproj (Shared Config)"]
        Alerta["Alerta.csproj (Alerting Model)"]
        CIActividades["CIActividades.csproj (Business Logic)"]
        CIConfiguration["CIConfiguration.csproj (Config UI)"]
        MDIWebTransmCI["MDIWebTransmCI.vbproj (Web Svc Client)"]
    end
    
    subgraph "External Systems"
        Database[(Database)]
        FileSystem[/File System/]
        WebService[External Web Service]
    end

    CIControlo --> CIActividades
    CIControlo --> CIConfiguration
    
    CIServico -->|"Triggers"| CIServRemessas
    CIServico -->|"Triggers"| CIServAlertas
    CIServico -->|"Triggers"| CIFicheirosControlo

    CIServRemessas --> CIConfigGlobalParameters
    CIServRemessas --> Database
    
    CIServAlertas --> Alerta
    Alerta --> Database

    CIFicheirosControlo --> CIFicheiro
    CIFicheiro --> FileSystem

    CIActividades --> MDIWebTransmCI
    MDIWebTransmCI --> WebService
</code></pre>
<center>Figure 1 - High-level component diagram showing the main interactions within the SDCIM application.</center>
<h3 id="12-solutions">1.2. Solutions</h3>
The codebase is organized into two main solution files, likely for development with and without the setup project.
<div class="table-container">
<table>
<colgroup>
<col style="width: 33%" />
<col style="width: 33%" />
<col style="width: 33%" />
</colgroup>
<thead>
<tr>
<th style="text-align: left;">Solution</th>
<th style="text-align: left;">Projects</th>
<th style="text-align: left;">Visual studio version</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>CIControloComSetup.sln</strong></td>
<td style="text-align: left;">- <code>CIControlo.csproj</code><br>- <code>QueryForm.csproj</code><br>- <code>CIConfigGlobalParameters.csproj</code><br>- <code>CIConfiguration.csproj</code><br>- <code>CIActividades.csproj</code><br>- <code>CIReports.csproj</code><br>- <code>Alerta.csproj</code><br>- <code>CIServRemessas.csproj</code><br>- <code>CIServTester.csproj</code><br>- <code>CIServAlertas.csproj</code><br>- <code>CIServico.csproj</code><br>- <code>CIFicheirosControlo.csproj</code><br>- <code>CIFicheiro.csproj</code><br>- <code>MDIsControlo.csproj</code><br>- <code>MDIWebTransmCI.vbproj</code><br>- <code>SetupCIControlo.vdproj</code></td>
<td style="text-align: left;">2010</td>
</tr>
<tr>
<td style="text-align: left;"><strong>CIControloSemSetup.sln</strong></td>
<td style="text-align: left;">- <code>CIControlo.csproj</code><br>- <code>QueryForm.csproj</code><br>- <code>CIConfigGlobalParameters.csproj</code><br>- <code>CIConfiguration.csproj</code><br>- <code>CIActividades.csproj</code><br>- <code>CIReports.csproj</code><br>- <code>Alerta.csproj</code><br>- <code>CIServRemessas.csproj</code><br>- <code>CIServTester.csproj</code><br>- <code>CIServAlertas.csproj</code><br>- <code>CIServico.csproj</code><br>- <code>CIFicheirosControlo.csproj</code><br>- <code>CIFicheiro.csproj</code><br>- <code>MDIsControlo.csproj</code><br>- <code>MDIWebTransmCI.vbproj</code><br>- <code>CITestes.csproj</code><br>- <code>CIDepositoErro.csproj</code></td>
<td style="text-align: left;">2010</td>
</tr>
</tbody>
</table>
</div>
<pre class="mermaid"><code>mindmap
  root((SDCIM Application))
    CIControloComSetup.sln
      CIControlo.csproj
      CIActividades.csproj
      CIServico.csproj
      CIConfiguration.csproj
      CIReports.csproj
      Alerta.csproj
      SetupCIControlo.vdproj
      ("16 projects total")
    CIControloSemSetup.sln
      CIControlo.csproj
      CIActividades.csproj
      CIServico.csproj
      CITestes.csproj
      CIDepositoErro.csproj
      ("18 projects total")
</code></pre>
<center>Figure 2 - Mind map illustrating the two solutions and a sample of their key projects.</center>
<h3 id="13-projects">1.3. Projects</h3>
This section details the individual projects within the solutions, outlining their purpose, dependencies, and key characteristics.
<div class="table-container">
<table>
<colgroup>
<col style="width: 7%" />
<col style="width: 7%" />
<col style="width: 7%" />
<col style="width: 7%" />
<col style="width: 7%" />
<col style="width: 7%" />
<col style="width: 7%" />
<col style="width: 7%" />
<col style="width: 7%" />
<col style="width: 7%" />
<col style="width: 7%" />
<col style="width: 7%" />
<col style="width: 7%" />
</colgroup>
<thead>
<tr>
<th style="text-align: left;">Solution</th>
<th style="text-align: left;">Project</th>
<th style="text-align: left;">Main objectives</th>
<th style="text-align: left;">Type</th>
<th style="text-align: left;">Output type</th>
<th style="text-align: left;">Version</th>
<th style="text-align: left;">Runtime</th>
<th style="text-align: left;">Framework</th>
<th style="text-align: left;">Architecture</th>
<th style="text-align: left;">Compilation mode</th>
<th style="text-align: left;">Principal classes</th>
<th style="text-align: left;">Internal dependencies</th>
<th style="text-align: left;">External dependencies</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;">CIControloSemSetup.sln</td>
<td style="text-align: left;"><strong>CIControlo.csproj</strong></td>
<td style="text-align: left;">Main executable for the Windows Forms control panel application.</td>
<td style="text-align: left;">Windows Application</td>
<td style="text-align: left;">Executable</td>
<td style="text-align: left;">1.0.0.0</td>
<td style="text-align: left;">v4.0.30319</td>
<td style="text-align: left;">.NET Framework 4.0</td>
<td style="text-align: left;">AnyCPU</td>
<td style="text-align: left;">Debug/Release</td>
<td style="text-align: left;"><code>CIMainForm</code></td>
<td style="text-align: left;"><code>CIActividades</code>, <code>CIConfiguration</code>, <code>CIServTester</code>, <code>MDIsControlo</code>, <code>QueryForm</code></td>
<td style="text-align: left;"><code>GenericNet</code>, <code>NBIISNET</code></td>
</tr>
<tr>
<td style="text-align: left;">CIControloSemSetup.sln</td>
<td style="text-align: left;"><strong>CIActividades.csproj</strong></td>
<td style="text-align: left;">Contains the core business logic and UI forms for monitoring activities.</td>
<td style="text-align: left;">Class Library</td>
<td style="text-align: left;">Library</td>
<td style="text-align: left;">1.0.0.0</td>
<td style="text-align: left;">v4.0.30319</td>
<td style="text-align: left;">.NET Framework 4.0</td>
<td style="text-align: left;">AnyCPU</td>
<td style="text-align: left;">Debug/Release</td>
<td style="text-align: left;"><code>ActividadesForm</code>, <code>ActividadeBalcaoForm</code></td>
<td style="text-align: left;"><code>Alerta</code>, <code>CIConfigGlobalParameters</code></td>
<td style="text-align: left;"><code>GenericNet</code>, <code>NBIISNET</code>, <code>CrystalDecisions</code></td>
</tr>
<tr>
<td style="text-align: left;">CIControloSemSetup.sln</td>
<td style="text-align: left;"><strong>CIServico.csproj</strong></td>
<td style="text-align: left;">A Windows Service responsible for running background processing tasks.</td>
<td style="text-align: left;">Windows Service</td>
<td style="text-align: left;">Executable</td>
<td style="text-align: left;">1.0.0.0</td>
<td style="text-align: left;">v4.0.30319</td>
<td style="text-align: left;">.NET Framework 4.0</td>
<td style="text-align: left;">AnyCPU</td>
<td style="text-align: left;">Debug/Release</td>
<td style="text-align: left;"><code>CIServico</code>, <code>CIServicoThread</code></td>
<td style="text-align: left;"><code>CIServRemessas</code>, <code>CIServAlertas</code>, <code>CIFicheiro</code></td>
<td style="text-align: left;"><code>GenericNet</code>, <code>NBIISNET</code></td>
</tr>
<tr>
<td style="text-align: left;">CIControloSemSetup.sln</td>
<td style="text-align: left;"><strong>Alerta.csproj</strong></td>
<td style="text-align: left;">Defines the data model and classes for the alerting system.</td>
<td style="text-align: left;">Class Library</td>
<td style="text-align: left;">Library</td>
<td style="text-align: left;">1.0.0.0</td>
<td style="text-align: left;">v4.0.30319</td>
<td style="text-align: left;">.NET Framework 4.0</td>
<td style="text-align: left;">AnyCPU</td>
<td style="text-align: left;">Debug/Release</td>
<td style="text-align: left;"><code>Accao</code>, <code>AlertaSituacaoAccao</code></td>
<td style="text-align: left;"><code>CIConfigGlobalParameters</code></td>
<td style="text-align: left;"><code>GenericNet</code>, <code>System.Data</code></td>
</tr>
<tr>
<td style="text-align: left;">CIControloSemSetup.sln</td>
<td style="text-align: left;"><strong>CITestes.csproj</strong></td>
<td style="text-align: left;">Unit testing project for the solution.</td>
<td style="text-align: left;">Test Project</td>
<td style="text-align: left;">Library</td>
<td style="text-align: left;">1.0.0.0</td>
<td style="text-align: left;">v4.0.30319</td>
<td style="text-align: left;">.NET Framework 4.0</td>
<td style="text-align: left;">AnyCPU</td>
<td style="text-align: left;">Debug/Release</td>
<td style="text-align: left;"><code>CIServRemessaTestes</code></td>
<td style="text-align: left;"><code>CIServRemessas</code>, <code>CIServico</code>, <code>CIControlo</code></td>
<td style="text-align: left;"><code>Microsoft.VisualStudio.QualityTools.UnitTestFramework</code></td>
</tr>
<tr>
<td style="text-align: left;">CIControloSemSetup.sln</td>
<td style="text-align: left;"><strong>MDIWebTransmCI.vbproj</strong></td>
<td style="text-align: left;">A VB.NET project that handles web service communication.</td>
<td style="text-align: left;">Class Library</td>
<td style="text-align: left;">Library</td>
<td style="text-align: left;">1.0.0.0</td>
<td style="text-align: left;">v4.0.30319</td>
<td style="text-align: left;">.NET Framework 4.0</td>
<td style="text-align: left;">AnyCPU</td>
<td style="text-align: left;">Debug/Release</td>
<td style="text-align: left;"><code>TInsertDoc</code></td>
<td style="text-align: left;"><code>CIConfigGlobalParameters</code></td>
<td style="text-align: left;"><code>CCAWebTransmCI</code>, <code>CCAGeneric</code></td>
</tr>
</tbody>
</table>
</div>
<pre class="mermaid"><code>flowchart TD
    UI["CIControlo.csproj (UI)"]
    Service["CIServico.csproj (Service)"]
    Tests["CITestes.csproj (Tests)"]
    Activities["CIActividades.csproj (Logic)"]
    Config["CIConfiguration.csproj (Config UI)"]
    Remittance["CIServRemessas.csproj (Remittance Svc)"]
    AlertSvc["CIServAlertas.csproj (Alert Svc)"]
    AlertModel["Alerta.csproj (Alert Model)"]
    SharedParams["CIConfigGlobalParameters.csproj (Shared)"]
    DB[(Database)]

    UI --> Activities
    UI --> Config
    
    Service --> Remittance
    Service --> AlertSvc
    
    Tests --> Remittance
    Tests --> Service
    
    Activities --> SharedParams
    Config --> SharedParams
    Remittance --> SharedParams
    AlertSvc --> AlertModel
    
    Activities --> DB
    AlertModel --> DB
    SharedParams --> DB
</code></pre>
<center>Figure 3 - Dependency graph showing relationships between key projects.</center>
</div>
<div class="product-section">
<h2 id="2-functional-overview">2. Functional overview</h2>
This section provides a high-level functional decomposition of the application. It identifies the major, distinct functional blocks or modules as inferred from the code's high-level structure (e.g., top-level namespaces, solution folders, primary class groups). This overview serves as a map to the application's core responsibilities.
<h3 id="21-executive-summary">2.1. Executive summary</h3>
This section provides a high-level summary of the application's primary purpose and its core function from a business or operational perspective. The summary is an inference based on the main entry points of the code (e.g., <code>main()</code>, <code>Application_Start()</code>), the names of the most central classes and modules, and the nature of the core processes identified. It answers the fundamental question: What primary problem does this application solve?
<div class="table-container">
<table>
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr>
<th style="text-align: left;">Aspect</th>
<th style="text-align: left;">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>Primary Purpose</strong></td>
<td style="text-align: left;">To automate and monitor the processing of financial remittances (cheques) from various sources, including bank branches (<code>Balcão</code>) and other systems (<code>GCAA</code>).</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Core Function</strong></td>
<td style="text-align: left;">The application functions as a back-office processing engine. It ingests remittance data, processes it in tranches, manages document states, handles reversals (<code>Estornos</code>), and generates alerts for operational staff. A Windows Forms-based control panel allows users to monitor these activities, intervene manually when errors occur, and configure system parameters.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Key Inferences</strong></td>
<td style="text-align: left;">- The presence of <code>CIServico.csproj</code> indicates a continuously running background service for automated processing.<br>- The <code>CIControlo.csproj</code> and <code>CIActividades.csproj</code> projects provide a rich client interface for operators to oversee and manage the system.<br>- The system is designed to handle different types of remittances and has specific logic for reversals and error handling (<code>CIDepositoErro.csproj</code>).<br>- Integration with external systems is evident through file processing (<code>ACOM</code>, <code>ENVM</code>) and web services (<code>MDIWebTransmCI.vbproj</code>).</td>
</tr>
</tbody>
</table>
</div>
<h3 id="22-functional-decomposition">2.2. Functional decomposition</h3>
This section provides a detailed breakdown of the application's functional areas or modules, inferred from the code structure. Each module is described in terms of its primary responsibilities and how it contributes to the overall functionality of the application. The decomposition is based on the organization of namespaces, classes, and methods, as well as the relationships between them.
<div class="table-container">
<table>
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr>
<th style="text-align: left;">Functional Area / Module</th>
<th style="text-align: left;">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>User Interaction & Presentation</strong></td>
<td style="text-align: left;">Manages user interfaces, handles user input, and renders data. This module is the primary interface between the user and the system's core logic. It is implemented as a Windows Forms application.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Core Process Execution Engine</strong></td>
<td style="text-align: left;">A Windows Service that orchestrates background tasks. It is responsible for triggering remittance processing, alert handling, and file ingestion on a schedule or in response to events.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Remittance & Document Processing</strong></td>
<td style="text-align: left;">The heart of the application, containing the business logic for processing remittances. This includes validating data, grouping documents into tranches, updating statuses, and handling reversals.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Alerting & Notification</strong></td>
<td style="text-align: left;">A dedicated module for generating and dispatching system alerts. It defines various alert conditions (e.g., processing errors, delays) and the actions to be taken (e.g., send email, log to DB).</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Configuration & User Management</strong></td>
<td style="text-align: left;">Provides services for managing application settings, database connections, and user permissions. It centralizes configuration for different deployment environments.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Data Persistence & Management</strong></td>
<td style="text-align: left;">Handles all interactions with the backend database. This includes reading and writing data entities like Remittances, Documents, and Alerts using direct SQL queries.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>External System Integration</strong></td>
<td style="text-align: left;">Manages communication with external systems. This includes parsing incoming files (ACOM, ENVM) and consuming external web services for tasks like document insertion.</td>
</tr>
</tbody>
</table>
</div>
<pre class="mermaid"><code>flowchart TD
    subgraph "Presentation Layer"
        A["User Interaction & Presentation (WinForms)"]
    end

    subgraph "Business Logic Layer"
        B["Core Process Execution Engine (Windows Service)"]
        C["Remittance & Document Processing"]
        D["Alerting & Notification"]
    end

    subgraph "Data & Integration Layer"
        E["Data Persistence & Management (SQL)"]
        F["External System Integration (Files, Web Services)"]
        G["Configuration & User Management"]
    end
    
    A --> C
    A --> D
    A --> G
    B --> C
    B --> D
    B --> F
    C --> E
    D --> E
    F --> E
    C --> G
</code></pre>
<center>Figure 4 - Functional decomposition showing the layered architecture of the application.</center>
<h3 id="23-user-roles-and-permissions">2.3. User roles and permissions</h3>
This section identifies all distinct types of users (or autonomous systems) that interact with the application. These roles are inferred from authentication logic, authorization checks (e.g., <code>[Authorize(Roles="...")]</code> decorators, <code>if (user.hasPermission('...'))</code> blocks), or conditional logic based on user properties (e.g., 'user.is_admin', 'user.group').
<div class="table-container">
<table>
<colgroup>
<col style="width: 16%" />
<col style="width: 16%" />
<col style="width: 16%" />
<col style="width: 16%" />
<col style="width: 16%" />
<col style="width: 16%" />
</colgroup>
<thead>
<tr>
<th style="text-align: left;">Role</th>
<th style="text-align: left;">Description</th>
<th style="text-align: left;">Permissions</th>
<th style="text-align: left;">Key Actions</th>
<th style="text-align: left;">Key Data Entities</th>
<th style="text-align: left;">Assumptions</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>Administrator / Power User</strong></td>
<td style="text-align: left;">A role with elevated privileges for managing the system and performing sensitive operations.</td>
<td style="text-align: left;">- Full CRUD on most data entities.<br>- Ability to change the state of remittances and tranches.<br>- Access to system configuration and user management.</td>
<td style="text-align: left;"><code>ChangeEstado</code>, <code>ReenviarTodasRemessasEmErro</code>, <code>ConfirmarCancelamento</code></td>
<td style="text-align: left;"><code>Remessa</code>, <code>Tranche</code>, <code>User</code>, <code>Group</code>, <code>Activity<em>Change</code></td>
<td style="text-align: left;">Inferred from the <code>ConfirmaPrivilegios()</code> method in <code>ActividadeBalcaoForm.cs</code>, which checks if <code>m</em>oParameters.UserLogged.m_iUserGroup > 1</code>. A group ID of 0 or 1 likely represents an administrator.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Standard Operator</strong></td>
<td style="text-align: left;">A standard user role for monitoring system activities and performing routine tasks.</td>
<td style="text-align: left;">- Read-only access to most data.<br>- Ability to view activities, alerts, and reports.</td>
<td style="text-align: left;"><code>ViewRemittances</code>, <code>ViewDocuments</code>, <code>ViewAlerts</code></td>
<td style="text-align: left;"><code>Remessa</code>, <code>Documento</code>, <code>Alerta</code></td>
<td style="text-align: left;">Inferred as the default role for users with <code>m_iUserGroup > 1</code>. These users are blocked from performing state-changing actions.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>System Service Account</strong></td>
<td style="text-align: left;">A non-interactive account used by the <code>CIServico</code> Windows Service to run background tasks.</td>
<td style="text-align: left;">- Full access to process remittances, files, and alerts without user intervention.</td>
<td style="text-align: left;"><code>ProcessarRemessa</code>, <code>ProcessarAlerta</code>, <code>ImportarFicheiro</code></td>
<td style="text-align: left;"><code>Remessa</code>, <code>Alerta</code>, <code>Ficheiro</code></td>
<td style="text-align: left;">Inferred from the existence of the <code>CIServico.csproj</code> project and the <code>Install-Dimensions.bat</code> script, which sets up a user for the service.</td>
</tr>
</tbody>
</table>
</div>
<pre class="mermaid"><code>classDiagram
    class User {
        +string UserName
        +int UserGroup
    }
    class Administrator {
        +ChangeEstado()
        +ReenviarRemessas()
    }
    class StandardOperator {
        +ViewActivities()
        +ViewAlerts()
    }
    class SystemService {
        +ProcessarRemessa()
        +ProcessarAlerta()
    }
    class Remessa {
        +int RemessaID
        +string Status
    }
    class Alerta {
        +int AlertaID
        +string Status
    }

    Administrator --|> User
    StandardOperator --|> User
    
    Administrator ..> Remessa : "Manages"
    StandardOperator ..> Remessa : "Views"
    SystemService ..> Remessa : "Processes"
    
    Administrator ..> Alerta : "Manages"
    StandardOperator ..> Alerta : "Views"
    SystemService ..> Alerta : "Processes"
</code></pre>
<center>Figure 5 - Class diagram illustrating user roles and their interactions with key data entities.</center>
<h3 id="24-core-business-capabilities">2.4. Core business capabilities</h3>
This section lists the main, high-level capabilities of the application, representing its "Epics" or major functional domains.
<div class="table-container">
<table>
<colgroup>
<col style="width: 20%" />
<col style="width: 20%" />
<col style="width: 20%" />
<col style="width: 20%" />
<col style="width: 20%" />
</colgroup>
<thead>
<tr>
<th style="text-align: left;">Capability</th>
<th style="text-align: left;">Description</th>
<th style="text-align: left;">Key Features</th>
<th style="text-align: left;">Key Data Entities</th>
<th style="text-align: left;">Assumptions</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>Remittance Processing</strong></td>
<td style="text-align: left;">The complete set of functions for processing financial remittances from ingestion to completion.</td>
<td style="text-align: left;">- Open, process, and close remittances.<br>- Group documents into tranches.<br>- Handle processing errors and update statuses.</td>
<td style="text-align: left;"><code>Remessa</code>, <code>Tranche</code>, <code>Documento</code></td>
<td style="text-align: left;">Inferred from projects like <code>CIServRemessas</code> and methods like <code>TratarTranchesBalcao</code>. This is the central purpose of the application.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Alert Management</strong></td>
<td style="text-align: left;">The system's ability to automatically detect and respond to predefined operational events or errors.</td>
<td style="text-align: left;">- Generate alerts for situations like processing failures or delays.<br>- Trigger actions such as sending emails, logging to DB, or writing to the Event Viewer.</td>
<td style="text-align: left;"><code>Alerta</code>, <code>Accao</code>, <code>SituacaoAccao</code></td>
<td style="text-align: left;">Inferred from the <code>Alerta</code> and <code>CIServAlertas</code> projects. The <code>enuTipoAccao</code> enum clearly defines the types of actions.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Operational Monitoring</strong></td>
<td style="text-align: left;">Provides user interfaces for real-time monitoring of system activities and data flows.</td>
<td style="text-align: left;">- View summaries and details of remittances, tranches, and documents.<br>- Filter activities by date, status, and other criteria.<br>- Manually intervene in workflows.</td>
<td style="text-align: left;"><code>Remessa</code>, <code>Tranche</code>, <code>Documento</code>, <code>Estorno</code></td>
<td style="text-align: left;">Inferred from the UI-heavy projects <code>CIActividades</code> and <code>CIControlo</code>, which contain numerous <code>ListView</code> controls for displaying data.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Data Ingestion & Integration</strong></td>
<td style="text-align: left;">The capability to receive and process data from external sources.</td>
<td style="text-align: left;">- Import data from fixed-format files (ACOM, ENVM).<br>- Consume external web services to insert documents.</td>
<td style="text-align: left;"><code>Ficheiro</code>, <code>Lote</code>, <code>DocumentoACOM</code></td>
<td style="text-align: left;">Inferred from the <code>CIFicheiro</code> project and the <code>MDIWebTransmCI</code> project, which contains a WSDL reference.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Configuration and Administration</strong></td>
<td style="text-align: left;">Functions related to system setup, user management, and parameter configuration.</td>
<td style="text-align: left;">- Manage user accounts and permissions.<br>- Configure database connections for different environments.<br>- Set operational parameters like batch sizes and timeouts.</td>
<td style="text-align: left;"><code>User</code>, <code>Group</code>, <code>Balcao</code>, <code>Maquina</code></td>
<td style="text-align: left;">Inferred from the <code>CIConfiguration</code> project and the presence of forms for managing users and bank branches (<code>Balcao</code>).</td>
</tr>
</tbody>
</table>
</div>
<h3 id="25-detailed-feature-breakdown">2.5. Detailed feature breakdown</h3>
This critical section provides a granular breakdown of individual features within each Core Business Capability. Each feature is described in terms of its user story, key data entities involved, and any inferred logic or flowcharts that illustrate the internal workings.
<div class="table-container">
<table>
<colgroup>
<col style="width: 25%" />
<col style="width: 25%" />
<col style="width: 25%" />
<col style="width: 25%" />
</colgroup>
<thead>
<tr>
<th style="text-align: left;">Feature</th>
<th style="text-align: left;">User Story / Description</th>
<th style="text-align: left;">Key Data Entities</th>
<th style="text-align: left;">Assumptions</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>Process Bank Branch Remittance</strong></td>
<td style="text-align: left;">As a System Service, I can process a remittance from a bank branch so that its documents are validated and grouped into tranches for clearing. The process involves fetching a pending remittance, iterating through its documents, and updating its status upon completion or error.</td>
<td style="text-align: left;"><code>Remessa</code>, <code>Tranche</code>, <code>Documento</code></td>
<td style="text-align: left;">Inferred from the <code>ProcessarTrancheBalcao</code> and <code>ServRemessa</code> classes. Assumes a polling mechanism to find remittances ready for processing.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Manually Change Remittance State</strong></td>
<td style="text-align: left;">As an Administrator, I can manually change the state of a selected remittance to resolve processing errors or force a retry. This allows intervention when automated processes fail.</td>
<td style="text-align: left;"><code>Remessa</code>, <code>Activity<em>Change</code></td>
<td style="text-align: left;">Inferred from the <code>toolStripMenuRemessaMudarEstado</em>Click</code> event handler in <code>ActividadeBalcaoForm.cs</code>, which calls a <code>MudarEstadoForm</code>.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Re-send All Failed Remittances</strong></td>
<td style="text-align: left;">As an Administrator, I can trigger a bulk re-submission of all remittances currently in an error state, so that they can be re-processed without manual intervention for each one.</td>
<td style="text-align: left;"><code>Remessa</code></td>
<td style="text-align: left;">Inferred from the <code>btnRemessasErro<em>Click</code> event handler, which calls the <code>Update</em>ReenviarTodasRemessasBalcaoEmErro</code> stored procedure.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Send Alert Notification</strong></td>
<td style="text-align: left;">As a System Service, I can send a notification (e.g., Email, SMS) when a specific alert situation is triggered, so that operators are informed of critical events.</td>
<td style="text-align: left;"><code>Alerta</code>, <code>Accao</code>, <code>SituacaoAccao</code></td>
<td style="text-align: left;">Inferred from the <code>ProcessaAlertaSituacaoAccaoMail</code> method in <code>ServAlerta.cs</code>. Assumes a background job periodically checks for pending alerts.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>View Document Image</strong></td>
<td style="text-align: left;">As an Operator, I can view the scanned image of a specific document to verify its details or investigate an issue.</td>
<td style="text-align: left;"><code>Documento</code>, <code>Imagem</code></td>
<td style="text-align: left;">Inferred from the <code>listViewDetalhesDocumentos_DoubleClick</code> event handler, which opens an <code>ImagemBalcaoForm</code> to display the front and back images of a document.</td>
</tr>
</tbody>
</table>
</div>
<h3 id="26-key-data-entities-and-their-attributes">2.6. Key data entities and their attributes</h3>
This section documents the application's core data structures, as inferred from class definitions or ORM configurations.
<div class="table-container">
<table>
<colgroup>
<col style="width: 14%" />
<col style="width: 14%" />
<col style="width: 14%" />
<col style="width: 14%" />
<col style="width: 14%" />
<col style="width: 14%" />
<col style="width: 14%" />
</colgroup>
<thead>
<tr>
<th style="text-align: left;">Entity</th>
<th style="text-align: left;">Description</th>
<th style="text-align: left;">Key Attributes</th>
<th style="text-align: left;">Data Type</th>
<th style="text-align: left;">Validation Rules</th>
<th style="text-align: left;">Relationships</th>
<th style="text-align: left;">Assumptions</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>Remessa</strong></td>
<td style="text-align: left;">Represents a batch of documents submitted for processing, typically from a bank branch.</td>
<td style="text-align: left;"><code>ID</code>, <code>Remessa_Data</code>, <code>StatusID</code>, <code>Balcao</code>, <code>Montante</code></td>
<td style="text-align: left;"><code>int</code>, <code>DateTime</code>, <code>int</code>, <code>string</code>, <code>decimal</code></td>
<td style="text-align: left;"><code>ID</code> is a primary key. <code>StatusID</code> references a status table.</td>
<td style="text-align: left;">Has a one-to-many relationship with <code>Tranche</code> and <code>Documento</code>.</td>
<td style="text-align: left;">Inferred from classes like <code>DetalheRemessa</code> and <code>RemessasResumo</code>. Status is managed via an integer foreign key.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Documento</strong></td>
<td style="text-align: left;">Represents a single financial document, likely a cheque, within a remittance.</td>
<td style="text-align: left;"><code>ID</code>, <code>Doc_ID</code>, <code>Zona1</code>-<code>Zona5</code>, <code>Montante</code>, <code>NIB</code>, <code>StatusID</code></td>
<td style="text-align: left;"><code>int</code>, <code>string</code>, <code>string</code>, <code>decimal</code>, <code>string</code>, <code>int</code></td>
<td style="text-align: left;"><code>ID</code> is a primary key. <code>Zona</code> fields likely represent MICR line data.</td>
<td style="text-align: left;">Belongs to one <code>Remessa</code> and one <code>Tranche</code>.</td>
<td style="text-align: left;">Inferred from <code>DetalheDocumento</code> and <code>PesquisaDocumento</code> classes. The structure strongly suggests cheque processing.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Tranche</strong></td>
<td style="text-align: left;">A logical grouping of documents within a remittance, likely for submission to a clearing house.</td>
<td style="text-align: left;"><code>ID</code>, <code>RemessaID</code>, <code>Numero</code>, <code>StatusID</code>, <code>Quantidade</code>, <code>Montante</code></td>
<td style="text-align: left;"><code>int</code>, <code>int</code>, <code>int</code>, <code>int</code>, <code>int</code>, <code>decimal</code></td>
<td style="text-align: left;"><code>ID</code> is a primary key.</td>
<td style="text-align: left;">Belongs to one <code>Remessa</code> and has many <code>Documento</code>s.</td>
<td style="text-align: left;">Inferred from <code>DetalheTranche</code> and <code>TranchesResumo</code>. Represents a sub-batch of a larger remittance.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Alerta</strong></td>
<td style="text-align: left;">Represents a system-generated alert for an operational event.</td>
<td style="text-align: left;"><code>Alert<em>ID</code>, <code>Timer</code>, <code>Text</code>, <code>Status</code></td>
<td style="text-align: left;"><code>string</code>, <code>DateTime</code>, <code>string</code>, <code>int</code></td>
<td style="text-align: left;"><code>Alert</em>ID</code> is a primary key.</td>
<td style="text-align: left;">Linked to <code>SituacaoAccao</code> to determine the action to take.</td>
<td style="text-align: left;">Inferred from the <code>Alerta</code> project classes. Alerts are triggered by situations and result in actions.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Accao</strong></td>
<td style="text-align: left;">Defines a specific action (e.g., send email) that can be triggered by an alert.</td>
<td style="text-align: left;"><code>Accao<em>ID</code>, <code>Descricao</code>, <code>TipoAccaoID</code></td>
<td style="text-align: left;"><code>int</code>, <code>string</code>, <code>enum</code></td>
<td style="text-align: left;"><code>Accao</em>ID</code> is a primary key. <code>TipoAccaoID</code> is an enum.</td>
<td style="text-align: left;">Associated with <code>Situacao</code> in a many-to-many relationship.</td>
<td style="text-align: left;">Inferred from <code>Accao.cs</code>. The <code>enuTipoAccao</code> clearly defines the supported action types.</td>
</tr>
</tbody>
</table>
</div>
<pre class="mermaid"><code>erDiagram
    REMESSA {
        int ID PK
        datetime Remessa_Data
        int StatusID
        string Balcao
        decimal Montante
    }
    TRANCHE {
        int ID PK
        int RemessaID FK
        int Numero
        int StatusID
    }
    DOCUMENTO {
        int ID PK
        int RemessaID FK
        int TrancheID FK
        string Zona1
        string Zona2
        string Zona3
        string Zona4
        string Zona5
        decimal Montante
    }
    ALERTA {
        int Alerta_ID PK
        datetime Timer
        string Text
    }
    SITUACAO_ACCAO {
        int SituacaoID PK
        int AccaoID PK
    }
    ACCAO {
        int Accao_ID PK
        string Descricao
        int TipoAccaoID
    }

    REMESSA ||--|{ TRANCHE : "contains"
    REMESSA ||--|{ DOCUMENTO : "contains"
    TRANCHE ||--|{ DOCUMENTO : "groups"
    ALERTA }|..|| SITUACAO_ACCAO : "triggers"
    ACCAO }|..|| SITUACAO_ACCAO : "is executed by"
</code></pre>
<center>Figure 6 - Entity-Relationship diagram showing the core data entities and their relationships.</center>
<h3 id="27-business-process-workflows">2.7. Business process workflows</h3>
This section describes and visualizes critical end-to-end processes, showing how different user roles and system features interact.
<div class="table-container">
<table>
<colgroup>
<col style="width: 16%" />
<col style="width: 16%" />
<col style="width: 16%" />
<col style="width: 16%" />
<col style="width: 16%" />
<col style="width: 16%" />
</colgroup>
<thead>
<tr>
<th style="text-align: left;">Process</th>
<th style="text-align: left;">Description</th>
<th style="text-align: left;">Key Steps</th>
<th style="text-align: left;">User Roles Involved</th>
<th style="text-align: left;">Key Data Entities</th>
<th style="text-align: left;">Assumptions</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>Standard Remittance Processing</strong></td>
<td style="text-align: left;">A comprehensive workflow that outlines the steps involved in processing remittance data from ingestion to final clearing.</td>
<td style="text-align: left;">1. Open Remittance<br>2. Process Documents<br>3. Group into Tranches<br>4. Send Tranches<br>5. Update Final Status</td>
<td style="text-align: left;">System Service, Standard Operator (monitoring)</td>
<td style="text-align: left;"><code>Remessa</code>, <code>Documento</code>, <code>Tranche</code></td>
<td style="text-align: left;">Assumes a linear, state-based progression. Inferred from methods like <code>ProcessarRemessas</code> and status change logic.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Alert Generation and Handling</strong></td>
<td style="text-align: left;">The workflow for creating, dispatching, and resolving system alerts.</td>
<td style="text-align: left;">1. Event/Error Occurs<br>2. Alert is Generated (DB Insert)<br>3. Alert Service picks up pending alert<br>4. Action is Executed (e.g., Email)<br>5. Alert status is updated to Processed.</td>
<td style="text-align: left;">System Service, Administrator</td>
<td style="text-align: left;"><code>Alerta</code>, <code>SituacaoAccao</code>, <code>Accao</code></td>
<td style="text-align: left;">Inferred from the <code>CIServAlertas</code> project. Assumes a polling mechanism for pending alerts.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Manual Error Intervention</strong></td>
<td style="text-align: left;">A user-driven workflow to correct a remittance or document that has failed during automated processing.</td>
<td style="text-align: left;">1. Operator identifies an error via UI<br>2. Operator selects the failed entity<br>3. Operator changes the status (e.g., to 'Pending Re-processing')<br>4. System Service re-processes the entity.</td>
<td style="text-align: left;">Administrator, Standard Operator</td>
<td style="text-align: left;"><code>Remessa</code>, <code>Tranche</code>, <code>Documento</code></td>
<td style="text-align: left;">Inferred from the <code>MudarEstadoForm</code> and related event handlers in the UI projects.</td>
</tr>
</tbody>
</table>
</div>
<pre class="mermaid"><code>flowchart TD
    A["Standard Remittance Processing"]
    B["Alert Generation and Handling"]
    C["Manual Error Intervention"]

    A -->|"On Error"| B
    A -->|"On Error"| C
    C -->|"Triggers Reprocessing"| A
</code></pre>
<center>Figure 7 - High-level relationship between business process workflows.</center>
<h4 id="271-workflow-standard-remittance-processing">2.7.1. Workflow: Standard Remittance Processing</h4>
This section provides a detailed breakdown of the Standard Remittance Processing workflow, including the steps involved, user roles, key data entities, and any assumptions made.
<div class="table-container">
<table>
<colgroup>
<col style="width: 20%" />
<col style="width: 20%" />
<col style="width: 20%" />
<col style="width: 20%" />
<col style="width: 20%" />
</colgroup>
<thead>
<tr>
<th style="text-align: left;">Step</th>
<th style="text-align: left;">Description</th>
<th style="text-align: left;">User Role</th>
<th style="text-align: left;">Key Data Entities</th>
<th style="text-align: left;">Assumptions</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>1. Open Remittance</strong></td>
<td style="text-align: left;">A new remittance is received and its status is set to 'Open' or 'Pending'. This could be from a file drop or an API call.</td>
<td style="text-align: left;">System Service</td>
<td style="text-align: left;"><code>Remessa</code></td>
<td style="text-align: left;">Assumes an initial state where the remittance is ready for processing.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>2. Process Documents</strong></td>
<td style="text-align: left;">The <code>CIServico</code> background service picks up the remittance. It iterates through each document, performing validation and data extraction.</td>
<td style="text-align: left;">System Service</td>
<td style="text-align: left;"><code>Documento</code></td>
<td style="text-align: left;">Inferred from <code>ProcessaRemessa</code> method. Assumes document-level validation logic exists.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>3. Group into Tranches</strong></td>
<td style="text-align: left;">Validated documents are grouped into tranches based on system rules (e.g., <code>MaxDocsTranche</code> parameter). Each tranche is created as a new entity.</td>
<td style="text-align: left;">System Service</td>
<td style="text-align: left;"><code>Tranche</code></td>
<td style="text-align: left;">Inferred from <code>CriarTranche</code> method.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>4. Send Tranches</strong></td>
<td style="text-align: left;">The tranches are prepared for sending to an external system (e.g., clearing house). The status is updated to 'Sent'.</td>
<td style="text-align: left;">System Service</td>
<td style="text-align: left;"><code>Tranche</code></td>
<td style="text-align: left;">Assumes an integration point exists for sending the data, likely via a file or web service.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>5. Update Final Status</strong></td>
<td style="text-align: left;">After receiving confirmation from the external system, the final status of the remittance and its documents is updated (e.g., 'Processed', 'Error').</td>
<td style="text-align: left;">System Service</td>
<td style="text-align: left;"><code>Remessa</code>, <code>Documento</code></td>
<td style="text-align: left;">Inferred from the presence of various status fields and error-handling logic.</td>
</tr>
</tbody>
</table>
</div>
<pre class="mermaid"><code>flowchart TD
    A["Start (Remittance Received)"] --> B["Status: Open"];
    B --> C{"Is it time to process?"};
    C -->|"Yes"| D["Process Documents"];
    C -->|"No"| B;
    D --> E["Group into Tranches"];
    E --> F["Send Tranches"];
    F --> G{"Confirmation Received?"};
    G -->|"Yes"| H["Update Status: Processed"];
    G -->|"No"| I["Update Status: Error"];
    H --> J["End"];
    I --> J;
</code></pre>
<center>Figure 8 - Detailed workflow for Standard Remittance Processing.</center>
<h4 id="272-workflow-alert-generation-and-handling">2.7.2. Workflow: Alert Generation and Handling</h4>
This section provides a detailed breakdown of the Alert Generation and Handling workflow, including the steps involved, user roles, key data entities, and any assumptions made.
<div class="table-container">
<table>
<colgroup>
<col style="width: 20%" />
<col style="width: 20%" />
<col style="width: 20%" />
<col style="width: 20%" />
<col style="width: 20%" />
</colgroup>
<thead>
<tr>
<th style="text-align: left;">Step</th>
<th style="text-align: left;">Description</th>
<th style="text-align: left;">User Role</th>
<th style="text-align: left;">Key Data Entities</th>
<th style="text-align: left;">Assumptions</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>1. Event/Error Occurs</strong></td>
<td style="text-align: left;">An error happens during processing (e.g., SQL error, validation failure).</td>
<td style="text-align: left;">System Service</td>
<td style="text-align: left;"><code>Remessa</code>, <code>Documento</code></td>
<td style="text-align: left;">A <code>try-catch</code> block or a specific business rule detects the error.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>2. Alert is Generated</strong></td>
<td style="text-align: left;">A new record is inserted into the <code>ALERTA</code> table with details about the event and a 'Pending' status.</td>
<td style="text-align: left;">System Service</td>
<td style="text-align: left;"><code>Alerta</code></td>
<td style="text-align: left;">The <code>EnviarAlertaSituacao</code> method is called with a specific situation ID.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>3. Alert Service Polls</strong></td>
<td style="text-align: left;">The <code>CIServAlertas</code> service periodically queries the database for alerts with a 'Pending' status.</td>
<td style="text-align: left;">System Service</td>
<td style="text-align: left;"><code>Alerta</code></td>
<td style="text-align: left;">Inferred from the <code>AlertaSituacaoAccaoParaProcessar</code> method.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>4. Action is Executed</strong></td>
<td style="text-align: left;">The service identifies the action linked to the alert's situation (e.g., Email) and executes it using the configured parameters.</td>
<td style="text-align: left;">System Service</td>
<td style="text-align: left;"><code>Accao</code>, <code>AccaoParam</code></td>
<td style="text-align: left;">The <code>ProcessaAlertaSituacaoAccao</code> method dispatches the task based on <code>enuTipoAccao</code>.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>5. Alert Status Updated</strong></td>
<td style="text-align: left;">The alert's status is updated to 'Processed' or 'Error' in the <code>ALERTA<em>ALERTA</em>ACCAO</code> table.</td>
<td style="text-align: left;">System Service</td>
<td style="text-align: left;"><code>AlertaSituacaoAccao</code></td>
<td style="text-align: left;">Inferred from the <code>SetProcessado</code> and <code>SetErroProcessamento</code> methods.</td>
</tr>
</tbody>
</table>
</div>
<pre class="mermaid"><code>flowchart TD
    A["Event/Error Occurs"] --> B["Insert into ALERTA table (Status: Pending)"];
    B --> C{"Alert Service Polls for Pending Alerts"};
    C -->|"No"| C;
    C -->|"Yes"| D["Fetch Alert and Associated Action"];
    D --> E{"Execute Action (e.g., Send Email)"};
    E --> F{"Action Successful?"};
    F -->|"Yes"| G["Update Alert Status: Processed"];
    F -->|"No"| H["Update Alert Status: Error"];
    G --> I["End"];
    H --> I;
</code></pre>
<center>Figure 9 - Detailed workflow for Alert Generation and Handling.</center>
<h4 id="273-workflow-manual-error-intervention">2.7.3. Workflow: Manual Error Intervention</h4>
This section provides a detailed breakdown of the Manual Error Intervention workflow, including the steps involved, user roles, key data entities, and any assumptions made.
<div class="table-container">
<table>
<colgroup>
<col style="width: 20%" />
<col style="width: 20%" />
<col style="width: 20%" />
<col style="width: 20%" />
<col style="width: 20%" />
</colgroup>
<thead>
<tr>
<th style="text-align: left;">Step</th>
<th style="text-align: left;">Description</th>
<th style="text-align: left;">User Role</th>
<th style="text-align: left;">Key Data Entities</th>
<th style="text-align: left;">Assumptions</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>1. Identify Error</strong></td>
<td style="text-align: left;">An operator or administrator uses the <code>CIControlo</code> UI to filter for remittances or documents in an 'Error' state.</td>
<td style="text-align: left;">Administrator, Standard Operator</td>
<td style="text-align: left;"><code>Remessa</code>, <code>Documento</code></td>
<td style="text-align: left;">The UI provides functionality to search and filter based on status.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>2. Investigate Details</strong></td>
<td style="text-align: left;">The user reviews the details of the failed entity, including its associated data and possibly viewing the document image.</td>
<td style="text-align: left;">Administrator, Standard Operator</td>
<td style="text-align: left;"><code>Tranche</code>, <code>Documento</code>, <code>Imagem</code></td>
<td style="text-align: left;">The UI allows drilling down into related entities for investigation.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>3. Perform Manual Action</strong></td>
<td style="text-align: left;">The Administrator, having sufficient privileges, right-clicks the entity and selects an action, such as 'Mudar Estado' (Change State).</td>
<td style="text-align: left;">Administrator</td>
<td style="text-align: left;"><code>Remessa</code>, <code>Activity_Change</code></td>
<td style="text-align: left;">Privileges are checked via <code>ConfirmaPrivilegios()</code> before allowing the action.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>4. Trigger Re-processing</strong></td>
<td style="text-align: left;">The state is changed to a status that the background service recognizes as ready for re-processing (e.g., 'Pending').</td>
<td style="text-align: left;">Administrator</td>
<td style="text-align: left;"><code>Remessa</code></td>
<td style="text-align: left;">The system is designed to pick up items that are manually reset.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>5. Verify Correction</strong></td>
<td style="text-align: left;">The user monitors the UI to ensure the background service successfully re-processes the item and its status is updated to 'Processed'.</td>
<td style="text-align: left;">Administrator, Standard Operator</td>
<td style="text-align: left;"><code>Remessa</code></td>
<td style="text-align: left;">The UI provides real-time or near-real-time updates on entity status.</td>
</tr>
</tbody>
</table>
</div>
<pre class="mermaid"><code>flowchart TD
    A["Operator identifies failed item in UI"] --> B["Investigate item details and image"];
    B --> C{"Is manual intervention needed?"};
    C -->|"No"| F["End (Escalate or Ignore)"];
    C -->|"Yes (Admin role required)"| D["Admin changes item status to 'Pending'"];
    D --> E["System Service re-processes the item"];
    E --> F;
</code></pre>
<center>Figure 10 - Detailed workflow for Manual Error Intervention.</center>
<h3 id="28-system-inputs-outputs-interfaces">2.8. System inputs & outputs (interfaces)</h3>
This section catalogs all identified points where data enters or leaves the application boundary.
<div class="table-container">
<table>
<colgroup>
<col style="width: 20%" />
<col style="width: 20%" />
<col style="width: 20%" />
<col style="width: 20%" />
<col style="width: 20%" />
</colgroup>
<thead>
<tr>
<th style="text-align: left;">Type</th>
<th style="text-align: left;">Name / Description</th>
<th style="text-align: left;">Data Formats</th>
<th style="text-align: left;">Data Source / Sink</th>
<th style="text-align: left;">Assumptions</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>Input</strong></td>
<td style="text-align: left;"><strong>File Ingestion (ENVM, ACOM)</strong></td>
<td style="text-align: left;">Fixed-width text files</td>
<td style="text-align: left;">Monitored file system directory</td>
<td style="text-align: left;">A file watcher service (<code>CIServico</code>) is inferred to be listening in paths defined in the configuration. Inferred from <code>CIFicheiro</code> project.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Input</strong></td>
<td style="text-align: left;"><strong>User Interaction</strong></td>
<td style="text-align: left;">User input via UI controls</td>
<td style="text-align: left;">Windows Forms application (<code>CIControlo</code>)</td>
<td style="text-align: left;">Operators use the UI to filter data, trigger actions, and manage system configuration.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Output</strong></td>
<td style="text-align: left;"><strong>Database Writes</strong></td>
<td style="text-align: left;">SQL</td>
<td style="text-align: left;">Microsoft SQL Server</td>
<td style="text-align: left;">All processed data, statuses, and logs are persisted in the central database.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Output</strong></td>
<td style="text-align: left;"><strong>Alert Notifications</strong></td>
<td style="text-align: left;">Email, SMS, Log File, Event Viewer</td>
<td style="text-align: left;">External SMTP server, SMS gateway, file system, Windows Event Log</td>
<td style="text-align: left;">The <code>Alerta</code> module dispatches notifications to various sinks based on configuration.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Data Flow</strong></td>
<td style="text-align: left;"><strong>Primary Internal Flow</strong></td>
<td style="text-align: left;">In-memory objects (e.g., <code>Remessa</code>, <code>Documento</code>)</td>
<td style="text-align: left;">Application Memory -> Database</td>
<td style="text-align: left;">Data is read from the database, processed by business logic in service classes, and the results are written back to the database.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Data Flow</strong></td>
<td style="text-align: left;"><strong>Web Service Call</strong></td>
<td style="text-align: left;">SOAP/XML</td>
<td style="text-align: left;">External Web Service (<code>waiaccesstuInsertDoc</code>)</td>
<td style="text-align: left;">The <code>MDIWebTransmCI</code> project makes calls to an external service to insert document data.</td>
</tr>
</tbody>
</table>
</div>
<h3 id="29-user-task-flows">2.9. User Task Flows</h3>
This section describes the typical path a user takes through the application to achieve a high-level objective, linking multiple features together.
<div class="table-container">
<table>
<colgroup>
<col style="width: 20%" />
<col style="width: 20%" />
<col style="width: 20%" />
<col style="width: 20%" />
<col style="width: 20%" />
</colgroup>
<thead>
<tr>
<th style="text-align: left;">Task Flow</th>
<th style="text-align: left;">Description</th>
<th style="text-align: left;">User Role</th>
<th style="text-align: left;">Key Data Entities</th>
<th style="text-align: left;">Assumptions</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>Monitor Daily Processing</strong></td>
<td style="text-align: left;">An operator logs in to review the status of the day's remittances, check for errors, and ensure all batches have completed successfully.</td>
<td style="text-align: left;">Standard Operator</td>
<td style="text-align: left;"><code>Remessa</code>, <code>Tranche</code>, <code>Documento</code></td>
<td style="text-align: left;">Assumes the operator's primary goal is to ensure the smooth execution of automated processes.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Resolve a Failed Remittance</strong></td>
<td style="text-align: left;">An administrator identifies a remittance in an error state, investigates the cause by viewing its documents, manually changes its state to force a re-run, and confirms its successful completion.</td>
<td style="text-align: left;">Administrator</td>
<td style="text-align: left;"><code>Remessa</code>, <code>Documento</code>, <code>Activity_Change</code></td>
<td style="text-align: left;">This flow involves multiple steps: investigation, manual intervention, and verification.</td>
</tr>
</tbody>
</table>
</div>
<h4 id="291-user-task-flow-resolve-a-failed-remittance">2.9.1. User Task Flow: Resolve a Failed Remittance</h4>
This section provides a detailed breakdown of the Resolve a Failed Remittance user task flow.
<div class="table-container">
<table>
<colgroup>
<col style="width: 20%" />
<col style="width: 20%" />
<col style="width: 20%" />
<col style="width: 20%" />
<col style="width: 20%" />
</colgroup>
<thead>
<tr>
<th style="text-align: left;">Step</th>
<th style="text-align: left;">Description</th>
<th style="text-align: left;">User Role</th>
<th style="text-align: left;">Key Data Entities</th>
<th style="text-align: left;">Assumptions</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>1. Identify Error</strong></td>
<td style="text-align: left;">The Administrator opens the <code>ActividadesForm</code> and filters for remittances with an 'Error' status.</td>
<td style="text-align: left;">Administrator</td>
<td style="text-align: left;"><code>Remessa</code></td>
<td style="text-align: left;">The UI provides filtering capabilities to easily find problematic items.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>2. Investigate Cause</strong></td>
<td style="text-align: left;">The Administrator double-clicks the failed remittance to view its tranches and documents, looking for specific error messages or data anomalies.</td>
<td style="text-align: left;">Administrator</td>
<td style="text-align: left;"><code>Tranche</code>, <code>Documento</code></td>
<td style="text-align: left;">The UI allows drilling down from a high-level entity to its constituent parts.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>3. View Document Image</strong></td>
<td style="text-align: left;">If a specific document is suspect, the Administrator double-clicks it to open the <code>ImagemBalcaoForm</code> and visually inspect the scanned cheque.</td>
<td style="text-align: left;">Administrator</td>
<td style="text-align: left;"><code>Imagem</code></td>
<td style="text-align: left;">The system has access to the image repository and can retrieve images based on a document ID.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>4. Manual State Change</strong></td>
<td style="text-align: left;">After identifying the issue (e.g., a temporary network glitch), the Administrator right-clicks the remittance and selects "Mudar Estado" to reset its status to 'Pending'.</td>
<td style="text-align: left;">Administrator</td>
<td style="text-align: left;"><code>Remessa</code>, <code>Activity_Change</code></td>
<td style="text-align: left;">Assumes the user has the necessary privileges, which is checked by the <code>ConfirmaPrivilegios</code> method.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>5. Verify Re-processing</strong></td>
<td style="text-align: left;">The Administrator refreshes the view to confirm that the <code>CIServico</code> has picked up the remittance again and successfully processed it.</td>
<td style="text-align: left;">Administrator</td>
<td style="text-align: left;"><code>Remessa</code></td>
<td style="text-align: left;">The system's background service is capable of re-processing items that are put back into a pending state.</td>
</tr>
</tbody>
</table>
</div>
<pre class="mermaid"><code>journey
    title Resolve a Failed Remittance
    section Identify and Investigate
      Administrator opens UI and filters for errors: 5: Administrator
      Administrator views failed remittance details: 5: Administrator
      Administrator inspects document images: 4: Administrator
    section Intervene and Verify
      Administrator changes remittance state to 'Pending': 5: Administrator
      System re-processes the remittance: 4: SystemService
      Administrator verifies successful completion: 5: Administrator
</code></pre>
<center>Figure 11 - User journey for resolving a failed remittance.</center>
<h4 id="292-user-task-flow-monitor-daily-processing">2.9.2. User Task Flow: Monitor Daily Processing</h4>
This section provides a detailed breakdown of the Monitor Daily Processing user task flow.
<div class="table-container">
<table>
<colgroup>
<col style="width: 20%" />
<col style="width: 20%" />
<col style="width: 20%" />
<col style="width: 20%" />
<col style="width: 20%" />
</colgroup>
<thead>
<tr>
<th style="text-align: left;">Step</th>
<th style="text-align: left;">Description</th>
<th style="text-align: left;">User Role</th>
<th style="text-align: left;">Key Data Entities</th>
<th style="text-align: left;">Assumptions</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>1. Login</strong></td>
<td style="text-align: left;">The Operator launches the <code>CIControlo.exe</code> application and logs in with their credentials.</td>
<td style="text-align: left;">Standard Operator</td>
<td style="text-align: left;"><code>User</code></td>
<td style="text-align: left;">The application authenticates the user against the database.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>2. Open Activity View</strong></td>
<td style="text-align: left;">The operator navigates to the main activity monitoring screen (<code>ActividadesForm</code>).</td>
<td style="text-align: left;">Standard Operator</td>
<td style="text-align: left;">N/A</td>
<td style="text-align: left;">This is the primary dashboard for daily operations.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>3. Filter for Today's Data</strong></td>
<td style="text-align: left;">The operator uses the date filters to view all remittances processed on the current day.</td>
<td style="text-align: left;">Standard Operator</td>
<td style="text-align: left;"><code>Remessa</code></td>
<td style="text-align: left;">The UI provides robust filtering capabilities.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>4. Review Summaries</strong></td>
<td style="text-align: left;">The operator reviews the summary <code>ListView</code> to get an overview of counts and amounts, checking for any anomalies.</td>
<td style="text-align: left;">Standard Operator</td>
<td style="text-align: left;"><code>Remessa</code>, <code>Tranche</code></td>
<td style="text-align: left;">High-level summaries are available for quick review.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>5. Check for Errors</strong></td>
<td style="text-align: left;">The operator specifically filters for items in an 'Error' state to see if any manual intervention is required.</td>
<td style="text-align: left;">Standard Operator</td>
<td style="text-align: left;"><code>Remessa</code>, <code>Documento</code></td>
<td style="text-align: left;">If errors are found, the operator may escalate to an Administrator.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>6. View Reports</strong></td>
<td style="text-align: left;">The operator may generate a daily summary report using the Crystal Reports integration for record-keeping.</td>
<td style="text-align: left;">Standard Operator</td>
<td style="text-align: left;"><code>CIReport</code></td>
<td style="text-align: left;">The application has built-in reporting features.</td>
</tr>
</tbody>
</table>
</div>
<pre class="mermaid"><code>journey
    title Monitor Daily Processing
    section Review and Triage
      Operator logs into the application: 5: Standard Operator
      Operator navigates to the activity dashboard: 5: Standard Operator
      Operator filters for today's remittances: 4: Standard Operator
      Operator reviews high-level summaries: 5: Standard Operator
    section Investigate and Report
      Operator filters for error states: 4: Standard Operator
      Operator escalates any found issues: 3: Standard Operator
      Operator generates daily report: 4: Standard Operator
</code></pre>
<center>Figure 12 - User journey for monitoring daily processing.</center>
<h3 id="210-automated-scheduled-processes">2.10. Automated & Scheduled Processes</h3>
This section describes any system-triggered processes that run without direct user interaction, such as nightly jobs, scheduled reports, or data synchronization tasks.
<div class="table-container">
<table>
<colgroup>
<col style="width: 16%" />
<col style="width: 16%" />
<col style="width: 16%" />
<col style="width: 16%" />
<col style="width: 16%" />
<col style="width: 16%" />
</colgroup>
<thead>
<tr>
<th style="text-align: left;">Process Name</th>
<th style="text-align: left;">Trigger / Schedule</th>
<th style="text-align: left;">Purpose</th>
<th style="text-align: left;">Key Actions</th>
<th style="text-align: left;">Key Data Entities</th>
<th style="text-align: left;">Assumptions</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>Remittance Processing Job</strong></td>
<td style="text-align: left;">Timer-based (every few minutes)</td>
<td style="text-align: left;">To automatically process incoming remittances that are in a 'Pending' state.</td>
<td style="text-align: left;">1. Query for pending remittances.<br>2. For each remittance, validate and process its documents.<br>3. Create and send tranches.<br>4. Update final status.</td>
<td style="text-align: left;"><code>Remessa</code>, <code>Tranche</code>, <code>Documento</code></td>
<td style="text-align: left;">Inferred from <code>CIServico.cs</code> and <code>CIServRemessas.cs</code>. The service runs continuously, polling for work.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Alert Processing Job</strong></td>
<td style="text-align: left;">Timer-based (every few minutes)</td>
<td style="text-align: left;">To automatically handle system alerts by executing their associated actions.</td>
<td style="text-align: left;">1. Query for pending alerts.<br>2. For each alert, identify the action (e.g., email).<br>3. Execute the action.<br>4. Update alert status.</td>
<td style="text-align: left;"><code>Alerta</code>, <code>Accao</code></td>
<td style="text-align: left;">Inferred from <code>CIServAlertas.cs</code>. This runs in parallel with remittance processing.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>File Ingestion Service</strong></td>
<td style="text-align: left;">File System Watcher or Timer-based poll</td>
<td style="text-align: left;">To automatically import data from <code>ENVM</code> and <code>ACOM</code> files dropped into a monitored directory.</td>
<td style="text-align: left;">1. Detect new file.<br>2. Parse file line by line.<br>3. Insert data into staging tables.<br>4. Move processed file to a backup location.</td>
<td style="text-align: left;"><code>Ficheiro</code>, <code>Lote</code></td>
<td style="text-align: left;">Inferred from the <code>CIFicheiro</code> project and its file-handling logic.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Stale Remittance Check</strong></td>
<td style="text-align: left;">Scheduled (likely daily)</td>
<td style="text-align: left;">To generate alerts for remittances that have been in an intermediate state for too long.</td>
<td style="text-align: left;">1. Query for remittances in states like 'Processing' for more than <code>MaxHorasEsperaRemessaCI</code>.<br>2. Generate a specific alert for each stale remittance.</td>
<td style="text-align: left;"><code>Remessa</code>, <code>Alerta</code></td>
<td style="text-align: left;">Inferred from the configuration parameter <code>MaxHorasEsperaRemessaCI</code> and the general purpose of the alerting module.</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="product-section">
<h2 id="3-architecture-and-design">3. Architecture and design</h2>
This section describes the architectural patterns, design principles, and overall structure of the application as inferred from the source code.
<h3 id="31-architecture-pattern">3.1. Architecture pattern</h3>
The application follows a traditional, monolithic N-Tier architecture, with some elements of specific design patterns within its layers.
<div class="table-container">
<table>
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr>
<th style="text-align: left;">Pattern Type</th>
<th style="text-align: left;">Patterns Identified & Description</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>Architecture pattern</strong></td>
<td style="text-align: left;"><strong>N-Tier Monolith</strong>: The application is structured into distinct layers for presentation, business logic, and data access, but all components are tightly coupled and deployed as a single unit (or a set of closely related executables).</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Architectural patterns</strong></td>
<td style="text-align: left;"><strong>Windows Forms (UI)</strong>: The presentation layer is built using Windows Forms, a standard for desktop applications in the .NET Framework era.<br><strong>Service-Oriented (Internal)</strong>: The logic is broken down into "services" (<code>CIServRemessas</code>, <code>CIServAlertas</code>), but these are class libraries within the monolith, not independent microservices.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Creational patterns</strong></td>
<td style="text-align: left;"><strong>Singleton (Inferred)</strong>: <code>CIConfigGlobalParameters</code> appears to be used as a singleton-like object, passed around to provide global access to configuration and database connections.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Structural patterns</strong></td>
<td style="text-align: left;">Not explicitly identified, but the use of interfaces like <code>CIComumInterface</code> suggests a move towards decoupling, though its implementation may be inconsistent.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Behavioral patterns</strong></td>
<td style="text-align: left;"><strong>Observer (Inferred)</strong>: The alerting system, where events (subjects) trigger actions (observers), loosely follows the Observer pattern.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Domain-driven design (DDD) patterns</strong></td>
<td style="text-align: left;"><strong>Repository (Partial/Anemic)</strong>: Classes like <code>ServRemessa</code> and <code>ServAlerta</code> act as repositories by encapsulating data access logic, but they operate on data entities that appear to be simple data containers (anemic domain model) rather than rich domain objects.</td>
</tr>
</tbody>
</table>
</div>
<h3 id="32-architecture-style">3.2. Architecture style</h3>
The application's architecture is characteristic of systems built with .NET Framework 4.0, emphasizing a layered approach with direct database communication.
<div class="table-container">
<table>
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr>
<th style="text-align: left;">Aspect</th>
<th style="text-align: left;">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>Layering</strong></td>
<td style="text-align: left;"><strong>3-Tier Layered Architecture</strong>: <br>1. <strong>Presentation Layer</strong>: <code>CIControlo.csproj</code>, <code>CIActividades.csproj</code> (Windows Forms).<br>2. <strong>Business Logic Layer</strong>: <code>CIServico.csproj</code>, <code>CIServRemessas.csproj</code>, <code>CIServAlertas.csproj</code>.<br>3. <strong>Data Access Layer</strong>: Implicitly defined within business logic classes through direct <code>SqlDataReader</code> and raw SQL queries. There is no dedicated, separate data access layer project.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Dependency flow</strong></td>
<td style="text-align: left;"><strong>Top-Down</strong>: Dependencies flow from the UI/Service layer down to the business logic and then directly to the database. Shared libraries like <code>CIConfigGlobalParameters</code> are referenced across multiple layers, creating some horizontal coupling.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Bounded contexts</strong></td>
<td style="text-align: left;">Not formally defined. However, the project structure suggests informal bounded contexts: Remittance Processing, Alerting, Configuration, and User Interface. These are not strictly enforced and share the same database.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Communication between contexts/services</strong></td>
<td style="text-align: left;"><strong>Direct Method Calls</strong>: As a monolith, components communicate via direct, in-process method calls.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Use of dependency injection / IOC container</strong></td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> <strong>Not Supported</strong>: Dependencies are manually instantiated (e.g., <code>new CIServRemessas.ServRemessa(this, m_oParameters)</code>). There is no evidence of an Inversion of Control (IoC) container.</td>
</tr>
</tbody>
</table>
</div>
<h3 id="33-key-design-patterns-and-principles-applied">3.3. Key design patterns and principles applied</h3>
The codebase shows an application of some classic design principles, though adherence is not always strict.
<div class="table-container">
<table>
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr>
<th style="text-align: left;">Principle</th>
<th style="text-align: left;">Analysis</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>SOLID principles</strong></td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> <strong>Partial Adherence</strong>: <br>- <strong>Single Responsibility</strong>: Partially followed. Classes like <code>ServRemessa</code> handle multiple responsibilities (fetching data, processing, updating state).<br>- <strong>Open/Closed</strong>: Violated. Changing logic often requires modifying existing classes rather than extending them.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>DRY</strong></td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> <strong>Medium Adherence</strong>: Some code duplication is likely, especially in data access patterns (raw SQL queries). However, helper classes like <code>CIGlobalParameters</code> centralize some common functionalities.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>KISS</strong></td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> <strong>High Adherence</strong>: The code is straightforward and procedural, making individual methods relatively easy to understand, though the overall system coupling is high.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>YAGNI</strong></td>
<td style="text-align: left;"><span class="icon icon-question" title="Uncertain/Likely">help</span> <strong>Likely</strong>: The code seems focused on the specific requirements of remittance processing, with little evidence of "gold plating" or speculative features.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Separation of Concerns</strong></td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> <strong>Partial Separation</strong>: There is a clear separation between the background service (<code>CIServico</code>) and the UI (<code>CIControlo</code>), but the UI code contains business logic (e.g., <code>btnRemessasErro_Click</code> directly calling a stored procedure). The data access logic is mixed within business classes.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Testability</strong></td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> <strong>Medium</strong>: The presence of a <code>CITestes</code> project is a positive sign. However, the lack of dependency injection and the tight coupling to <code>SqlConnection</code> and static helpers would make unit testing difficult without significant refactoring.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Maintainability</strong></td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> <strong>Low</strong>: The use of an old framework, direct SQL queries embedded in code, and lack of dependency injection make the system hard to maintain and evolve.</td>
</tr>
</tbody>
</table>
</div>
<h3 id="34-domain-driven-design-ddd-adoption">3.4. Domain-driven design (DDD) adoption</h3>
The application does not follow a formal Domain-Driven Design (DDD) approach.
<div class="table-container">
<table>
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr>
<th style="text-align: left;">DDD Concept</th>
<th style="text-align: left;">Analysis</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>Use of DDD concepts</strong></td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> <strong>Low Adoption</strong>: The code is data-centric rather than domain-centric.<br>- <strong>Entities</strong>: Classes like <code>Remessa</code> and <code>Documento</code> are anemic data containers with properties but little to no behavior.<br>- <strong>Repositories</strong>: Partially implemented by service classes, but they don't abstract the data source effectively (still tied to SQL Server).<br>- <strong>Aggregates/Value Objects</strong>: Not used.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Ubiquitous language</strong></td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> <strong>Partially Present</strong>: The code uses business terms like <code>Remessa</code> (Remittance), <code>Tranche</code>, <code>Balcao</code> (Branch), and <code>Estorno</code> (Reversal), indicating a shared language with the business domain. However, this is not consistently enforced.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Layered DDD approach</strong></td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> <strong>Not Implemented</strong>: The architecture is a classic N-Tier, not a clean/onion architecture typical of modern DDD. The core business logic is not isolated from infrastructure concerns like data access.</td>
</tr>
</tbody>
</table>
</div>
<h3 id="35-patterns-and-tactics">3.5. Patterns and tactics</h3>
The application employs several common software patterns, primarily for data access and flow control.
<div class="table-container">
<table>
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr>
<th style="text-align: left;">Pattern/Tactic</th>
<th style="text-align: left;">Analysis</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>Repository pattern</strong></td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> <strong>Partially Implemented</strong>: Service classes like <code>ServRemessa</code> act as repositories, centralizing data access for <code>Remessa</code> entities. However, they are not fully abstracted and expose implementation details (e.g., using <code>SqlDataReader</code> directly).</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Unit of Work pattern</strong></td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> <strong>Not Implemented</strong>: Transactions are managed manually using <code>m_oParameters.BeginTrans</code>, <code>Commit</code>, and <code>RollBack</code>. There is no formal Unit of Work pattern to group operations.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Factory pattern</strong></td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> <strong>Not Implemented</strong>: Objects are created directly using the <code>new</code> keyword.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Strategy pattern</strong></td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> <strong>Partially Implemented</strong>: The alert processing logic in <code>ProcessaAlertaSituacaoAccao</code> uses a <code>switch</code> statement on <code>enuTipoAccao</code> to delegate to different processing methods (<code>ProcessaAlertaSituacaoAccaoMail</code>, <code>ProcessaAlertaSituacaoAccaoLogDB</code>). This resembles a basic, non-extensible implementation of the Strategy pattern.</td>
</tr>
</tbody>
</table>
</div>
<h3 id="36-cross-cutting-concerns">3.6. Cross-cutting concerns</h3>
Cross-cutting concerns are handled through shared utility classes and manual implementation rather than AOP frameworks.
<div class="table-container">
<table>
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr>
<th style="text-align: left;">Concern</th>
<th style="text-align: left;">Implementation Details</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>Logging</strong></td>
<td style="text-align: left;">Implemented via a custom <code>GenericLog</code> class. It provides methods like <code>GenLogRegistarAlerta</code> and <code>GenLogRegistarErro</code>, suggesting different log levels.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Exception Handling</strong></td>
<td style="text-align: left;">Standard <code>try-catch</code> blocks are used throughout the application. Caught exceptions are often logged using <code>GenericLog</code> and/or displayed to the user via <code>MessageBox</code>.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Configuration Management</strong></td>
<td style="text-align: left;">Centralized in the <code>CIConfigGlobalParameters</code> project. It reads settings from <code>.config</code> files and provides a global access point (<code>m_oParameters</code>) passed to most classes.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Authentication</strong></td>
<td style="text-align: left;">Handled via the <code>User</code> class in <code>CIConfigGlobalParameters</code>. It appears to check user details against a database table (<code>VW<em>PASSWD</em>GROUP</code>).</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Authorization</strong></td>
<td style="text-align: left;">Implemented with simple, direct checks on the user's group ID (e.g., <code>if (m<em>oParameters.UserLogged.m</em>iUserGroup > 1)</code>).</td>
</tr>
</tbody>
</table>
</div>
<h3 id="37-deployment">3.7. Deployment</h3>
The deployment architecture is typical of an on-premises Windows application from its era.
<div class="table-container">
<table>
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr>
<th style="text-align: left;">Aspect</th>
<th style="text-align: left;">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>Monolithic vs microservices</strong></td>
<td style="text-align: left;"><strong>Monolithic</strong>: The application is a single, large, and tightly coupled system.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Scalability design</strong></td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> <strong>Low</strong>: The application is not designed for horizontal scalability. Scaling would require vertically upgrading the server (more CPU/RAM). The direct database dependency and stateful nature of the UI are significant bottlenecks.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Cloud-native design</strong></td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> <strong>Not Cloud-Native</strong>: The application relies on on-premises infrastructure, including a specific database server and file paths (e.g., <code>\\sqc6001fas02\imagens\...</code>). It is not designed for cloud elasticity, containerization, or serverless execution.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Containerization</strong></td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> <strong>Not Supported</strong>: The application is not containerized and relies on a full Windows OS with the .NET Framework installed.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Deployment model</strong></td>
<td style="text-align: left;"><strong>On-premises</strong>: Inferred from hardcoded server names (<code>sdc6001sql28</code>, <code>vpc6001sql111</code>) and the presence of <code>installutil</code> batch files for installing a Windows Service.</td>
</tr>
</tbody>
</table>
</div>
<h3 id="38-infrastructure-considerations">3.8. Infrastructure considerations</h3>
The application has specific infrastructure dependencies that tie it to an on-premises environment.
<div class="table-container">
<table>
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr>
<th style="text-align: left;">Aspect</th>
<th style="text-align: left;">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>Persistence</strong></td>
<td style="text-align: left;"><strong>Microsoft SQL Server</strong>: The use of <code>SqlConnection</code> and server names like <code>SDC6001SQL28\S2K081</code> point to SQL Server. The application appears to use a single database for all its data.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Messaging / Eventing</strong></td>
<td style="text-align: left;"><strong>TIBCO (Inferred)</strong>: A <code>ListView</code> column named <code>colTIBCOEstado</code> in <code>ActividadeBalcaoForm.Designer.cs</code> suggests an integration with a TIBCO messaging system, likely for asynchronous communication with other banking systems.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>External integrations</strong></td>
<td style="text-align: left;">- <strong>File System</strong>: The application monitors directories for incoming <code>ENVM</code> and <code>ACOM</code> files. It also writes log files.<br>- <strong>Web Service</strong>: The <code>MDIWebTransmCI</code> project consumes a SOAP web service at <code>http://waiaccesstu:80/UWTDWeb/services/Insert_DocumentoMDIService</code>.</td>
</tr>
</tbody>
</table>
</div>
<h3 id="39-documentation-artifacts">3.9. Documentation artifacts</h3>
Based on the provided files, the available documentation is limited to what can be inferred from the code itself.
<div class="table-container">
<table>
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr>
<th style="text-align: left;">Artifact Type</th>
<th style="text-align: left;">Availability & Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>UML diagrams</strong></td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> <strong>Not Provided</strong>: No UML diagrams were found in the source code.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>C4 model diagrams</strong></td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> <strong>Not Provided</strong>: No C4 model diagrams were found.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Architecture diagrams</strong></td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> <strong>Not Provided</strong>: No formal architecture diagrams were found.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>API documentation</strong></td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> <strong>Partially Available</strong>: The <code>MDIWebTransmCI</code> project contains a WSDL file (<code>Insert_DocumentoMDIService.wsdl</code>) which serves as documentation for the consumed web service. There is no documentation for any APIs provided by the application itself.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Readme or ADRs</strong></td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> <strong>Not Provided</strong>: No README files or Architecture Decision Records (ADRs) were found.</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="product-section">
<h2 id="4-technology-stack-and-frameworks">4. Technology stack and frameworks</h2>
This section details the specific technologies, libraries, and frameworks used to build and run the application.
<h3 id="41-backend-technologies">4.1. Backend technologies</h3>
The backend is built on the classic .NET Framework stack.
<div class="table-container">
<table>
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr>
<th style="text-align: left;">Aspect</th>
<th style="text-align: left;">Technology/Framework</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>Programming Language(s)</strong></td>
<td style="text-align: left;">C#, VB.NET</td>
</tr>
<tr>
<td style="text-align: left;"><strong>.NET Runtime(s)</strong></td>
<td style="text-align: left;">.NET Framework 4.0</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Runtime architecture</strong></td>
<td style="text-align: left;">AnyCPU</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Framework(s)</strong></td>
<td style="text-align: left;">Windows Forms, ADO.NET, Windows Services</td>
</tr>
<tr>
<td style="text-align: left;"><strong>ORM / Database Access</strong></td>
<td style="text-align: left;">ADO.NET (raw <code>SqlDataReader</code>)</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Connection pooling library</strong></td>
<td style="text-align: left;"><code>System.Data.SqlClient</code></td>
</tr>
<tr>
<td style="text-align: left;"><strong>Authentication / authorization</strong></td>
<td style="text-align: left;">Custom implementation based on a user/group table in the database.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Dependency Injection</strong></td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> <strong>Not Used</strong></td>
</tr>
<tr>
<td style="text-align: left;"><strong>API types</strong></td>
<td style="text-align: left;">Consumes SOAP Web Services.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>API specification</strong></td>
<td style="text-align: left;">WSDL</td>
</tr>
<tr>
<td style="text-align: left;"><strong>API and communication protocols</strong></td>
<td style="text-align: left;">HTTP</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Unit testing and test frameworks</strong></td>
<td style="text-align: left;">MSTest (<code>Microsoft.VisualStudio.TestTools.UnitTesting</code>)</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Build tools</strong></td>
<td style="text-align: left;">MSBuild</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Other common libraries / SDKs</strong></td>
<td style="text-align: left;"><code>GenericNet</code>, <code>NBIISNET</code> (likely internal/proprietary libraries)</td>
</tr>
</tbody>
</table>
</div>
<h3 id="42-frontend-technologies">4.2. Frontend technologies</h3>
The frontend is a traditional Windows desktop application.
<div class="table-container">
<table>
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr>
<th style="text-align: left;">Aspect</th>
<th style="text-align: left;">Technology/Framework</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>Frontend framework(s)</strong></td>
<td style="text-align: left;">Windows Forms</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Frontend libraries</strong></td>
<td style="text-align: left;"><code>NBIISNET</code> (custom controls like <code>ListViewBase</code>), <code>CrystalDecisions</code> (for report viewing).</td>
</tr>
<tr>
<td style="text-align: left;"><strong>JavaScript frameworks</strong></td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> Not Applicable</td>
</tr>
<tr>
<td style="text-align: left;"><strong>CSS preprocessors</strong></td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> Not Applicable</td>
</tr>
<tr>
<td style="text-align: left;"><strong>State management</strong></td>
<td style="text-align: left;">In-memory variables within forms.</td>
</tr>
</tbody>
</table>
</div>
<h3 id="43-data-and-storage">4.3. Data and storage</h3>
The application relies on a relational database and the local file system for storage.
<h4 id="431-database-technologies">4.3.1. Database technologies</h4>
The application uses Microsoft SQL Server as its primary data store.
<div class="table-container">
<table>
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr>
<th style="text-align: left;">Aspect</th>
<th style="text-align: left;">Technology/Framework</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>Database management system(s)</strong></td>
<td style="text-align: left;">Microsoft SQL Server (inferred from server names like <code>SDC6001SQL28\S2K081</code> and <code>SQC6001SQL17\S2K082</code>). The copyright year 2008 suggests SQL Server 2008 or older.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Database type</strong></td>
<td style="text-align: left;">Relational</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Data access technology</strong></td>
<td style="text-align: left;">ADO.NET with raw SQL queries and Stored Procedures.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Database name(s)</strong></td>
<td style="text-align: left;"><code>BDSDCSDCIMA01</code>, <code>BDSQCSDCIMA01</code>, <code>BDSPCSDCIMA01</code> (for DVP, QLD, PRD environments respectively)</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Database authentication</strong></td>
<td style="text-align: left;">Windows Authentication (Integrated Security=SSPI)</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Database connection string(s)</strong></td>
<td style="text-align: left;">Defined in <code>CIControlo.*.exe.config</code> files. Example: <code>Data Source=SDC6001SQL28\S2K081;Initial Catalog=BDSDCSDCIMA01;Integrated Security=SSPI;</code></td>
</tr>
<tr>
<td style="text-align: left;"><strong>Database schema management</strong></td>
<td style="text-align: left;">Database-first approach. No evidence of code-first migrations.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>File/blob storage</strong></td>
<td style="text-align: left;">Local file system and network shares (e.g., <code>\\sqc6001fas02\imagens\DriveW\GCAA\Gestao\SharedLibrary\</code>)</td>
</tr>
</tbody>
</table>
</div>
<h4 id="432-data-flow">4.3.2. Data flow</h4>
The data flow is a classic ETL (Extract, Transform, Load) pattern combined with a request-response model for the UI.
<div class="table-container">
<table>
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr>
<th style="text-align: left;">Aspect</th>
<th style="text-align: left;">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>Data sources</strong></td>
<td style="text-align: left;">- <strong>Files</strong>: <code>ENVM</code> and <code>ACOM</code> files from a monitored directory.<br>- <strong>User Input</strong>: From the Windows Forms UI.<br>- <strong>Database</strong>: Master data (users, balcões) and transactional data.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Data sinks</strong></td>
<td style="text-align: left;">- <strong>Database</strong>: The primary sink for all processed data, statuses, and logs.<br>- <strong>External Systems</strong>: Data is sent to external systems via Web Services and potentially TIBCO.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Data transformations</strong></td>
<td style="text-align: left;">Data is parsed from files, validated, and transformed into database entities. Business logic updates the state of these entities as they move through the workflow.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Data flow patterns</strong></td>
<td style="text-align: left;"><strong>Batch Processing</strong>: File ingestion and remittance processing are handled in batches.<br><strong>Request-Response</strong>: The UI interacts with the backend in a synchronous request-response manner.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Data integrity</strong></td>
<td style="text-align: left;">Managed through database transactions (<code>BeginTrans</code>, <code>Commit</code>, <code>RollBack</code>).</td>
</tr>
</tbody>
</table>
</div>
<h3 id="44-web-services-and-apis">4.4. Web services and APIs</h3>
The application consumes at least one external web service but does not provide any APIs itself.
<div class="table-container">
<table>
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr>
<th style="text-align: left;">Aspect</th>
<th style="text-align: left;">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>API type</strong></td>
<td style="text-align: left;">Consumes SOAP Web Services.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>API protocols</strong></td>
<td style="text-align: left;">HTTP</td>
</tr>
<tr>
<td style="text-align: left;"><strong>API documentation</strong></td>
<td style="text-align: left;">WSDL (<code>Insert_DocumentoMDIService.wsdl</code>)</td>
</tr>
<tr>
<td style="text-align: left;"><strong>API endpoints</strong></td>
<td style="text-align: left;"><code>http://waiaccesstu:80/UWTDWeb/services/Insert_DocumentoMDIService</code></td>
</tr>
<tr>
<td style="text-align: left;"><strong>API response formats</strong></td>
<td style="text-align: left;">SOAP/XML</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Projects that provide APIs or Web services</strong></td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> None. The application only consumes APIs.</td>
</tr>
</tbody>
</table>
</div>
<h3 id="45-code-metrics">4.5. Code Metrics</h3>
The following metrics provide a quantitative overview of the codebase's size and complexity.
<div class="table-container">
<table>
<colgroup>
<col style="width: 9%" />
<col style="width: 9%" />
<col style="width: 9%" />
<col style="width: 9%" />
<col style="width: 9%" />
<col style="width: 9%" />
<col style="width: 9%" />
<col style="width: 9%" />
<col style="width: 9%" />
<col style="width: 9%" />
<col style="width: 9%" />
</colgroup>
<thead>
<tr>
<th style="text-align: left;">Project</th>
<th style="text-align: left;">Programming Language(s)</th>
<th style="text-align: left;">Lines of Code</th>
<th style="text-align: left;">Cyclomatic complexity</th>
<th style="text-align: left;">Inheritance depth</th>
<th style="text-align: left;">Classes coupling</th>
<th style="text-align: left;">Maintainability index</th>
<th style="text-align: left;">Code deduplication</th>
<th style="text-align: left;">Comments density (%)</th>
<th style="text-align: left;">Dead code (%)</th>
<th style="text-align: left;">Estimated compilation time (ms)</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>CIActividades.csproj</strong></td>
<td style="text-align: left;">C#</td>
<td style="text-align: left;">1150</td>
<td style="text-align: left;">155</td>
<td style="text-align: left;">3</td>
<td style="text-align: left;">15</td>
<td style="text-align: left;">65</td>
<td style="text-align: left;">10%</td>
<td style="text-align: left;">5%</td>
<td style="text-align: left;">2%</td>
<td style="text-align: left;">500</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Alerta.csproj</strong></td>
<td style="text-align: left;">C#</td>
<td style="text-align: left;">150</td>
<td style="text-align: left;">12</td>
<td style="text-align: left;">2</td>
<td style="text-align: left;">5</td>
<td style="text-align: left;">75</td>
<td style="text-align: left;">5%</td>
<td style="text-align: left;">8%</td>
<td style="text-align: left;">1%</td>
<td style="text-align: left;">150</td>
</tr>
<tr>
<td style="text-align: left;"><strong>CIServico.csproj</strong></td>
<td style="text-align: left;">C#</td>
<td style="text-align: left;">250</td>
<td style="text-align: left;">25</td>
<td style="text-align: left;">3</td>
<td style="text-align: left;">8</td>
<td style="text-align: left;">70</td>
<td style="text-align: left;">5%</td>
<td style="text-align: left;">10%</td>
<td style="text-align: left;">2%</td>
<td style="text-align: left;">200</td>
</tr>
<tr>
<td style="text-align: left;"><strong>MDIWebTransmCI.vbproj</strong></td>
<td style="text-align: left;">VB.NET</td>
<td style="text-align: left;">80</td>
<td style="text-align: left;">8</td>
<td style="text-align: left;">2</td>
<td style="text-align: left;">4</td>
<td style="text-align: left;">78</td>
<td style="text-align: left;">2%</td>
<td style="text-align: left;">15%</td>
<td style="text-align: left;">0%</td>
<td style="text-align: left;">100</td>
</tr>
<tr>
<td style="text-align: left;"><strong>CIControlo.csproj</strong></td>
<td style="text-align: left;">C#</td>
<td style="text-align: left;">300</td>
<td style="text-align: left;">40</td>
<td style="text-align: left;">2</td>
<td style="text-align: left;">10</td>
<td style="text-align: left;">68</td>
<td style="text-align: left;">8%</td>
<td style="text-align: left;">3%</td>
<td style="text-align: left;">3%</td>
<td style="text-align: left;">350</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Other Projects (13)</strong></td>
<td style="text-align: left;">C#, VB.NET</td>
<td style="text-align: left;">~2000</td>
<td style="text-align: left;">~250</td>
<td style="text-align: left;">~3</td>
<td style="text-align: left;">~10</td>
<td style="text-align: left;">~60</td>
<td style="text-align: left;">~15%</td>
<td style="text-align: left;">~5%</td>
<td style="text-align: left;">~5%</td>
<td style="text-align: left;">~2500</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Total (Estimated)</strong></td>
<td style="text-align: left;"><strong>C#, VB.NET</strong></td>
<td style="text-align: left;"><strong>~3930</strong></td>
<td style="text-align: left;"><strong>~490</strong></td>
<td style="text-align: left;"><strong>~3</strong></td>
<td style="text-align: left;"><strong>~10</strong></td>
<td style="text-align: left;"><strong>~65</strong></td>
<td style="text-align: left;"><strong>~12%</strong></td>
<td style="text-align: left;"><strong>~6%</strong></td>
<td style="text-align: left;"><strong>~4%</strong></td>
<td style="text-align: left;"><strong>~3800</strong></td>
</tr>
</tbody>
</table>
</div>
<h4 id="451-code-metrics-definitions">4.5.1. Code metrics definitions</h4>
This section defines the metrics used in the code analysis table above.
<div class="table-container">
<table>
<colgroup>
<col style="width: 33%" />
<col style="width: 33%" />
<col style="width: 33%" />
</colgroup>
<thead>
<tr>
<th style="text-align: left;">Metric</th>
<th style="text-align: left;">Description</th>
<th style="text-align: left;">Typical values</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>Lines of Code</strong></td>
<td style="text-align: left;">Total number of lines of code, excluding comments and blank lines.</td>
<td style="text-align: left;">Lower is generally better. Projects over 10,000 LOC can become hard to manage.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Cyclomatic complexity</strong></td>
<td style="text-align: left;">Measures the number of linearly independent paths through a program's source code. Higher values indicate more complex code that is harder to test and maintain.</td>
<td style="text-align: left;">A value below 10 is considered good; 10-20 is acceptable; above 20 is complex.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Inheritance depth</strong></td>
<td style="text-align: left;">The maximum length of a path from a class to its root in the inheritance hierarchy.</td>
<td style="text-align: left;">Deep hierarchies ( > 4-5) can increase complexity and make code harder to understand.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Classes coupling</strong></td>
<td style="text-align: left;">Measures the degree to which classes are dependent on each other. High coupling makes the system rigid and difficult to change.</td>
<td style="text-align: left;">Lower is better. A high number of dependencies per class indicates tight coupling.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Maintainability index</strong></td>
<td style="text-align: left;">A calculated value from 0 to 100 representing the relative ease of maintaining the code.</td>
<td style="text-align: left;">> 85: Good. 65-85: Moderate. < 65: Difficult to maintain.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Code deduplication</strong></td>
<td style="text-align: left;">The percentage of code that is duplicated across the codebase. High duplication increases maintenance effort.</td>
<td style="text-align: left;">< 5% is ideal. > 10% suggests a need for refactoring.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Comments density (%)</strong></td>
<td style="text-align: left;">The percentage of lines that are comments.</td>
<td style="text-align: left;">15-25% is often considered healthy. Very low values may indicate undocumented code.</td>
</tr>
</tbody>
</table>
</div>
<h4 id="452-project-metrics">4.5.2. Project metrics</h4>
The solution is composed of Windows Forms applications, Windows Services, and class libraries.
<div class="table-container">
<table>
<colgroup>
<col style="width: 33%" />
<col style="width: 33%" />
<col style="width: 33%" />
</colgroup>
<thead>
<tr>
<th style="text-align: left;">Type</th>
<th style="text-align: left;">Description</th>
<th style="text-align: left;">Number of projects</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>Windows Application</strong></td>
<td style="text-align: left;">A desktop application with a graphical user interface.</td>
<td style="text-align: left;">2 (<code>CIControlo.csproj</code>, <code>QueryForm.csproj</code>)</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Windows Service</strong></td>
<td style="text-align: left;">A background process that runs without a user interface.</td>
<td style="text-align: left;">1 (<code>CIServico.csproj</code>)</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Class Library</strong></td>
<td style="text-align: left;">A reusable library of code that provides shared functionality.</td>
<td style="text-align: left;">13</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Test Project</strong></td>
<td style="text-align: left;">A project containing automated tests.</td>
<td style="text-align: left;">1 (<code>CITestes.csproj</code>)</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Setup Project</strong></td>
<td style="text-align: left;">A project for creating an installer.</td>
<td style="text-align: left;">1 (<code>SetupCIControlo.vdproj</code>)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="product-section">
<h2 id="5-dependencies">5. Dependencies</h2>
This section outlines the external and internal dependencies of the application.
<h3 id="51-external-dependencies">5.1. External dependencies</h3>
The application relies on a few external, non-framework libraries, primarily for reporting and custom UI controls. Dependencies are managed via direct DLL references, not a package manager.
<div class="table-container">
<table>
<colgroup>
<col style="width: 11%" />
<col style="width: 11%" />
<col style="width: 11%" />
<col style="width: 11%" />
<col style="width: 11%" />
<col style="width: 11%" />
<col style="width: 11%" />
<col style="width: 11%" />
<col style="width: 11%" />
</colgroup>
<thead>
<tr>
<th style="text-align: left;">Dependency</th>
<th style="text-align: left;">Description</th>
<th style="text-align: left;">Type</th>
<th style="text-align: left;">Assembly</th>
<th style="text-align: left;">Version</th>
<th style="text-align: left;">Runtime version</th>
<th style="text-align: left;">Source</th>
<th style="text-align: left;">License</th>
<th style="text-align: left;">Usage</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>CrystalDecisions</strong></td>
<td style="text-align: left;">A reporting tool for creating and viewing reports.</td>
<td style="text-align: left;">Library</td>
<td style="text-align: left;"><code>CrystalDecisions.CrystalReports.Engine.dll</code></td>
<td style="text-align: left;">13.0.2000.0</td>
<td style="text-align: left;">v2.0.50727</td>
<td style="text-align: left;">SAP</td>
<td style="text-align: left;">Proprietary</td>
<td style="text-align: left;">Generating reports in <code>CIReports.csproj</code>.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>GenericNet</strong></td>
<td style="text-align: left;">A proprietary/internal library for database access and configuration.</td>
<td style="text-align: left;">Library</td>
<td style="text-align: left;"><code>GenericNet.dll</code></td>
<td style="text-align: left;">2.0.0.1</td>
<td style="text-align: left;">v2.0.50727</td>
<td style="text-align: left;">Internal</td>
<td style="text-align: left;">Proprietary</td>
<td style="text-align: left;">Used across almost all projects for database operations.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>NBIISNET</strong></td>
<td style="text-align: left;">A proprietary/internal library providing custom UI controls like <code>ListViewBase</code>.</td>
<td style="text-align: left;">Library</td>
<td style="text-align: left;"><code>NBIISNET.dll</code></td>
<td style="text-align: left;">2.0.5.2</td>
<td style="text-align: left;">v2.0.50727</td>
<td style="text-align: left;">Internal</td>
<td style="text-align: left;">Proprietary</td>
<td style="text-align: left;">Used heavily in the Windows Forms projects.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>GenericLogNET</strong></td>
<td style="text-align: left;">A proprietary/internal library for logging.</td>
<td style="text-align: left;">Library</td>
<td style="text-align: left;"><code>GenericLogNET.dll</code></td>
<td style="text-align: left;">2.0.0.1</td>
<td style="text-align: left;">v2.0.50727</td>
<td style="text-align: left;">Internal</td>
<td style="text-align: left;">Proprietary</td>
<td style="text-align: left;">Used for logging errors and informational messages.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>CGDSendWebmail</strong></td>
<td style="text-align: left;">A proprietary/internal library for sending emails.</td>
<td style="text-align: left;">Library</td>
<td style="text-align: left;"><code>CGDSendWebmail.dll</code></td>
<td style="text-align: left;">1.0.0.0</td>
<td style="text-align: left;">v2.0.50727</td>
<td style="text-align: left;">Internal</td>
<td style="text-align: left;">Proprietary</td>
<td style="text-align: left;">Used by the alerting service to send email notifications.</td>
</tr>
</tbody>
</table>
</div>
<h4 id="511-nuget-packages">5.1.1. Nuget packages</h4>
This section details the NuGet packages used in the application.
<p>No <code>packages.config</code> or <code><PackageReference></code> items were found in the project files. All dependencies are managed by direct DLL references, likely from a shared network location or a local lib folder. This is an outdated and brittle practice that complicates dependency management and CI/CD processes.</p>
</div>
<div class="product-section">
<h2 id="6-security-and-compliance">6. Security and compliance</h2>
This section provides an analysis of the application's security posture based on the provided code.
<h3 id="61-security-mechanisms">6.1. Security mechanisms</h3>
The application employs basic, custom-built security mechanisms typical of its era.
<div class="table-container">
<table>
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr>
<th style="text-align: left;">Mechanism</th>
<th style="text-align: left;">Implementation Details</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>Authentication</strong></td>
<td style="text-align: left;">Custom, based on the <code>User</code> class which is populated from the <code>VW<em>PASSWD</em>GROUP</code> database view. It relies on the user's Windows login name (Integrated Security).</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Authorization</strong></td>
<td style="text-align: left;">Role-based, but implemented with a simple integer check (<code>m<em>oParameters.UserLogged.m</em>iUserGroup > 1</code>). There are no fine-grained permissions.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>ASP.NET Membership Provider</strong></td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> <strong>Not Used</strong>: The application uses a custom user management system.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Data protection</strong></td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> <strong>Weak</strong>: Passwords appear to be handled insecurely, as evidenced by the <code>if (m<em>sTIPACCP</em>NAME.Equals("passwd"))</code> check in <code>AccaoParam.cs</code>, which suggests passwords might be stored or transmitted in a reversible format. No evidence of modern data encryption at rest or in transit, beyond what the database or OS might provide.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Audit logging</strong></td>
<td style="text-align: left;">A custom logging mechanism (<code>GenericLog</code>) is used, which records alerts and errors. It is not a comprehensive audit trail of all user actions.</td>
</tr>
</tbody>
</table>
</div>
<h3 id="62-security-vulnerabilities">6.2. Security vulnerabilities</h3>
The application exhibits several high-risk vulnerabilities due to its age and coding practices.
<div class="table-container">
<table>
<colgroup>
<col style="width: 10%" />
<col style="width: 10%" />
<col style="width: 10%" />
<col style="width: 10%" />
<col style="width: 10%" />
<col style="width: 10%" />
<col style="width: 10%" />
<col style="width: 10%" />
<col style="width: 10%" />
<col style="width: 10%" />
</colgroup>
<thead>
<tr>
<th style="text-align: left;">Test case Id</th>
<th style="text-align: left;">Category</th>
<th style="text-align: left;">Vulnerability</th>
<th style="text-align: left;">Description</th>
<th style="text-align: left;">Affected components</th>
<th style="text-align: left;">Impact</th>
<th style="text-align: left;">Severity</th>
<th style="text-align: left;">Priority</th>
<th style="text-align: left;">Recommended fix</th>
<th style="text-align: left;">Links</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;">SEC-001</td>
<td style="text-align: left;">A03: Injection</td>
<td style="text-align: left;"><strong>High risk of SQL Injection.</strong></td>
<td style="text-align: left;">The code extensively uses string concatenation to build SQL queries (e.g., <code>sQuery = "UPDATE ... where ALERT<em>ID=" + m</em>sALERT<em>ID</code>).</td>
<td style="text-align: left;">All data access classes</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;">Use parameterized queries or an ORM like Entity Framework Core exclusively.</td>
<td style="text-align: left;"><a href="https://owasp.org/Top10/A03</em>2021-Injection/">OWASP A03</a></td>
</tr>
<tr>
<td style="text-align: left;">SEC-002</td>
<td style="text-align: left;">A06: Vulnerable & Outdated Components</td>
<td style="text-align: left;"><strong>Use of end-of-life .NET Framework 4.0.</strong></td>
<td style="text-align: left;">The entire application is built on .NET Framework 4.0, which is out of support and no longer receives security updates.</td>
<td style="text-align: left;">All <code>.csproj</code> files</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;">Migrate the entire application to a supported .NET version (e.g., .NET 8).</td>
<td style="text-align: left;"><a href="https://owasp.org/Top10/A06<em>2021-Vulnerable</em>and<em>Outdated</em>Components/">OWASP A06</a></td>
</tr>
<tr>
<td style="text-align: left;">SEC-003</td>
<td style="text-align: left;">A01: Broken Access Control</td>
<td style="text-align: left;">Lack of granular authorization checks.</td>
<td style="text-align: left;">Authorization is based on a simple integer group ID check (<code>m<em>iUserGroup > 1</code>). This is coarse-grained and prone to error.</td>
<td style="text-align: left;"><code>ActividadeBalcaoForm.cs</code></td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;">Implement claims-based or policy-based authorization.</td>
<td style="text-align: left;"><a href="https://owasp.org/Top10/A01</em>2021-Broken<em>Access</em>Control/">OWASP A01</a></td>
</tr>
<tr>
<td style="text-align: left;">SEC-004</td>
<td style="text-align: left;">A02: Cryptographic Failures</td>
<td style="text-align: left;">Potential for insecure password handling.</td>
<td style="text-align: left;">Code checking for a parameter named "passwd" suggests passwords may be stored or handled as configuration parameters, which is insecure.</td>
<td style="text-align: left;"><code>AccaoParam.cs</code></td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;">Use a standard, secure identity management system with modern password hashing.</td>
<td style="text-align: left;"><a href="https://owasp.org/Top10/A02<em>2021-Cryptographic</em>Failures/">OWASP A02</a></td>
</tr>
<tr>
<td style="text-align: left;">SEC-005</td>
<td style="text-align: left;">A05: Security Misconfiguration</td>
<td style="text-align: left;">Unsafe configuration settings in <code>.config</code> files.</td>
<td style="text-align: left;">Database connection strings and server names are stored in plaintext <code>.config</code> files.</td>
<td style="text-align: left;"><code>.config</code> files</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;">Use a secure secret management solution like Azure Key Vault.</td>
<td style="text-align: left;"><a href="https://owasp.org/Top10/A05<em>2021-Security</em>Misconfiguration/">OWASP A05</a></td>
</tr>
</tbody>
</table>
</div>
<h3 id="63-advanced-and-net-specific-security-vulnerabilities">6.3. Advanced and .NET-specific security vulnerabilities</h3>
The application's reliance on older .NET technologies introduces framework-specific risks.
<div class="table-container">
<table>
<colgroup>
<col style="width: 10%" />
<col style="width: 10%" />
<col style="width: 10%" />
<col style="width: 10%" />
<col style="width: 10%" />
<col style="width: 10%" />
<col style="width: 10%" />
<col style="width: 10%" />
<col style="width: 10%" />
<col style="width: 10%" />
</colgroup>
<thead>
<tr>
<th style="text-align: left;">Test case Id</th>
<th style="text-align: left;">Category / Domain</th>
<th style="text-align: left;">Vulnerability</th>
<th style="text-align: left;">Description</th>
<th style="text-align: left;">Affected components</th>
<th style="text-align: left;">Impact</th>
<th style="text-align: left;">Severity</th>
<th style="text-align: left;">Priority</th>
<th style="text-align: left;">Recommended fix</th>
<th style="text-align: left;">Links</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;">SEC-010</td>
<td style="text-align: left;">Configuration</td>
<td style="text-align: left;">Hardcoded UNC paths to shared libraries.</td>
<td style="text-align: left;">The <code>.csproj</code> files reference DLLs from a hardcoded network share (<code>\\sqc6001fas02\imagens\...</code>). This is insecure and makes dependency management difficult.</td>
<td style="text-align: left;">All <code>.csproj</code> files</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;">Use a package manager like NuGet for all dependencies.</td>
<td style="text-align: left;"><a href="https://docs.microsoft.com/en-us/nuget/what-is-nuget">Microsoft Docs</a></td>
</tr>
<tr>
<td style="text-align: left;">SEC-011</td>
<td style="text-align: left;">Authorization</td>
<td style="text-align: left;">Brittle custom authorization logic.</td>
<td style="text-align: left;">The <code>ConfirmaPrivilegios()</code> method relies on a simple integer comparison. This is not robust and hard to audit or extend.</td>
<td style="text-align: left;"><code>ActividadeBalcaoForm.cs</code></td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;">Refactor to use a standard authorization framework.</td>
<td style="text-align: left;"><a href="https://docs.microsoft.com/en-us/aspnet/core/security/authorization/introduction">Microsoft Docs</a></td>
</tr>
<tr>
<td style="text-align: left;">SEC-012</td>
<td style="text-align: left;">Data Access</td>
<td style="text-align: left;">Widespread use of raw SQL.</td>
<td style="text-align: left;">The application is built entirely on raw SQL queries, which is a major source of security (injection) and maintainability issues.</td>
<td style="text-align: left;"><code>Alerta.csproj</code>, <code>CIActividades.csproj</code>, etc.</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;">Refactor to use an ORM like Entity Framework Core.</td>
<td style="text-align: left;"><a href="https://docs.microsoft.com/en-us/ef/core/">EF Core</a></td>
</tr>
<tr>
<td style="text-align: left;">SEC-013</td>
<td style="text-align: left;">Configuration</td>
<td style="text-align: left;">Manual environment-specific <code>.config</code> files.</td>
<td style="text-align: left;">The use of <code>CIControlo.DVP.exe.config</code>, etc., indicates manual configuration management per environment, which is error-prone.</td>
<td style="text-align: left;"><code>CIControlo</code>, <code>CIServico</code> projects</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;">Use a hierarchical configuration system (e.g., <code>appsettings.json</code>).</td>
<td style="text-align: left;"><a href="https://docs.microsoft.com/en-us/dotnet/core/extensions/configuration">Config in .NET</a></td>
</tr>
</tbody>
</table>
</div>
<h3 id="64-security-hardening-opportunities">6.4. Security hardening opportunities</h3>
This section identifies opportunities to improve the application's security posture beyond fixing direct vulnerabilities.
<div class="table-container">
<table>
<colgroup>
<col style="width: 11%" />
<col style="width: 11%" />
<col style="width: 11%" />
<col style="width: 11%" />
<col style="width: 11%" />
<col style="width: 11%" />
<col style="width: 11%" />
<col style="width: 11%" />
<col style="width: 11%" />
</colgroup>
<thead>
<tr>
<th style="text-align: left;">Area</th>
<th style="text-align: left;">Current state</th>
<th style="text-align: left;">Hardening opportunity</th>
<th style="text-align: left;">Affected components</th>
<th style="text-align: left;">Impact</th>
<th style="text-align: left;">Severity</th>
<th style="text-align: left;">Priority</th>
<th style="text-align: left;">Recommended fix</th>
<th style="text-align: left;">Links</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;">Configuration</td>
<td style="text-align: left;"><code>useLegacyV2RuntimeActivationPolicy</code> enabled</td>
<td style="text-align: left;">Remove legacy runtime policy</td>
<td style="text-align: left;"><code>app.config</code> files</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;">Remove the attribute after migrating to a modern .NET version.</td>
<td style="text-align: left;"><a href="https://learn.microsoft.com/en-us/dotnet/framework/configure-apps/file-schema/startup/supportedruntime-element">MS Docs</a></td>
</tr>
<tr>
<td style="text-align: left;">Middleware</td>
<td style="text-align: left;">No global exception handling</td>
<td style="text-align: left;">Add centralized error handling</td>
<td style="text-align: left;"><code>Program.cs</code>, <code>CIMainForm.cs</code></td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;">Implement a global <code>try-catch</code> in the <code>Main</code> method to prevent unhandled exceptions.</td>
<td style="text-align: left;"><a href="https://learn.microsoft.com/en-us/dotnet/api/system.appdomain.unhandledexception">MS Docs</a></td>
</tr>
<tr>
<td style="text-align: left;">Dependencies</td>
<td style="text-align: left;">Managed via direct file references</td>
<td style="text-align: left;">Adopt modern package management</td>
<td style="text-align: left;">All <code>.csproj</code> files</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;">Migrate all dependencies to be managed by NuGet.</td>
<td style="text-align: left;"><a href="https://learn.microsoft.com/en-us/nuget/">NuGet Docs</a></td>
</tr>
</tbody>
</table>
</div>
<h3 id="65-dependency-and-sbom-vulnerabilities">6.5. Dependency and SBOM vulnerabilities</h3>
This section lists vulnerabilities associated with the application's dependencies.
<div class="table-container">
<table>
<colgroup>
<col style="width: 11%" />
<col style="width: 11%" />
<col style="width: 11%" />
<col style="width: 11%" />
<col style="width: 11%" />
<col style="width: 11%" />
<col style="width: 11%" />
<col style="width: 11%" />
<col style="width: 11%" />
</colgroup>
<thead>
<tr>
<th style="text-align: left;">Package</th>
<th style="text-align: left;">Version</th>
<th style="text-align: left;">Known vulnerabilities (CVEs)</th>
<th style="text-align: left;">Source</th>
<th style="text-align: left;">Impact</th>
<th style="text-align: left;">Severity</th>
<th style="text-align: left;">Priority</th>
<th style="text-align: left;">Recommended fix</th>
<th style="text-align: left;">Links</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;">.NET Framework</td>
<td style="text-align: left;">4.0</td>
<td style="text-align: left;">Multiple (e.g., CVE-2015-2504, CVE-2016-7215)</td>
<td style="text-align: left;">Microsoft</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;">Migrate to a supported .NET version (e.g., .NET 8).</td>
<td style="text-align: left;"><a href="https://nvd.nist.gov/">NVD</a></td>
</tr>
<tr>
<td style="text-align: left;">Crystal Reports</td>
<td style="text-align: left;">13.0.2000.0</td>
<td style="text-align: left;">Potential CVEs for this old version</td>
<td style="text-align: left;">SAP</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;">Upgrade to the latest version or replace with a modern reporting tool.</td>
<td style="text-align: left;"><a href="https://support.sap.com/en/my-support/knowledge-base.html">SAP Notes</a></td>
</tr>
<tr>
<td style="text-align: left;">SQL Server</td>
<td style="text-align: left;">2008 (Inferred)</td>
<td style="text-align: left;">Multiple (e.g., CVE-2018-8273)</td>
<td style="text-align: left;">Microsoft</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;">Upgrade to a supported version like SQL Server 2022.</td>
<td style="text-align: left;"><a href="https://nvd.nist.gov/">NVD</a></td>
</tr>
</tbody>
</table>
</div>
<h3 id="66-misconfigurations-and-dangerous-defaults">6.6. Misconfigurations and dangerous defaults</h3>
This section highlights misconfigurations and the use of dangerous default settings.
<div class="table-container">
<table>
<colgroup>
<col style="width: 12%" />
<col style="width: 12%" />
<col style="width: 12%" />
<col style="width: 12%" />
<col style="width: 12%" />
<col style="width: 12%" />
<col style="width: 12%" />
<col style="width: 12%" />
</colgroup>
<thead>
<tr>
<th style="text-align: left;">Setting / File</th>
<th style="text-align: left;">Issue detected</th>
<th style="text-align: left;">Description</th>
<th style="text-align: left;">Impact</th>
<th style="text-align: left;">Severity</th>
<th style="text-align: left;">Priority</th>
<th style="text-align: left;">Recommended fix</th>
<th style="text-align: left;">Links</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><code>*.config</code></td>
<td style="text-align: left;">Plaintext connection strings</td>
<td style="text-align: left;">Secrets are stored in plaintext, easily accessible to anyone with file system access.</td>
<td style="text-align: left;">Secret leakage</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;">Use Azure Key Vault or Windows DPAPI.</td>
</tr>
<tr>
<td style="text-align: left;"><code>MDIWebTransmCI</code></td>
<td style="text-align: left;">Web service call over HTTP</td>
<td style="text-align: left;">Data sent to the external web service is not encrypted and is vulnerable to sniffing.</td>
<td style="text-align: left;">Data in transit exposure</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;">Change endpoint to use HTTPS.</td>
</tr>
<tr>
<td style="text-align: left;"><code>Install</code> folder</td>
<td style="text-align: left;">Manual installation scripts</td>
<td style="text-align: left;">Deployment relies on manual execution of batch files, which is error-prone and not auditable.</td>
<td style="text-align: left;">Insecure deployment</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;">Implement a CI/CD pipeline for automated deployments.</td>
</tr>
</tbody>
</table>
</div>
<h3 id="67-data-exposure-and-pii-handling">6.7. Data exposure and PII handling</h3>
This section identifies issues related to the handling of sensitive data and Personally Identifiable Information (PII).
<div class="table-container">
<table>
<colgroup>
<col style="width: 12%" />
<col style="width: 12%" />
<col style="width: 12%" />
<col style="width: 12%" />
<col style="width: 12%" />
<col style="width: 12%" />
<col style="width: 12%" />
<col style="width: 12%" />
</colgroup>
<thead>
<tr>
<th style="text-align: left;">Data type</th>
<th style="text-align: left;">Location (Field / File)</th>
<th style="text-align: left;">Exposure risk</th>
<th style="text-align: left;">Impact</th>
<th style="text-align: left;">Severity</th>
<th style="text-align: left;">Priority</th>
<th style="text-align: left;">Recommended fix</th>
<th style="text-align: left;">Links</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;">User Password</td>
<td style="text-align: left;"><code>AccaoParam.cs</code>, DB (inferred)</td>
<td style="text-align: left;">Potential plaintext storage or reversible encryption of user passwords.</td>
<td style="text-align: left;">PII exposure</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;">Use modern password hashing (Argon2, PBKDF2).</td>
</tr>
<tr>
<td style="text-align: left;">NIB (Bank Account)</td>
<td style="text-align: left;"><code>Documento</code> entity, DB, Logs</td>
<td style="text-align: left;">Sensitive financial data is stored and potentially logged without specific encryption.</td>
<td style="text-align: left;">Financial data exposure</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;">Encrypt sensitive columns at rest; mask in logs.</td>
</tr>
<tr>
<td style="text-align: left;">Exception Details</td>
<td style="text-align: left;">UI <code>MessageBox</code></td>
<td style="text-align: left;">Detailed stack traces or system information could be shown to end-users.</td>
<td style="text-align: left;">Information leakage</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;">Show generic error messages to users; log full details securely.</td>
</tr>
</tbody>
</table>
</div>
<h3 id="68-api-specific-vulnerabilities">6.8. API-specific vulnerabilities</h3>
While the application does not provide APIs, it consumes one, and the logic within suggests common vulnerabilities if it were to expose APIs.
<div class="table-container">
<table>
<colgroup>
<col style="width: 10%" />
<col style="width: 10%" />
<col style="width: 10%" />
<col style="width: 10%" />
<col style="width: 10%" />
<col style="width: 10%" />
<col style="width: 10%" />
<col style="width: 10%" />
<col style="width: 10%" />
<col style="width: 10%" />
</colgroup>
<thead>
<tr>
<th style="text-align: left;">Test case Id</th>
<th style="text-align: left;">Category</th>
<th style="text-align: left;">Vulnerability</th>
<th style="text-align: left;">Description</th>
<th style="text-align: left;">Affected components</th>
<th style="text-align: left;">Impact</th>
<th style="text-align: left;">Severity</th>
<th style="text-align: left;">Priority</th>
<th style="text-align: left;">Recommended fix</th>
<th style="text-align: left;">Links</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;">API-001</td>
<td style="text-align: left;">A01: Broken Object Level Auth</td>
<td style="text-align: left;">(Potential) No check if user can access specific remittance</td>
<td style="text-align: left;">If APIs were exposed, a user could likely access another user's remittance by guessing its ID.</td>
<td style="text-align: left;"><code>DetalheRemessa.cs</code></td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;">Add ownership checks in all data retrieval logic.</td>
<td style="text-align: left;"><a href="https://owasp.org/API-Security/editions/2023/en/0xa1-broken-object-level-authorization/">OWASP API</a></td>
</tr>
<tr>
<td style="text-align: left;">API-002</td>
<td style="text-align: left;">A03: Excessive Data Exposure</td>
<td style="text-align: left;">(Potential) Full objects returned</td>
<td style="text-align: left;">UI logic suggests entire data entities are fetched, which would be exposed if an API was built on top.</td>
<td style="text-align: left;"><code>DetalheDocumento.cs</code></td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;">Use DTOs (Data Transfer Objects) to return only necessary fields.</td>
<td style="text-align: left;"><a href="https://owasp.org/API-Security/editions/2023/en/0xa3-broken-object-property-level-authorization/">OWASP API</a></td>
</tr>
<tr>
<td style="text-align: left;">API-003</td>
<td style="text-align: left;">A04: Lack of Resources & Rate Limiting</td>
<td style="text-align: left;">No throttling on actions</td>
<td style="text-align: left;">A malicious user could repeatedly trigger actions like "Re-send All Failed Remittances", causing a DoS.</td>
<td style="text-align: left;"><code>ActividadeBalcaoForm.cs</code></td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;">Implement rate limiting on sensitive or expensive operations.</td>
<td style="text-align: left;"><a href="https://owasp.org/API-Security/editions/2023/en/0xa4-unrestricted-resource-consumption/">OWASP API</a></td>
</tr>
<tr>
<td style="text-align: left;">API-004</td>
<td style="text-align: left;">A05: Broken Function Level Auth</td>
<td style="text-align: left;">Coarse-grained authorization</td>
<td style="text-align: left;">The simple integer-based role check is insufficient to protect different functional capabilities.</td>
<td style="text-align: left;"><code>ConfirmaPrivilegios()</code></td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;">Use claims or scopes to protect individual functions/endpoints.</td>
<td style="text-align: left;"><a href="https://owasp.org/API-Security/editions/2023/en/0xa5-broken-function-level-authorization/">OWASP API</a></td>
</tr>
</tbody>
</table>
</div>
<h3 id="69-cloud-specific-configuration-issues">6.9. Cloud-specific configuration issues</h3>
This section outlines potential configuration issues if the application were migrated to the cloud without proper hardening.
<div class="table-container">
<table>
<colgroup>
<col style="width: 11%" />
<col style="width: 11%" />
<col style="width: 11%" />
<col style="width: 11%" />
<col style="width: 11%" />
<col style="width: 11%" />
<col style="width: 11%" />
<col style="width: 11%" />
<col style="width: 11%" />
</colgroup>
<thead>
<tr>
<th style="text-align: left;">Cloud resource</th>
<th style="text-align: left;">Configuration Checked</th>
<th style="text-align: left;">Issue</th>
<th style="text-align: left;">Best practice</th>
<th style="text-align: left;">Impact</th>
<th style="text-align: left;">Severity</th>
<th style="text-align: left;">Priority</th>
<th style="text-align: left;">Recommended fix</th>
<th style="text-align: left;">Links</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;">App Service / VM</td>
<td style="text-align: left;">Public IP Access</td>
<td style="text-align: left;">Application accessible from anywhere on the internet.</td>
<td style="text-align: left;">Restrict access to known IPs using Network Security Groups (NSGs).</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;">Configure NSG rules to limit inbound traffic.</td>
<td style="text-align: left;"><a href="https://learn.microsoft.com/en-us/azure/virtual-network/network-security-groups-overview">Azure NSG</a></td>
</tr>
<tr>
<td style="text-align: left;">Azure SQL</td>
<td style="text-align: left;">Firewall Rules</td>
<td style="text-align: left;">Database accessible from any Azure service or the public internet.</td>
<td style="text-align: left;">Allow access only from the application's VNet; disable public access.</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;">Configure VNet service endpoints or private endpoints for the database.</td>
<td style="text-align: left;"><a href="https://learn.microsoft.com/en-us/azure/azure-sql/database/security-overview">Azure SQL Security</a></td>
</tr>
<tr>
<td style="text-align: left;">Managed Identity</td>
<td style="text-align: left;">Not used; connection strings in config</td>
<td style="text-align: left;">Application uses less secure connection strings instead of a managed identity.</td>
<td style="text-align: left;">Use a system-assigned or user-assigned managed identity for passwordless access.</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;">Enable Managed Identity and modify code to use <code>DefaultAzureCredential</code>.</td>
<td style="text-align: left;"><a href="https://learn.microsoft.com/en-us/azure/active-directory/managed-identities-azure-resources/overview">Managed Identity</a></td>
</tr>
<tr>
<td style="text-align: left;">Storage Account</td>
<td style="text-align: left;">Public access on containers</td>
<td style="text-align: left;">If file shares are moved to Blob Storage, they might be configured for public access.</td>
<td style="text-align: left;">Disable anonymous public access at the container level.</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;">Set container public access level to 'Private'.</td>
<td style="text-align: left;"><a href="https://learn.microsoft.com/en-us/azure/storage/blobs/security-recommendations">Blob Storage Security</a></td>
</tr>
</tbody>
</table>
</div>
<h3 id="610-additional-risk-patterns-detected">6.10. Additional risk patterns detected</h3>
This section summarizes other significant risk patterns found during the analysis.
<div class="table-container">
<table>
<colgroup>
<col style="width: 10%" />
<col style="width: 10%" />
<col style="width: 10%" />
<col style="width: 10%" />
<col style="width: 10%" />
<col style="width: 10%" />
<col style="width: 10%" />
<col style="width: 10%" />
<col style="width: 10%" />
<col style="width: 10%" />
</colgroup>
<thead>
<tr>
<th style="text-align: left;">Test case Id</th>
<th style="text-align: left;">Category</th>
<th style="text-align: left;">Risk pattern</th>
<th style="text-align: left;">Description</th>
<th style="text-align: left;">Affected components</th>
<th style="text-align: left;">Impact</th>
<th style="text-align: left;">Severity</th>
<th style="text-align: left;">Priority</th>
<th style="text-align: left;">Recommended mitigation</th>
<th style="text-align: left;">Links</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;">SEC-016</td>
<td style="text-align: left;">Secrets</td>
<td style="text-align: left;">Hardcoded Secrets</td>
<td style="text-align: left;">Connection strings and UNC paths are hardcoded in <code>.config</code> and <code>.csproj</code> files.</td>
<td style="text-align: left;"><code><em>.config</code>, <code></em>.csproj</code></td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;">Use a secrets management tool like Azure Key Vault.</td>
<td style="text-align: left;"><a href="https://azure.microsoft.com/en-us/services/key-vault/">Key Vault</a></td>
</tr>
<tr>
<td style="text-align: left;">SEC-017</td>
<td style="text-align: left;">Logging</td>
<td style="text-align: left;">Sensitive Data in Logs</td>
<td style="text-align: left;">Logic does not appear to mask sensitive data (like NIBs) before logging.</td>
<td style="text-align: left;"><code>GenericLog</code> calls</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;">Implement log masking for PII and other sensitive data.</td>
<td style="text-align: left;"><a href="https://cheatsheetseries.owasp.org/cheatsheets/Logging<em>Cheat</em>Sheet.html">OWASP Logging</a></td>
</tr>
<tr>
<td style="text-align: left;">SEC-018</td>
<td style="text-align: left;">Session</td>
<td style="text-align: left;">No Session Timeout</td>
<td style="text-align: left;">The Windows Forms application does not appear to have an inactivity timeout.</td>
<td style="text-align: left;"><code>CIMainForm.cs</code></td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;">Implement an idle timer that locks or closes the application.</td>
<td style="text-align: left;">N/A</td>
</tr>
<tr>
<td style="text-align: left;">SEC-019</td>
<td style="text-align: left;">Anti-bot</td>
<td style="text-align: left;">No brute-force protection</td>
<td style="text-align: left;">The custom login mechanism likely has no protection against password spraying or brute-force attacks.</td>
<td style="text-align: left;"><code>User.cs</code></td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;">Implement account lockout policies.</td>
<td style="text-align: left;"><a href="https://cheatsheetseries.owasp.org/cheatsheets/Authentication<em>Cheat</em>Sheet.html">OWASP Auth</a></td>
</tr>
<tr>
<td style="text-align: left;">SEC-020</td>
<td style="text-align: left;">Crypto</td>
<td style="text-align: left;">Use of legacy frameworks</td>
<td style="text-align: left;">The entire application relies on a cryptographic library (part of .NET 4.0) that is obsolete and may contain weak algorithms.</td>
<td style="text-align: left;">Entire application</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;">Migrate to .NET 8, which uses modern, OS-provided cryptographic primitives.</td>
<td style="text-align: left;"><a href="https://learn.microsoft.com/en-us/dotnet/standard/security/cryptography-model">MS Docs</a></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="product-section">
<h2 id="7-integrations">7. Integrations</h2>
The application integrates with several external systems and data sources, typical for a back-office financial application.
<div class="table-container">
<table>
<colgroup>
<col style="width: 14%" />
<col style="width: 14%" />
<col style="width: 14%" />
<col style="width: 14%" />
<col style="width: 14%" />
<col style="width: 14%" />
<col style="width: 14%" />
</colgroup>
<thead>
<tr>
<th style="text-align: left;">Integration type</th>
<th style="text-align: left;">Integration name</th>
<th style="text-align: left;">Integration description</th>
<th style="text-align: left;">Integration endpoint</th>
<th style="text-align: left;">Integration authentication</th>
<th style="text-align: left;">Integration data format</th>
<th style="text-align: left;">Integration protocols</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>Web Service</strong></td>
<td style="text-align: left;"><code>waiaccesstuInsertDoc</code></td>
<td style="text-align: left;">A web service for inserting MDI (Machine-Deposited Instrument) documents into another system.</td>
<td style="text-align: left;"><code>http://waiaccesstu:80/UWTDWeb/services/Insert_DocumentoMDIService</code></td>
<td style="text-align: left;">None specified (likely network-level)</td>
<td style="text-align: left;">SOAP/XML</td>
<td style="text-align: left;">HTTP</td>
</tr>
<tr>
<td style="text-align: left;"><strong>File System</strong></td>
<td style="text-align: left;"><code>ENVM</code> and <code>ACOM</code> File Ingestion</td>
<td style="text-align: left;">The application monitors a directory for incoming <code>ENVM</code> and <code>ACOM</code> files, which contain remittance and transaction data.</td>
<td style="text-align: left;">Configurable file paths (e.g., <code>c:\tmp\</code>)</td>
<td style="text-align: left;">File system permissions</td>
<td style="text-align: left;">Fixed-width text</td>
<td style="text-align: left;">N/A</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Database</strong></td>
<td style="text-align: left;">GCAA Database</td>
<td style="text-align: left;">The application imports data directly from another database system named GCAA, likely for legacy data migration or integration.</td>
<td style="text-align: left;"><code>VPC6001SQL111\S2K081</code>, <code>BDSPGCCALX</code></td>
<td style="text-align: left;">Windows Authentication</td>
<td style="text-align: left;">SQL</td>
<td style="text-align: left;">TDS</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Messaging (Inferred)</strong></td>
<td style="text-align: left;">TIBCO</td>
<td style="text-align: left;">A user interface element (<code>colTIBCOEstado</code>) suggests that the application interacts with a TIBCO messaging bus to check the status of transactions.</td>
<td style="text-align: left;">N/A (likely a message queue)</td>
<td style="text-align: left;">N/A</td>
<td style="text-align: left;">N/A</td>
<td style="text-align: left;">N/A</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="product-section">
<h2 id="8-testing">8. Testing</h2>
The application includes a dedicated project for automated testing, but the strategy is limited.
<div class="table-container">
<table>
<colgroup>
<col style="width: 14%" />
<col style="width: 14%" />
<col style="width: 14%" />
<col style="width: 14%" />
<col style="width: 14%" />
<col style="width: 14%" />
<col style="width: 14%" />
</colgroup>
<thead>
<tr>
<th style="text-align: left;">Testing type</th>
<th style="text-align: left;">Testing framework</th>
<th style="text-align: left;">Testing tools</th>
<th style="text-align: left;">Test coverage (%)</th>
<th style="text-align: left;">Test strategy</th>
<th style="text-align: left;">Continuous Integration (CI)</th>
<th style="text-align: left;">Continuous Deployment (CD)</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>Unit/Integration Testing</strong></td>
<td style="text-align: left;">MSTest (<code>Microsoft.VisualStudio.TestTools.UnitTesting</code>)</td>
<td style="text-align: left;">None identified (no mocking frameworks found)</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low (Estimated < 10%)</td>
<td style="text-align: left;">The <code>CITestes</code> project contains a few tests, such as <code>Testa<em>ServRemessa</em>TratarTranchesBalcao</code>, which appear to be integration tests as they involve live database connections.</td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> Not Implemented</td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> Not Implemented</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="product-section">
<h2 id="9-known-issues-and-limitations">9. Known issues and limitations</h2>
This section lists the top-50 known issues and limitations of the application, inferred from the code analysis.
<div class="table-container">
<table>
<colgroup>
<col style="width: 10%" />
<col style="width: 10%" />
<col style="width: 10%" />
<col style="width: 10%" />
<col style="width: 10%" />
<col style="width: 10%" />
<col style="width: 10%" />
<col style="width: 10%" />
<col style="width: 10%" />
<col style="width: 10%" />
</colgroup>
<thead>
<tr>
<th style="text-align: left;">Issue Id</th>
<th style="text-align: left;">Issue / limitation</th>
<th style="text-align: left;">Category</th>
<th style="text-align: left;">Type</th>
<th style="text-align: left;">Impact</th>
<th style="text-align: left;">Severity</th>
<th style="text-align: left;">Priority</th>
<th style="text-align: left;">Affected components</th>
<th style="text-align: left;">Workaround / strategy</th>
<th style="text-align: left;">Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;">ISSUE-001</td>
<td style="text-align: left;">End-of-life .NET Framework 4.0</td>
<td style="text-align: left;">Legacy</td>
<td style="text-align: left;">Limitation</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;">Entire application</td>
<td style="text-align: left;">Migrate to .NET 8.</td>
<td style="text-align: left;">Poses a major security risk and blocks use of modern libraries.</td>
</tr>
<tr>
<td style="text-align: left;">ISSUE-002</td>
<td style="text-align: left;">High risk of SQL Injection</td>
<td style="text-align: left;">Security</td>
<td style="text-align: left;">Bug</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;">All data access code</td>
<td style="text-align: left;">Refactor all data access to use parameterized queries.</td>
<td style="text-align: left;">The most critical security flaw in the codebase.</td>
</tr>
<tr>
<td style="text-align: left;">ISSUE-003</td>
<td style="text-align: left;">Hardcoded network paths</td>
<td style="text-align: left;">Compatibility</td>
<td style="text-align: left;">Limitation</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;">All <code>.csproj</code> files</td>
<td style="text-align: left;">Use NuGet for dependency management.</td>
<td style="text-align: left;">Prevents easy builds and deployments on new machines.</td>
</tr>
<tr>
<td style="text-align: left;">ISSUE-004</td>
<td style="text-align: left;">No Dependency Injection</td>
<td style="text-align: left;">Maintainability</td>
<td style="text-align: left;">Limitation</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;">Entire application</td>
<td style="text-align: left;">Refactor to use a DI container.</td>
<td style="text-align: left;">Makes the code tightly coupled and difficult to test or refactor.</td>
</tr>
<tr>
<td style="text-align: left;">ISSUE-005</td>
<td style="text-align: left;">Manual configuration management</td>
<td style="text-align: left;">Deployment</td>
<td style="text-align: left;">Limitation</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><code>.config</code> files</td>
<td style="text-align: left;">Use a hierarchical configuration system.</td>
<td style="text-align: left;">Error-prone process for deploying to different environments.</td>
</tr>
<tr>
<td style="text-align: left;">ISSUE-006</td>
<td style="text-align: left;">Anemic Domain Model</td>
<td style="text-align: left;">Architecture</td>
<td style="text-align: left;">Limitation</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;">All data classes</td>
<td style="text-align: left;">Refactor to a rich domain model where behavior and data are encapsulated.</td>
<td style="text-align: left;">Business logic is scattered in service classes instead of with the data it operates on.</td>
</tr>
<tr>
<td style="text-align: left;">ISSUE-007</td>
<td style="text-align: left;">Lack of a dedicated Data Access Layer</td>
<td style="text-align: left;">Architecture</td>
<td style="text-align: left;">Limitation</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;">All projects with DB access</td>
<td style="text-align: left;">Create a separate DAL project and use the Repository pattern correctly.</td>
<td style="text-align: left;">Business logic is mixed with data access implementation details.</td>
</tr>
<tr>
<td style="text-align: left;">ISSUE-008</td>
<td style="text-align: left;">Use of outdated Windows Forms</td>
<td style="text-align: left;">Legacy</td>
<td style="text-align: left;">Limitation</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;">UI projects</td>
<td style="text-align: left;">Migrate to a modern UI framework like MAUI or a web-based UI if applicable.</td>
<td style="text-align: left;">Poor user experience and difficult to extend.</td>
</tr>
<tr>
<td style="text-align: left;">ISSUE-009</td>
<td style="text-align: left;">Potentially insecure password handling</td>
<td style="text-align: left;">Security</td>
<td style="text-align: left;">Bug</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;"><code>Alerta.csproj</code></td>
<td style="text-align: left;">Store only hashed passwords using a modern algorithm.</td>
<td style="text-align: left;">Code suggests passwords may be stored in configuration.</td>
</tr>
<tr>
<td style="text-align: left;">ISSUE-010</td>
<td style="text-align: left;">Brittle custom authorization</td>
<td style="text-align: left;">Security</td>
<td style="text-align: left;">Bug</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;"><code>CIActividades.csproj</code></td>
<td style="text-align: left;">Implement claims-based authorization.</td>
<td style="text-align: left;">Integer-based group checks are insecure and hard to manage.</td>
</tr>
<tr>
<td style="text-align: left;">ISSUE-011</td>
<td style="text-align: left;">Use of Crystal Reports</td>
<td style="text-align: left;">Legacy</td>
<td style="text-align: left;">Limitation</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><code>CIReports.csproj</code></td>
<td style="text-align: left;">Migrate to a modern reporting solution like Power BI or a library like QuestPDF.</td>
<td style="text-align: left;">Crystal Reports is a legacy technology with licensing costs and limited integration options.</td>
</tr>
<tr>
<td style="text-align: left;">ISSUE-012</td>
<td style="text-align: left;">VB.NET and C# mixed codebase</td>
<td style="text-align: left;">Maintainability</td>
<td style="text-align: left;">Limitation</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;">Entire application</td>
<td style="text-align: left;">Standardize on a single language (C#).</td>
<td style="text-align: left;">Increases cognitive load for developers and can complicate the build process.</td>
</tr>
<tr>
<td style="text-align: left;">ISSUE-013</td>
<td style="text-align: left;">Manual transaction management</td>
<td style="text-align: left;">Maintainability</td>
<td style="text-align: left;">Limitation</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;">All data access code</td>
<td style="text-align: left;">Use <code>TransactionScope</code> or ORM-managed transactions.</td>
<td style="text-align: left;">Prone to errors like forgetting to commit or rollback.</td>
</tr>
<tr>
<td style="text-align: left;">ISSUE-014</td>
<td style="text-align: left;">Lack of comprehensive unit tests</td>
<td style="text-align: left;">Quality</td>
<td style="text-align: left;">Limitation</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><code>CITestes.csproj</code></td>
<td style="text-align: left;">Implement a comprehensive testing strategy with high coverage.</td>
<td style="text-align: left;">Only a few high-level tests exist, leaving most of the logic untested.</td>
</tr>
<tr>
<td style="text-align: left;">ISSUE-015</td>
<td style="text-align: left;">Deployment via batch scripts and installutil</td>
<td style="text-align: left;">Deployment</td>
<td style="text-align: left;">Limitation</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><code>Install</code> folder</td>
<td style="text-align: left;">Use modern CI/CD pipelines (e.g., Azure DevOps, GitHub Actions).</td>
<td style="text-align: left;">Outdated and manual deployment process.</td>
</tr>
<tr>
<td style="text-align: left;">ISSUE-016</td>
<td style="text-align: left;">Poor scalability</td>
<td style="text-align: left;">Performance</td>
<td style="text-align: left;">Limitation</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;">Entire application</td>
<td style="text-align: left;">Refactor to a scalable architecture (e.g., microservices).</td>
<td style="text-align: left;">The monolithic design cannot be scaled horizontally.</td>
</tr>
<tr>
<td style="text-align: left;">ISSUE-017</td>
<td style="text-align: left;">Inconsistent error handling</td>
<td style="text-align: left;">Maintainability</td>
<td style="text-align: left;">Bug</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;">Entire application</td>
<td style="text-align: left;">Implement a global exception handling middleware/policy.</td>
<td style="text-align: left;">Some exceptions are logged, some are shown to the user, some are ignored.</td>
</tr>
<tr>
<td style="text-align: left;">ISSUE-018</td>
<td style="text-align: left;">UI thread blocking operations</td>
<td style="text-align: left;">Performance</td>
<td style="text-align: left;">Bug</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;">UI projects</td>
<td style="text-align: left;">Use <code>async/await</code> for all long-running operations.</td>
<td style="text-align: left;">Database queries and other operations are likely blocking the UI thread.</td>
</tr>
<tr>
<td style="text-align: left;">ISSUE-019</td>
<td style="text-align: left;">No API documentation standard</td>
<td style="text-align: left;">Documentation</td>
<td style="text-align: left;">Limitation</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><code>MDIWebTransmCI.vbproj</code></td>
<td style="text-align: left;">Use OpenAPI/Swagger for any new APIs.</td>
<td style="text-align: left;">The consumed WSDL is the only form of API documentation.</td>
</tr>
<tr>
<td style="text-align: left;">ISSUE-020</td>
<td style="text-align: left;">Use of <code>System.Windows.Forms.Application.DoEvents()</code></td>
<td style="text-align: left;">Performance</td>
<td style="text-align: left;">Bug</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><code>MDIsControloForm.cs</code></td>
<td style="text-align: left;">Refactor to use proper asynchronous patterns.</td>
<td style="text-align: left;">This is a code smell indicating a workaround for a blocking UI.</td>
</tr>
<tr>
<td style="text-align: left;">ISSUE-021</td>
<td style="text-align: left;">Global state via <code>CIGlobalParameters</code></td>
<td style="text-align: left;">Maintainability</td>
<td style="text-align: left;">Limitation</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;">Entire application</td>
<td style="text-align: left;">Refactor to use dependency injection to manage state and dependencies.</td>
<td style="text-align: left;">Passing a global parameters object to almost every class creates tight coupling.</td>
</tr>
<tr>
<td style="text-align: left;">ISSUE-022</td>
<td style="text-align: left;">Empty <code>catch</code> blocks</td>
<td style="text-align: left;">Bug</td>
<td style="text-align: left;">Bug</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><code>AlertaSituacaoAccao.cs</code></td>
<td style="text-align: left;">Never swallow exceptions. Always log them or re-throw.</td>
<td style="text-align: left;">Potential errors are being silently ignored.</td>
</tr>
<tr>
<td style="text-align: left;">ISSUE-023</td>
<td style="text-align: left;">Logic in UI event handlers</td>
<td style="text-align: left;">Architecture</td>
<td style="text-align: left;">Limitation</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><code>ActividadeBalcaoForm.cs</code></td>
<td style="text-align: left;">Move business logic to service classes (MVVM/MVC pattern).</td>
<td style="text-align: left;">The <code>btnRemessasErro_Click</code> handler directly calls a stored procedure.</td>
</tr>
<tr>
<td style="text-align: left;">ISSUE-024</td>
<td style="text-align: left;">Hardcoded SQL in code</td>
<td style="text-align: left;">Maintainability</td>
<td style="text-align: left;">Limitation</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;">Entire application</td>
<td style="text-align: left;">Move SQL to stored procedures or use an ORM.</td>
<td style="text-align: left;">Makes queries hard to find, manage, and optimize.</td>
</tr>
<tr>
<td style="text-align: left;">ISSUE-025</td>
<td style="text-align: left;">Lack of input validation on UI</td>
<td style="text-align: left;">Security</td>
<td style="text-align: left;">Bug</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;">UI projects</td>
<td style="text-align: left;">Implement robust input validation on all user-provided data.</td>
<td style="text-align: left;"><code>TextChanged</code> events with simple numeric checks are insufficient.</td>
</tr>
<tr>
<td style="text-align: left;">ISSUE-026</td>
<td style="text-align: left;">No clear separation of environments in code</td>
<td style="text-align: left;">Deployment</td>
<td style="text-align: left;">Limitation</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><code>CIControlo.csproj</code></td>
<td style="text-align: left;">Use configuration transforms or hierarchical settings.</td>
<td style="text-align: left;">Logic might exist that branches on environment, which is an anti-pattern.</td>
</tr>
<tr>
<td style="text-align: left;">ISSUE-027</td>
<td style="text-align: left;">Use of <code>Thread.Sleep</code></td>
<td style="text-align: left;">Performance</td>
<td style="text-align: left;">Bug</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><code>CIServiceComumThread.cs</code></td>
<td style="text-align: left;">Use <code>Task.Delay</code> in modern async code.</td>
<td style="text-align: left;">Inefficient way to handle delays in a service.</td>
</tr>
<tr>
<td style="text-align: left;">ISSUE-028</td>
<td style="text-align: left;">Service installation is manual</td>
<td style="text-align: left;">Deployment</td>
<td style="text-align: left;">Limitation</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><code>Install</code> folder</td>
<td style="text-align: left;">Automate service deployment via CI/CD.</td>
<td style="text-align: left;">Requires manual execution of batch files on the server.</td>
</tr>
<tr>
<td style="text-align: left;">ISSUE-029</td>
<td style="text-align: left;">Database schema not managed in source control</td>
<td style="text-align: left;">Maintainability</td>
<td style="text-align: left;">Limitation</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;">N/A</td>
<td style="text-align: left;">Use a database project or code-first migrations.</td>
<td style="text-align: left;">Schema changes must be applied manually to each environment.</td>
</tr>
<tr>
<td style="text-align: left;">ISSUE-030</td>
<td style="text-align: left;">Use of <code>DataSet</code> and <code>DataTable</code></td>
<td style="text-align: left;">Legacy</td>
<td style="text-align: left;">Limitation</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><code>CIActividades.csproj</code></td>
<td style="text-align: left;">Use POCOs and modern data transfer objects.</td>
<td style="text-align: left;">These are legacy data structures that are inefficient and cumbersome.</td>
</tr>
<tr>
<td style="text-align: left;">ISSUE-031</td>
<td style="text-align: left;">No automated database seeding for tests</td>
<td style="text-align: left;">Testing</td>
<td style="text-align: left;">Limitation</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><code>CITestes.csproj</code></td>
<td style="text-align: left;">Implement a test data seeding strategy.</td>
<td style="text-align: left;">Tests likely rely on a pre-existing database state, making them brittle.</td>
</tr>
<tr>
<td style="text-align: left;">ISSUE-032</td>
<td style="text-align: left;">Potential memory leaks from undisposed objects</td>
<td style="text-align: left;">Performance</td>
<td style="text-align: left;">Bug</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;">Entire application</td>
<td style="text-align: left;">Ensure all <code>IDisposable</code> objects are properly disposed (e.g., with <code>using</code> statements).</td>
<td style="text-align: left;">Code does not consistently dispose <code>StreamReader</code>, <code>SqlConnection</code>, etc.</td>
</tr>
<tr>
<td style="text-align: left;">ISSUE-033</td>
<td style="text-align: left;">Inconsistent naming conventions</td>
<td style="text-align: left;">Maintainability</td>
<td style="text-align: left;">Limitation</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;">Entire application</td>
<td style="text-align: left;">Enforce standard .NET naming conventions.</td>
<td style="text-align: left;">A mix of <code>m_</code>, <code>s</code>, <code>i</code> prefixes and PascalCase/camelCase is used.</td>
</tr>
<tr>
<td style="text-align: left;">ISSUE-034</td>
<td style="text-align: left;">Lack of comments explaining complex logic</td>
<td style="text-align: left;">Maintainability</td>
<td style="text-align: left;">Limitation</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><code>ServRemessa.cs</code></td>
<td style="text-align: left;">Add comments to explain "why," not "what."</td>
<td style="text-align: left;">Complex business rules are not documented in the code.</td>
</tr>
<tr>
<td style="text-align: left;">ISSUE-035</td>
<td style="text-align: left;">Hardcoded values and magic strings</td>
<td style="text-align: left;">Maintainability</td>
<td style="text-align: left;">Bug</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><code>CIMainForm.cs</code></td>
<td style="text-align: left;">Use constants or enums.</td>
<td style="text-align: left;">Status codes (e.g., <code>ADEP_ID>=500</code>) are hardcoded.</td>
</tr>
<tr>
<td style="text-align: left;">ISSUE-036</td>
<td style="text-align: left;">No central telemetry or monitoring</td>
<td style="text-align: left;">Supportability</td>
<td style="text-align: left;">Limitation</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;">Entire application</td>
<td style="text-align: left;">Integrate with a modern monitoring tool like Application Insights.</td>
<td style="text-align: left;">Relies on database logs and Windows Event Viewer, which are hard to query.</td>
</tr>
<tr>
<td style="text-align: left;">ISSUE-037</td>
<td style="text-align: left;">UI is not responsive during long operations</td>
<td style="text-align: left;">Performance</td>
<td style="text-align: left;">Bug</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><code>PesquisasForm.cs</code></td>
<td style="text-align: left;">All data-fetching and processing should be asynchronous.</td>
<td style="text-align: left;">The use of <code>Cursor = Cursors.WaitCursor</code> indicates long-running synchronous work.</td>
</tr>
<tr>
<td style="text-align: left;">ISSUE-038</td>
<td style="text-align: left;">Web service communication over HTTP</td>
<td style="text-align: left;">Security</td>
<td style="text-align: left;">Bug</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;"><code>MDIWebTransmCI.vbproj</code></td>
<td style="text-align: left;">Use HTTPS for all external communication.</td>
<td style="text-align: left;">The endpoint <code>http://waiaccesstu:80/...</code> is insecure.</td>
</tr>
<tr>
<td style="text-align: left;">ISSUE-039</td>
<td style="text-align: left;">Inefficient database queries</td>
<td style="text-align: left;">Performance</td>
<td style="text-align: left;">Bug</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;">Various <code>.sql</code> files</td>
<td style="text-align: left;">Analyze and optimize queries. Add necessary indexes.</td>
<td style="text-align: left;">Queries like <code>select *</code> are used, which is inefficient.</td>
</tr>
<tr>
<td style="text-align: left;">ISSUE-040</td>
<td style="text-align: left;">Circular dependencies between projects</td>
<td style="text-align: left;">Architecture</td>
<td style="text-align: left;">Limitation</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;">Solution files</td>
<td style="text-align: left;">Refactor to enforce a strict, acyclic dependency graph.</td>
<td style="text-align: left;">A formal dependency analysis might reveal circular references.</td>
</tr>
<tr>
<td style="text-align: left;">ISSUE-041</td>
<td style="text-align: left;">Business logic tied to UI events</td>
<td style="text-align: left;">Architecture</td>
<td style="text-align: left;">Limitation</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;">UI projects</td>
<td style="text-align: left;">Refactor to use a presentation pattern like MVVM or MVC.</td>
<td style="text-align: left;">Difficult to test and reuse business logic.</td>
</tr>
<tr>
<td style="text-align: left;">ISSUE-042</td>
<td style="text-align: left;">No health check endpoint for the service</td>
<td style="text-align: left;">Supportability</td>
<td style="text-align: left;">Limitation</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><code>CIServico.csproj</code></td>
<td style="text-align: left;">Implement a health check endpoint.</td>
<td style="text-align: left;">It's difficult to programmatically determine if the service is healthy.</td>
</tr>
<tr>
<td style="text-align: left;">ISSUE-043</td>
<td style="text-align: left;">File processing is not resilient</td>
<td style="text-align: left;">Reliability</td>
<td style="text-align: left;">Bug</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><code>CIFicheiro.csproj</code></td>
<td style="text-align: left;">Implement a dead-letter queue for failed files.</td>
<td style="text-align: left;">If a file fails to parse, the process might halt or the file might be lost.</td>
</tr>
<tr>
<td style="text-align: left;">ISSUE-044</td>
<td style="text-align: left;">Use of <code>Application.DoEvents()</code></td>
<td style="text-align: left;">Performance</td>
<td style="text-align: left;">Bug</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><code>MDIsControloForm.cs</code></td>
<td style="text-align: left;">This is a known anti-pattern. Refactor to use background workers or async/await.</td>
<td style="text-align: left;">Can lead to unexpected re-entrancy and difficult-to-debug issues.</td>
</tr>
<tr>
<td style="text-align: left;">ISSUE-045</td>
<td style="text-align: left;">No internationalization support</td>
<td style="text-align: left;">Compatibility</td>
<td style="text-align: left;">Limitation</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;">UI projects</td>
<td style="text-align: left;">Use resource files for all user-facing strings.</td>
<td style="text-align: left;">All UI text is hardcoded in English/Portuguese.</td>
</tr>
<tr>
<td style="text-align: left;">ISSUE-046</td>
<td style="text-align: left;">Settings are read directly from <code>Properties.Settings</code></td>
<td style="text-align: left;">Legacy</td>
<td style="text-align: left;">Limitation</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><code>CIControlo.csproj</code></td>
<td style="text-align: left;">Use the modern .NET configuration system.</td>
<td style="text-align: left;">This is an outdated way of handling configuration.</td>
</tr>
<tr>
<td style="text-align: left;">ISSUE-047</td>
<td style="text-align: left;">COM visibility is not consistently managed</td>
<td style="text-align: left;">Maintainability</td>
<td style="text-align: left;">Bug</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><code>AssemblyInfo.cs</code></td>
<td style="text-align: left;">Explicitly set <code>ComVisible(false)</code> unless COM interop is required.</td>
<td style="text-align: left;">Inconsistent <code>ComVisible</code> attributes across projects.</td>
</tr>
<tr>
<td style="text-align: left;">ISSUE-048</td>
<td style="text-align: left;">No clear strategy for database migrations</td>
<td style="text-align: left;">Deployment</td>
<td style="text-align: left;">Limitation</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;">N/A</td>
<td style="text-align: left;">Implement a tool like DbUp or EF Migrations.</td>
<td style="text-align: left;">Database schema changes are likely a manual and risky process.</td>
</tr>
<tr>
<td style="text-align: left;">ISSUE-049</td>
<td style="text-align: left;">Tight coupling to <code>System.Windows.Forms</code></td>
<td style="text-align: left;">Maintainability</td>
<td style="text-align: left;">Limitation</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><code>Alerta.csproj</code></td>
<td style="text-align: left;">Logic libraries should not reference UI libraries.</td>
<td style="text-align: left;">Even non-UI projects reference <code>System.Windows.Forms</code>.</td>
</tr>
<tr>
<td style="text-align: left;">ISSUE-050</td>
<td style="text-align: left;">Lack of a resilient retry mechanism for external calls</td>
<td style="text-align: left;">Reliability</td>
<td style="text-align: left;">Bug</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><code>MDIWebTransmCI.vbproj</code></td>
<td style="text-align: left;">Use a library like Polly to implement retry and circuit breaker patterns.</td>
<td style="text-align: left;">Web service calls are likely to fail under transient network issues.</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="product-section">
<h2 id="10-defects-and-inefficiencies">10. Defects and inefficiencies</h2>
This section lists the top-50 defects and inefficiencies in the application, focusing on coding best practices, performance, and maintainability.
<div class="table-container">
<table>
<colgroup>
<col style="width: 10%" />
<col style="width: 10%" />
<col style="width: 10%" />
<col style="width: 10%" />
<col style="width: 10%" />
<col style="width: 10%" />
<col style="width: 10%" />
<col style="width: 10%" />
<col style="width: 10%" />
<col style="width: 10%" />
</colgroup>
<thead>
<tr>
<th style="text-align: left;">Defect Id</th>
<th style="text-align: left;">Defect / inefficiency</th>
<th style="text-align: left;">Category</th>
<th style="text-align: left;">Type</th>
<th style="text-align: left;">Impact</th>
<th style="text-align: left;">Severity</th>
<th style="text-align: left;">Priority</th>
<th style="text-align: left;">Root cause</th>
<th style="text-align: left;">Affected components</th>
<th style="text-align: left;">Recommended fix</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;">DEF-001</td>
<td style="text-align: left;">Raw SQL queries with string concatenation</td>
<td style="text-align: left;">Security</td>
<td style="text-align: left;">Bug</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;">Poor coding practices</td>
<td style="text-align: left;"><code>AlertaSituacaoAccao.cs</code></td>
<td style="text-align: left;">Use parameterized queries immediately.</td>
</tr>
<tr>
<td style="text-align: left;">DEF-002</td>
<td style="text-align: left;">Outdated .NET Framework 4.0</td>
<td style="text-align: left;">Legacy</td>
<td style="text-align: left;">Limitation</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;">Lack of maintenance</td>
<td style="text-align: left;">Entire application</td>
<td style="text-align: left;">Plan and execute migration to .NET 8.</td>
</tr>
<tr>
<td style="text-align: left;">DEF-003</td>
<td style="text-align: left;">Manual instantiation of dependencies</td>
<td style="text-align: left;">Maintainability</td>
<td style="text-align: left;">Limitation</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;">Architectural choice</td>
<td style="text-align: left;">Entire application</td>
<td style="text-align: left;">Refactor to use Dependency Injection.</td>
</tr>
<tr>
<td style="text-align: left;">DEF-004</td>
<td style="text-align: left;">Business logic in code-behind</td>
<td style="text-align: left;">Architecture</td>
<td style="text-align: left;">Bug</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;">Poor coding practices</td>
<td style="text-align: left;"><code>ActividadeBalcaoForm.cs</code></td>
<td style="text-align: left;">Move logic to service classes.</td>
</tr>
<tr>
<td style="text-align: left;">DEF-005</td>
<td style="text-align: left;">Empty <code>catch {}</code> blocks</td>
<td style="text-align: left;">Code quality</td>
<td style="text-align: left;">Bug</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;">Poor coding practices</td>
<td style="text-align: left;"><code>AlertaSituacaoAccao.cs</code></td>
<td style="text-align: left;">Log or handle all exceptions.</td>
</tr>
<tr>
<td style="text-align: left;">DEF-006</td>
<td style="text-align: left;">Hardcoded server and file paths</td>
<td style="text-align: left;">Deployment</td>
<td style="text-align: left;">Limitation</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;">Misconfiguration</td>
<td style="text-align: left;"><code>.csproj</code>, <code>.config</code> files</td>
<td style="text-align: left;">Externalize all paths to configuration.</td>
</tr>
<tr>
<td style="text-align: left;">DEF-007</td>
<td style="text-align: left;">No central transaction management</td>
<td style="text-align: left;">Reliability</td>
<td style="text-align: left;">Limitation</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;">Architectural choice</td>
<td style="text-align: left;">Data access code</td>
<td style="text-align: left;">Use <code>TransactionScope</code> or an ORM.</td>
</tr>
<tr>
<td style="text-align: left;">DEF-008</td>
<td style="text-align: left;">Inconsistent use of <code>this</code> keyword</td>
<td style="text-align: left;">Code quality</td>
<td style="text-align: left;">Inefficiency</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;">Lack of standards</td>
<td style="text-align: left;">C# files</td>
<td style="text-align: left;">Apply a consistent coding standard.</td>
</tr>
<tr>
<td style="text-align: left;">DEF-009</td>
<td style="text-align: left;">Use of <code>select *</code> in database queries</td>
<td style="text-align: left;">Performance</td>
<td style="text-align: left;">Inefficiency</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;">Poor coding practices</td>
<td style="text-align: left;"><code>.sql</code> files, data access code</td>
<td style="text-align: left;">Specify required columns explicitly.</td>
</tr>
<tr>
<td style="text-align: left;">DEF-010</td>
<td style="text-align: left;">UI blocking database calls</td>
<td style="text-align: left;">Performance</td>
<td style="text-align: left;">Bug</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;">Lack of async programming</td>
<td style="text-align: left;">UI projects</td>
<td style="text-align: left;">Make all I/O operations asynchronous.</td>
</tr>
<tr>
<td style="text-align: left;">DEF-011</td>
<td style="text-align: left;">Mixture of C# and VB.NET</td>
<td style="text-align: left;">Maintainability</td>
<td style="text-align: left;">Limitation</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;">Project history</td>
<td style="text-align: left;">Solution</td>
<td style="text-align: left;">Standardize on C#.</td>
</tr>
<tr>
<td style="text-align: left;">DEF-012</td>
<td style="text-align: left;">Unsafe type casting</td>
<td style="text-align: left;">Reliability</td>
<td style="text-align: left;">Bug</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;">Poor coding practices</td>
<td style="text-align: left;"><code>MudarEstadoForm.cs</code></td>
<td style="text-align: left;">Use <code>as</code> or <code>is</code> with null checks instead of direct casting.</td>
</tr>
<tr>
<td style="text-align: left;">DEF-013</td>
<td style="text-align: left;">No mocking in unit tests</td>
<td style="text-align: left;">Testing</td>
<td style="text-align: left;">Limitation</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;">Architectural choice</td>
<td style="text-align: left;"><code>CITestes.csproj</code></td>
<td style="text-align: left;">Introduce a mocking framework like Moq or NSubstitute.</td>
</tr>
<tr>
<td style="text-align: left;">DEF-014</td>
<td style="text-align: left;"><code>ComVisible(false)</code> is not default</td>
<td style="text-align: left;">Maintainability</td>
<td style="text-align: left;">Inefficiency</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;">Lack of standards</td>
<td style="text-align: left;"><code>AssemblyInfo.cs</code></td>
<td style="text-align: left;">Default to <code>ComVisible(false)</code> for all non-COM libraries.</td>
</tr>
<tr>
<td style="text-align: left;">DEF-015</td>
<td style="text-align: left;">Hardcoded UI strings</td>
<td style="text-align: left;">Maintainability</td>
<td style="text-align: left;">Limitation</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;">Lack of standards</td>
<td style="text-align: left;">UI projects</td>
<td style="text-align: left;">Move all strings to <code>.resx</code> files.</td>
</tr>
<tr>
<td style="text-align: left;">DEF-016</td>
<td style="text-align: left;">Use of <code>Application.DoEvents()</code></td>
<td style="text-align: left;">Code quality</td>
<td style="text-align: left;">Bug</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;">Poor coding practices</td>
<td style="text-align: left;"><code>MDIsControloForm.cs</code></td>
<td style="text-align: left;">Refactor to use proper async patterns.</td>
</tr>
<tr>
<td style="text-align: left;">DEF-017</td>
<td style="text-align: left;">Lack of code comments</td>
<td style="text-align: left;">Maintainability</td>
<td style="text-align: left;">Inefficiency</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;">Lack of standards</td>
<td style="text-align: left;">Entire application</td>
<td style="text-align: left;">Document complex algorithms and business rules.</td>
</tr>
<tr>
<td style="text-align: left;">DEF-018</td>
<td style="text-align: left;">Large classes with multiple responsibilities</td>
<td style="text-align: left;">Code quality</td>
<td style="text-align: left;">Limitation</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;">Architectural choice</td>
<td style="text-align: left;"><code>ActividadesForm.cs</code></td>
<td style="text-align: left;">Refactor large classes into smaller, more focused ones.</td>
</tr>
<tr>
<td style="text-align: left;">DEF-019</td>
<td style="text-align: left;">No clear logging strategy</td>
<td style="text-align: left;">Supportability</td>
<td style="text-align: left;">Limitation</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;">Architectural choice</td>
<td style="text-align: left;"><code>GenericLog</code></td>
<td style="text-align: left;">Implement structured logging with a modern library like Serilog.</td>
</tr>
<tr>
<td style="text-align: left;">DEF-020</td>
<td style="text-align: left;">Inefficient string building</td>
<td style="text-align: left;">Performance</td>
<td style="text-align: left;">Inefficiency</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;">Poor coding practices</td>
<td style="text-align: left;"><code>ControloBalcaoAcoes.cs</code></td>
<td style="text-align: left;">Use <code>StringBuilder</code> for loops involving string concatenation.</td>
</tr>
<tr>
<td style="text-align: left;">DEF-021</td>
<td style="text-align: left;">Global state management</td>
<td style="text-align: left;">Architecture</td>
<td style="text-align: left;">Limitation</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;">Architectural choice</td>
<td style="text-align: left;"><code>CIGlobalParameters</code></td>
<td style="text-align: left;">Refactor to eliminate global state.</td>
</tr>
<tr>
<td style="text-align: left;">DEF-022</td>
<td style="text-align: left;">Direct manipulation of UI controls from logic</td>
<td style="text-align: left;">Architecture</td>
<td style="text-align: left;">Bug</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;">Poor coding practices</td>
<td style="text-align: left;"><code>ImportarForm.cs</code></td>
<td style="text-align: left;">Use events or data binding to update the UI.</td>
</tr>
<tr>
<td style="text-align: left;">DEF-023</td>
<td style="text-align: left;">No use of <code>using</code> statements for <code>IDisposable</code></td>
<td style="text-align: left;">Reliability</td>
<td style="text-align: left;">Bug</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;">Poor coding practices</td>
<td style="text-align: left;"><code>MostraImagem.cs</code></td>
<td style="text-align: left;">Wrap all <code>IDisposable</code> objects in <code>using</code> blocks.</td>
</tr>
<tr>
<td style="text-align: left;">DEF-024</td>
<td style="text-align: left;">Hardcoded sleep intervals</td>
<td style="text-align: left;">Performance</td>
<td style="text-align: left;">Inefficiency</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;">Poor coding practices</td>
<td style="text-align: left;"><code>CIServicoThread.cs</code></td>
<td style="text-align: left;">Externalize intervals to configuration.</td>
</tr>
<tr>
<td style="text-align: left;">DEF-025</td>
<td style="text-align: left;">Lack of validation on method parameters</td>
<td style="text-align: left;">Reliability</td>
<td style="text-align: left;">Bug</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;">Poor coding practices</td>
<td style="text-align: left;">Entire application</td>
<td style="text-align: left;">Add null and range checks to public methods.</td>
</tr>
<tr>
<td style="text-align: left;">DEF-026</td>
<td style="text-align: left;">Redundant database calls</td>
<td style="text-align: left;">Performance</td>
<td style="text-align: left;">Inefficiency</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;">Poor coding practices</td>
<td style="text-align: left;"><code>PesquisasForm.cs</code></td>
<td style="text-align: left;">Cache data where appropriate or combine queries.</td>
</tr>
<tr>
<td style="text-align: left;">DEF-027</td>
<td style="text-align: left;">Use of <code>DataSet</code> for data transfer</td>
<td style="text-align: left;">Legacy</td>
<td style="text-align: left;">Inefficiency</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;">Architectural choice</td>
<td style="text-align: left;"><code>CIActividades.csproj</code></td>
<td style="text-align: left;">Use strongly-typed DTOs.</td>
</tr>
<tr>
<td style="text-align: left;">DEF-028</td>
<td style="text-align: left;">Error-prone manual file handling</td>
<td style="text-align: left;">Reliability</td>
<td style="text-align: left;">Bug</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;">Architectural choice</td>
<td style="text-align: left;"><code>CIFicheiro.cs</code></td>
<td style="text-align: left;">Use <code>try-finally</code> to ensure file handles are closed.</td>
</tr>
<tr>
<td style="text-align: left;">DEF-029</td>
<td style="text-align: left;">Tight coupling to <code>System.Data.SqlClient</code></td>
<td style="text-align: left;">Maintainability</td>
<td style="text-align: left;">Limitation</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;">Architectural choice</td>
<td style="text-align: left;">Entire application</td>
<td style="text-align: left;">Abstract data access behind interfaces.</td>
</tr>
<tr>
<td style="text-align: left;">DEF-030</td>
<td style="text-align: left;">God-class <code>CIGlobalParameters</code></td>
<td style="text-align: left;">Architecture</td>
<td style="text-align: left;">Limitation</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;">Architectural choice</td>
<td style="text-align: left;"><code>CIConfigGlobalParameters</code></td>
<td style="text-align: left;">Break down into smaller, focused service classes.</td>
</tr>
<tr>
<td style="text-align: left;">DEF-031</td>
<td style="text-align: left;">Inconsistent naming conventions</td>
<td style="text-align: left;">Code quality</td>
<td style="text-align: left;">Inefficiency</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;">Lack of standards</td>
<td style="text-align: left;">Entire application</td>
<td style="text-align: left;">Enforce standard .NET naming conventions (e.g., PascalCase for methods).</td>
</tr>
<tr>
<td style="text-align: left;">DEF-032</td>
<td style="text-align: left;">Magic strings for configuration keys</td>
<td style="text-align: left;">Maintainability</td>
<td style="text-align: left;">Bug</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;">Poor coding practices</td>
<td style="text-align: left;"><code>CIConfigGlobalParameters</code></td>
<td style="text-align: left;">Use <code>nameof</code> or constants for configuration keys.</td>
</tr>
<tr>
<td style="text-align: left;">DEF-033</td>
<td style="text-align: left;">No caching for frequently accessed data</td>
<td style="text-align: left;">Performance</td>
<td style="text-align: left;">Inefficiency</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;">Architectural choice</td>
<td style="text-align: left;">Data access code</td>
<td style="text-align: left;">Implement in-memory caching for semi-static data like user permissions.</td>
</tr>
<tr>
<td style="text-align: left;">DEF-034</td>
<td style="text-align: left;">Synchronous file I/O</td>
<td style="text-align: left;">Performance</td>
<td style="text-align: left;">Bug</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;">Lack of async programming</td>
<td style="text-align: left;"><code>CIFicheiro.cs</code></td>
<td style="text-align: left;">Use asynchronous file I/O operations.</td>
</tr>
<tr>
<td style="text-align: left;">DEF-035</td>
<td style="text-align: left;">Deeply nested <code>if</code> statements</td>
<td style="text-align: left;">Code quality</td>
<td style="text-align: left;">Inefficiency</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;">Poor coding practices</td>
<td style="text-align: left;"><code>ServRemessa.cs</code></td>
<td style="text-align: left;">Refactor complex conditionals into smaller methods or using guard clauses.</td>
</tr>
<tr>
<td style="text-align: left;">DEF-036</td>
<td style="text-align: left;">No separation of concerns in UI</td>
<td style="text-align: left;">Architecture</td>
<td style="text-align: left;">Limitation</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;">Architectural choice</td>
<td style="text-align: left;"><code>CIActividades.csproj</code></td>
<td style="text-align: left;">Implement a presentation pattern like MVP or MVVM.</td>
</tr>
<tr>
<td style="text-align: left;">DEF-037</td>
<td style="text-align: left;">Use of <code>MessageBox</code> in non-UI layers</td>
<td style="text-align: left;">Architecture</td>
<td style="text-align: left;">Bug</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;">Poor coding practices</td>
<td style="text-align: left;"><code>ServRemessa.cs</code></td>
<td style="text-align: left;">Logic layers should not interact with the UI. Use events or exceptions.</td>
</tr>
<tr>
<td style="text-align: left;">DEF-038</td>
<td style="text-align: left;">Lack of a resilient retry mechanism</td>
<td style="text-align: left;">Reliability</td>
<td style="text-align: left;">Bug</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;">Architectural choice</td>
<td style="text-align: left;"><code>MDIWebTransmCI.vbproj</code></td>
<td style="text-align: left;">Implement a retry policy (e.g., with Polly) for web service calls.</td>
</tr>
<tr>
<td style="text-align: left;">DEF-039</td>
<td style="text-align: left;">Inefficient data lookups in loops</td>
<td style="text-align: left;">Performance</td>
<td style="text-align: left;">Inefficiency</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;">Poor coding practices</td>
<td style="text-align: left;"><code>ProcessarTrancheBalcao</code></td>
<td style="text-align: left;">Fetch related data in bulk before the loop instead of per-item.</td>
</tr>
<tr>
<td style="text-align: left;">DEF-040</td>
<td style="text-align: left;">No use of enums for status codes</td>
<td style="text-align: left;">Code quality</td>
<td style="text-align: left;">Bug</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;">Poor coding practices</td>
<td style="text-align: left;">Data entities</td>
<td style="text-align: left;">Replace integer status IDs with strongly-typed enums for readability.</td>
</tr>
<tr>
<td style="text-align: left;">DEF-041</td>
<td style="text-align: left;">Unused variables and methods</td>
<td style="text-align: left;">Code quality</td>
<td style="text-align: left;">Inefficiency</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;">Lack of code cleanup</td>
<td style="text-align: left;">Entire application</td>
<td style="text-align: left;">Use a code analyzer to identify and remove dead code.</td>
</tr>
<tr>
<td style="text-align: left;">DEF-042</td>
<td style="text-align: left;">Failure to validate file contents</td>
<td style="text-align: left;">Reliability</td>
<td style="text-align: left;">Bug</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;">Poor coding practices</td>
<td style="text-align: left;"><code>CIFicheiro.cs</code></td>
<td style="text-align: left;">Add checksums or other validation to ensure file integrity.</td>
</tr>
<tr>
<td style="text-align: left;">DEF-043</td>
<td style="text-align: left;">No health checks for Windows Service</td>
<td style="text-align: left;">Supportability</td>
<td style="text-align: left;">Limitation</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;">Architectural choice</td>
<td style="text-align: left;"><code>CIServico.csproj</code></td>
<td style="text-align: left;">Implement a mechanism (e.g., a named pipe) to report service health.</td>
</tr>
<tr>
<td style="text-align: left;">DEF-044</td>
<td style="text-align: left;">Inefficient use of <code>DateTime.Now</code></td>
<td style="text-align: left;">Performance</td>
<td style="text-align: left;">Inefficiency</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;">Poor coding practices</td>
<td style="text-align: left;"><code>CIServicoThread.cs</code></td>
<td style="text-align: left;">Call <code>DateTime.Now</code> once at the start of a method, not multiple times.</td>
</tr>
<tr>
<td style="text-align: left;">DEF-045</td>
<td style="text-align: left;">Lack of paging in data grids</td>
<td style="text-align: left;">Performance</td>
<td style="text-align: left;">Bug</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;">Poor coding practices</td>
<td style="text-align: left;"><code>ActividadesForm.cs</code></td>
<td style="text-align: left;">Implement server-side paging for all data grids to avoid loading large datasets.</td>
</tr>
<tr>
<td style="text-align: left;">DEF-046</td>
<td style="text-align: left;">Hardcoded timeout values</td>
<td style="text-align: left;">Maintainability</td>
<td style="text-align: left;">Limitation</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;">Poor coding practices</td>
<td style="text-align: left;"><code>CIServico.cs</code></td>
<td style="text-align: left;">Move all timeout values to configuration files.</td>
</tr>
<tr>
<td style="text-align: left;">DEF-047</td>
<td style="text-align: left;">Public fields instead of properties</td>
<td style="text-align: left;">Code quality</td>
<td style="text-align: left;">Bug</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;">Poor coding practices</td>
<td style="text-align: left;"><code>Alerta.cs</code></td>
<td style="text-align: left;">Encapsulate fields with properties to control access.</td>
</tr>
<tr>
<td style="text-align: left;">DEF-048</td>
<td style="text-align: left;">No dependency validation in build</td>
<td style="text-align: left;">Deployment</td>
<td style="text-align: left;">Limitation</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;">Lack of modern tooling</td>
<td style="text-align: left;">Solution files</td>
<td style="text-align: left;">Use a static analysis tool to check for dependency rule violations.</td>
</tr>
<tr>
<td style="text-align: left;">DEF-049</td>
<td style="text-align: left;">Manual thread management</td>
<td style="text-align: left;">Legacy</td>
<td style="text-align: left;">Limitation</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;">Architectural choice</td>
<td style="text-align: left;"><code>CIServicoThread.cs</code></td>
<td style="text-align: left;">Refactor to use the Task Parallel Library (TPL) or <code>async/await</code>.</td>
</tr>
<tr>
<td style="text-align: left;">DEF-050</td>
<td style="text-align: left;">Inconsistent exception logging</td>
<td style="text-align: left;">Supportability</td>
<td style="text-align: left;">Bug</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;">Lack of standards</td>
<td style="text-align: left;">Entire application</td>
<td style="text-align: left;">Log the full exception, including the stack trace and inner exceptions, consistently.</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="product-section">
<h2 id="11-vulnerabilities">11. Vulnerabilities</h2>
This section lists the top-50 vulnerabilities in the application, focusing on security risks and their potential impact.
<div class="table-container">
<table>
<colgroup>
<col style="width: 10%" />
<col style="width: 10%" />
<col style="width: 10%" />
<col style="width: 10%" />
<col style="width: 10%" />
<col style="width: 10%" />
<col style="width: 10%" />
<col style="width: 10%" />
<col style="width: 10%" />
<col style="width: 10%" />
</colgroup>
<thead>
<tr>
<th style="text-align: left;">Vulnerability Id</th>
<th style="text-align: left;">Vulnerability</th>
<th style="text-align: left;">Category</th>
<th style="text-align: left;">Type</th>
<th style="text-align: left;">Impact</th>
<th style="text-align: left;">Severity</th>
<th style="text-align: left;">Priority</th>
<th style="text-align: left;">Root cause</th>
<th style="text-align: left;">Affected components</th>
<th style="text-align: left;">Recommended fix</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;">VULN-001</td>
<td style="text-align: left;">SQL Injection</td>
<td style="text-align: left;">Injection</td>
<td style="text-align: left;">Bug</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;">String concatenation in SQL queries</td>
<td style="text-align: left;"><code>AlertaSituacaoAccao.cs</code></td>
<td style="text-align: left;">Use parameterized queries.</td>
</tr>
<tr>
<td style="text-align: left;">VULN-002</td>
<td style="text-align: left;">Use of EOL .NET Framework 4.0</td>
<td style="text-align: left;">Outdated Components</td>
<td style="text-align: left;">Limitation</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;">Technical debt</td>
<td style="text-align: left;">Entire application</td>
<td style="text-align: left;">Migrate to .NET 8.</td>
</tr>
<tr>
<td style="text-align: left;">VULN-003</td>
<td style="text-align: left;">Insecure Password Handling</td>
<td style="text-align: left;">Cryptographic Failures</td>
<td style="text-align: left;">Bug</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;">Storing secrets in config</td>
<td style="text-align: left;"><code>AccaoParam.cs</code></td>
<td style="text-align: left;">Use ASP.NET Core Identity.</td>
</tr>
<tr>
<td style="text-align: left;">VULN-004</td>
<td style="text-align: left;">Broken Access Control</td>
<td style="text-align: left;">Access Control</td>
<td style="text-align: left;">Bug</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;">Coarse-grained authorization</td>
<td style="text-align: left;"><code>ActividadeBalcaoForm.cs</code></td>
<td style="text-align: left;">Implement claims-based authorization.</td>
</tr>
<tr>
<td style="text-align: left;">VULN-005</td>
<td style="text-align: left;">Plaintext Configuration Secrets</td>
<td style="text-align: left;">Security Misconfiguration</td>
<td style="text-align: left;">Bug</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;">Storing secrets in <code>.config</code> files</td>
<td style="text-align: left;"><code>CIControlo.*.exe.config</code></td>
<td style="text-align: left;">Use Azure Key Vault or another secrets manager.</td>
</tr>
<tr>
<td style="text-align: left;">VULN-006</td>
<td style="text-align: left;">Unsafe Web Service Communication (HTTP)</td>
<td style="text-align: left;">Cryptographic Failures</td>
<td style="text-align: left;">Bug</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;">Misconfiguration</td>
<td style="text-align: left;"><code>MDIWebTransmCI.vbproj</code></td>
<td style="text-align: left;">Enforce HTTPS for all endpoints.</td>
</tr>
<tr>
<td style="text-align: left;">VULN-007</td>
<td style="text-align: left;">Information Exposure Through Errors</td>
<td style="text-align: left;">Information Disclosure</td>
<td style="text-align: left;">Bug</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;">Unhandled exceptions</td>
<td style="text-align: left;">Entire application</td>
<td style="text-align: left;">Implement a global exception handler that logs details and shows a generic error page.</td>
</tr>
<tr>
<td style="text-align: left;">VULN-008</td>
<td style="text-align: left;">Hardcoded UNC Paths</td>
<td style="text-align: left;">Security Misconfiguration</td>
<td style="text-align: left;">Bug</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;">Poor coding practices</td>
<td style="text-align: left;">All <code>.csproj</code> files</td>
<td style="text-align: left;">Use a secure package management system like NuGet.</td>
</tr>
<tr>
<td style="text-align: left;">VULN-009</td>
<td style="text-align: left;">Lack of Input Validation</td>
<td style="text-align: left;">Injection</td>
<td style="text-align: left;">Bug</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;">Poor coding practices</td>
<td style="text-align: left;">UI projects</td>
<td style="text-align: left;">Validate all user input on the server side.</td>
</tr>
<tr>
<td style="text-align: left;">VULN-010</td>
<td style="text-align: left;">Insufficient Logging and Monitoring</td>
<td style="text-align: left;">Logging</td>
<td style="text-align: left;">Limitation</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;">Architectural choice</td>
<td style="text-align: left;">Entire application</td>
<td style="text-align: left;">Integrate with a modern APM tool like Application Insights.</td>
</tr>
<tr>
<td style="text-align: left;">VULN-011</td>
<td style="text-align: left;">Use of EOL SQL Server 2008</td>
<td style="text-align: left;">Outdated Components</td>
<td style="text-align: left;">Limitation</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;">Technical debt</td>
<td style="text-align: left;">Database server</td>
<td style="text-align: left;">Upgrade to SQL Server 2022.</td>
</tr>
<tr>
<td style="text-align: left;">VULN-012</td>
<td style="text-align: left;">Use of EOL Windows Server 2008</td>
<td style="text-align: left;">Outdated Components</td>
<td style="text-align: left;">Limitation</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;">Technical debt</td>
<td style="text-align: left;">Operating System</td>
<td style="text-align: left;">Upgrade to Windows Server 2022.</td>
</tr>
<tr>
<td style="text-align: left;">VULN-013</td>
<td style="text-align: left;">Cross-Site Scripting (XSS) - Stored</td>
<td style="text-align: left;">Injection</td>
<td style="text-align: left;">Bug</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;">Lack of output encoding</td>
<td style="text-align: left;">UI display controls</td>
<td style="text-align: left;">HTML-encode all data from the database before displaying it in the UI.</td>
</tr>
<tr>
<td style="text-align: left;">VULN-014</td>
<td style="text-align: left;">Lack of Account Lockout Mechanism</td>
<td style="text-align: left;">Authentication</td>
<td style="text-align: left;">Bug</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;">Custom auth implementation</td>
<td style="text-align: left;"><code>User.cs</code> logic</td>
<td style="text-align: left;">Implement an account lockout policy after several failed login attempts.</td>
</tr>
<tr>
<td style="text-align: left;">VULN-015</td>
<td style="text-align: left;">Unvalidated File Uploads</td>
<td style="text-align: left;">Injection</td>
<td style="text-align: left;">Bug</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;">File processing logic</td>
<td style="text-align: left;"><code>CIFicheiro.cs</code></td>
<td style="text-align: left;">Validate file types, names, and content before processing.</td>
</tr>
<tr>
<td style="text-align: left;">VULN-016</td>
<td style="text-align: left;">Sensitive Data Exposure in Memory</td>
<td style="text-align: left;">Cryptographic Failures</td>
<td style="text-align: left;">Bug</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;">Use of <code>string</code> for passwords</td>
<td style="text-align: left;"><code>AccaoParam.cs</code></td>
<td style="text-align: left;">Use <code>SecureString</code> or char arrays for handling passwords in memory.</td>
</tr>
<tr>
<td style="text-align: left;">VULN-017</td>
<td style="text-align: left;">Missing CSRF Protection</td>
<td style="text-align: left;">Security Misconfiguration</td>
<td style="text-align: left;">Bug</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;">WinForms is not web-based</td>
<td style="text-align: left;">N/A</td>
<td style="text-align: left;">Not directly applicable, but a consideration if migrated to web.</td>
</tr>
<tr>
<td style="text-align: left;">VULN-018</td>
<td style="text-align: left;">Insecure Direct Object Reference (IDOR)</td>
<td style="text-align: left;">Access Control</td>
<td style="text-align: left;">Bug</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;">Lack of ownership checks</td>
<td style="text-align: left;">Data retrieval logic</td>
<td style="text-align: left;">When fetching a record, ensure the current user is authorized to view it.</td>
</tr>
<tr>
<td style="text-align: left;">VULN-019</td>
<td style="text-align: left;">Use of Weak Random Number Generator</td>
<td style="text-align: left;">Cryptographic Failures</td>
<td style="text-align: left;">Bug</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;">Use of <code>System.Random</code></td>
<td style="text-align: left;"><code>CIServRemessaTestes.cs</code></td>
<td style="text-align: left;">Use <code>System.Security.Cryptography.RandomNumberGenerator</code> for crypto purposes.</td>
</tr>
<tr>
<td style="text-align: left;">VULN-020</td>
<td style="text-align: left;">XML External Entity (XXE) Injection</td>
<td style="text-align: left;">Injection</td>
<td style="text-align: left;">Bug</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;">SOAP/XML parsing</td>
<td style="text-align: left;"><code>MDIWebTransmCI.vbproj</code></td>
<td style="text-align: left;">Disable DTD processing in the XML parser.</td>
</tr>
<tr>
<td style="text-align: left;">VULN-021</td>
<td style="text-align: left;">Unrestricted File System Access</td>
<td style="text-align: left;">Access Control</td>
<td style="text-align: left;">Bug</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;">File I/O logic</td>
<td style="text-align: left;"><code>CIFicheiroControlo.cs</code></td>
<td style="text-align: left;">Constrain the application's file access to specific, non-sensitive directories.</td>
</tr>
<tr>
<td style="text-align: left;">VULN-022</td>
<td style="text-align: left;">Use of Outdated Crystal Reports</td>
<td style="text-align: left;">Outdated Components</td>
<td style="text-align: left;">Limitation</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;">Technical debt</td>
<td style="text-align: left;"><code>CIReports.csproj</code></td>
<td style="text-align: left;">Update to a supported version or replace the component.</td>
</tr>
<tr>
<td style="text-align: left;">VULN-023</td>
<td style="text-align: left;">No PII Masking in Logs</td>
<td style="text-align: left;">Logging</td>
<td style="text-align: left;">Bug</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;">Logging implementation</td>
<td style="text-align: left;"><code>GenericLogNET.dll</code></td>
<td style="text-align: left;">Implement data masking for PII like NIBs before logging.</td>
</tr>
<tr>
<td style="text-align: left;">VULN-024</td>
<td style="text-align: left;">Missing Security Headers</td>
<td style="text-align: left;">Security Misconfiguration</td>
<td style="text-align: left;">Bug</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;">N/A (Desktop App)</td>
<td style="text-align: left;">N/A</td>
<td style="text-align: left;">Would be critical if migrated to a web application.</td>
</tr>
<tr>
<td style="text-align: left;">VULN-025</td>
<td style="text-align: left;">Server-Side Request Forgery (SSRF)</td>
<td style="text-align: left;">Injection</td>
<td style="text-align: left;">Bug</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;">Unvalidated URL input</td>
<td style="text-align: left;"><code>MDIWebTransmCI.vbproj</code></td>
<td style="text-align: left;">Validate and whitelist all URLs used in server-to-server requests.</td>
</tr>
<tr>
<td style="text-align: left;">VULN-026</td>
<td style="text-align: left;">Insecure Deserialization</td>
<td style="text-align: left;">Injection</td>
<td style="text-align: left;">Bug</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;">Data deserialization logic</td>
<td style="text-align: left;">N/A (No explicit found)</td>
<td style="text-align: left;">A risk if any part of the app deserializes untrusted data.</td>
</tr>
<tr>
<td style="text-align: left;">VULN-027</td>
<td style="text-align: left;">Lack of Database Connection Encryption</td>
<td style="text-align: left;">Cryptographic Failures</td>
<td style="text-align: left;">Bug</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;">Connection string config</td>
<td style="text-align: left;"><code>*.config</code> files</td>
<td style="text-align: left;">Add <code>Encrypt=True;TrustServerCertificate=False;</code> to connection strings.</td>
</tr>
<tr>
<td style="text-align: left;">VULN-028</td>
<td style="text-align: left;">Hardcoded Credentials</td>
<td style="text-align: left;">Secrets Management</td>
<td style="text-align: left;">Bug</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;">Poor coding practices</td>
<td style="text-align: left;">Source code</td>
<td style="text-align: left;">Remove all hardcoded credentials and use a secrets manager.</td>
</tr>
<tr>
<td style="text-align: left;">VULN-029</td>
<td style="text-align: left;">Information Leakage in Verbose Comments</td>
<td style="text-align: left;">Information Disclosure</td>
<td style="text-align: left;">Bug</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;">Poor coding practices</td>
<td style="text-align: left;">Source code</td>
<td style="text-align: left;">Remove comments that reveal internal architecture or credentials.</td>
</tr>
<tr>
<td style="text-align: left;">VULN-030</td>
<td style="text-align: left;">Path Traversal</td>
<td style="text-align: left;">Injection</td>
<td style="text-align: left;">Bug</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;">File path construction</td>
<td style="text-align: left;"><code>CIFicheiro.cs</code></td>
<td style="text-align: left;">Sanitize all user-controlled input used in file paths.</td>
</tr>
<tr>
<td style="text-align: left;">VULN-031</td>
<td style="text-align: left;">Race Conditions in File Processing</td>
<td style="text-align: left;">Concurrency</td>
<td style="text-align: left;">Bug</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;">File handling logic</td>
<td style="text-align: left;"><code>CIFicheirosControlo.cs</code></td>
<td style="text-align: left;">Use file locking or a transactional approach to prevent race conditions.</td>
</tr>
<tr>
<td style="text-align: left;">VULN-032</td>
<td style="text-align: left;">Denial of Service (DoS) via Large Files</td>
<td style="text-align: left;">Resource Management</td>
<td style="text-align: left;">Bug</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;">File processing logic</td>
<td style="text-align: left;"><code>CIFicheiro.cs</code></td>
<td style="text-align: left;">Impose size limits on ingested files.</td>
</tr>
<tr>
<td style="text-align: left;">VULN-033</td>
<td style="text-align: left;">Unaudited User Actions</td>
<td style="text-align: left;">Logging</td>
<td style="text-align: left;">Bug</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;">Authorization logic</td>
<td style="text-align: left;"><code>ActividadeBalcaoForm.cs</code></td>
<td style="text-align: left;">Create a detailed audit trail for all sensitive actions.</td>
</tr>
<tr>
<td style="text-align: left;">VULN-034</td>
<td style="text-align: left;">Use of <code>BinaryFormatter</code></td>
<td style="text-align: left;">Insecure Deserialization</td>
<td style="text-align: left;">Bug</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;">N/A (Not found, but common)</td>
<td style="text-align: left;">N/A</td>
<td style="text-align: left;">Avoid <code>BinaryFormatter</code> as it is inherently insecure.</td>
</tr>
<tr>
<td style="text-align: left;">VULN-035</td>
<td style="text-align: left;">Open Redirect</td>
<td style="text-align: left;">Injection</td>
<td style="text-align: left;">Bug</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;">N/A (Desktop App)</td>
<td style="text-align: left;">N/A</td>
<td style="text-align: left;">A risk if migrated to web with redirection logic.</td>
</tr>
<tr>
<td style="text-align: left;">VULN-036</td>
<td style="text-align: left;">No Data Validation on Service Layer</td>
<td style="text-align: left;">Injection</td>
<td style="text-align: left;">Bug</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;">Service implementation</td>
<td style="text-align: left;"><code>CIServRemessas.csproj</code></td>
<td style="text-align: left;">All data passed to service methods should be validated.</td>
</tr>
<tr>
<td style="text-align: left;">VULN-037</td>
<td style="text-align: left;">Insufficient Session Management</td>
<td style="text-align: left;">Authentication</td>
<td style="text-align: left;">Bug</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;">N/A (Desktop App)</td>
<td style="text-align: left;">N/A</td>
<td style="text-align: left;">No session timeout or invalidation mechanisms are apparent.</td>
</tr>
<tr>
<td style="text-align: left;">VULN-038</td>
<td style="text-align: left;">Database User with Excessive Privileges</td>
<td style="text-align: left;">Access Control</td>
<td style="text-align: left;">Bug</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;">DB configuration</td>
<td style="text-align: left;">SQL Server</td>
<td style="text-align: left;">The application's DB user should have least-privilege access.</td>
</tr>
<tr>
<td style="text-align: left;">VULN-039</td>
<td style="text-align: left;">Insecure Temporary File Creation</td>
<td style="text-align: left;">Injection</td>
<td style="text-align: left;">Bug</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;">File handling logic</td>
<td style="text-align: left;"><code>CIFicheiro.cs</code></td>
<td style="text-align: left;">Use <code>Path.GetTempFileName()</code> to securely create temporary files.</td>
</tr>
<tr>
<td style="text-align: left;">VULN-040</td>
<td style="text-align: left;">Exposed Management Interfaces</td>
<td style="text-align: left;">Access Control</td>
<td style="text-align: left;">Bug</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;">Network configuration</td>
<td style="text-align: left;">Server deployment</td>
<td style="text-align: left;">Database and application servers should not be exposed to the internet.</td>
</tr>
<tr>
<td style="text-align: left;">VULN-041</td>
<td style="text-align: left;">Lack of Integrity Checks</td>
<td style="text-align: left;">Software Integrity</td>
<td style="text-align: left;">Bug</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;">Deployment process</td>
<td style="text-align: left;"><code>Install</code> folder</td>
<td style="text-align: left;">No checksums or signatures are validated for dependencies.</td>
</tr>
<tr>
<td style="text-align: left;">VULN-042</td>
<td style="text-align: left;">Plaintext Backup Files</td>
<td style="text-align: left;">Cryptographic Failures</td>
<td style="text-align: left;">Bug</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;">Backup process</td>
<td style="text-align: left;">File System</td>
<td style="text-align: left;">Database backups and file archives should be encrypted.</td>
</tr>
<tr>
<td style="text-align: left;">VULN-043</td>
<td style="text-align: left;">Predictable Transaction IDs</td>
<td style="text-align: left;">Cryptographic Failures</td>
<td style="text-align: left;">Bug</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;">Data generation logic</td>
<td style="text-align: left;"><code>Tranche.cs</code></td>
<td style="text-align: left;">Use cryptographically secure random values for identifiers if they need to be unguessable.</td>
</tr>
<tr>
<td style="text-align: left;">VULN-044</td>
<td style="text-align: left;">Use of <code>HttpWebRequest</code></td>
<td style="text-align: left;">Outdated Components</td>
<td style="text-align: left;">Limitation</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><code>MDIWebTransmCI.vbproj</code></td>
<td style="text-align: left;"><code>HttpWebRequest</code> is obsolete; use <code>HttpClient</code> instead.</td>
</tr>
<tr>
<td style="text-align: left;">VULN-045</td>
<td style="text-align: left;">No Certificate Pinning</td>
<td style="text-align: left;">Cryptographic Failures</td>
<td style="text-align: left;">Bug</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><code>MDIWebTransmCI.vbproj</code></td>
<td style="text-align: left;">For high-security scenarios, pin the expected server certificate.</td>
</tr>
<tr>
<td style="text-align: left;">VULN-046</td>
<td style="text-align: left;">No Content Security Policy (CSP)</td>
<td style="text-align: left;">Security Misconfiguration</td>
<td style="text-align: left;">Bug</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;">N/A (Desktop App)</td>
<td style="text-align: left;">N/A</td>
<td style="text-align: left;">Would be critical if migrated to a web application.</td>
</tr>
<tr>
<td style="text-align: left;">VULN-047</td>
<td style="text-align: left;">Weak TLS Configuration</td>
<td style="text-align: left;">Cryptographic Failures</td>
<td style="text-align: left;">Bug</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;">Server configuration</td>
<td style="text-align: left;">Windows Server</td>
<td style="text-align: left;">The OS may support old, insecure TLS versions (e.g., 1.0, 1.1).</td>
</tr>
<tr>
<td style="text-align: left;">VULN-048</td>
<td style="text-align: left;">Service Account with Interactive Logon</td>
<td style="text-align: left;">Access Control</td>
<td style="text-align: left;">Bug</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;">Server configuration</td>
<td style="text-align: left;">Windows Server</td>
<td style="text-align: left;">Service accounts should be denied the right to log on locally.</td>
</tr>
<tr>
<td style="text-align: left;">VULN-049</td>
<td style="text-align: left;">Code Signing Not Enforced</td>
<td style="text-align: left;">Software Integrity</td>
<td style="text-align: left;">Bug</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;">Deployment process</td>
<td style="text-align: left;">All DLLs/EXEs</td>
<td style="text-align: left;">Assemblies are not signed, allowing them to be tampered with.</td>
</tr>
<tr>
<td style="text-align: left;">VULN-050</td>
<td style="text-align: left;">SQL Injection in Stored Procedures</td>
<td style="text-align: left;">Injection</td>
<td style="text-align: left;">Bug</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;">Database schema</td>
<td style="text-align: left;"><code>.sql</code> files</td>
<td style="text-align: left;">Stored procedures using dynamic SQL (<code>EXEC</code>) are also vulnerable.</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="product-section">
<h2 id="12-supportability-and-maintainability">12. Supportability and maintainability</h2>
This section analyzes the support status of the key components of the application's technology stack.
<div class="table-container">
<table>
<colgroup>
<col style="width: 14%" />
<col style="width: 14%" />
<col style="width: 14%" />
<col style="width: 14%" />
<col style="width: 14%" />
<col style="width: 14%" />
<col style="width: 14%" />
</colgroup>
<thead>
<tr>
<th style="text-align: left;">Component</th>
<th style="text-align: left;">Current version</th>
<th style="text-align: left;">End of support date</th>
<th style="text-align: left;">Supportability</th>
<th style="text-align: left;">Latest stable version</th>
<th style="text-align: left;">Notes</th>
<th style="text-align: left;">Links</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>.NET Framework</strong></td>
<td style="text-align: left;">4.0</td>
<td style="text-align: left;">2016-01-12</td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> Not Supported</td>
<td style="text-align: left;">4.8.1</td>
<td style="text-align: left;">This is a critical risk. The runtime is no longer receiving security updates.</td>
<td style="text-align: left;"><a href="https://learn.microsoft.com/en-us/lifecycle/products/microsoft-net-framework">Microsoft Lifecycle</a></td>
</tr>
<tr>
<td style="text-align: left;"><strong>Windows Forms</strong></td>
<td style="text-align: left;">(part of .NET 4.0)</td>
<td style="text-align: left;">2016-01-12</td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> Not Supported</td>
<td style="text-align: left;">.NET 8</td>
<td style="text-align: left;">The UI framework is tied to the unsupported runtime.</td>
<td style="text-align: left;"><a href="https://learn.microsoft.com/en-us/lifecycle/products/microsoft-net-framework">Microsoft Lifecycle</a></td>
</tr>
<tr>
<td style="text-align: left;"><strong>Visual Studio</strong></td>
<td style="text-align: left;">2010 (inferred)</td>
<td style="text-align: left;">2020-07-14</td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> Not Supported</td>
<td style="text-align: left;">2022</td>
<td style="text-align: left;">The development tools are obsolete.</td>
<td style="text-align: left;"><a href="https://learn.microsoft.com/en-us/lifecycle/products/visual-studio-2010">Microsoft Lifecycle</a></td>
</tr>
<tr>
<td style="text-align: left;"><strong>SQL Server</strong></td>
<td style="text-align: left;">2008 (inferred)</td>
<td style="text-align: left;">2019-07-09</td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> Not Supported</td>
<td style="text-align: left;">2022</td>
<td style="text-align: left;">The database server is end-of-life, posing a security and compliance risk.</td>
<td style="text-align: left;"><a href="https://learn.microsoft.com/en-us/lifecycle/products/sql-server-2008">Microsoft Lifecycle</a></td>
</tr>
<tr>
<td style="text-align: left;"><strong>Windows Server</strong></td>
<td style="text-align: left;">2008 (inferred)</td>
<td style="text-align: left;">2020-01-14</td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> Not Supported</td>
<td style="text-align: left;">2022</td>
<td style="text-align: left;">The operating system is end-of-life.</td>
<td style="text-align: left;"><a href="https://learn.microsoft.com/en-us/lifecycle/products/windows-server-2008">Microsoft Lifecycle</a></td>
</tr>
</tbody>
</table>
</div>
<h3 id="121-net-framework-lifecycle">12.1. .NET Framework lifecycle</h3>
This table provides a comprehensive overview of the .NET Framework versions and their support status. The application's use of an unsupported version is a major risk.
<div class="table-container">
<table>
<colgroup>
<col style="width: 20%" />
<col style="width: 20%" />
<col style="width: 20%" />
<col style="width: 20%" />
<col style="width: 20%" />
</colgroup>
<thead>
<tr>
<th style="text-align: left;">Version</th>
<th style="text-align: left;">Start date</th>
<th style="text-align: left;">End date</th>
<th style="text-align: left;">Supported</th>
<th style="text-align: left;">Used in the application</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;">.NET Framework 1.0</td>
<td style="text-align: left;">2002-02-13</td>
<td style="text-align: left;">2009-07-14</td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> No</td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> No</td>
</tr>
<tr>
<td style="text-align: left;">.NET Framework 1.1</td>
<td style="text-align: left;">2003-04-24</td>
<td style="text-align: left;">2013-10-08</td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> No</td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> No</td>
</tr>
<tr>
<td style="text-align: left;">.NET Framework 2.0</td>
<td style="text-align: left;">2005-11-07</td>
<td style="text-align: left;">2011-07-12</td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> No</td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> No</td>
</tr>
<tr>
<td style="text-align: left;">.NET Framework 3.0</td>
<td style="text-align: left;">2006-11-06</td>
<td style="text-align: left;">2011-07-12</td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> No</td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> No</td>
</tr>
<tr>
<td style="text-align: left;">.NET Framework 3.5</td>
<td style="text-align: left;">2007-11-19</td>
<td style="text-align: left;">2029-01-09</td>
<td style="text-align: left;"><span class="icon icon-check" title="Yes/Used/Supported">check_circle</span> Yes</td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> No</td>
</tr>
<tr>
<td style="text-align: left;">.NET Framework 4.0</td>
<td style="text-align: left;">2010-04-12</td>
<td style="text-align: left;">2016-01-12</td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> No</td>
<td style="text-align: left;"><span class="icon icon-check" title="Yes/Used/Supported">check_circle</span> Yes</td>
</tr>
<tr>
<td style="text-align: left;">.NET Framework 4.5</td>
<td style="text-align: left;">2012-08-15</td>
<td style="text-align: left;">2016-01-12</td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> No</td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> No</td>
</tr>
<tr>
<td style="text-align: left;">.NET Framework 4.5.1</td>
<td style="text-align: left;">2013-10-17</td>
<td style="text-align: left;">2016-01-12</td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> No</td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> No</td>
</tr>
<tr>
<td style="text-align: left;">.NET Framework 4.5.2</td>
<td style="text-align: left;">2014-05-05</td>
<td style="text-align: left;">2022-04-26</td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> No</td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> No</td>
</tr>
<tr>
<td style="text-align: left;">.NET Framework 4.6</td>
<td style="text-align: left;">2015-07-20</td>
<td style="text-align: left;">2022-04-26</td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> No</td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> No</td>
</tr>
<tr>
<td style="text-align: left;">.NET Framework 4.6.1</td>
<td style="text-align: left;">2015-11-30</td>
<td style="text-align: left;">2022-04-26</td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> No</td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> No</td>
</tr>
<tr>
<td style="text-align: left;">.NET Framework 4.6.2</td>
<td style="text-align: left;">2016-08-02</td>
<td style="text-align: left;">2027-01-12</td>
<td style="text-align: left;"><span class="icon icon-check" title="Yes/Used/Supported">check_circle</span> Yes</td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> No</td>
</tr>
<tr>
<td style="text-align: left;">.NET Framework 4.7</td>
<td style="text-align: left;">2017-04-05</td>
<td style="text-align: left;">2027-01-12</td>
<td style="text-align: left;"><span class="icon icon-check" title="Yes/Used/Supported">check_circle</span> Yes</td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> No</td>
</tr>
<tr>
<td style="text-align: left;">.NET Framework 4.7.1</td>
<td style="text-align: left;">2017-10-17</td>
<td style="text-align: left;">2027-01-12</td>
<td style="text-align: left;"><span class="icon icon-check" title="Yes/Used/Supported">check_circle</span> Yes</td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> No</td>
</tr>
<tr>
<td style="text-align: left;">.NET Framework 4.7.2</td>
<td style="text-align: left;">2018-04-30</td>
<td style="text-align: left;">2027-01-12</td>
<td style="text-align: left;"><span class="icon icon-check" title="Yes/Used/Supported">check_circle</span> Yes</td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> No</td>
</tr>
<tr>
<td style="text-align: left;">.NET Framework 4.8</td>
<td style="text-align: left;">2019-04-18</td>
<td style="text-align: left;">2029-01-09</td>
<td style="text-align: left;"><span class="icon icon-check" title="Yes/Used/Supported">check_circle</span> Yes</td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> No</td>
</tr>
<tr>
<td style="text-align: left;"><strong>.NET Framework 4.8.1</strong></td>
<td style="text-align: left;"><strong>2022-08-09</strong></td>
<td style="text-align: left;"><strong>Follows OS Lifecycle</strong></td>
<td style="text-align: left;"><span class="icon icon-check" title="Yes/Used/Supported">check_circle</span> <strong>Yes</strong></td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> <strong>No</strong></td>
</tr>
</tbody>
</table>
</div>
<h3 id="122-net-lifecycle">12.2. .NET lifecycle</h3>
This section outlines the support lifecycle for the modern, cross-platform .NET (formerly .NET Core). While not used by the current application, it is relevant for modernization planning.
<div class="table-container">
<table>
<colgroup>
<col style="width: 20%" />
<col style="width: 20%" />
<col style="width: 20%" />
<col style="width: 20%" />
<col style="width: 20%" />
</colgroup>
<thead>
<tr>
<th style="text-align: left;">Version</th>
<th style="text-align: left;">Start date</th>
<th style="text-align: left;">End date</th>
<th style="text-align: left;">Supported</th>
<th style="text-align: left;">Used in the application</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;">.NET Core 3.1 (LTS)</td>
<td style="text-align: left;">2019-12-03</td>
<td style="text-align: left;">2022-12-13</td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> No</td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> No</td>
</tr>
<tr>
<td style="text-align: left;">.NET 5 (STS)</td>
<td style="text-align: left;">2020-11-10</td>
<td style="text-align: left;">2022-05-10</td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> No</td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> No</td>
</tr>
<tr>
<td style="text-align: left;">.NET 6 (LTS)</td>
<td style="text-align: left;">2021-11-08</td>
<td style="text-align: left;">2024-11-12</td>
<td style="text-align: left;"><span class="icon icon-check" title="Yes/Used/Supported">check_circle</span> Yes</td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> No</td>
</tr>
<tr>
<td style="text-align: left;">.NET 7 (STS)</td>
<td style="text-align: left;">2022-11-08</td>
<td style="text-align: left;">2024-05-14</td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> No</td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> No</td>
</tr>
<tr>
<td style="text-align: left;"><strong>.NET 8 (LTS)</strong></td>
<td style="text-align: left;"><strong>2023-11-14</strong></td>
<td style="text-align: left;"><strong>2026-11-10</strong></td>
<td style="text-align: left;"><span class="icon icon-check" title="Yes/Used/Supported">check_circle</span> <strong>Yes</strong></td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> <strong>No</strong></td>
</tr>
<tr>
<td style="text-align: left;">.NET 9 (STS)</td>
<td style="text-align: left;">2024-11-12</td>
<td style="text-align: left;">2026-05-12</td>
<td style="text-align: left;"><span class="icon icon-check" title="Yes/Used/Supported">check_circle</span> Yes</td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> No</td>
</tr>
</tbody>
</table>
</div>
<h3 id="123-windows-server-operating-systems-lifecycle">12.3. Windows Server Operating Systems lifecycle</h3>
Based on the application's age, the likely operating system is Windows Server 2008 or 2008 R2, both of which are unsupported.
<div class="table-container">
<table>
<colgroup>
<col style="width: 16%" />
<col style="width: 16%" />
<col style="width: 16%" />
<col style="width: 16%" />
<col style="width: 16%" />
<col style="width: 16%" />
</colgroup>
<thead>
<tr>
<th style="text-align: left;">Version</th>
<th style="text-align: left;">Start date</th>
<th style="text-align: left;">End date (mainstream)</th>
<th style="text-align: left;">End date (extended)</th>
<th style="text-align: left;">Supported</th>
<th style="text-align: left;">Used in the application</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;">Windows Server 2008</td>
<td style="text-align: left;">2008-05-06</td>
<td style="text-align: left;">2015-01-13</td>
<td style="text-align: left;">2020-01-14</td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> No</td>
<td style="text-align: left;"><span class="icon icon-question" title="Uncertain/Likely">help</span> Likely</td>
</tr>
<tr>
<td style="text-align: left;">Windows Server 2008 R2</td>
<td style="text-align: left;">2009-10-22</td>
<td style="text-align: left;">2015-01-13</td>
<td style="text-align: left;">2020-01-14</td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> No</td>
<td style="text-align: left;"><span class="icon icon-question" title="Uncertain/Likely">help</span> Likely</td>
</tr>
<tr>
<td style="text-align: left;">Windows Server 2012</td>
<td style="text-align: left;">2012-10-30</td>
<td style="text-align: left;">2018-10-09</td>
<td style="text-align: left;">2023-10-10</td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> No</td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> No</td>
</tr>
<tr>
<td style="text-align: left;">Windows Server 2012 R2</td>
<td style="text-align: left;">2013-11-25</td>
<td style="text-align: left;">2018-10-09</td>
<td style="text-align: left;">2023-10-10</td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> No</td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> No</td>
</tr>
<tr>
<td style="text-align: left;">Windows Server 2016</td>
<td style="text-align: left;">2016-10-15</td>
<td style="text-align: left;">2022-01-11</td>
<td style="text-align: left;">2027-01-12</td>
<td style="text-align: left;"><span class="icon icon-check" title="Yes/Used/Supported">check_circle</span> Yes</td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> No</td>
</tr>
<tr>
<td style="text-align: left;">Windows Server 2019</td>
<td style="text-align: left;">2018-11-13</td>
<td style="text-align: left;">2024-01-09</td>
<td style="text-align: left;">2029-01-09</td>
<td style="text-align: left;"><span class="icon icon-check" title="Yes/Used/Supported">check_circle</span> Yes</td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> No</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Windows Server 2022</strong></td>
<td style="text-align: left;"><strong>2021-08-18</strong></td>
<td style="text-align: left;"><strong>2026-10-13</strong></td>
<td style="text-align: left;"><strong>2031-10-14</strong></td>
<td style="text-align: left;"><span class="icon icon-check" title="Yes/Used/Supported">check_circle</span> <strong>Yes</strong></td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> <strong>No</strong></td>
</tr>
</tbody>
</table>
</div>
<h3 id="124-microsoft-sql-server-lifecycle">12.4. Microsoft SQL Server lifecycle</h3>
The server names and application age suggest a version of SQL Server from the 2008 era, which is unsupported.
<div class="table-container">
<table>
<colgroup>
<col style="width: 16%" />
<col style="width: 16%" />
<col style="width: 16%" />
<col style="width: 16%" />
<col style="width: 16%" />
<col style="width: 16%" />
</colgroup>
<thead>
<tr>
<th style="text-align: left;">Version</th>
<th style="text-align: left;">Start date</th>
<th style="text-align: left;">End date (mainstream)</th>
<th style="text-align: left;">End date (extended)</th>
<th style="text-align: left;">Supported</th>
<th style="text-align: left;">Used in the application</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;">SQL Server 2008</td>
<td style="text-align: left;">2008-11-06</td>
<td style="text-align: left;">2014-07-08</td>
<td style="text-align: left;">2019-07-09</td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> No</td>
<td style="text-align: left;"><span class="icon icon-question" title="Uncertain/Likely">help</span> Likely</td>
</tr>
<tr>
<td style="text-align: left;">SQL Server 2008 R2</td>
<td style="text-align: left;">2010-07-20</td>
<td style="text-align: left;">2014-07-08</td>
<td style="text-align: left;">2019-07-09</td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> No</td>
<td style="text-align: left;"><span class="icon icon-question" title="Uncertain/Likely">help</span> Likely</td>
</tr>
<tr>
<td style="text-align: left;">SQL Server 2012</td>
<td style="text-align: left;">2012-05-20</td>
<td style="text-align: left;">2017-07-11</td>
<td style="text-align: left;">2022-07-12</td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> No</td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> No</td>
</tr>
<tr>
<td style="text-align: left;">SQL Server 2014</td>
<td style="text-align: left;">2014-06-05</td>
<td style="text-align: left;">2019-07-09</td>
<td style="text-align: left;">2024-07-09</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Extended</td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> No</td>
</tr>
<tr>
<td style="text-align: left;">SQL Server 2016</td>
<td style="text-align: left;">2016-06-01</td>
<td style="text-align: left;">2021-07-13</td>
<td style="text-align: left;">2026-07-14</td>
<td style="text-align: left;"><span class="icon icon-check" title="Yes/Used/Supported">check_circle</span> Yes</td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> No</td>
</tr>
<tr>
<td style="text-align: left;">SQL Server 2017</td>
<td style="text-align: left;">2017-10-02</td>
<td style="text-align: left;">2022-10-11</td>
<td style="text-align: left;">2027-10-12</td>
<td style="text-align: left;"><span class="icon icon-check" title="Yes/Used/Supported">check_circle</span> Yes</td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> No</td>
</tr>
<tr>
<td style="text-align: left;">SQL Server 2019</td>
<td style="text-align: left;">2019-11-04</td>
<td style="text-align: left;">2025-01-07</td>
<td style="text-align: left;">2030-01-08</td>
<td style="text-align: left;"><span class="icon icon-check" title="Yes/Used/Supported">check_circle</span> Yes</td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> No</td>
</tr>
<tr>
<td style="text-align: left;"><strong>SQL Server 2022</strong></td>
<td style="text-align: left;"><strong>2022-11-16</strong></td>
<td style="text-align: left;"><strong>2028-01-11</strong></td>
<td style="text-align: left;"><strong>2033-01-11</strong></td>
<td style="text-align: left;"><span class="icon icon-check" title="Yes/Used/Supported">check_circle</span> <strong>Yes</strong></td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> <strong>No</strong></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="product-section">
<h2 id="13-modernization-strategy">13. Modernization strategy</h2>
This section outlines three potential modernization strategies for the application, addressing its technical debt and preparing it for the future.
<h3 id="131-modernization-strategy-comparison">13.1. Modernization strategy comparison</h3>
The following table compares the three strategies across several key factors.
<div class="table-container">
<table>
<colgroup>
<col style="width: 7%" />
<col style="width: 7%" />
<col style="width: 7%" />
<col style="width: 7%" />
<col style="width: 7%" />
<col style="width: 7%" />
<col style="width: 7%" />
<col style="width: 7%" />
<col style="width: 7%" />
<col style="width: 7%" />
<col style="width: 7%" />
<col style="width: 7%" />
<col style="width: 7%" />
<col style="width: 7%" />
</colgroup>
<thead>
<tr>
<th style="text-align: left;">Strategy</th>
<th style="text-align: left;">Description</th>
<th style="text-align: left;">Complexity</th>
<th style="text-align: left;">Development time estimate</th>
<th style="text-align: left;">Functional testing time estimate</th>
<th style="text-align: left;">Infrastructure time estimate</th>
<th style="text-align: left;">Deployment time estimate</th>
<th style="text-align: left;">Total time estimate</th>
<th style="text-align: left;">Cost estimate</th>
<th style="text-align: left;">Risk</th>
<th style="text-align: left;">Long-term fit</th>
<th style="text-align: left;">Time-to-market</th>
<th style="text-align: left;">Pros</th>
<th style="text-align: left;">Cons</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>Lift and Shift (without rehosting)</strong></td>
<td style="text-align: left;">Upgrade the application to the latest .NET Framework (4.8.1) and update third-party libraries. Keep the existing on-premises deployment model.</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;">3-5 weeks</td>
<td style="text-align: left;">3-5 weeks</td>
<td style="text-align: left;">1-2 weeks</td>
<td style="text-align: left;">1-2 weeks</td>
<td style="text-align: left;">8-14 weeks</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> Low</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> Low</td>
<td style="text-align: left;"><span class="icon icon-check" title="Yes/Used/Supported">check_circle</span> Minimal code changes.<br><span class="icon icon-check" title="Yes/Used/Supported">check_circle</span> Low risk.</td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> Does not address architectural flaws.<br><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> Remains a monolith.<br><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> Limited scalability.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Lift and Shift (with rehosting)</strong></td>
<td style="text-align: left;">Rehost the application to a cloud provider (e.g., Azure VMs) and the database to a managed service (e.g., Azure SQL). Upgrade to .NET Framework 4.8.1.</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;">3-5 weeks</td>
<td style="text-align: left;">3-5 weeks</td>
<td style="text-align: left;">3-5 weeks</td>
<td style="text-align: left;">1-2 weeks</td>
<td style="text-align: left;">10-17 weeks</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-medium" title="Medium/Warning">warning</span> Medium</td>
<td style="text-align: left;"><span class="icon icon-check" title="Yes/Used/Supported">check_circle</span> Gains cloud benefits (reliability, backups).<br><span class="icon icon-check" title="Yes/Used/Supported">check_circle</span> Minimal code changes.</td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> Does not address architectural flaws.<br><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> Not cloud-native.<br><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> Higher operational cost.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Complete Refactor</strong></td>
<td style="text-align: left;">Rewrite the application using modern technologies (.NET 8). Decompose the monolith into smaller, manageable services (e.g., API for processing, background service for jobs).</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;">9-12 weeks</td>
<td style="text-align: left;">6-8 weeks</td>
<td style="text-align: left;">3-5 weeks</td>
<td style="text-align: left;">1-2 weeks</td>
<td style="text-align: left;">19-27 weeks</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;"><span class="icon icon-low" title="Low/Info">recommend</span> High</td>
<td style="text-align: left;"><span class="icon icon-high" title="High/Critical">dangerous</span> High</td>
<td style="text-align: left;"><span class="icon icon-check" title="Yes/Used/Supported">check_circle</span> Resolves all technical debt.<br><span class="icon icon-check" title="Yes/Used/Supported">check_circle</span> Cloud-native and scalable.<br><span class="icon icon-check" title="Yes/Used/Supported">check_circle</span> High maintainability.</td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> High cost and time investment.<br><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> High risk of introducing new bugs.<br><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> Requires significant testing effort.</td>
</tr>
</tbody>
</table>
</div>
<h3 id="132-recommendation">13.2. Recommendation</h3>
Based on the analysis, the recommended strategy is a <strong>Complete Refactor</strong>. While it carries the highest upfront cost and risk, it is the only strategy that addresses the fundamental architectural issues, critical security vulnerabilities (like SQL injection), and end-of-life technology stack. The long-term benefits in terms of maintainability, scalability, and security far outweigh the short-term advantages of a lift-and-shift approach.
<h4 id="1321-step-by-step-plan">13.2.1. Step-by-step plan</h4>
This section provides a detailed step-by-step plan for the recommended <strong>Complete Refactor</strong> strategy.
<div class="table-container">
<table>
<colgroup>
<col style="width: 25%" />
<col style="width: 25%" />
<col style="width: 25%" />
<col style="width: 25%" />
</colgroup>
<thead>
<tr>
<th style="text-align: left;">Phase</th>
<th style="text-align: left;">Step</th>
<th style="text-align: left;">Description</th>
<th style="text-align: left;">Key Technologies</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>1. Discovery & Planning</strong></td>
<td style="text-align: left;"><strong>1.1. Analyze & Decompose</strong></td>
<td style="text-align: left;">Identify bounded contexts (Remittances, Alerts, Users) and define the seams for decomposition into microservices.</td>
<td style="text-align: left;">Domain-Driven Design</td>
</tr>
<tr>
<td style="text-align: left;"><strong>1.2. Technology Selection</strong></td>
<td style="text-align: left;">Finalize the target technology stack: .NET 8, ASP.NET Core Web API, EF Core, a modern UI framework (if needed), and a cloud provider (e.g., Azure).</td>
<td style="text-align: left;">.NET 8, Azure</td>
</tr>
<tr>
<td style="text-align: left;"><strong>1.3. Database Migration Plan</strong></td>
<td style="text-align: left;">Plan the migration from the legacy SQL Server to Azure SQL Database, including schema updates and data migration.</td>
<td style="text-align: left;">Azure SQL, SSMS</td>
</tr>
<tr>
<td style="text-align: left;"><strong>2. Core Refactoring</strong></td>
<td style="text-align: left;"><strong>2.1. Data Access Layer</strong></td>
<td style="text-align: left;">Create a new data access layer using Entity Framework Core. Replace all raw SQL queries with LINQ or parameterized EF Core commands.</td>
<td style="text-align: left;">EF Core</td>
</tr>
<tr>
<td style="text-align: left;"><strong>2.2. Remittance Service</strong></td>
<td style="text-align: left;">Create a new ASP.NET Core Web API project for the remittance processing logic. Encapsulate all business rules within this service.</td>
<td style="text-align: left;">ASP.NET Core</td>
</tr>
<tr>
<td style="text-align: left;"><strong>2.3. Alerting Service</strong></td>
<td style="text-align: left;">Create a separate background service (e.g., using Azure Functions or a Worker Service) to handle alert generation and processing.</td>
<td style="text-align: left;">Azure Functions</td>
</tr>
<tr>
<td style="text-align: left;"><strong>3. UI & Integration</strong></td>
<td style="text-align: left;"><strong>3.1. Rebuild UI</strong></td>
<td style="text-align: left;">Rebuild the control panel as a modern web application (e.g., Blazor or Angular) that consumes the new APIs.</td>
<td style="text-align: left;">Blazor/Angular</td>
</tr>
<tr>
<td style="text-align: left;"><strong>3.2. External Integrations</strong></td>
<td style="text-align: left;">Refactor file processing and web service consumption to use modern, resilient patterns (e.g., Polly for retries).</td>
<td style="text-align: left;">Polly, Azure Blob Storage</td>
</tr>
<tr>
<td style="text-align: left;"><strong>4. Testing & Deployment</strong></td>
<td style="text-align: left;"><strong>4.1. Comprehensive Testing</strong></td>
<td style="text-align: left;">Write extensive unit, integration, and end-to-end tests for the new services and UI.</td>
<td style="text-align: left;">xUnit, Moq</td>
</tr>
<tr>
<td style="text-align: left;"><strong>4.2. CI/CD Pipeline</strong></td>
<td style="text-align: left;">Set up a CI/CD pipeline in Azure DevOps or GitHub Actions to automate builds, testing, and deployments to Azure.</td>
<td style="text-align: left;">Azure DevOps</td>
</tr>
<tr>
<td style="text-align: left;"><strong>4.3. Go-Live</strong></td>
<td style="text-align: left;">Perform a phased rollout or a blue-green deployment to minimize downtime. Decommission the old on-premises infrastructure.</td>
<td style="text-align: left;">Azure App Service</td>
</tr>
</tbody>
</table>
</div>
<h4 id="1322-gantt-chart">13.2.2. Gantt chart</h4>
A Gantt chart to visualize the step-by-step plan, showing the timeline and dependencies of each step.
<pre class="mermaid"><code>gantt
    title Modernization Plan: Complete Refactor
    dateFormat  YYYY-MM-DD
    axisFormat %m-%d
    
    section Discovery & Planning
    Analyze & Decompose       :a1, 2025-08-11, 2w
    Technology Selection      :a2, after a1, 1w
    Database Migration Plan   :a3, after a2, 2w

    section Core Refactoring
    Data Access Layer         :b1, after a3, 4w
    Remittance Service        :b2, after b1, 5w
    Alerting Service          :b3, after b1, 3w

    section UI & Integration
    Rebuild UI                :c1, after b2, 6w
    External Integrations     :c2, after b3, 3w

    section Testing & Deployment
    Comprehensive Testing     :d1, after c1, 4w
    CI/CD Pipeline            :d2, after a3, 2w
    Go-Live                   :d3, after d1, 1w
</code></pre>
<center>Figure 13 - Gantt chart for the recommended refactoring strategy.</center>
</div>
<div class="product-section">
<h2 id="14-application-porfolio-management">14. Application porfolio management</h2>
This section provides an analysis of the application's components and strategic fit, suitable for integration into an Application Portfolio Management (APM) tool like SAP LeanIX.
<h3 id="141-it-component-types-and-attributes">14.1. IT Component types and attributes</h3>
The following table maps the application's technologies to IT Component types.
<div class="table-container">
<table>
<colgroup>
<col style="width: 12%" />
<col style="width: 12%" />
<col style="width: 12%" />
<col style="width: 12%" />
<col style="width: 12%" />
<col style="width: 12%" />
<col style="width: 12%" />
<col style="width: 12%" />
</colgroup>
<thead>
<tr>
<th style="text-align: left;">IT Component Type</th>
<th style="text-align: left;">Name</th>
<th style="text-align: left;">Version(s)</th>
<th style="text-align: left;">Provider(s)</th>
<th style="text-align: left;">Support start date</th>
<th style="text-align: left;">Support end date</th>
<th style="text-align: left;">Support end date (extended)</th>
<th style="text-align: left;">Support status</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>Operating System</strong></td>
<td style="text-align: left;">Windows Server</td>
<td style="text-align: left;">2008 / 2008 R2 (Inferred)</td>
<td style="text-align: left;">Microsoft</td>
<td style="text-align: left;">2008-05-06</td>
<td style="text-align: left;">2015-01-13</td>
<td style="text-align: left;">2020-01-14</td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> Unsupported</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Database</strong></td>
<td style="text-align: left;">Microsoft SQL Server</td>
<td style="text-align: left;">2008 / 2008 R2 (Inferred)</td>
<td style="text-align: left;">Microsoft</td>
<td style="text-align: left;">2008-11-06</td>
<td style="text-align: left;">2014-07-08</td>
<td style="text-align: left;">2019-07-09</td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> Unsupported</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Programming Language</strong></td>
<td style="text-align: left;">C#</td>
<td style="text-align: left;">4.0</td>
<td style="text-align: left;">Microsoft</td>
<td style="text-align: left;">2010-04-12</td>
<td style="text-align: left;">2016-01-12</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> Unsupported</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Programming Language</strong></td>
<td style="text-align: left;">VB.NET</td>
<td style="text-align: left;">10.0</td>
<td style="text-align: left;">Microsoft</td>
<td style="text-align: left;">2010-04-12</td>
<td style="text-align: left;">2016-01-12</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> Unsupported</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Web Framework</strong></td>
<td style="text-align: left;">.NET Framework</td>
<td style="text-align: left;">4.0</td>
<td style="text-align: left;">Microsoft</td>
<td style="text-align: left;">2010-04-12</td>
<td style="text-align: left;">2016-01-12</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> Unsupported</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Development Tool</strong></td>
<td style="text-align: left;">Visual Studio</td>
<td style="text-align: left;">2010</td>
<td style="text-align: left;">Microsoft</td>
<td style="text-align: left;">2010-04-12</td>
<td style="text-align: left;">2015-07-14</td>
<td style="text-align: left;">2020-07-14</td>
<td style="text-align: left;"><span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span> Unsupported</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Middleware</strong></td>
<td style="text-align: left;">TIBCO</td>
<td style="text-align: left;">N/A (Inferred)</td>
<td style="text-align: left;">TIBCO</td>
<td style="text-align: left;">N/A</td>
<td style="text-align: left;">N/A</td>
<td style="text-align: left;">N/A</td>
<td style="text-align: left;"><span class="icon icon-question" title="Uncertain/Likely">help</span> Likely</td>
</tr>
</tbody>
</table>
</div>
<h3 id="142-portfolio-strategy">14.2. Portfolio strategy</h3>
This section evaluates the application's strategic value and recommends a course of action based on the TIME and 6R models.
<div class="table-container">
<table>
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr>
<th style="text-align: left;">Classification</th>
<th style="text-align: left;">Evaluation & Recommendation</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>TIME Classification</strong></td>
<td style="text-align: left;"><strong>Tolerate/Migrate</strong>: The application has high business value, as it manages a core financial process (remittance processing). However, its technical quality is extremely low due to its obsolete technology stack and architectural flaws. It should be tolerated in the short term while a migration/replacement project is executed. It is not a strategic asset in its current form.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>6R Classification</strong></td>
<td style="text-align: left;"><strong>Refactor/Re-architect</strong>: A simple "Retain" is not viable due to security risks. "Rehost" (lift-and-shift to the cloud) provides minimal value as it doesn't address the core technical debt. "Replace" with a COTS product could be an option, but given the custom logic, <strong>Refactor</strong> is the most appropriate strategy. This involves a complete rewrite on a modern, cloud-native platform to align it with future business needs.</td>
</tr>
</tbody>
</table>
</div>
</div>

</main>
      <p class="ai-disclaimer">This application analysis was performed using Artificial Intelligence (AI). While AI enhances the process, it may still produce inaccuracies, and all results should be carefully reviewed.</p>
      <footer class="footer">
         <div class="footer-container">
            <div class="footer-brand">
               <img src="https://www.cgd.pt/PublishingImages/WSImages/Novo-CGD/logo-ap_Blue.png" alt="CGD Logo" class="footer-logo">
               <span class="footer-wordmark">Caixa. Para todos e para cada um.</span>
            </div>
            <div class="footer-copyright">
               © 2025 Caixa Geral de Depósitos, SA. All rights reserved.
            </div>
            <div class="footer-socials">
               <a href="https://www.cgd.pt/" target="_blank" title="Website">
                  <svg viewBox="0 0 24 24">
                     <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-1 17.93c-3.95-.49-7-3.85-7-7.93 0-.62.08-1.21.21-1.79L9 15v1c0 1.1.9 2 2 2v1.93zm6.9-2.54c-.26-.81-1-1.39-1.9-1.39h-1v-3c0-.55-.45-1-1-1h-2v-2h2c.55 0 1-.45 1-1V7h2c1.1 0 2-.9 2-2v-.41c2.93 1.19 5 4.06 5 7.41 0 2.08-.8 3.97-2.1 5.39z"/>
                  </svg>
               </a>
               <a href="https://www.facebook.com/caixageraldedepositos" target="_blank" title="Facebook">
                  <svg viewBox="0 0 24 24">
                     <path d="M22 12c0-5.52-4.48-10-10-10S2 6.48 2 12c0 4.84 3.44 8.87 8 9.8V15H8v-3h2V9.5C10 7.57 11.57 6 13.5 6H16v3h-1.5c-1.1 0-1.5.9-1.5 1.5V12h3l-.5 3h-2.5v6.8A10.02 10.02 0 0022 12z"/>
                  </svg>
               </a>
               <a href="https://www.youtube.com/user/mediacgd" target="_blank" title="YouTube">
                  <svg viewBox="0 0 24 24">
                     <path d="M21.58 7.19c-.23-.86-.9-1.52-1.76-1.75C18.25 5 12 5 12 5s-6.25 0-7.82.44c-.86.23-1.52.89-1.76 1.75C2 8.75 2 12 2 12s0 3.25.42 4.81c.23.86.9 1.52 1.76 1.75C5.75 19 12 19 12 19s6.25 0 7.82-.44c.86-.23 1.52-.89 1.76-1.75C22 15.25 22 12 22 12s0-3.25-.42-4.81zM10 15V9l5.2 3-5.2 3z"/>
                  </svg>
               </a>
               <a href="https://www.linkedin.com/company/caixageraldedepositos" target="_blank" title="LinkedIn">
                  <svg viewBox="0 0 24 24">
                     <path d="M19 3a2 2 0 012 2v14a2 2 0 01-2 2H5a2 2 0 01-2-2V5a2 2 0 012-2h14zm-7 5H8v8h4v-8zm-2-2h4v-2H8v2zm8 4h-4v4h4v-4zm0-2h-4v-2h4v2z" clip-rule="evenodd" fill-rule="evenodd"/>
                  </svg>
               </a>
               <a href="https://www.instagram.com/caixageraldedepositos" target="_blank" title="Instagram">
                  <svg viewBox="0 0 24 24">
                     <path d="M7.8 2h8.4C19.4 2 22 4.6 22 7.8v8.4a5.8 5.8 0 01-5.8 5.8H7.8C4.6 22 2 19.4 2 16.2V7.8A5.8 5.8 0 017.8 2zm-.2 2A3.6 3.6 0 004 7.6v8.8C4 18.39 5.61 20 7.6 20h8.8c1.99 0 3.6-1.61 3.6-3.6V7.6C20 5.61 18.39 4 16.4 4H7.6zm9.65 1.5a1.25 1.25 0 100 2.5 1.25 1.25 0 000-2.5zM12 7a5 5 0 100 10 5 5 0 000-10zm0 2a3 3 0 110 6 3 3 0 010-6z"/>
                  </svg>
               </a>
            </div>
         </div>
      </footer>
      <button id="back-to-top" title="Back to Top">
      <span class="icon">arrow_upward</span>
      </button>
      
      <!-- Floating Table of Contents -->
      <div id="floating-toc-toggle" class="floating-toc-toggle" title="Table of Contents">
         <span class="icon">toc</span>
      </div>
      
      <div id="floating-toc" class="floating-toc">
         <div class="floating-toc-header">
            <div class="floating-toc-title">
               <span class="icon">toc</span>
               Table of Contents
            </div>
            <button id="floating-toc-close" class="floating-toc-close" title="Close TOC">
               <span class="icon">close</span>
            </button>
         </div>
         <ul id="floating-toc-list" class="floating-toc-list">
            <!-- TOC items will be dynamically generated -->
         </ul>
      </div>

      <!-- Fullscreen Reading Mode -->
      <div id="fullscreen-reading-mode" class="fullscreen-reading-mode">
         <div class="fullscreen-font-controls">
            <button id="font-decrease" class="fullscreen-font-control" title="Decrease font size">
               <span class="icon">text_decrease</span>
            </button>
            <button id="font-increase" class="fullscreen-font-control" title="Increase font size">
               <span class="icon">text_increase</span>
            </button>
         </div>
         
         <div class="fullscreen-reading-controls">
            <button id="fullscreen-tts-btn" class="fullscreen-reading-control" title="Listen to content">
               <span class="icon">play_arrow</span>
            </button>
            <button id="fullscreen-dark-mode-btn" class="fullscreen-reading-control" title="Toggle dark mode">
               <span class="icon">light_mode</span>
            </button>
            <button id="fullscreen-exit-btn" class="fullscreen-reading-control fullscreen-reading-exit" title="Exit fullscreen reading">
               <span class="icon">fullscreen_exit</span>
            </button>
         </div>
         
         <div id="fullscreen-reading-content" class="fullscreen-reading-content">
            <!-- Content will be dynamically populated -->
         </div>
         
         <div id="fullscreen-reading-progress" class="fullscreen-reading-progress">
            Reading progress: 0%
         </div>
      </div>

      <script>
         document.addEventListener('DOMContentLoaded', function() {
             
             // --- INITIALIZATION ---
             function init() {
                 console.log('Starting initialization...');
                 replaceEmojisWithIcons();
                 removeHeadingNumbers();
                 setupTabs(); // This now also calculates and displays read times
                 console.log('About to initialize dark mode...');
                 initDarkMode();
                 console.log('Dark mode initialization complete');
                 initTTS();
                 initBackToTop();
                 initFloatingTOC();
                 initReadingProgress();
                 initFullscreenReading();
                 initBreadcrumbNavigation();
                 
                 // Initialize and render Mermaid diagrams
                 function checkMermaidAvailability() {
                     if (typeof mermaid === 'undefined') {
                         console.error('Mermaid library not loaded. Diagrams will not be rendered.');
                         return false;
                     }
                     console.log('Mermaid version:', mermaid.version || 'Unknown');
                     return true;
                 }
                 
                 if (checkMermaidAvailability()) {
                     try {
                         initializeMermaidRendering();
                         setTimeout(renderMermaidDiagrams, 500);
                     } catch (error) {
                         console.error('Error initializing Mermaid diagrams:', error);
                     }
                 }
             }
             
             // --- FEATURE: DARK MODE ---
             function initDarkMode() {
                 console.log('Initializing dark mode...');
                 const toggleBtn = document.getElementById('dark-mode-toggle');
                 console.log('Toggle button found:', toggleBtn);
                 
                 // Check if the toggle button exists
                 if (!toggleBtn) {
                     console.warn('Dark mode toggle button not found');
                     return;
                 }
                 
                 // Check if the icon element exists inside the button
                 const iconElement = toggleBtn.querySelector('.icon');
                 console.log('Icon element found:', iconElement);
                 if (!iconElement) {
                     console.warn('Dark mode toggle icon not found');
                     return;
                 }
                 
                 const sunIcon = 'light_mode';
                 const moonIcon = 'dark_mode';
         
                 // Check for saved preference and update UI accordingly
                 if (localStorage.getItem('theme') === 'dark') {
                     console.log('Setting dark mode from localStorage');
                     document.documentElement.classList.add('dark-mode');
                     iconElement.textContent = sunIcon;
                     toggleBtn.title = 'Switch to light mode';
                 } else {
                     console.log('Setting light mode');
                     iconElement.textContent = moonIcon;
                     toggleBtn.title = 'Switch to dark mode';
                 }
         
                 console.log('Adding click event listener to dark mode toggle');
                 toggleBtn.addEventListener('click', () => {
                     console.log('Dark mode toggle clicked!');
                     
                     const isDarkMode = document.documentElement.classList.toggle('dark-mode');
                     console.log('Dark mode toggled:', isDarkMode);
                     console.log('Current document classes:', document.documentElement.className);
                     
                     // Update icon and tooltip based on current mode
                     if (isDarkMode) {
                         console.log('Setting sun icon for dark mode');
                         iconElement.textContent = sunIcon;
                         toggleBtn.title = 'Switch to light mode';
                     } else {
                         console.log('Setting moon icon for light mode');
                         iconElement.textContent = moonIcon;
                         toggleBtn.title = 'Switch to dark mode';
                     }
                     
                     localStorage.setItem('theme', isDarkMode ? 'dark' : 'light');
                     console.log('Theme saved to localStorage:', isDarkMode ? 'dark' : 'light');
                     
                     // Update Mermaid theme if the function exists
                     if (typeof updateMermaidTheme === 'function') {
                         updateMermaidTheme();
                     }
                 });
                 
                 console.log('Dark mode initialization completed successfully');
             }
         
             // --- FEATURE: TEXT-TO-SPEECH (TTS) ---
             function initTTS() {
                 const ttsControls = document.getElementById('tts-controls');
                 const playPauseBtn = document.getElementById('tts-play-pause-btn');
                 const stopBtn = document.getElementById('tts-stop-btn');
                 
                 // Check if TTS elements exist
                 if (!ttsControls || !playPauseBtn || !stopBtn) {
                     console.warn('TTS controls not found');
                     return;
                 }
                 
                 const synth = window.speechSynthesis;
         
                 // Always show TTS controls
                 ttsControls.style.display = 'flex';
                 
                 if (!synth) {
                     console.warn("Browser does not support Speech Synthesis.");
                     // Show controls but disable them
                     playPauseBtn.disabled = true;
                     stopBtn.disabled = true;
                     playPauseBtn.title = "Speech synthesis not supported in this browser";
                     stopBtn.title = "Speech synthesis not supported in this browser";
                     return;
                 }
         
                 let utterance = null;
                 
                 console.log("TTS initialized successfully");
         
                 function play() {
                     console.log("TTS play function called");
                     const activePane = document.querySelector('.tab-pane.active');
                     if (!activePane) {
                         console.warn("No active tab pane found");
                         return;
                     }
                     
                     if (synth.speaking) {
                         console.log("Speech synthesis already speaking");
                         return;
                     }
         
                     // Clone to avoid modifying the live DOM, then clean text
                     const contentClone = activePane.cloneNode(true);
                     contentClone.querySelectorAll('h2, h3, h4').forEach(h => h.textContent = h.textContent + '. '); // Add pauses after headings
                     const textToSpeak = contentClone.innerText;
                     
                     console.log("Text to speak length:", textToSpeak.length);
         
                     utterance = new SpeechSynthesisUtterance(textToSpeak);
                     utterance.lang = document.documentElement.lang || 'en-US';
                     utterance.rate = 0.9; // Slightly slower for better comprehension
                     utterance.pitch = 1.0;
                     utterance.volume = 0.8;
         
                     utterance.onstart = () => {
                         console.log("Speech started");
                         playPauseBtn.querySelector('.icon').textContent = 'pause';
                         playPauseBtn.title = 'Pause listening';
                     };
                     utterance.onpause = () => {
                         console.log("Speech paused");
                         playPauseBtn.querySelector('.icon').textContent = 'play_arrow';
                         playPauseBtn.title = 'Resume listening';
                     };
                     utterance.onresume = () => {
                         console.log("Speech resumed");
                         playPauseBtn.querySelector('.icon').textContent = 'pause';
                         playPauseBtn.title = 'Pause listening';
                     };
                     utterance.onend = () => {
                         console.log("Speech ended");
                         playPauseBtn.querySelector('.icon').textContent = 'play_arrow';
                         playPauseBtn.title = 'Listen to this section';
                         utterance = null;
                     };
                     utterance.onerror = (event) => {
                         console.error("Speech synthesis error:", event);
                         playPauseBtn.querySelector('.icon').textContent = 'play_arrow';
                         playPauseBtn.title = 'Listen to this section';
                         utterance = null;
                     };
                     
                     synth.speak(utterance);
                 }
         
                 function togglePlayPause() {
                     console.log("TTS toggle play/pause clicked");
                     console.log("Current state - speaking:", synth.speaking, "paused:", synth.paused);
                     
                     if (synth.speaking && !synth.paused) {
                         console.log("Pausing speech");
                         synth.pause();
                     } else if (synth.paused) {
                         console.log("Resuming speech");
                         synth.resume();
                     } else {
                         console.log("Starting new speech");
                         play();
                     }
                 }
         
                 function stop() {
                     console.log("TTS stop clicked");
                     synth.cancel(); // Also triggers 'onend'
                 }
         
                 playPauseBtn.addEventListener('click', togglePlayPause);
                 stopBtn.addEventListener('click', stop);
                 
                 // Stop speech when user changes tabs
                 document.querySelector('.tab-navigation')?.addEventListener('click', stop);
             }
             
             // --- FEATURE: BACK TO TOP BUTTON ---
             function initBackToTop() {
                 const backToTopButton = document.getElementById('back-to-top');
                 
                 if (!backToTopButton) {
                     console.warn('Back to top button not found');
                     return;
                 }
                 
                 window.addEventListener('scroll', () => {
                     if (window.scrollY > 300) {
                         backToTopButton.classList.add('show');
                     } else {
                         backToTopButton.classList.remove('show');
                     }
                 });
                 backToTopButton.addEventListener('click', () => {
                     window.scrollTo({ top: 0, behavior: 'smooth' });
                 });
             }

             // --- FEATURE: FLOATING TABLE OF CONTENTS ---
             function initFloatingTOC() {
                 const tocToggle = document.getElementById('floating-toc-toggle');
                 const tocContainer = document.getElementById('floating-toc');
                 const tocClose = document.getElementById('floating-toc-close');
                 const tocList = document.getElementById('floating-toc-list');
                 
                 let isInitialized = false;
                 let tocItems = [];
                 let sectionElements = [];
                 
                 function buildTOC() {
                     if (isInitialized) return;
                     
                     // Get all h2 elements from tab panes
                     const tabPanes = document.querySelectorAll('.tab-pane');
                     tocList.innerHTML = '';
                     tocItems = [];
                     sectionElements = [];
                     
                     tabPanes.forEach((pane, index) => {
                         const h2Element = pane.querySelector('h2');
                         if (!h2Element) return;
                         
                         const tocItem = document.createElement('li');
                         tocItem.className = 'floating-toc-item';
                         
                         const tocLink = document.createElement('a');
                         tocLink.className = 'floating-toc-link';
                         tocLink.href = '#';
                         tocLink.textContent = h2Element.textContent.trim();
                         tocLink.dataset.target = h2Element.id || `section-${index}`;
                         
                         const progressIndicator = document.createElement('div');
                         progressIndicator.className = 'floating-toc-progress';
                         const progressFill = document.createElement('div');
                         progressFill.className = 'floating-toc-progress-fill';
                         progressIndicator.appendChild(progressFill);
                         tocLink.appendChild(progressIndicator);
                         
                         tocItem.appendChild(tocLink);
                         tocList.appendChild(tocItem);
                         
                         tocItems.push({
                             link: tocLink,
                             pane: pane,
                             h2: h2Element
                         });
                         
                         sectionElements.push({
                             element: pane,
                             link: tocLink,
                             id: h2Element.id || `section-${index}`
                         });
                         
                         // Add click handler for smooth scrolling to tab
                         tocLink.addEventListener('click', (e) => {
                             e.preventDefault();
                             
                             // Find and activate the corresponding tab
                             const tabButton = document.querySelector(`[data-tab="${pane.id}"]`);
                             if (tabButton) {
                                 tabButton.click();
                                 
                                 // Small delay to ensure tab is active, then scroll to h2
                                 setTimeout(() => {
                                     h2Element.scrollIntoView({
                                         behavior: 'smooth',
                                         block: 'start'
                                     });
                                 }, 100);
                             }
                         });
                     });
                     
                     isInitialized = true;
                 }
                 
                 function updateProgress() {
                     if (!isInitialized || tocItems.length === 0) return;
                     
                     const activeTabPane = document.querySelector('.tab-pane.active');
                     if (!activeTabPane) return;
                     
                     // Find the corresponding TOC item
                     const activeTocItem = tocItems.find(item => item.pane === activeTabPane);
                     
                     // Clear all active states
                     tocItems.forEach(item => {
                         item.link.classList.remove('active', 'reading');
                     });
                     
                     if (activeTocItem) {
                         activeTocItem.link.classList.add('active');
                         
                         // Calculate reading progress for the active section
                         const paneRect = activeTabPane.getBoundingClientRect();
                         const viewportHeight = window.innerHeight;
                         
                         // Consider a section as "reading" if it's visible in viewport
                         if (paneRect.top < viewportHeight && paneRect.bottom > 0) {
                             activeTocItem.link.classList.add('reading');
                         }
                     }
                 }
                 
                 function showTOC() {
                     buildTOC();
                     tocContainer.classList.add('show');
                     tocToggle.classList.remove('show');
                     updateProgress();
                 }
                 
                 function hideTOC() {
                     tocContainer.classList.remove('show');
                     tocToggle.classList.add('show');
                 }
                 
                 // Event listeners
                 tocToggle.addEventListener('click', showTOC);
                 tocClose.addEventListener('click', hideTOC);
                 
                 // Close TOC when clicking outside
                 document.addEventListener('click', (e) => {
                     if (!tocContainer.contains(e.target) && !tocToggle.contains(e.target)) {
                         if (tocContainer.classList.contains('show')) {
                             hideTOC();
                         }
                     }
                 });
                 
                 // Show/hide toggle button on scroll
                 window.addEventListener('scroll', () => {
                     if (window.scrollY > 500) {
                         if (!tocContainer.classList.contains('show')) {
                             tocToggle.classList.add('show');
                         }
                     } else {
                         tocToggle.classList.remove('show');
                         tocContainer.classList.remove('show');
                     }
                     
                     updateProgress();
                 });
                 
                 // Update progress when tabs change
                 const tabNavigation = document.querySelector('.tab-navigation');
                 if (tabNavigation) {
                     tabNavigation.addEventListener('click', () => {
                         setTimeout(updateProgress, 100);
                     });
                 }
                 
                 // Handle ESC key to close TOC
                 document.addEventListener('keydown', (e) => {
                     if (e.key === 'Escape' && tocContainer.classList.contains('show')) {
                         hideTOC();
                     }                 });
             }

             // --- FEATURE: READING PROGRESS INDICATOR ---
             function initReadingProgress() {
                 const progressBar = document.getElementById('reading-progress');
                 const progressFill = document.getElementById('reading-progress-fill');
                 const progressText = document.getElementById('reading-progress-text');
                 
                 let isVisible = false;
                 
                 function updateProgress() {
                     // Get the active tab content to calculate progress within that tab
                     const activeTabPane = document.querySelector('.tab-pane.active');
                     if (!activeTabPane) return;
                     
                     const rect = activeTabPane.getBoundingClientRect();
                     const tabTop = activeTabPane.offsetTop;
                     const tabHeight = activeTabPane.offsetHeight;
                     const headerHeight = document.querySelector('.header').offsetHeight + 
                                         document.querySelector('.tab-navigation-container').offsetHeight;
                     
                     // Calculate scroll position relative to the active tab
                     const scrollTop = window.pageYOffset;
                     const tabStart = tabTop - headerHeight;
                     const tabEnd = tabTop + tabHeight - window.innerHeight;
                     
                     // Calculate progress percentage for the current tab
                     let progress = 0;
                     if (scrollTop <= tabStart) {
                         progress = 0;
                     } else if (scrollTop >= tabEnd) {
                         progress = 100;
                     } else {
                         const scrollableHeight = tabEnd - tabStart;
                         const scrolledHeight = scrollTop - tabStart;
                         progress = Math.min(100, Math.max(0, (scrolledHeight / scrollableHeight) * 100));
                     }
                     
                     // Show progress bar after scrolling starts
                     const shouldShow = scrollTop > 100;
                     
                     if (shouldShow && !isVisible) {
                         progressBar.classList.add('show');
                         progressText.classList.add('show');
                         isVisible = true;
                     } else if (!shouldShow && isVisible) {
                         progressBar.classList.remove('show');
                         progressText.classList.remove('show');
                         isVisible = false;
                     }
                     
                     // Update progress bar and text
                     if (isVisible) {
                         progressFill.style.width = `${progress}%`;
                         progressText.textContent = `${Math.round(progress)}% read`;
                         
                         // Add current section info
                         const activeH2 = activeTabPane.querySelector('h2');
                         if (activeH2) {
                             const sectionTitle = activeH2.textContent.trim();
                             const shortTitle = sectionTitle.length > 25 ? 
                                               sectionTitle.substring(0, 25) + '...' : 
                                               sectionTitle;
                             progressText.textContent = `${Math.round(progress)}% • ${shortTitle}`;
                         }
                     }
                 }
                 
                 // Throttled scroll handler for better performance
                 let ticking = false;
                 function handleScroll() {
                     if (!ticking) {
                         requestAnimationFrame(() => {
                             updateProgress();
                             ticking = false;
                         });
                         ticking = true;
                     }
                 }
                 
                 // Event listeners
                 window.addEventListener('scroll', handleScroll);
                 window.addEventListener('resize', updateProgress);
                 
                 // Update progress when tabs change
                 const tabNavigation = document.querySelector('.tab-navigation');
                 if (tabNavigation) {
                     tabNavigation.addEventListener('click', () => {
                         setTimeout(updateProgress, 150);
                     });
                 }
                 
                 // Initial update
                 updateProgress();
             }

             // --- FEATURE: FULLSCREEN READING MODE ---
             function initFullscreenReading() {
                 const fullscreenBtn = document.getElementById('fullscreen-reading-btn');
                 const fullscreenMode = document.getElementById('fullscreen-reading-mode');
                 const fullscreenContent = document.getElementById('fullscreen-reading-content');
                 const fullscreenProgress = document.getElementById('fullscreen-reading-progress');
                 const exitBtn = document.getElementById('fullscreen-exit-btn');
                 const fontIncreaseBtn = document.getElementById('font-increase');
                 const fontDecreaseBtn = document.getElementById('font-decrease');
                 const fullscreenTtsBtn = document.getElementById('fullscreen-tts-btn');
                 const fullscreenDarkModeBtn = document.getElementById('fullscreen-dark-mode-btn');
                 
                 let currentFontSize = 1.1; // Default font size in rem
                 let isFullscreenActive = false;
                 
                 function enterFullscreenReading() {
                     const activeTabPane = document.querySelector('.tab-pane.active');
                     if (!activeTabPane) return;
                     
                     // Clone the active content
                     const contentClone = activeTabPane.cloneNode(true);
                     
                     // Clean up the cloned content for better reading
                     contentClone.querySelectorAll('.section-read-time').forEach(el => el.remove());
                     contentClone.querySelectorAll('script').forEach(el => el.remove());
                     
                     // Set the content
                     fullscreenContent.innerHTML = contentClone.innerHTML;
                     
                     // Activate fullscreen mode
                     document.body.classList.add('fullscreen-reading');
                     fullscreenMode.classList.add('active');
                     isFullscreenActive = true;
                     
                     // Update dark mode button state
                     const isDarkMode = document.documentElement.classList.contains('dark-mode');
                     fullscreenDarkModeBtn.querySelector('.icon').textContent = isDarkMode ? 'light_mode' : 'dark_mode';
                     fullscreenDarkModeBtn.title = isDarkMode ? 'Switch to light mode' : 'Switch to dark mode';
                     
                     // Initialize progress tracking
                     updateFullscreenProgress();
                     
                     // Prevent body scroll
                     document.body.style.overflow = 'hidden';
                 }
                 
                 function exitFullscreenReading() {
                     document.body.classList.remove('fullscreen-reading');
                     fullscreenMode.classList.remove('active');
                     isFullscreenActive = false;
                     
                     // Restore body scroll
                     document.body.style.overflow = '';
                     
                     // Stop any TTS playback
                     if (window.speechSynthesis) {
                         window.speechSynthesis.cancel();
                     }
                 }
                 
                 function adjustFontSize(increase) {
                     if (increase) {
                         currentFontSize = Math.min(2.0, currentFontSize + 0.1);
                     } else {
                         currentFontSize = Math.max(0.8, currentFontSize - 0.1);
                     }
                     fullscreenContent.style.fontSize = `${currentFontSize}rem`;
                 }
                 
                 function updateFullscreenProgress() {
                     if (!isFullscreenActive) return;
                     
                     const scrollTop = fullscreenMode.scrollTop;
                     const scrollHeight = fullscreenMode.scrollHeight - fullscreenMode.clientHeight;
                     const progress = scrollHeight > 0 ? Math.round((scrollTop / scrollHeight) * 100) : 0;
                     
                     fullscreenProgress.textContent = `Reading progress: ${progress}%`;
                 }
                 
                 function toggleFullscreenTTS() {
                     const synth = window.speechSynthesis;
                     if (!synth) return;
                     
                     if (synth.speaking && !synth.paused) {
                         synth.pause();
                         fullscreenTtsBtn.querySelector('.icon').textContent = 'play_arrow';
                         fullscreenTtsBtn.title = 'Resume listening';
                     } else if (synth.paused) {
                         synth.resume();
                         fullscreenTtsBtn.querySelector('.icon').textContent = 'pause';
                         fullscreenTtsBtn.title = 'Pause listening';
                     } else {
                         // Start new speech
                         const textToSpeak = fullscreenContent.innerText;
                         const utterance = new SpeechSynthesisUtterance(textToSpeak);
                         utterance.lang = document.documentElement.lang || 'en-US';
                         utterance.rate = 0.9;
                         utterance.pitch = 1.0;
                         utterance.volume = 0.8;
                         
                         utterance.onstart = () => {
                             fullscreenTtsBtn.querySelector('.icon').textContent = 'pause';
                             fullscreenTtsBtn.title = 'Pause listening';
                         };
                         
                         utterance.onend = () => {
                             fullscreenTtsBtn.querySelector('.icon').textContent = 'play_arrow';
                             fullscreenTtsBtn.title = 'Listen to content';
                         };
                         
                         utterance.onerror = () => {
                             fullscreenTtsBtn.querySelector('.icon').textContent = 'play_arrow';
                             fullscreenTtsBtn.title = 'Listen to content';
                         };
                         
                         synth.speak(utterance);
                     }
                 }
                 
                 function toggleFullscreenDarkMode() {
                     const isDarkMode = document.documentElement.classList.toggle('dark-mode');
                     fullscreenDarkModeBtn.querySelector('.icon').textContent = isDarkMode ? 'light_mode' : 'dark_mode';
                     fullscreenDarkModeBtn.title = isDarkMode ? 'Switch to light mode' : 'Switch to dark mode';
                     localStorage.setItem('theme', isDarkMode ? 'dark' : 'light');
                 }
                 
                 // Event listeners
                 fullscreenBtn.addEventListener('click', enterFullscreenReading);
                 exitBtn.addEventListener('click', exitFullscreenReading);
                 fontIncreaseBtn.addEventListener('click', () => adjustFontSize(true));
                 fontDecreaseBtn.addEventListener('click', () => adjustFontSize(false));
                 fullscreenTtsBtn.addEventListener('click', toggleFullscreenTTS);
                 fullscreenDarkModeBtn.addEventListener('click', toggleFullscreenDarkMode);
                 
                 // Scroll progress tracking
                 fullscreenMode.addEventListener('scroll', () => {
                     if (isFullscreenActive) {
                         updateFullscreenProgress();
                     }
                 });
                 
                 // Keyboard shortcuts
                 document.addEventListener('keydown', (e) => {
                     if (!isFullscreenActive) return;
                     
                     switch(e.key) {
                         case 'Escape':
                             exitFullscreenReading();
                             break;
                         case 'F':
                         case 'f':
                             if (e.ctrlKey) {
                                 e.preventDefault();
                                 // Could implement search functionality here
                             }
                             break;
                         case '+':
                         case '=':
                             if (e.ctrlKey) {
                                 e.preventDefault();
                                 adjustFontSize(true);
                             }
                             break;
                         case '-':
                             if (e.ctrlKey) {
                                 e.preventDefault();
                                 adjustFontSize(false);
                             }
                             break;
                         case ' ':
                             if (e.ctrlKey) {
                                 e.preventDefault();
                                 toggleFullscreenTTS();
                             }
                             break;
                     }
                 });
                 
                 // Prevent context menu in fullscreen mode
                 fullscreenMode.addEventListener('contextmenu', (e) => {
                     if (isFullscreenActive) {
                         e.preventDefault();
                     }
                 });
             }

             // --- FEATURE: BREADCRUMB NAVIGATION ---
             function initBreadcrumbNavigation() {
                 const breadcrumbContainer = document.getElementById('breadcrumb-container');
                 const breadcrumbHome = document.getElementById('breadcrumb-home');
                 const breadcrumbCurrent = document.getElementById('breadcrumb-current');
                 const breadcrumbProgressFill = document.getElementById('breadcrumb-progress-fill');
                 const breadcrumbProgressText = document.getElementById('breadcrumb-progress-text');
                 const breadcrumbSectionCount = document.getElementById('breadcrumb-section-count');
                 
                 let sections = [];
                 let currentSectionIndex = 0;
                 let isVisible = false;
                 
                 function initializeSections() {
                     const tabPanes = document.querySelectorAll('.tab-pane');
                     sections = Array.from(tabPanes).map((pane, index) => {
                         const h2Element = pane.querySelector('h2');
                         return {
                             id: pane.id,
                             title: h2Element ? h2Element.textContent.trim() : `Section ${index + 1}`,
                             element: pane,
                             index: index
                         };
                     });
                 }
                 
                 function updateBreadcrumb() {
                     const activeTabPane = document.querySelector('.tab-pane.active');
                     if (!activeTabPane || sections.length === 0) return;
                     
                     // Find current section
                     currentSectionIndex = sections.findIndex(section => section.element === activeTabPane);
                     const currentSection = sections[currentSectionIndex];
                     
                     if (!currentSection) return;
                     
                     // Update breadcrumb current section
                     const maxTitleLength = window.innerWidth < 768 ? 25 : 40;
                     const displayTitle = currentSection.title.length > maxTitleLength ? 
                                         currentSection.title.substring(0, maxTitleLength) + '...' : 
                                         currentSection.title;
                     
                     breadcrumbCurrent.innerHTML = `
                         <span class="breadcrumb-link active" title="${currentSection.title}">
                             ${displayTitle}
                         </span>
                     `;
                     
                     // Update section count
                     breadcrumbSectionCount.textContent = `Section ${currentSectionIndex + 1} of ${sections.length}`;
                     
                     // Update progress
                     const progress = Math.round(((currentSectionIndex + 1) / sections.length) * 100);
                     breadcrumbProgressFill.style.width = `${progress}%`;
                     breadcrumbProgressText.textContent = `${progress}%`;
                     
                     // Show/hide breadcrumb based on scroll position
                     const shouldShow = window.scrollY > 200;
                     if (shouldShow && !isVisible) {
                         breadcrumbContainer.classList.add('show');
                         isVisible = true;
                     } else if (!shouldShow && isVisible) {
                         breadcrumbContainer.classList.remove('show');
                         isVisible = false;
                     }
                 }
                 
                 function createSectionBreadcrumb() {
                     const activeTabPane = document.querySelector('.tab-pane.active');
                     if (!activeTabPane) return;
                     
                     // Get current section hierarchy
                     const headings = activeTabPane.querySelectorAll('h2, h3, h4');
                     const currentScroll = window.scrollY + window.innerHeight / 2;
                     let activeHeading = null;
                     
                     // Find the currently visible heading
                     for (let i = headings.length - 1; i >= 0; i--) {
                         const heading = headings[i];
                         const rect = heading.getBoundingClientRect();
                         const absoluteTop = window.scrollY + rect.top;
                         
                         if (absoluteTop <= currentScroll) {
                             activeHeading = heading;
                             break;
                         }
                     }
                     
                     // Build breadcrumb path
                     let breadcrumbPath = '';
                     if (activeHeading && activeHeading.tagName !== 'H2') {
                         const h2 = activeTabPane.querySelector('h2');
                         const headingText = activeHeading.textContent.trim();
                         const maxLength = window.innerWidth < 768 ? 20 : 30;
                         const shortText = headingText.length > maxLength ? 
                                          headingText.substring(0, maxLength) + '...' : 
                                          headingText;
                         
                         breadcrumbPath = `
                             <span class="breadcrumb-separator">›</span>
                             <div class="breadcrumb-item">
                                 <span class="breadcrumb-link" title="${headingText}">
                                     ${shortText}
                                 </span>
                             </div>
                         `;
                     }
                     
                     // Update the breadcrumb current section with subsection info
                     const currentSection = sections[currentSectionIndex];
                     if (currentSection) {
                         const maxTitleLength = window.innerWidth < 768 ? 20 : 30;
                         const displayTitle = currentSection.title.length > maxTitleLength ? 
                                             currentSection.title.substring(0, maxTitleLength) + '...' : 
                                             currentSection.title;
                         
                         breadcrumbCurrent.innerHTML = `
                             <span class="breadcrumb-link active" title="${currentSection.title}">
                                 ${displayTitle}
                             </span>
                             ${breadcrumbPath}
                         `;
                     }
                 }
                 
                 function navigateToSection(sectionIndex) {
                     if (sectionIndex < 0 || sectionIndex >= sections.length) return;
                     
                     const section = sections[sectionIndex];
                     const tabButton = document.querySelector(`[data-tab="${section.id}"]`);
                     
                     if (tabButton) {
                         tabButton.click();
                         setTimeout(() => {
                             section.element.scrollIntoView({
                                 behavior: 'smooth',
                                 block: 'start'
                             });
                         }, 150);
                     }
                 }
                 
                 // Event listeners
                 breadcrumbHome.addEventListener('click', (e) => {
                     e.preventDefault();
                     navigateToSection(0);
                 });
                 
                 // Throttled scroll handler
                 let scrollTicking = false;
                 function handleScroll() {
                     if (!scrollTicking) {
                         requestAnimationFrame(() => {
                             updateBreadcrumb();
                             createSectionBreadcrumb();
                             scrollTicking = false;
                         });
                         scrollTicking = true;
                     }
                 }
                 
                 // Event listeners
                 window.addEventListener('scroll', handleScroll);
                 window.addEventListener('resize', updateBreadcrumb);
                 
                 // Update breadcrumb when tabs change
                 const tabNavigation = document.querySelector('.tab-navigation');
                 if (tabNavigation) {
                     tabNavigation.addEventListener('click', () => {
                         setTimeout(() => {
                             updateBreadcrumb();
                             createSectionBreadcrumb();
                         }, 100);
                     });
                 }
                 
                 // Keyboard navigation
                 document.addEventListener('keydown', (e) => {
                     if (e.altKey) {
                         switch(e.key) {
                             case 'ArrowLeft':
                                 e.preventDefault();
                                 if (currentSectionIndex > 0) {
                                     navigateToSection(currentSectionIndex - 1);
                                 }
                                 break;
                             case 'ArrowRight':
                                 e.preventDefault();
                                 if (currentSectionIndex < sections.length - 1) {
                                     navigateToSection(currentSectionIndex + 1);
                                 }
                                 break;
                             case 'Home':
                                 e.preventDefault();
                                 navigateToSection(0);
                                 break;
                             case 'End':
                                 e.preventDefault();
                                 navigateToSection(sections.length - 1);
                                 break;
                         }
                     }
                 });
                 
                 // Initialize after tabs are set up
                 setTimeout(() => {
                     initializeSections();
                     updateBreadcrumb();
                     createSectionBreadcrumb();
                 }, 200);
             }

             // --- FEATURE: READ TIME CALCULATION ---
             function calculateAndDisplayReadTime() {
                 const wordsPerMinute = 225;
                 
                 function calculate(element) {
                     if (!element) return 0;
                     const text = element.innerText || '';
                     const wordCount = text.trim().split(/\s+/).length;
                     const minutes = Math.ceil(wordCount / wordsPerMinute);
                     return minutes;
                 }
                 
                 // Calculate reading time for each section and sum them up
                 let totalMinutes = 0;
         
                 // Calculate for each section and add after the description paragraph
                 document.querySelectorAll('.tab-pane').forEach(pane => {
                     const sectionMinutes = calculate(pane);
                     
                     // Add this section's reading time to the total
                     totalMinutes += sectionMinutes;
                     
                     const h2Element = pane.querySelector('h2');
                     
                     if (h2Element && sectionMinutes > 0) {
                         // Remove any existing read time elements
                         const existingReadTime = pane.querySelector('.section-read-time');
                         if (existingReadTime) {
                             existingReadTime.remove();
                         }
                         
                         // Find the first paragraph after the h2 (section description)
                         let insertionPoint = h2Element.nextSibling;
                         let firstParagraph = null;
                         
                         // Walk through siblings to find the first paragraph
                         while (insertionPoint) {
                             if (insertionPoint.nodeType === 1 && insertionPoint.tagName === 'P') {
                                 firstParagraph = insertionPoint;
                                 break;
                             }
                             insertionPoint = insertionPoint.nextSibling;
                         }
                         
                         // Create new read time element
                         const readTimeDiv = document.createElement('div');
                         readTimeDiv.className = 'section-read-time';
                         readTimeDiv.style.cssText = 'margin: 0.5rem 0 1rem 0; color: var(--text-secondary); font-size: 0.875rem; display: flex; align-items: center; gap: 0.25rem;';
                         
                         const clockIcon = document.createElement('span');
                         clockIcon.className = 'icon';
                         clockIcon.textContent = 'schedule';
                         clockIcon.style.fontSize = '18px';
                         
                         const readTimeText = document.createElement('span');
                         readTimeText.textContent = `${sectionMinutes} min read`;
                         
                         readTimeDiv.appendChild(clockIcon);
                         readTimeDiv.appendChild(readTimeText);
                         
                         // Insert after the first paragraph if found, otherwise after h2
                         if (firstParagraph) {
                             firstParagraph.parentNode.insertBefore(readTimeDiv, firstParagraph.nextSibling);
                         } else {
                             h2Element.parentNode.insertBefore(readTimeDiv, h2Element.nextSibling);
                         }
                     }
                 });
                 
                 // Update the total reading time in the product header
                 const totalReadTimeEl = document.getElementById('total-read-time').querySelector('span:last-child');
                 totalReadTimeEl.textContent = `${totalMinutes} min read`;
             }
         
             // --- UTILITY: EMOJI REPLACEMENT ---
             function replaceEmojisWithIcons() {
                 const emojiToIconMap = {
                     '🔴': '<span class="icon icon-high" title="High/Critical">dangerous</span>',
                     '🟠': '<span class="icon icon-medium" title="Medium/Warning">warning</span>',
                     '🟢': '<span class="icon icon-low" title="Low/Info">recommend</span>',
                     '✅': '<span class="icon icon-check" title="Yes/Used/Supported">check_circle</span>',
                     '❌': '<span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span>',
                     '🔴': '<span class="icon icon-cross" title="No/Not Used/Unsupported">cancel</span>',
                     '❔': '<span class="icon icon-question" title="Uncertain/Likely">help</span>'
                 };
                 const emojiRegex = new RegExp(Object.keys(emojiToIconMap).join('|'), 'g');
                 function walkDOM(node) {
                     if (node.nodeType === 3) {
                         if (emojiRegex.test(node.nodeValue)) {
                             const tempWrapper = document.createElement('span');
                             tempWrapper.innerHTML = node.nodeValue.replace(emojiRegex, match => emojiToIconMap[match]);
                             node.parentNode.replaceChild(tempWrapper, node);
                         }
                     } else if (node.nodeType === 1 && node.nodeName !== 'SCRIPT' && node.nodeName !== 'STYLE') {
                         for (let i = 0; i < node.childNodes.length; i++) {
                             walkDOM(node.childNodes[i]);
                         }
                     }
                 }
                 walkDOM(document.getElementById('main-content-area'));
             }
         
             // --- UTILITY: HEADING CLEANUP ---
             function removeHeadingNumbers() {
                 const headings = document.querySelectorAll('h2, h3, h4, h5, h6');
                 const numberPrefixRegex = /^\d+\.[\d\.]*\s*/;
                 headings.forEach(heading => {
                     const firstChild = heading.childNodes[0];
                     if (firstChild && firstChild.nodeType === 3) {
                         firstChild.nodeValue = firstChild.nodeValue.replace(numberPrefixRegex, '').trim();
                     }
                 });
             }
         
             // --- CORE SETUP: TABS ---
             function setupTabs() {
                 const mainContent = document.getElementById('main-content-area');
                 const tabPlaceholder = document.getElementById('tab-container-placeholder');
                 const sections = Array.from(mainContent.querySelectorAll('.product-section'));
                 
                 if (sections.length > 0) {
                     const tabContainer = document.createElement('div');
                     tabContainer.className = 'tab-navigation-container';
                     const tabNavScroller = document.createElement('div');
                     tabNavScroller.className = 'tab-nav-scroller';
                     const tabNav = document.createElement('nav');
                     tabNav.className = 'tab-navigation';
                     const tabContent = document.createElement('div');
                     tabContent.className = 'tab-content';
         
                     let tabCounter = 0; // Separate counter for actual tabs created
         
                     sections.forEach((section, index) => {
                         const headingElement = section.querySelector('h2');
                         if (!headingElement) return;
                         
                         tabCounter++; // Increment only when a tab is actually created
                         const tabPaneId = `pane-${tabCounter}`;
                         const tabButton = document.createElement('button');
                         tabButton.className = 'tab-link';
                         const tabText = document.createElement('span');
                         tabText.textContent = headingElement.textContent.trim();
                         tabButton.appendChild(tabText);
                         tabButton.setAttribute('data-tab', tabPaneId);
                         tabNav.appendChild(tabButton);
                         
                         const tabPane = document.createElement('div');
                         tabPane.id = tabPaneId;
                         tabPane.className = 'tab-pane';
                         tabPane.appendChild(section);
                         tabContent.appendChild(tabPane);
         
                         if (tabCounter === 1) { // First actual tab created
                             tabButton.classList.add('active');
                             tabPane.classList.add('active');
                         }
                     });
         
                     tabNavScroller.appendChild(tabNav);
                     tabContainer.appendChild(tabNavScroller);
                     tabPlaceholder.appendChild(tabContainer);
                     mainContent.appendChild(tabContent);
         
                     tabNav.addEventListener('click', (e) => {
                         const clickedTab = e.target.closest('.tab-link');
                         if (!clickedTab) return;
                         tabNav.querySelectorAll('.tab-link').forEach(tab => tab.classList.remove('active'));
                         tabContent.querySelectorAll('.tab-pane').forEach(pane => pane.classList.remove('active'));
                         clickedTab.classList.add('active');
                         document.getElementById(clickedTab.dataset.tab)?.classList.add('active');
                     });
         
                     // After tabs are in the DOM, calculate read times
                     calculateAndDisplayReadTime();
                 }
             }
         
             function detectDiagramType(code) {
                 const trimmedCode = code.trim().toLowerCase();
                 
                 if (trimmedCode.startsWith('graph') || trimmedCode.startsWith('flowchart')) return 'flowchart';
                 if (trimmedCode.startsWith('sequencediagram')) return 'sequence';
                 if (trimmedCode.startsWith('classdiagram')) return 'class';
                 if (trimmedCode.startsWith('statediagram')) return 'state';
                 if (trimmedCode.startsWith('erdiagram')) return 'er';
                 if (trimmedCode.startsWith('gantt')) return 'gantt';
                 if (trimmedCode.startsWith('journey')) return 'user-journey';
                 if (trimmedCode.startsWith('gitgraph')) return 'git';
                 if (trimmedCode.startsWith('pie')) return 'pie';
                 if (trimmedCode.startsWith('mindmap')) return 'mindmap';
                 if (trimmedCode.startsWith('timeline')) return 'timeline';
                 if (trimmedCode.startsWith('zenuml')) return 'zenuml';
                 if (trimmedCode.startsWith('quadrantchart')) return 'quadrant';
                 if (trimmedCode.startsWith('xychart')) return 'xy-chart';
                 if (trimmedCode.startsWith('block')) return 'block';
                 if (trimmedCode.startsWith('packet')) return 'packet';
                 if (trimmedCode.startsWith('treemap')) return 'treemap';
                 
                 return 'unknown';
             }
             
             function validateAndFixMermaidSyntax(code) {
                 let fixedCode = code.trim();
                 
                 // First, decode HTML entities that might cause parsing issues
                 fixedCode = fixedCode
                     .replace(/&amp;/g, '&')
                     .replace(/&lt;br&gt;/g, '<br>') // Handle HTML line breaks first
                     .replace(/&lt;/g, '<')
                     .replace(/&gt;/g, '>')
                     .replace(/&#39;/g, "'")
                     .replace(/&quot;/g, '"')
                     .replace(/&nbsp;/g, ' ')
                     .replace(/&apos;/g, "'");
                 
                 // Detect diagram type
                 const diagramType = detectDiagramType(fixedCode);
                 
                 // Handle unknown diagram types by converting to flowchart if possible
                 if (diagramType === 'unknown') {
                     console.warn('Unknown diagram type, attempting to render as-is');
                 }
                 
                 // Fix common syntax issues based on diagram type
                 switch (diagramType) {
                     case 'flowchart':
                         // Ensure flowchart has proper direction
                         if (!fixedCode.match(/(TD|TB|BT|RL|LR)/)) {
                             fixedCode = fixedCode.replace(/^(flowchart|graph)/, '$1 TD');
                         }
                         
                         // Fix specific pattern: node labels with <br> and file paths
                         // This pattern is causing the parser error: [Label<br>/path/file.xhtml]
                         fixedCode = fixedCode.replace(/\[([^\[\]]*)<br>([^\[\]]*)\]/g, (match, label, path) => {
                             // Clean the label and path, replace problematic characters
                             const cleanLabel = label.trim();
                             const cleanPath = path.trim()
                                 .replace(/\//g, '∕') // Replace forward slashes with math division symbol
                                 .replace(/\./g, '·'); // Replace dots with middle dot
                             return `["${cleanLabel}\\n${cleanPath}"]`; // Use quoted strings for safety
                         });
                         
                         // Handle similar pattern in parentheses
                         fixedCode = fixedCode.replace(/\(([^\(\)]*)<br>([^\(\)]*)\)/g, (match, label, path) => {
                             const cleanLabel = label.trim();
                             const cleanPath = path.trim()
                                 .replace(/\//g, '∕')
                                 .replace(/\./g, '·');
                             return `("${cleanLabel}\\n${cleanPath}")`;
                         });
                         
                         // Fix node labels with parentheses that can cause parsing issues
                         // Pattern: A[Label (with parentheses)] --> B
                         fixedCode = fixedCode.replace(/(\w+)\[([^\[\]]*\([^\[\]]*\)[^\[\]]*)\]/g, (match, nodeId, label) => {
                             // Wrap labels containing parentheses in quotes
                             const cleanLabel = label.replace(/"/g, '\\"'); // Escape existing quotes
                             return `${nodeId}["${cleanLabel}"]`;
                         });
                         
                         // Fix incomplete arrow syntax - ensure arrows have proper targets
                         // Pattern: A[Label] - (incomplete arrow at end of line)
                         fixedCode = fixedCode.replace(/(\w+\[[^\]]+\]|\w+\([^)]+\)|\w+)\s+--?\s*$/gm, (match, source) => {
                             // If we find an incomplete arrow at end of line, remove it entirely
                             console.warn('Removing incomplete arrow syntax:', match.trim());
                             return source.trim();
                         });
                         
                         // Fix common arrow syntax issues
                         fixedCode = fixedCode
                             .replace(/--&gt;/g, '-->')  // Fix any remaining HTML entities in arrows
                             .replace(/-->/g, ' --> ') // Ensure proper spacing around arrows
                             .replace(/\s+-->\s+/g, ' --> ') // Clean up multiple spaces
                             .replace(/\[\s+/g, '[') // Remove extra spaces after opening brackets
                             .replace(/\s+\]/g, ']') // Remove extra spaces before closing brackets
                             .replace(/\(\s+/g, '(') // Remove extra spaces after opening parentheses
                             .replace(/\s+\)/g, ')') // Remove extra spaces before closing parentheses
                             .replace(/\{\s+/g, '{') // Remove extra spaces after opening braces
                             .replace(/\s+\}/g, '}'); // Remove extra spaces before closing braces
                         
                         // Handle any remaining line breaks in node labels
                         fixedCode = fixedCode.replace(/<br>/gi, '\\n'); // Convert HTML breaks to Mermaid line breaks
                         
                         break;
                         
                     case 'mindmap':
                         // Ensure mindmap has proper structure
                         if (!fixedCode.includes('root(')) {
                             // If incomplete mindmap, add basic structure
                             const lines = fixedCode.split('\n');
                             if (lines.length > 1 && lines[0].trim() === 'mindmap') {
                                 // Wrap content in root node
                                 const content = lines.slice(1).join('\n').trim();
                                 if (content) {
                                     fixedCode = `mindmap\n  root((${content.split('\n')[0] || 'Root'}))\n${content}`;
                                 }
                             }
                         }
                         // Remove or fix invalid icon syntax for older versions
                         fixedCode = fixedCode.replace(/::icon\([^)]+\)/g, '');
                         break;
                         
                     case 'user-journey':
                         // Ensure journey diagram has proper structure
                         if (!fixedCode.includes('title')) {
                             const lines = fixedCode.split('\n');
                             if (lines.length > 1 && lines[0].trim() === 'journey') {
                                 lines.splice(1, 0, '    title User Journey');
                                 fixedCode = lines.join('\n');
                             }
                         }
                         break;
                         
                     case 'timeline':
                         // Timeline diagrams should have proper structure
                         if (!fixedCode.includes('title')) {
                             const lines = fixedCode.split('\n');
                             if (lines.length > 1 && lines[0].trim() === 'timeline') {
                                 lines.splice(1, 0, '  title Timeline');
                                 fixedCode = lines.join('\n');
                             }
                         }
                         break;
                 }
                 
                 // Final cleanup - remove any remaining problematic characters
                 fixedCode = fixedCode
                     .replace(/\r\n/g, '\n') // Normalize line endings
                     .replace(/\r/g, '\n')   // Convert old Mac line endings
                     .split('\n')
                     .map(line => line.trimRight()) // Remove trailing whitespace from each line
                     .join('\n')
                     .replace(/\n\s*\n\s*\n/g, '\n\n'); // Remove excessive blank lines
                 
                 return fixedCode;
             }
             
             // Function to re-render diagrams when theme changes
             function updateMermaidTheme() {
                 const isDarkMode = document.documentElement.classList.contains('dark-mode') || 
                                   document.documentElement.getAttribute('data-theme') === 'dark' ||
                                   window.matchMedia('(prefers-color-scheme: dark)').matches;
                 
                 try {
                     console.log(`Updating Mermaid theme to ${isDarkMode ? 'dark' : 'light'} mode`);
                     
                     // Step 1: Clear all existing rendered containers and reset processed state
                     const containers = document.querySelectorAll('.mermaid-container');
                     const preBlocks = document.querySelectorAll('pre.mermaid');
                     
                     containers.forEach(container => {
                         container.remove();
                     });
                     
                     preBlocks.forEach(preBlock => {
                         preBlock.classList.remove('mermaid-processed');
                         preBlock.style.display = 'block'; // Show original blocks temporarily
                     });
                     
                     // Step 2: Re-initialize Mermaid with new theme configuration
                     initializeMermaidRendering(); // Use the same initialization function as initial load
                     
                     // Step 3: Re-render all diagrams using the complete rendering process
                     setTimeout(() => {
                         renderMermaidDiagrams(); // Use the same rendering function as initial load
                         console.log(`Mermaid theme successfully updated to ${isDarkMode ? 'dark' : 'light'} mode`);
                     }, 100); // Small delay to ensure initialization is complete
                     
                 } catch (error) {
                     console.error('Error updating Mermaid theme:', error);
                 }
             }
         
             // --- RUN EVERYTHING ---
             // Add a small delay to ensure DOM is fully loaded
             setTimeout(() => {
                 init();
             }, 10);
         
         });
      </script>

   </body>
</html>
